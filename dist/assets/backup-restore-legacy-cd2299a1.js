System.register(["./index-legacy-525baae1.js","./index-legacy-1cd78d63.js"],(function(e,t){"use strict";var n,s,r,a,i,c,o,l,m,g,u,d,f;return{setters:[e=>{n=e.d,s=e.e,r=e.a,a=e.b6,i=e.f,c=e.a0,o=e.B,l=e.W,m=e.v,g=e.bc,u=e.h,d=e.n},e=>{f=e.o}],execute:function(){const t={success:{icon:"✅",color:"$success9"},error:{icon:"❌",color:"$danger9"},info:{icon:"ℹ️",color:"$info9"}},p=e=>i(c,{w:"$full",spacing:"$1",get children(){return[i(g,{get children(){return t[e.type].icon}}),i(g,{get color(){return t[e.type].color},get children(){return e.msg}})]}});e("default",(()=>{const e=n();let t;f("manage.sidemenu.backup-restore");const[g,b]=s([]),h=(e,n)=>{b((t=>[...t,{type:n,msg:e}])),t.scrollTop=t.scrollHeight},[_,y]=r((()=>a.get("/admin/setting/list"))),[$,k]=r((()=>a.get("/admin/user/list"))),[w,v]=r((()=>a.get("/admin/meta/list"))),[j,x]=r((()=>a.get("/admin/storage/list"))),L=async()=>{h(e("br.start_backup"),"info");const t={settings:[],users:[],storages:[],metas:[]};for(const n of[{name:"settings",fn:y,page:!1},{name:"users",fn:k,page:!0},{name:"storages",fn:x,page:!0},{name:"metas",fn:v,page:!0}]){const s=await n.fn();u(s,(s=>{h(e("br.success_backup_item",{item:e(`manage.sidemenu.${n.name}`)}),"success"),n.page?t[n.name]=s.content:t[n.name]=s}),(t=>{h(e("br.failed_backup_item",{item:e(`manage.sidemenu.${n.name}`)})+":"+t,"error")}))}!function(e,t){const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=e,r.click(),URL.revokeObjectURL(s)}("alist_backup_"+(new Date).toLocaleString()+".json",t),h(e("br.finish_backup"),"info")},[R,S]=r((e=>a.post("/admin/setting/save",e))),[O,U]=r((e=>a.post("/admin/user/create",e))),[B,C]=r((e=>a.post("/admin/storage/create",e))),[E,I]=r((e=>a.post("/admin/meta/create",e)));return i(l,{spacing:"$2",w:"$full",get children(){return[i(c,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[i(o,{get loading(){return _()||$()||w()||j()},onClick:()=>{L()},colorScheme:"accent",get children(){return e("br.backup")}}),i(o,{get loading(){return R()||O()||B()||E()},onClick:()=>{(async()=>{h(e("br.start_restore"),"info");const t=document.createElement("input");t.type="file",t.accept="application/json",t.onchange=async t=>{const n=t.target.files;if(!n||0===n.length)return void d.warning(e("br.no_file"));const s=n[0],r=new FileReader;r.onload=async()=>{const t=JSON.parse(r.result);t.settings&&u(await S(t.settings.filter((e=>!["version","index_progress"].includes(e.key)))),(()=>{h(e("br.success_restore_item",{item:e("manage.sidemenu.settings")}),"success")}),(t=>{h(e("br.failed_restore_item",{item:e("manage.sidemenu.settings")})+":"+t,"error")}));for(const n of[{name:"users",fn:U,data:t.users,key:"username"},{name:"storages",fn:C,data:t.storages,key:"mount_path"},{name:"metas",fn:I,data:t.metas,key:"path"}])for(const t of n.data||[])t.id=0,u(await n.fn(t),(()=>{h(e("br.success_restore_item",{item:e(`manage.sidemenu.${n.name}`)})+"-"+`[${t[n.key]}]`,"success")}),(s=>{h(e("br.failed_restore_item",{item:e(`manage.sidemenu.${n.name}`)})+` [ ${t[n.key]} ] :`+s,"error")}));h(e("br.finish_restore"),"info")},r.readAsText(s)},t.click()})()},get children(){return e("br.restore")}})]}}),i(l,{p:"$2",ref(e){"function"==typeof t?t(e):t=e},w:"$full",alignItems:"start",rounded:"$md",h:"70vh",bg:"$neutral3",overflowY:"auto",spacing:"$1",get children(){return i(m,{get each(){return g()},children:e=>i(p,e)})}})]}})}))}}}));
