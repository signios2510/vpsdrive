import{cq as Ue,cr as Re}from"./index.af08b204.js";function we(Ie){throw new Error('Could not dynamically require "'+Ie+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ve={exports:{}};/*!
 * artplayer.js v4.6.2
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2023 Harvey Zack
 * Released under the MIT License.
 */(function(Ie,Ne){(function(B,$,K,M,O){var R=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Re<"u"?Re:{},s=typeof R[M]=="function"&&R[M],D=s.cache||{},g=typeof we=="function"&&we.bind(Ie);function b(x,E){if(!D[x]){if(!B[x]){var T=typeof R[M]=="function"&&R[M];if(!E&&T)return T(x,!0);if(s)return s(x,!0);if(g&&typeof x=="string")return g(x);var L=new Error("Cannot find module '"+x+"'");throw L.code="MODULE_NOT_FOUND",L}r.resolve=function(_){var v=B[x][1][_];return v!=null?v:_},r.cache={};var I=D[x]=new b.Module(x);B[x][0].call(I.exports,r,I,I.exports,this)}return D[x].exports;function r(_){var v=r.resolve(_);return v===!1?{}:b(v)}}b.isParcelRequire=!0,b.Module=function(x){this.id=x,this.bundle=b,this.exports={}},b.modules=B,b.cache=D,b.parent=s,b.register=function(x,E){B[x]=[function(T,L){L.exports=E},{}]},Object.defineProperty(b,"root",{get:function(){return R[M]}}),R[M]=b;for(var c=0;c<$.length;c++)b($[c]);if(K){var C=b(K);Ie.exports=C}})({"5lTcX":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("bundle-text:./style/index.less"),R=M.interopDefault(O),s=B("option-validator"),D=M.interopDefault(s),g=B("./utils/emitter"),b=M.interopDefault(g),c=B("./utils"),C=B("./scheme"),x=M.interopDefault(C),E=B("./config"),T=M.interopDefault(E),L=B("./whitelist"),I=M.interopDefault(L),r=B("./template"),_=M.interopDefault(r),v=B("./i18n"),n=M.interopDefault(v),l=B("./player"),i=M.interopDefault(l),a=B("./control"),m=M.interopDefault(a),p=B("./contextmenu"),o=M.interopDefault(p),d=B("./info"),A=M.interopDefault(d),u=B("./subtitle"),f=M.interopDefault(u),t=B("./events"),h=M.interopDefault(t),e=B("./hotkey"),y=M.interopDefault(e),P=B("./layer"),S=M.interopDefault(P),w=B("./loading"),k=M.interopDefault(w),F=B("./notice"),U=M.interopDefault(F),N=B("./mask"),j=M.interopDefault(N),W=B("./icons"),H=M.interopDefault(W),G=B("./setting"),V=M.interopDefault(G),Y=B("./storage"),Q=M.interopDefault(Y),z=B("./plugins"),X=M.interopDefault(z),q=B("./mobile"),te=M.interopDefault(q);let ee=0;const Z=[];class J extends b.default{constructor(ne,ue){super(),this.id=++ee;const oe=c.mergeDeep(J.option,ne);if(this.option=(0,D.default)(oe,x.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isRotate=!1,this.isDestroy=!1,this.whitelist=new I.default(this),this.template=new _.default(this),this.events=new h.default(this),this.whitelist.state?(this.storage=new Q.default(this),this.icons=new H.default(this),this.i18n=new n.default(this),this.notice=new U.default(this),this.player=new i.default(this),this.layers=new S.default(this),this.controls=new m.default(this),this.contextmenu=new o.default(this),this.subtitle=new f.default(this),this.info=new A.default(this),this.loading=new k.default(this),this.hotkey=new y.default(this),this.mask=new j.default(this),this.setting=new V.default(this),this.plugins=new X.default(this)):this.mobile=new te.default(this),typeof ue=="function"&&this.on("ready",()=>ue.call(this,this)),J.DEBUG){const le=ae=>console.log(`[ART.${this.id}] -> ${ae}`);le("Version@"+J.version),le("Env@"+J.env),le("Build@"+J.build);for(let ae=0;ae<T.default.events.length;ae++)this.on("video:"+T.default.events[ae],se=>le("Event@"+se.type))}Z.push(this)}static get instances(){return Z}static get version(){return"4.6.2"}static get env(){return"production"}static get build(){return"2023-01-26 15:26:58"}static get config(){return T.default}static get utils(){return c}static get scheme(){return x.default}static get Emitter(){return b.default}static get validator(){return D.default}static get kindOf(){return D.default.kindOf}static get html(){return _.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},escape:!0,encoding:"utf-8"},moreVideoAttr:{controls:!1,preload:c.isSafari?"auto":"metadata"},i18n:{},icons:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}get video(){return this.template.$video}destroy(ne=!0){this.events.destroy(),this.template.destroy(ne),Z.splice(Z.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}if(K.default=J,J.DEBUG=!1,J.CONTEXTMENU=!0,J.NOTICE_TIME=2e3,J.SETTING_WIDTH=250,J.SETTING_ITEM_WIDTH=200,J.SETTING_ITEM_HEIGHT=35,J.INDICATOR_SIZE=14,J.INDICATOR_SIZE_ICON=16,J.INDICATOR_SIZE_MOBILE=18,J.INDICATOR_SIZE_MOBILE_ICON=20,J.VOLUME_PANEL_WIDTH=60,J.VOLUME_HANDLE_WIDTH=12,J.RESIZE_TIME=500,J.SCROLL_TIME=200,J.SCROLL_GAP=50,J.AUTO_PLAYBACK_MAX=10,J.AUTO_PLAYBACK_MIN=5,J.AUTO_PLAYBACK_TIMEOUT=3e3,J.RECONNECT_TIME_MAX=5,J.RECONNECT_SLEEP_TIME=1e3,J.CONTROL_HIDE_TIME=3e3,J.DB_CLICE_TIME=300,J.MOBILE_AUTO_PLAYBACKRATE=3,J.MOBILE_AUTO_PLAYBACKRATE_TIME=1e3,J.MOBILE_AUTO_ORIENTATION_TIME=200,J.INFO_LOOP_TIME=1e3,J.FAST_FORWARD_VALUE=3,J.FAST_FORWARD_TIME=1e3,J.TOUCH_MOVE_RATIO=.5,J.VOLUME_STEP=.1,J.SEEK_STEP=5,J.PROGRESS_HEIGHT=6,J.PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2],J.ASPECT_RATIO=["default","4:3","16:9"],J.FLIP=["normal","horizontal","vertical"],J.FULLSCREEN_WEB_IN_BODY=!1,typeof document<"u"&&!document.getElementById("artplayer-style")){const ie=c.createElement("style");ie.id="artplayer-style",ie.textContent=R.default,document.head.appendChild(ie)}typeof window<"u"&&(window.Artplayer=J),console.log(`%c ArtPlayer %c ${J.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},{"bundle-text:./style/index.less":"0016T","option-validator":"bAWi2","./utils/emitter":"66mFZ","./utils":"71aH7","./scheme":"AKEiO","./config":"lyjeQ","./whitelist":"9L0ao","./template":"X13Zf","./i18n":"3jKkj","./player":"a90nx","./control":"8Z0Uf","./contextmenu":"2KYsr","./info":"02ajl","./subtitle":"eSWto","./events":"jo4S1","./hotkey":"6NoFy","./layer":"6G6hZ","./loading":"3dsEe","./notice":"dWGTw","./mask":"5POkG","./icons":"6OeNg","./setting":"3eYNH","./storage":"2aaJe","./plugins":"8MTUM","./mobile":"7mil2","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"0016T":[function(B,$,K){$.exports='.art-video-player{z-index:20;width:100%;height:100%;zoom:1;color:#eee;text-align:left;direction:ltr;user-select:none;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#000;outline:0;margin:0 auto;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.3;display:flex;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{width:5px;height:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-video-player .art-video{z-index:10;width:100%;height:100%;cursor:pointer;background-color:#000;position:absolute;inset:0}.art-video-player .art-poster{z-index:11;width:100%;height:100%;user-select:none;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;width:100%;text-align:center;color:#fff;pointer-events:none;text-shadow:1px 0 1px #000,0 1px 1px #000,-1px 0 1px #000,0 -1px 1px #000,1px 1px 1px #000,-1px -1px 1px #000,1px -1px 1px #000,-1px 1px 1px #000;padding:0 20px;font-size:20px;transition:bottom .2s;display:none;position:absolute;bottom:10px}.art-video-player .art-subtitle p{word-break:break-all;height:fit-content;margin:5px 0 0;line-height:1.2}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{z-index:50;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-mask .art-state{width:60px;height:60px;opacity:.85;cursor:pointer;pointer-events:auto;justify-content:center;align-items:center;display:flex;position:absolute;bottom:65px;right:30px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player.art-mobile .art-state{position:static}.art-video-player .art-loading{z-index:70;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;height:100px;opacity:0;visibility:hidden;pointer-events:none;background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:space-between;padding:50px 10px 0;transition:all .2s ease-in-out;display:flex;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-bottom .art-progress{z-index:0;pointer-events:auto;flex:1;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress{height:4px;cursor:pointer;flex-direction:row;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{height:50%;width:100%;background:#fff3;align-items:center;transition:all .2s;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;height:100%;width:0;background:#fff6;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;height:100%;width:0;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;height:100%;pointer-events:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{width:7px;height:100%;pointer-events:auto;background:#ffffff80;display:inline-block;position:absolute;top:0;left:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:hidden;z-index:40;border-radius:50%;justify-content:center;align-items:center;transition:transform .1s ease-in-out;position:absolute;transform:scale(.1)}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{width:100%;height:100%;pointer-events:none;user-select:none}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:hover{transform:scale(1.2)!important}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;height:20px;color:#fff;text-align:center;white-space:nowrap;background:#000000b3;border-radius:3px;padding:0 5px;font-size:12px;font-weight:700;line-height:20px;display:none;position:absolute;top:-25px;left:0}.art-video-player .art-bottom .art-progress .art-control-thumbnails{pointer-events:none;background-color:#000000b3;border-radius:3px;display:none;position:absolute;bottom:10px;left:0;box-shadow:0 1px 3px #0003,0 1px 2px -1px #0003}.art-video-player .art-bottom .art-progress .art-control-loop{width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{width:2px;height:8px;background:#ffffffbf;position:absolute;top:-2px;left:0}.art-video-player .art-bottom .art-controls{z-index:1;pointer-events:auto;height:45px;justify-content:space-between;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-controls-center{height:100%;flex:1;justify-content:center;align-items:center;padding:0 10px;display:flex}.art-video-player .art-bottom .art-controls .art-controls-right{justify-content:flex-end}.art-video-player .art-bottom .art-controls .art-control{opacity:.75;min-height:36px;min-width:36px;text-align:center;cursor:pointer;white-space:nowrap;justify-content:center;align-items:center;font-size:12px;line-height:1;transition:opacity .1s ease-in-out;display:flex}.art-video-player .art-bottom .art-controls .art-control .art-icon{float:left;height:36px;width:36px;justify-content:center;align-items:center;transition:transform .2s ease-in-out;display:flex;transform:scale(1)}.art-video-player .art-bottom .art-controls .art-control .art-icon:active{transform:scale(.85)}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;width:0;height:100%;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);position:relative;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{width:12px;height:12px;background:#fff;border-radius:12px;margin-top:-6px;position:absolute;top:50%;left:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:#fff3;left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{content:"";height:3px;width:60px;margin-top:-2px;display:block;position:absolute;top:50%}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{z-index:30;position:relative}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{width:100px;text-align:center;color:#fff;background:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;line-height:30px;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:#ffffff1a}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:visible;transform:scale(1)}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-error .art-progress-indicator,.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-error .art-progress-tip,.art-video-player.art-destroy .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-bottom{height:105px;padding:50px 7px 0}.art-video-player.art-mobile .art-bottom .art-controls{height:40px}.art-video-player.art-mobile .art-bottom .art-progress-indicator{visibility:visible!important;transform:scale(1)!important}.art-video-player .art-notice{z-index:80;width:100%;pointer-events:none;padding:10px;font-size:14px;display:none;position:absolute;top:0;left:0}.art-video-player .art-notice .art-notice-inner{color:#fff;background-color:#0009;border-radius:3px;padding:5px 10px;display:inline-block}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;min-width:200px;background-color:#000000e6;border-radius:3px;flex-direction:column;padding:5px 0;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;color:#fff;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;border-bottom:1px solid #ffffff1a;padding:10px 15px;font-size:12px;display:block;overflow:hidden}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 7px;display:inline-block}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:var(--theme)}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;height:auto;max-height:300px;background-color:#000000e6;border-radius:3px;font-size:13px;transition:all .2s;display:none;position:absolute;bottom:60px;left:0;overflow:auto}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{height:35px;cursor:pointer;color:#fffc;justify-content:space-between;align-items:center;padding:0 5px;line-height:1;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{color:#fff;background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:var(--theme)}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{width:30px;height:30px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{white-space:nowrap;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:24px;width:24px;justify-content:center;align-items:center;margin-right:10px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80;margin-right:5px;font-size:12px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{height:24px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{height:3px;width:80px;appearance:none;background-color:#fff3;outline:none}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player.art-mobile .art-settings{max-height:200px}.art-video-player .art-info{z-index:100;width:350px;color:#fff;-webkit-font-smoothing:antialiased;background-color:#000000e6;flex-direction:column;padding:10px;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-info .art-info-item{margin-bottom:5px;display:flex}.art-video-player .art-info .art-info-item .art-info-title{width:100px;text-align:right}.art-video-player .art-info .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;user-select:all;flex:1;padding-left:5px;overflow:hidden}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;object-fit:fill}.art-video-player.art-fullscreen-web{z-index:9999;width:100%;height:100%;position:fixed;inset:0}.art-video-player .art-mini-header{z-index:110;height:35px;color:#fff;opacity:0;visibility:hidden;background-color:#00000080;justify-content:space-between;align-items:center;line-height:35px;transition:all .2s ease-in-out;display:none;position:absolute;top:0;left:0;right:0}.art-video-player .art-mini-header .art-mini-title{text-overflow:ellipsis;white-space:nowrap;cursor:move;flex:1;padding:0 10px;overflow:hidden}.art-video-player .art-mini-header .art-mini-close{width:35px;text-align:center;cursor:pointer;font-size:22px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{z-index:9999;width:400px;height:225px;position:fixed;box-shadow:0 2px 5px #00000029,0 3px 6px #0003}.art-video-player.art-mini .art-mini-header{user-select:none;display:flex}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-settings,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{justify-content:center;align-items:center;display:flex}.art-auto-size .art-video-player{transition:all .2s}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-miniProgressBar{height:2px;background-color:var(--theme);display:block;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-layer-lock{height:34px;width:34px;color:#fff;background-color:#00000080;border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;top:calc(50% - 17px);left:15px}.art-video-player .art-layer-autoPlayback{background-color:#000c;border-radius:3px;align-items:center;padding:10px;line-height:1;display:none;position:absolute;bottom:60px;left:20px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close{cursor:pointer;align-items:center;margin-right:10px;display:flex}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close svg{width:15px;height:15px;fill:var(--theme)}.art-video-player .art-layer-autoPlayback .art-autoPlayback-last{margin-right:10px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-jump{color:var(--theme);cursor:pointer}.art-video-player.art-lock .art-bottom{display:none!important}.art-video-player.art-lock .art-subtitle{bottom:10px!important}.art-video-player.art-lock .art-layer-miniProgressBar{display:block!important}.art-video-player.art-control-show .art-layer-miniProgressBar{display:none}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{min-width:100px;max-width:200px;max-height:200px;text-align:center;color:#fff;background-color:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px;overflow:auto}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;padding:0 5px;line-height:30px;overflow:hidden}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover,.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current{color:var(--theme)}.art-video-player .art-control-selector:hover .art-selector-list{display:block}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}'},{}],bAWi2:[function(B,$,K){$.exports=function(){function M(c){return(M=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C})(c)}var O=Object.prototype.toString,R=function(c){if(c===void 0)return"undefined";if(c===null)return"null";var C=M(c);if(C==="boolean")return"boolean";if(C==="string")return"string";if(C==="number")return"number";if(C==="symbol")return"symbol";if(C==="function")return function(x){return s(x)==="GeneratorFunction"}(c)?"generatorfunction":"function";if(function(x){return Array.isArray?Array.isArray(x):x instanceof Array}(c))return"array";if(function(x){return!(!x.constructor||typeof x.constructor.isBuffer!="function")&&x.constructor.isBuffer(x)}(c))return"buffer";if(function(x){try{if(typeof x.length=="number"&&typeof x.callee=="function")return!0}catch(E){if(E.message.indexOf("callee")!==-1)return!0}return!1}(c))return"arguments";if(function(x){return x instanceof Date||typeof x.toDateString=="function"&&typeof x.getDate=="function"&&typeof x.setDate=="function"}(c))return"date";if(function(x){return x instanceof Error||typeof x.message=="string"&&x.constructor&&typeof x.constructor.stackTraceLimit=="number"}(c))return"error";if(function(x){return x instanceof RegExp||typeof x.flags=="string"&&typeof x.ignoreCase=="boolean"&&typeof x.multiline=="boolean"&&typeof x.global=="boolean"}(c))return"regexp";switch(s(c)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(x){return typeof x.throw=="function"&&typeof x.return=="function"&&typeof x.next=="function"}(c))return"generator";switch(C=O.call(c)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return C.slice(8,-1).toLowerCase().replace(/\s/g,"")};function s(c){return c.constructor?c.constructor.name:null}function D(c,C){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return g(c,C,x),b(c,C,x),function(E,T,L){var I=R(T),r=R(E);if(I==="object"){if(r!=="object")throw new Error("[Type Error]: '".concat(L.join("."),"' require 'object' type, but got '").concat(r,"'"));Object.keys(T).forEach(function(_){var v=E[_],n=T[_],l=L.slice();l.push(_),g(v,n,l),b(v,n,l),D(v,n,l)})}if(I==="array"){if(r!=="array")throw new Error("[Type Error]: '".concat(L.join("."),"' require 'array' type, but got '").concat(r,"'"));E.forEach(function(_,v){var n=E[v],l=T[v]||T[0],i=L.slice();i.push(v),g(n,l,i),b(n,l,i),D(n,l,i)})}}(c,C,x),c}function g(c,C,x){if(R(C)==="string"){var E=R(c);if(C[0]==="?"&&(C=C.slice(1)+"|undefined"),!(-1<C.indexOf("|")?C.split("|").map(function(T){return T.toLowerCase().trim()}).filter(Boolean).some(function(T){return E===T}):C.toLowerCase().trim()===E))throw new Error("[Type Error]: '".concat(x.join("."),"' require '").concat(C,"' type, but got '").concat(E,"'"))}}function b(c,C,x){if(R(C)==="function"){var E=C(c,R(c),x);if(E!==!0){var T=R(E);throw T==="string"?new Error(E):T==="error"?E:new Error("[Validator Error]: The scheme for '".concat(x.join("."),"' validator require return true, but got '").concat(E,"'"))}}}return D.kindOf=R,D}()},{}],"66mFZ":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default=class{on(M,O,R){const s=this.e||(this.e={});return(s[M]||(s[M]=[])).push({fn:O,ctx:R}),this}once(M,O,R){const s=this;function D(...g){s.off(M,D),O.apply(R,g)}return D._=O,this.on(M,D,R)}emit(M,...O){const R=((this.e||(this.e={}))[M]||[]).slice();for(let s=0;s<R.length;s+=1)R[s].fn.apply(R[s].ctx,O);return this}off(M,O){const R=this.e||(this.e={}),s=R[M],D=[];if(s&&O)for(let g=0,b=s.length;g<b;g+=1)s[g].fn!==O&&s[g].fn._!==O&&D.push(s[g]);return D.length?R[M]=D:delete R[M],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(B,$,K){K.interopDefault=function(M){return M&&M.__esModule?M:{default:M}},K.defineInteropFlag=function(M){Object.defineProperty(M,"__esModule",{value:!0})},K.exportAll=function(M,O){return Object.keys(M).forEach(function(R){R==="default"||R==="__esModule"||O.hasOwnProperty(R)||Object.defineProperty(O,R,{enumerable:!0,get:function(){return M[R]}})}),O},K.export=function(M,O,R){Object.defineProperty(M,O,{enumerable:!0,get:R})}},{}],"71aH7":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./dom");M.exportAll(O,K);var R=B("./error");M.exportAll(R,K);var s=B("./subtitle");M.exportAll(s,K);var D=B("./file");M.exportAll(D,K);var g=B("./property");M.exportAll(g,K);var b=B("./time");M.exportAll(b,K);var c=B("./format");M.exportAll(c,K);var C=B("./compatibility");M.exportAll(C,K)},{"./dom":"bSNiV","./error":"hwmZz","./subtitle":"inzwq","./file":"6b7Ip","./property":"5NSdr","./time":"epmNy","./format":"gapRl","./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bSNiV:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K),M.export(K,"query",()=>R),M.export(K,"queryAll",()=>s),M.export(K,"addClass",()=>D),M.export(K,"removeClass",()=>g),M.export(K,"hasClass",()=>b),M.export(K,"append",()=>c),M.export(K,"remove",()=>C),M.export(K,"setStyle",()=>x),M.export(K,"setStyles",()=>E),M.export(K,"getStyle",()=>T),M.export(K,"sublings",()=>L),M.export(K,"inverseClass",()=>I),M.export(K,"tooltip",()=>r),M.export(K,"isInViewport",()=>_),M.export(K,"includeFromEvent",()=>v),M.export(K,"replaceElement",()=>n),M.export(K,"createElement",()=>l);var O=B("./compatibility");function R(i,a=document){return a.querySelector(i)}function s(i,a=document){return Array.from(a.querySelectorAll(i))}function D(i,a){return i.classList.add(a)}function g(i,a){return i.classList.remove(a)}function b(i,a){return i.classList.contains(a)}function c(i,a){return a instanceof Element?i.appendChild(a):i.insertAdjacentHTML("beforeend",String(a)),i.lastElementChild||i.lastChild}function C(i){return i.parentNode.removeChild(i)}function x(i,a,m){return i.style[a]=m,i}function E(i,a){return Object.keys(a).forEach(m=>{x(i,m,a[m])}),i}function T(i,a,m=!0){const p=window.getComputedStyle(i,null).getPropertyValue(a);return m?parseFloat(p):p}function L(i){return Array.from(i.parentElement.children).filter(a=>a!==i)}function I(i,a){L(i).forEach(m=>g(m,a)),D(i,a)}function r(i,a,m="top"){O.isMobile||(i.setAttribute("aria-label",a),D(i,"hint--rounded"),D(i,`hint--${m}`))}function _(i,a=0){const m=i.getBoundingClientRect(),p=window.innerHeight||document.documentElement.clientHeight,o=window.innerWidth||document.documentElement.clientWidth,d=m.top-a<=p&&m.top+m.height+a>=0,A=m.left-a<=o+a&&m.left+m.width+a>=0;return d&&A}function v(i,a){return i.composedPath&&i.composedPath().indexOf(a)>-1}function n(i,a){return a.parentNode.replaceChild(i,a),i}function l(i){return document.createElement(i)}},{"./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6ZTr6":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K),M.export(K,"userAgent",()=>O),M.export(K,"isMobile",()=>R),M.export(K,"isSafari",()=>s),M.export(K,"isWechat",()=>D),M.export(K,"isIE",()=>g),M.export(K,"isAndroid",()=>b),M.export(K,"isIOS",()=>c);const O=typeof window<"u"?window.navigator.userAgent:"",R=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(O),s=/^((?!chrome|android).)*safari/i.test(O),D=/MicroMessenger/i.test(O),g=/MSIE|Trident/i.test(O),b=/android/i.test(O),c=/iPad|iPhone|iPod/i.test(O)&&!window.MSStream},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hwmZz:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K),M.export(K,"ArtPlayerError",()=>O),M.export(K,"errorHandle",()=>R);class O extends Error{constructor(D,g){super(D),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,g||this.constructor),this.name="ArtPlayerError"}}function R(s,D){if(!s)throw new O(D);return s}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],inzwq:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");function O(D){return`WEBVTT \r
\r
`.concat((g=D,g.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(b,c,C)=>{let x=C.slice(0,3);return C.length===1&&(x=C+"00"),C.length===2&&(x=C+"0"),`${c},${x}`})).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`));var g}function R(D){return URL.createObjectURL(new Blob([D],{type:"text/vtt"}))}function s(D){const g=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function b(c=""){return c.split(/[:.]/).map((C,x,E)=>{if(x===E.length-1){if(C.length===1)return`.${C}00`;if(C.length===2)return`.${C}0`}else if(C.length===1)return(x===0?"0":":0")+C;return x===0?C:x===E.length-1?`.${C}`:`:${C}`}).join("")}return`WEBVTT

${D.split(/\r?\n/).map(c=>{const C=c.match(g);return C?{start:b(C[1].trim()),end:b(C[2].trim()),text:C[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(x=>x.trim()).join(`
`)}:null}).filter(c=>c).map((c,C)=>c?`${C+1}
${c.start} --> ${c.end}
${c.text}`:"").filter(c=>c.trim()).join(`

`)}`}M.defineInteropFlag(K),M.export(K,"srtToVtt",()=>O),M.export(K,"vttToBlob",()=>R),M.export(K,"assToVtt",()=>s)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6b7Ip":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");function O(s){return s.includes("?")?O(s.split("?")[0]):s.includes("#")?O(s.split("#")[0]):s.trim().toLowerCase().split(".").pop()}function R(s,D){const g=document.createElement("a");g.style.display="none",g.href=s,g.download=D,document.body.appendChild(g),g.click(),document.body.removeChild(g)}M.defineInteropFlag(K),M.export(K,"getExt",()=>O),M.export(K,"download",()=>R)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5NSdr":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K),M.export(K,"def",()=>O),M.export(K,"has",()=>s),M.export(K,"get",()=>D),M.export(K,"mergeDeep",()=>g);const O=Object.defineProperty,{hasOwnProperty:R}=Object.prototype;function s(b,c){return R.call(b,c)}function D(b,c){return Object.getOwnPropertyDescriptor(b,c)}function g(...b){const c=C=>C&&typeof C=="object"&&!Array.isArray(C);return b.reduce((C,x)=>(Object.keys(x).forEach(E=>{const T=C[E],L=x[E];Array.isArray(T)&&Array.isArray(L)?C[E]=T.concat(...L):!c(T)||!c(L)||L instanceof Element?C[E]=L:C[E]=g(T,L)}),C),{})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],epmNy:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");function O(D=0){return new Promise(g=>setTimeout(g,D))}function R(D,g,b){let c;function C(...x){clearTimeout(c),c=setTimeout(function(){c=null,D.apply(b,x)},g)}return C.clearTimeout=function(){clearTimeout(c)},C}function s(D,g){let b,c,C=!1;return function x(...E){if(C)return b=E,void(c=this);C=!0,D.apply(this,E),setTimeout(()=>{C=!1,b&&(x.apply(c,b),b=null,c=null)},g)}}M.defineInteropFlag(K),M.export(K,"sleep",()=>O),M.export(K,"debounce",()=>R),M.export(K,"throttle",()=>s)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gapRl:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");function O(b,c,C){return Math.max(Math.min(b,Math.max(c,C)),Math.min(c,C))}function R(b){return b.charAt(0).toUpperCase()+b.slice(1)}function s(b){return["string","number"].includes(typeof b)}function D(b){const c=Math.floor(b/3600),C=Math.floor((b-3600*c)/60),x=Math.floor(b-3600*c-60*C);return(c>0?[c,C,x]:[C,x]).map(E=>E<10?`0${E}`:String(E)).join(":")}function g(b){return b.replace(/[&<>'"]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[c]||c)}M.defineInteropFlag(K),M.export(K,"clamp",()=>O),M.export(K,"capitalize",()=>R),M.export(K,"isStringOrNumber",()=>s),M.export(K,"secondToTime",()=>D),M.export(K,"escape",()=>g)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],AKEiO:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K),M.export(K,"ComponentOption",()=>x);var O=B("../utils");const R="array",s="boolean",D="string",g="number",b="object",c="function";function C(E,T,L){return(0,O.errorHandle)(T===D||T===g||E instanceof Element,`${L.join(".")} require '${D}' or 'Element' type`)}const x={html:C,disable:`?${s}`,name:`?${D}`,index:`?${g}`,style:`?${b}`,click:`?${c}`,mounted:`?${c}`,tooltip:`?${D}|${g}`,width:`?${g}`,selector:`?${R}`,onSelect:`?${c}`,switch:`?${s}`,onSwitch:`?${c}`,range:`?${R}`,onRange:`?${c}`,onChange:`?${c}`};K.default={id:D,container:C,url:D,poster:D,title:D,type:D,theme:D,lang:D,volume:g,isLive:s,muted:s,autoplay:s,autoSize:s,autoMini:s,loop:s,flip:s,playbackRate:s,aspectRatio:s,screenshot:s,setting:s,hotkey:s,pip:s,mutex:s,backdrop:s,fullscreen:s,fullscreenWeb:s,subtitleOffset:s,miniProgressBar:s,useSSR:s,playsInline:s,lock:s,fastForward:s,autoPlayback:s,autoOrientation:s,airplay:s,plugins:[c],whitelist:[`${D}|${c}|regexp`],layers:[x],contextmenu:[x],settings:[x],controls:[{...x,position:(E,T,L)=>{const I=["top","left","right"];return(0,O.errorHandle)(I.includes(E),`${L.join(".")} only accept ${I.toString()} as parameters`)}}],quality:[{default:`?${s}`,html:D,url:D}],highlight:[{time:g,text:D}],thumbnails:{url:D,number:g,column:g,width:g,height:g},subtitle:{url:D,type:D,style:b,escape:s,encoding:D},moreVideoAttr:b,i18n:b,icons:b,customType:b}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lyjeQ:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9L0ao":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("./utils");K.default=class{constructor(O){this.art=O}get state(){const{option:O,constructor:{kindOf:R}}=this.art;return!M.isMobile||!O.whitelist.length||O.whitelist.some(s=>{switch(R(s)){case"string":return s==="*"||M.userAgent.indexOf(s)>-1;case"function":return s(M.userAgent);case"regexp":return s.test(M.userAgent);default:return!1}})}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],X13Zf:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("./utils");class O{constructor(s){this.art=s;const{option:D,constructor:g,whitelist:b}=s;D.container instanceof Element?this.$container=D.container:(this.$container=(0,M.query)(D.container),(0,M.errorHandle)(this.$container,`No container element found by ${D.container}`));const c=this.$container.tagName.toLowerCase();(0,M.errorHandle)(c==="div",`Unsupported container element type, only support 'div' but got '${c}'`),(0,M.errorHandle)(g.instances.every(C=>C.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=s.id,this.$original=this.$container.cloneNode(!0),b.state?this.desktop():this.mobile()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"><track default kind="metadata" src=""></track></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.6.2</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">\xD7</div></div><div class="art-contextmenus"></div></div>'}query(s){return(0,M.query)(s,this.$container)}desktop(){const{option:s}=this.art;s.useSSR||(this.$container.innerHTML=O.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$track=this.query("track"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),s.backdrop&&((0,M.addClass)(this.$setting,"art-backdrop-filter"),(0,M.addClass)(this.$contextmenu,"art-backdrop-filter"),(0,M.addClass)(this.$info,"art-backdrop-filter")),M.isMobile&&(0,M.addClass)(this.$player,"art-mobile")}mobile(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video")}destroy(s){s?(0,M.replaceElement)(this.$original,this.$container):(0,M.addClass)(this.$player,"art-destroy")}}K.default=O},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3jKkj":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("../utils"),R=B("./zh-cn.json"),s=M.interopDefault(R),D=B("./zh-tw.json"),g=M.interopDefault(D),b=B("./pl.json"),c=M.interopDefault(b),C=B("./cs.json"),x=M.interopDefault(C),E=B("./es.json"),T=M.interopDefault(E),L=B("./fa.json"),I=M.interopDefault(L);K.default=class{constructor(r){this.art=r,this.languages={"zh-cn":s.default,"zh-tw":g.default,pl:c.default,cs:x.default,es:T.default,fa:I.default},this.update(r.option.i18n)}init(){const r=this.art.option.lang.toLowerCase();this.language=this.languages[r]||{}}get(r){return this.language[r]||r}update(r){this.languages=(0,O.mergeDeep)(this.languages,r),this.init()}}},{"../utils":"71aH7","./zh-cn.json":"lNQi5","./zh-tw.json":"eRpom","./pl.json":"iEpPa","./cs.json":"dBgp3","./es.json":"dNIrL","./fa.json":"7Plhe","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lNQi5:[function(B,$,K){$.exports=JSON.parse('{"Video Info":"\u7EDF\u8BA1\u4FE1\u606F","Close":"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u6682\u505C","Rate":"\u901F\u5EA6","Mute":"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u8FDE\u63A5","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8BA4","Normal":"\u6B63\u5E38","Open":"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u5F00\u542F\u753B\u4E2D\u753B","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F6C\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],eRpom:[function(B,$,K){$.exports=JSON.parse('{"Video Info":"\u7D71\u8A08\u8A0A\u606F","Close":"\u95DC\u9589","Video Load Failed":"\u8F09\u5165\u5931\u6557","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u66AB\u505C","Rate":"\u901F\u5EA6","Mute":"\u975C\u97F3","Video Flip":"\u756B\u9762\u7FFB\u8F49","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u9023\u63A5","Show Setting":"\u986F\u793A\u8BBE\u7F6E","Hide Setting":"\u96B1\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u5716","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u756B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8A8D","Normal":"\u6B63\u5E38","Open":"\u6253\u958B","Switch Video":"\u5207\u63DB","Switch Subtitle":"\u5207\u63DB\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7DB2\u9801\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u958B\u555F\u756B\u4E2D\u756B","Exit PIP Mode":"\u9000\u51FA\u756B\u4E2D\u756B","PIP Not Supported":"\u4E0D\u652F\u6301\u756B\u4E2D\u756B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F49\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],iEpPa:[function(B,$,K){$.exports=JSON.parse('{"Video Info":"Informacje o wideo","Close":"Zamknij","Video Load Failed":"B\u0142\u0105d \u0142adowania wideo","Volume":"G\u0142o\u015Bno\u015B\u0107","Play":"Odtw\xF3rz","Pause":"Wstrzymaj","Rate":"Oce\u0144","Mute":"Wycisz","Video Flip":"Rotacja wideo","Horizontal":"Pozioma","Vertical":"Pionowa","Reconnect":"Po\u0142\u0105cz ponownie","Show Setting":"Poka\u017C ustawienia","Hide Setting":"Ukryj ustawienia","Screenshot":"Zrzut ekranu","Play Speed":"Pr\u0119dko\u015B\u0107 odtwarzania","Aspect Ratio":"Wsp\xF3\u0142czynnik proporcji","Default":"Domy\u015Blny","Normal":"Normalny","Open":"Otw\xF3rz","Switch Video":"Prze\u0142\u0105cz wideo","Switch Subtitle":"Prze\u0142\u0105cz napisy","Fullscreen":"Pe\u0142ny ekran","Exit Fullscreen":"Zamknij pe\u0142ny ekran","Web Fullscreen":"Tryb pe\u0142nej strony","Exit Web Fullscreen":"Zamknij tryb pe\u0142nej strony","Mini Player":"Miniodtwarzacz","PIP Mode":"Tryb PiP","Exit PIP Mode":"Zamknij tryb PiP","PIP Not Supported":"Tryb PiP nieobs\u0142ugiwany","Fullscreen Not Supported":"Pe\u0142ny ekran nieobs\u0142ugiwany","Subtitle Offset":"Przesuni\u0119cie napis\xF3w","Last Seen":"Ostatnio widziany","Jump Play":"Skocz do gry","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nie jest dost\u0119pny"}')},{}],dBgp3:[function(B,$,K){$.exports=JSON.parse('{"Video Info":"Info o videu","Close":"Zav\u0159\xEDt","Video Load Failed":"Nahr\xE1n\xED videa selhalo","Volume":"Hlasitost","Play":"P\u0159ehr\xE1t","Pause":"Pozastavit","Rate":"Hodnocen\xED","Mute":"Ztlumit","Video Flip":"Oto\u010Dit video","Horizontal":"Horizont\xE1ln\u011B","Vertical":"Vertik\xE1ln\u011B","Reconnect":"Op\u011Btovn\xE9 p\u0159ipojen\xED","Show Setting":"Zobrazit nastaven\xED","Hide Setting":"Skr\xFDt nastaven\xED","Screenshot":"Sn\xEDmek obrazovky","Play Speed":"Rychlost p\u0159ehr\xE1v\xE1n\xED","Aspect Ratio":"Pom\u011Br stran","Default":"V\xFDchoz\xED","Normal":"Norm\xE1ln\xED","Open":"Otev\u0159\xEDt","Switch Video":"P\u0159epnout video","Switch Subtitle":"P\u0159epnout titulky","Fullscreen":"Cel\xE1 obrazovka","Exit Fullscreen":"Opustit re\u017Eim cel\xE9 obrazovky","Web Fullscreen":"Cel\xE1 str\xE1nka","Exit Web Fullscreen":"Zav\u0159\xEDt re\u017Eim cel\xE9 str\xE1nky","Mini Player":"Mini p\u0159ehr\xE1va\u010D","PIP Mode":"Re\u017Eim PIP","Exit PIP Mode":"Opustit re\u017Eim PIP","PIP Not Supported":"Re\u017Eim PIP nen\xED podporov\xE1n","Fullscreen Not Supported":"Re\u017Eim cel\xE9 obrazovky nen\xED podporov\xE1n","Subtitle Offset":"Posun titulk\u016F","Last Seen":"Naposledy vid\u011Bn","Jump Play":"Hra na skok","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nen\xED k dispozici"}')},{}],dNIrL:[function(B,$,K){$.exports=JSON.parse('{"Video Info":"Informaci\xF3n del video","Close":"Cerrar","Video Load Failed":"Fall\xF3 carga de video","Volume":"Volumen","Play":"Reproduciendo","Pause":"Pausa","Rate":"Velocidad","Mute":"Silencio","Video Flip":"Rotar video","Horizontal":"Horizontal","Vertical":"Vertical","Reconnect":"Reconectando","Show Setting":"Mostrar ajustes","Hide Setting":"Ocultar ajustes","Screenshot":"Captura de Pantalla","Play Speed":"Velocidad de reproducci\xF3n","Aspect Ratio":"Relaci\xF3n de aspecto","Default":"Por defecto","Normal":"Normal","Open":"Abrir","Switch Video":"Cambiar video","Switch Subtitle":"Cambiar subt\xEDtulo","Fullscreen":"Pantalla completa","Exit Fullscreen":"Salir de Pantalla completa","Web Fullscreen":"Pantalla completa Web","Exit Web Fullscreen":"Salir de Pantalla completa","Mini Player":"Mini reproductor","PIP Mode":"Modo PiP","Exit PIP Mode":"Cerrar modo PiP","PIP Not Supported":"Modo PiP no compatible","Fullscreen Not Supported":"Pantalla completa no soportada","Subtitle Offset":"Ajuste subt\xEDtulo","Last Seen":"Visto \xFAltima vez","Jump Play":"Saltar","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay no disponible"}')},{}],"7Plhe":[function(B,$,K){$.exports=JSON.parse('{"Video Info":"\u0627\u0637\u0644\u0627\u0639\u0627\u062A \u0648\u06CC\u062F\u06CC\u0648","Close":"\u0628\u0633\u062A\u0646","Video Load Failed":"\u0628\u0627\u0631\u06AF\u0630\u0627\u0631\u06CC \u0646\u0627\u0645\u0648\u0641\u0642","Play":"\u067E\u062E\u0634","Volume":"\u0645\u06CC\u0632\u0627\u0646 \u0635\u062F\u0627","Pause":"\u062A\u0648\u0642\u0641","Rate":"\u0646\u0631\u062E","Mute":"\u0633\u06A9\u0648\u062A","Video Flip":"\u0686\u0631\u062E\u0634 \u062A\u0635\u0648\u06CC\u0631","Horizontal":"\u0627\u0641\u0642\u06CC","Vertical":"\u0639\u0645\u0648\u062F\u06CC","Reconnect":"\u0627\u062A\u0635\u0627\u0644 \u0645\u062C\u062F\u062F","Show Setting":"\u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Hide Setting":"\u0628\u0633\u062A\u0646 \u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Screenshot":"\u0639\u06A9\u0633 \u0627\u0632 \u0635\u0641\u062D\u0647","Play Speed":"\u0633\u0631\u0639\u062A \u067E\u062E\u0634","Aspect Ratio":"\u0646\u0633\u0628\u062A \u062A\u0635\u0648\u06CC\u0631","Default":"\u062D\u0627\u0644\u062A \u067E\u06CC\u0634\u0641\u0631\u0636","Normal":" \u062D\u0627\u0644\u062A \u0639\u0627\u062F\u06CC","Open":"\u0628\u0627\u0632\u06A9\u0631\u062F\u0646","Switch Video":"\u062A\u063A\u06CC\u06CC\u0631 \u0648\u06CC\u062F\u06CC\u0648","Switch Subtitle":"\u0646\u063A\u06CC\u06CC\u0631 \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Fullscreen":"\u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Exit Fullscreen":"\u06A9\u0648\u0686\u06A9 \u06A9\u0631\u062F\u0646","Web Fullscreen":"\u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Exit Web Fullscreen":"\u062E\u0631\u0648\u062C \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Mini Player":"\u062D\u0627\u0644\u062A \u067E\u062E\u0634 \u06A9\u0648\u0686\u06A9","PIP Mode":" \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Exit PIP Mode":"\u062E\u0631\u0648\u062C \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","PIP Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Fullscreen Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Subtitle Offset":"\u0627\u0641\u0633\u062A \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Last Seen":"\u0622\u062E\u0631\u06CC\u0646 \u0628\u0627\u0632\u062F\u06CC\u062F","Jump Play":"\u062C\u0627\u0645\u067E \u067E\u0644\u06CC","AirPlay":"\u0627\u06CC\u0631 \u067E\u0644\u06CC","AirPlay Not Available":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0627\u06CC\u0631\u067E\u0644\u06CC"}')},{}],a90nx:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./urlMix"),R=M.interopDefault(O),s=B("./attrMix"),D=M.interopDefault(s),g=B("./playMix"),b=M.interopDefault(g),c=B("./pauseMix"),C=M.interopDefault(c),x=B("./toggleMix"),E=M.interopDefault(x),T=B("./seekMix"),L=M.interopDefault(T),I=B("./volumeMix"),r=M.interopDefault(I),_=B("./currentTimeMix"),v=M.interopDefault(_),n=B("./durationMix"),l=M.interopDefault(n),i=B("./switchMix"),a=M.interopDefault(i),m=B("./playbackRateMix"),p=M.interopDefault(m),o=B("./aspectRatioMix"),d=M.interopDefault(o),A=B("./screenshotMix"),u=M.interopDefault(A),f=B("./fullscreenMix"),t=M.interopDefault(f),h=B("./fullscreenWebMix"),e=M.interopDefault(h),y=B("./pipMix"),P=M.interopDefault(y),S=B("./loadedMix"),w=M.interopDefault(S),k=B("./playedMix"),F=M.interopDefault(k),U=B("./playingMix"),N=M.interopDefault(U),j=B("./autoSizeMix"),W=M.interopDefault(j),H=B("./rectMix"),G=M.interopDefault(H),V=B("./flipMix"),Y=M.interopDefault(V),Q=B("./miniMix"),z=M.interopDefault(Q),X=B("./loopMix"),q=M.interopDefault(X),te=B("./posterMix"),ee=M.interopDefault(te),Z=B("./autoHeightMix"),J=M.interopDefault(Z),ie=B("./themeMix"),ne=M.interopDefault(ie),ue=B("./titleMix"),oe=M.interopDefault(ue),le=B("./typeMix"),ae=M.interopDefault(le),se=B("./normalSizeMix"),de=M.interopDefault(se),fe=B("./subtitleOffsetMix"),ve=M.interopDefault(fe),ce=B("./airplayMix"),pe=M.interopDefault(ce),xe=B("./optionInit"),me=M.interopDefault(xe),_e=B("./eventInit"),Ee=M.interopDefault(_e);K.default=class{constructor(re){(0,R.default)(re),(0,D.default)(re),(0,b.default)(re),(0,C.default)(re),(0,E.default)(re),(0,L.default)(re),(0,r.default)(re),(0,v.default)(re),(0,l.default)(re),(0,a.default)(re),(0,p.default)(re),(0,d.default)(re),(0,u.default)(re),(0,t.default)(re),(0,e.default)(re),(0,P.default)(re),(0,w.default)(re),(0,F.default)(re),(0,N.default)(re),(0,W.default)(re),(0,G.default)(re),(0,Y.default)(re),(0,z.default)(re),(0,q.default)(re),(0,ee.default)(re),(0,J.default)(re),(0,ne.default)(re),(0,oe.default)(re),(0,ae.default)(re),(0,de.default)(re),(0,ve.default)(re),(0,pe.default)(re),(0,Ee.default)(re),(0,me.default)(re)}}},{"./urlMix":"kQoac","./attrMix":"deCma","./playMix":"fOJuP","./pauseMix":"fzHAy","./toggleMix":"cBHxQ","./seekMix":"koAPr","./volumeMix":"6eyuR","./currentTimeMix":"faaWv","./durationMix":"5y91K","./switchMix":"iceD8","./playbackRateMix":"keKwh","./aspectRatioMix":"jihET","./screenshotMix":"36kPY","./fullscreenMix":"2GYOJ","./fullscreenWebMix":"5aYAP","./pipMix":"7EnIB","./loadedMix":"3N9mP","./playedMix":"et96R","./playingMix":"9DzzM","./autoSizeMix":"i1LDY","./rectMix":"IqARI","./flipMix":"7E7Vs","./miniMix":"gpugx","./loopMix":"f1hVG","./posterMix":"1SuFS","./autoHeightMix":"8x4te","./themeMix":"2FqhO","./titleMix":"7Am53","./typeMix":"1fQQs","./normalSizeMix":"ePkBr","./subtitleOffsetMix":"6vlBV","./airplayMix":"eftqT","./optionInit":"fCWZK","./eventInit":"f8Lv3","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kQoac:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{option:R,template:{$video:s}}=O;(0,M.def)(O,"url",{get:()=>s.currentSrc,async set(D){if(D){const g=R.type||(0,M.getExt)(D),b=R.customType[g];g&&b?(await(0,M.sleep)(),O.loading.show=!0,b.call(O,s,D,O)):(O.url&&O.url!==D&&O.once("video:canplay",()=>{O.isReady&&O.emit("restart")}),s.src=D,O.option.url=D,O.emit("url",D))}else await(0,M.sleep)(),O.loading.show=!0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],deCma:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{template:{$video:R}}=O;(0,M.def)(O,"attr",{value(s,D){if(D===void 0)return R[s];R[s]=D}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fOJuP:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{i18n:R,notice:s,option:D,constructor:{instances:g},template:{$video:b}}=O;(0,M.def)(O,"play",{value:async function(){const c=await b.play();if(s.show=R.get("Play"),O.emit("play"),D.mutex)for(let C=0;C<g.length;C++){const x=g[C];x!==O&&x.pause()}return c}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fzHAy:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{template:{$video:R},i18n:s,notice:D}=O;(0,M.def)(O,"pause",{value(){const g=R.pause();return D.show=s.get("Pause"),O.emit("pause"),g}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cBHxQ:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){(0,M.def)(O,"toggle",{value:()=>O.playing?O.pause():O.play()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],koAPr:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{notice:R}=O;(0,M.def)(O,"seek",{set(s){O.currentTime=s,O.emit("seek",O.currentTime),O.duration&&(R.show=`${(0,M.secondToTime)(O.currentTime)} / ${(0,M.secondToTime)(O.duration)}`)}}),(0,M.def)(O,"forward",{set(s){O.seek=O.currentTime+s}}),(0,M.def)(O,"backward",{set(s){O.seek=O.currentTime-s}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6eyuR":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{template:{$video:R},i18n:s,notice:D,storage:g}=O;(0,M.def)(O,"volume",{get:()=>R.volume||0,set:b=>{R.volume=(0,M.clamp)(b,0,1),D.show=`${s.get("Volume")}: ${parseInt(100*R.volume,10)}`,R.volume!==0&&g.set("volume",R.volume)}}),(0,M.def)(O,"muted",{get:()=>R.muted,set:b=>{R.muted=b}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],faaWv:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{$video:R}=O.template;(0,M.def)(O,"currentTime",{get:()=>R.currentTime||0,set:s=>{s=parseFloat(s),Number.isNaN(s)||(R.currentTime=(0,M.clamp)(s,0,O.duration))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5y91K":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){(0,M.def)(O,"duration",{get:()=>{const{duration:R}=O.template.$video;return R===1/0?0:R||0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],iceD8:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{i18n:R,option:s,notice:D}=O;function g(b,c,C){return new Promise(x=>{if(b===O.url)return x(b);const{playing:E}=O;O.pause(),URL.revokeObjectURL(O.url),O.url=b,O.once("video:canplay",()=>{O.playbackRate=!1,O.aspectRatio=!1,O.flip="normal",O.autoSize=s.autoSize,O.currentTime=C,O.notice.show="",E&&O.play(),c&&(D.show=`${R.get("Switch Video")}: ${c}`),x(b)})})}(0,M.def)(O,"switchQuality",{value:(b,c)=>g(b,c,O.currentTime)}),(0,M.def)(O,"switchUrl",{value:(b,c)=>g(b,c,0)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],keKwh:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{template:{$video:R},i18n:s,notice:D}=O;(0,M.def)(O,"playbackRate",{get:()=>R.playbackRate,set(g){if(g){if(g===R.playbackRate)return;R.playbackRate=g,D.show=`${s.get("Rate")}: ${g===1?s.get("Normal"):`${g}x`}`}else O.playbackRate=1}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jihET:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{template:{$video:R,$player:s},i18n:D,notice:g}=O;(0,M.def)(O,"aspectRatio",{get:()=>s.dataset.aspectRatio||"default",set(b){if(b||(b="default"),b==="default")(0,M.setStyle)(R,"width",null),(0,M.setStyle)(R,"height",null),(0,M.setStyle)(R,"padding",null),delete s.dataset.aspectRatio;else{const c=b.split(":").map(Number),{videoWidth:C,videoHeight:x}=R,{clientWidth:E,clientHeight:T}=s,L=C/x,I=c[0]/c[1];if(L>I){const r=I*x/C;(0,M.setStyle)(R,"width",100*r+"%"),(0,M.setStyle)(R,"height","100%"),(0,M.setStyle)(R,"padding",`0 ${(E-E*r)/2}px`)}else{const r=C/I/x;(0,M.setStyle)(R,"width","100%"),(0,M.setStyle)(R,"height",100*r+"%"),(0,M.setStyle)(R,"padding",(T-T*r)/2+"px 0")}s.dataset.aspectRatio=b}g.show=`${D.get("Aspect Ratio")}: ${b==="default"?D.get("Default"):b}`,O.emit("aspectRatio",b)}}),(0,M.def)(O,"aspectRatioReset",{set(b){if(b){const{aspectRatio:c}=O;O.aspectRatio=c}}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"36kPY":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{option:R,notice:s,template:{$video:D}}=O,g=(0,M.createElement)("canvas");(0,M.def)(O,"getDataURL",{value:()=>new Promise((b,c)=>{try{g.width=D.videoWidth,g.height=D.videoHeight,g.getContext("2d").drawImage(D,0,0),b(g.toDataURL("image/png"))}catch(C){s.show=C,c(C)}})}),(0,M.def)(O,"getBlobUrl",{value:()=>new Promise((b,c)=>{try{g.width=D.videoWidth,g.height=D.videoHeight,g.getContext("2d").drawImage(D,0,0),g.toBlob(C=>{b(URL.createObjectURL(C))})}catch(C){s.show=C,c(C)}})}),(0,M.def)(O,"screenshot",{value:async()=>{const b=await O.getDataURL();return(0,M.download)(b,`${R.title||"artplayer"}_${(0,M.secondToTime)(D.currentTime)}.png`),O.emit("screenshot",b),b}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2GYOJ":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("../libs/screenfull"),R=M.interopDefault(O),s=B("../utils");K.default=function(D){const{i18n:g,notice:b,template:{$video:c,$player:C}}=D;D.once("video:loadedmetadata",()=>{R.default.isEnabled?(x=>{R.default.on("change",()=>{x.emit("fullscreen",R.default.isFullscreen)}),(0,s.def)(x,"fullscreen",{get:()=>R.default.isFullscreen,async set(E){E?(x.normalSize="fullscreen",x.aspectRatioReset=!0,x.autoSize=!1,await R.default.request(C),(0,s.addClass)(C,"art-fullscreen"),x.emit("resize"),b.show=""):(x.aspectRatioReset=!0,x.autoSize=x.option.autoSize,await R.default.exit(),(0,s.removeClass)(C,"art-fullscreen"),x.emit("resize"),b.show="")}})})(D):document.fullscreenEnabled||c.webkitSupportsFullscreen?(x=>{(0,s.def)(x,"fullscreen",{get:()=>c.webkitDisplayingFullscreen,set(E){E?(x.normalSize="fullscreen",c.webkitEnterFullscreen(),x.emit("fullscreen",!0),b.show=""):(c.webkitExitFullscreen(),x.emit("fullscreen",!1),b.show="")}})})(D):(0,s.def)(D,"fullscreen",{get:()=>!1,set(){b.show=g.get("Fullscreen Not Supported")}}),(0,s.def)(D,"fullscreen",(0,s.get)(D,"fullscreen"))})}},{"../libs/screenfull":"8v40z","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8v40z":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);const M=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],O=(()=>{if(typeof document>"u")return!1;const D=M[0],g={};for(const b of M)if(b[1]in document){for(const[c,C]of b.entries())g[D[c]]=C;return g}return!1})(),R={change:O.fullscreenchange,error:O.fullscreenerror};let s={request:(D=document.documentElement,g)=>new Promise((b,c)=>{const C=()=>{s.off("change",C),b()};s.on("change",C);const x=D[O.requestFullscreen](g);x instanceof Promise&&x.then(C).catch(c)}),exit:()=>new Promise((D,g)=>{if(!s.isFullscreen)return void D();const b=()=>{s.off("change",b),D()};s.on("change",b);const c=document[O.exitFullscreen]();c instanceof Promise&&c.then(b).catch(g)}),toggle:(D,g)=>s.isFullscreen?s.exit():s.request(D,g),onchange(D){s.on("change",D)},onerror(D){s.on("error",D)},on(D,g){const b=R[D];b&&document.addEventListener(b,g,!1)},off(D,g){const b=R[D];b&&document.removeEventListener(b,g,!1)},raw:O};Object.defineProperties(s,{isFullscreen:{get:()=>Boolean(document[O.fullscreenElement])},element:{enumerable:!0,get:()=>document[O.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>Boolean(document[O.fullscreenEnabled])}}),O||(s={isEnabled:!1}),K.default=s},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5aYAP":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{notice:R,constructor:s,template:{$container:D,$player:g}}=O;(0,M.def)(O,"fullscreenWeb",{get:()=>(0,M.hasClass)(g,"art-fullscreen-web"),set(b){b?(s.FULLSCREEN_WEB_IN_BODY&&(0,M.append)(document.body,g),O.normalSize="fullscreenWeb",(0,M.addClass)(g,"art-fullscreen-web"),O.aspectRatioReset=!0,O.autoSize=!1,O.emit("resize"),O.emit("fullscreenWeb",!0),R.show=""):(s.FULLSCREEN_WEB_IN_BODY&&(0,M.append)(D,g),(0,M.removeClass)(g,"art-fullscreen-web"),O.aspectRatioReset=!0,O.autoSize=O.option.autoSize,O.emit("resize"),O.emit("fullscreenWeb",!1),R.show="")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7EnIB":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{i18n:R,notice:s,template:{$video:D}}=O;document.pictureInPictureEnabled?function(g){const{template:{$video:b},proxy:c,notice:C}=g;b.disablePictureInPicture=!1,(0,M.def)(g,"pip",{get:()=>document.pictureInPictureElement,set(x){x?(g.normalSize="pip",b.requestPictureInPicture().catch(E=>{throw C.show=E,E})):document.exitPictureInPicture().catch(E=>{throw C.show=E,E})}}),c(b,"enterpictureinpicture",()=>{g.emit("pip",!0)}),c(b,"leavepictureinpicture",()=>{g.emit("pip",!1)})}(O):D.webkitSupportsPresentationMode?function(g){const{$video:b}=g.template;b.webkitSetPresentationMode("inline"),(0,M.def)(g,"pip",{get:()=>b.webkitPresentationMode==="picture-in-picture",set(c){c?(g.normalSize="pip",b.webkitSetPresentationMode("picture-in-picture"),g.emit("pip",!0)):(b.webkitSetPresentationMode("inline"),g.emit("pip",!1))}})}(O):(0,M.def)(O,"pip",{get:()=>!1,set(){s.show=R.get("PIP Not Supported")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3N9mP":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{$video:R}=O.template;(0,M.def)(O,"loaded",{get:()=>O.loadedTime/R.duration}),(0,M.def)(O,"loadedTime",{get:()=>R.buffered.length?R.buffered.end(R.buffered.length-1):0})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],et96R:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){(0,M.def)(O,"played",{get:()=>O.currentTime/O.duration})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9DzzM":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{$video:R}=O.template;(0,M.def)(O,"playing",{get:()=>R.currentTime>0&&!R.paused&&!R.ended&&R.readyState>2})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],i1LDY:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{$container:R,$player:s,$video:D}=O.template;(0,M.def)(O,"autoSize",{get:()=>(0,M.hasClass)(R,"art-auto-size"),set(g){if(g){const{videoWidth:b,videoHeight:c}=D,{width:C,height:x}=R.getBoundingClientRect(),E=b/c,T=C/x;if((0,M.addClass)(R,"art-auto-size"),T>E){const L=x*E/C*100;(0,M.setStyle)(s,"width",`${L}%`),(0,M.setStyle)(s,"height","100%")}else{const L=C/E/x*100;(0,M.setStyle)(s,"width","100%"),(0,M.setStyle)(s,"height",`${L}%`)}O.emit("autoSize",{width:O.width,height:O.height})}else(0,M.removeClass)(R,"art-auto-size"),(0,M.setStyle)(s,"width",null),(0,M.setStyle)(s,"height",null),O.emit("autoSize")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],IqARI:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){(0,M.def)(O,"rect",{get:()=>O.template.$player.getBoundingClientRect()});const R=["bottom","height","left","right","top","width"];for(let s=0;s<R.length;s++){const D=R[s];(0,M.def)(O,D,{get:()=>O.rect[D]})}(0,M.def)(O,"x",{get:()=>O.left+window.pageXOffset}),(0,M.def)(O,"y",{get:()=>O.top+window.pageYOffset})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7E7Vs":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{template:{$player:R},i18n:s,notice:D}=O;(0,M.def)(O,"flip",{get:()=>R.dataset.flip||"normal",set(g){g||(g="normal"),g==="normal"?delete R.dataset.flip:R.dataset.flip=g,D.show=`${s.get("Video Flip")}: ${s.get((0,M.capitalize)(g))}`,O.emit("flip",g)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gpugx:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{i18n:R,option:s,storage:D,proxy:g,template:{$player:b,$miniClose:c,$miniTitle:C,$miniHeader:x}}=O;let E=!1,T=0,L=0,I=0,r=0;g(x,"mousedown",_=>{E=!0,T=_.pageX,L=_.pageY,I=O.left,r=O.top}),g(document,"mousemove",_=>{if(E){(0,M.addClass)(b,"art-is-dragging");const v=r+_.pageY-L,n=I+_.pageX-T;(0,M.setStyle)(b,"top",`${v}px`),(0,M.setStyle)(b,"left",`${n}px`),D.set("top",v),D.set("left",n)}}),g(document,"mouseup",()=>{E=!1,(0,M.removeClass)(b,"art-is-dragging")}),g(c,"click",()=>{O.mini=!1,E=!1,(0,M.removeClass)(b,"art-is-dragging")}),(0,M.append)(C,s.title||R.get("Mini Player")),(0,M.def)(O,"mini",{get:()=>(0,M.hasClass)(b,"art-mini"),set(_){if(_){O.normalSize="mini",O.autoSize=!1,(0,M.addClass)(b,"art-mini");const v=D.get("top"),n=D.get("left");if(v&&n)(0,M.setStyle)(b,"top",`${v}px`),(0,M.setStyle)(b,"left",`${n}px`),(0,M.isInViewport)(x)||(D.del("top"),D.del("left"),O.mini=!0);else{const l=window.innerHeight-O.height-50,i=window.innerWidth-O.width-50;D.set("top",l),D.set("left",i),(0,M.setStyle)(b,"top",`${l}px`),(0,M.setStyle)(b,"left",`${i}px`)}O.aspectRatio=!1,O.playbackRate=!1,O.notice.show="",O.emit("mini",!0)}else(0,M.removeClass)(b,"art-mini"),(0,M.setStyle)(b,"top",null),(0,M.setStyle)(b,"left",null),O.aspectRatio=!1,O.playbackRate=!1,O.autoSize=s.autoSize,O.notice.show="",O.emit("mini",!1)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f1hVG:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){let R=[];(0,M.def)(O,"loop",{get:()=>R,set:s=>{if(Array.isArray(s)&&typeof s[0]=="number"&&typeof s[1]=="number"){const D=(0,M.clamp)(s[0],0,Math.min(s[1],O.duration)),g=(0,M.clamp)(s[1],D,O.duration);R=g-D>=1?[D,g]:[]}else R=[]}}),O.on("video:timeupdate",()=>{R.length&&(O.currentTime<R[0]||O.currentTime>R[1])&&(O.seek=R[0])})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1SuFS":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{option:R,template:{$poster:s}}=O;(0,M.def)(O,"poster",{get:()=>R.poster,set(D){R.poster=D,(0,M.setStyle)(s,"backgroundImage",`url(${D})`)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8x4te":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{option:R,template:{$container:s,$video:D}}=O,g=s.style.height;(0,M.def)(O,"autoHeight",{get:()=>(0,M.hasClass)(s,"art-auto-height"),set(b){if(b){const{clientWidth:c}=s,{videoHeight:C,videoWidth:x}=D,E=C*(c/x);(0,M.setStyle)(s,"height",E+"px"),(0,M.addClass)(s,"art-auto-height"),O.autoSize=R.autoSize,O.emit("autoHeight",E)}else(0,M.setStyle)(s,"height",g),(0,M.removeClass)(s,"art-auto-height"),O.autoSize=R.autoSize,O.emit("autoHeight")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2FqhO":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{option:R,template:{$player:s}}=O;(0,M.def)(O,"theme",{get:()=>getComputedStyle(s).getPropertyValue("--theme"),set(D){R.theme=D,s.style.setProperty("--theme",D)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7Am53":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){(0,M.def)(O,"title",{get:()=>O.option.title,set(R){O.option.title=R}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1fQQs":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){(0,M.def)(O,"type",{get:()=>O.option.type,set(R){O.option.type=R}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePkBr:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const R=["mini","pip","fullscreen","fullscreenWeb"];(0,M.def)(O,"normalSize",{get:()=>R.every(s=>!O[s]),set(s){R.filter(D=>D!==s).forEach(D=>{O[D]&&(O[D]=!1)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6vlBV":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{clamp:R}=O.constructor.utils,{notice:s,template:D,i18n:g}=O;let b=0,c=[];O.on("subtitle:switch",()=>{c=[]}),(0,M.def)(O,"subtitleOffset",{get:()=>b,set(C){if(D.$track&&D.$track.track){const x=Array.from(D.$track.track.cues);b=R(C,-5,5);for(let E=0;E<x.length;E++){const T=x[E];c[E]||(c[E]={startTime:T.startTime,endTime:T.endTime}),T.startTime=R(c[E].startTime+b,0,O.duration),T.endTime=R(c[E].endTime+b,0,O.duration)}O.subtitle.update(),s.show=`${g.get("Subtitle Offset")}: ${C}s`,O.emit("subtitleOffset",C)}else O.emit("subtitleOffset",0)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eftqT:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{i18n:R,notice:s,proxy:D,template:{$video:g}}=O;let b=!0;window.WebKitPlaybackTargetAvailabilityEvent&&g.webkitShowPlaybackTargetPicker?D(g,"webkitplaybacktargetavailabilitychanged",c=>{switch(c.availability){case"available":b=!0;break;case"not-available":b=!1}}):b=!1,(0,M.def)(O,"airplay",{value(){b?(g.webkitShowPlaybackTargetPicker(),O.emit("airplay")):s.show=R.get("AirPlay Not Available")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fCWZK:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{option:R,storage:s,template:{$video:D,$poster:g}}=O;Object.keys(R.moreVideoAttr).forEach(c=>{O.attr(c,R.moreVideoAttr[c])}),R.muted&&(O.muted=R.muted),R.volume&&(D.volume=(0,M.clamp)(R.volume,0,1));const b=s.get("volume");typeof b=="number"&&(D.volume=(0,M.clamp)(b,0,1)),R.poster&&(0,M.setStyle)(g,"backgroundImage",`url(${R.poster})`),R.autoplay&&(D.autoplay=R.autoplay),R.playsInline&&(D.playsInline=!0,D["webkit-playsinline"]=!0),R.theme&&(O.theme=R.theme),O.url=R.url}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f8Lv3:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("../config"),R=M.interopDefault(O),s=B("../utils");K.default=function(D){const{i18n:g,notice:b,option:c,constructor:C,proxy:x,template:{$player:E,$video:T,$poster:L}}=D;let I=0;for(let r=0;r<R.default.events.length;r++)x(T,R.default.events[r],_=>{D.emit(`video:${_.type}`,_)});D.on("video:canplay",()=>{I=0,D.loading.show=!1}),D.once("video:canplay",()=>{D.loading.show=!1,D.controls.show=!0,D.mask.show=!0,D.isReady=!0,D.emit("ready")}),D.on("video:ended",()=>{c.loop?(D.seek=0,D.play(),D.controls.show=!1,D.mask.show=!1):(D.controls.show=!0,D.mask.show=!0)}),D.on("video:error",async r=>{I<C.RECONNECT_TIME_MAX?(await(0,s.sleep)(C.RECONNECT_SLEEP_TIME),I+=1,D.url=c.url,b.show=`${g.get("Reconnect")}: ${I}`,D.emit("error",r,I)):(D.mask.show=!0,D.loading.show=!1,D.controls.show=!0,(0,s.addClass)(E,"art-error"),await(0,s.sleep)(C.RECONNECT_SLEEP_TIME),b.show=g.get("Video Load Failed"),D.destroy(!1))}),D.on("video:loadedmetadata",()=>{D.autoSize=c.autoSize,s.isMobile&&(D.loading.show=!1,D.controls.show=!0,D.mask.show=!0)}),D.on("video:loadstart",()=>{D.loading.show=!0,D.mask.show=!1,D.controls.show=!0}),D.on("video:pause",()=>{D.controls.show=!0,D.mask.show=!0}),D.on("video:play",()=>{D.mask.show=!1,(0,s.setStyle)(L,"display","none")}),D.on("video:playing",()=>{D.mask.show=!1}),D.on("video:seeked",()=>{D.loading.show=!1}),D.on("video:seeking",()=>{D.loading.show=!0,D.mask.show=!1}),D.on("video:timeupdate",()=>{D.mask.show=!1}),D.on("video:waiting",()=>{D.loading.show=!0,D.mask.show=!1})}},{"../config":"lyjeQ","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8Z0Uf":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("../utils"),R=B("../utils/component"),s=M.interopDefault(R),D=B("./fullscreen"),g=M.interopDefault(D),b=B("./fullscreenWeb"),c=M.interopDefault(b),C=B("./pip"),x=M.interopDefault(C),E=B("./playAndPause"),T=M.interopDefault(E),L=B("./progress"),I=M.interopDefault(L),r=B("./time"),_=M.interopDefault(r),v=B("./volume"),n=M.interopDefault(v),l=B("./setting"),i=M.interopDefault(l),a=B("./thumbnails"),m=M.interopDefault(a),p=B("./screenshot"),o=M.interopDefault(p),d=B("./quality"),A=M.interopDefault(d),u=B("./loop"),f=M.interopDefault(u),t=B("./airplay"),h=M.interopDefault(t);class e extends s.default{constructor(P){super(P),this.name="control";const{proxy:S,constructor:w,template:{$player:k}}=P;let F=Date.now();S(k,["click","mousemove","touchstart","touchmove"],()=>{this.show=!0,(0,O.removeClass)(k,"art-hide-cursor"),(0,O.addClass)(k,"art-hover"),F=Date.now()}),P.on("video:timeupdate",()=>{!P.isInput&&P.playing&&this.show&&Date.now()-F>=w.CONTROL_HIDE_TIME&&(this.show=!1,(0,O.addClass)(k,"art-hide-cursor"),(0,O.removeClass)(k,"art-hover"))}),this.init()}init(){const{option:P}=this.art;P.isLive||this.add((0,I.default)({name:"progress",position:"top",index:10})),!P.thumbnails.url||P.isLive||O.isMobile||this.add((0,m.default)({name:"thumbnails",position:"top",index:20})),this.add((0,f.default)({name:"loop",position:"top",index:30})),this.add((0,T.default)({name:"playAndPause",position:"left",index:10})),this.add((0,n.default)({name:"volume",position:"left",index:20})),P.isLive||this.add((0,_.default)({name:"time",position:"left",index:30})),P.quality.length&&this.add((0,A.default)({name:"quality",position:"right",index:10})),P.screenshot&&!O.isMobile&&this.add((0,o.default)({name:"screenshot",position:"right",index:20})),P.setting&&this.add((0,i.default)({name:"setting",position:"right",index:30})),P.pip&&this.add((0,x.default)({name:"pip",position:"right",index:40})),P.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,h.default)({name:"airplay",position:"right",index:50})),P.fullscreenWeb&&this.add((0,c.default)({name:"fullscreenWeb",position:"right",index:60})),P.fullscreen&&this.add((0,g.default)({name:"fullscreen",position:"right",index:70}));for(let S=0;S<P.controls.length;S++)this.add(P.controls[S])}add(P){const S=typeof P=="function"?P(this.art):P,{$progress:w,$controlsLeft:k,$controlsRight:F}=this.art.template;switch(S.position){case"top":this.$parent=w;break;case"left":this.$parent=k;break;case"right":this.$parent=F;break;default:(0,O.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(S)}}K.default=e},{"../utils":"71aH7","../utils/component":"18nVI","./fullscreen":"c61Lj","./fullscreenWeb":"03jeB","./pip":"u8l8e","./playAndPause":"ebXtb","./progress":"bgoVP","./time":"ikc2j","./volume":"b8NFx","./setting":"03o9l","./thumbnails":"eCVx2","./screenshot":"4KCF5","./quality":"efgTY","./loop":"2hIff","./airplay":"4IS2d","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"18nVI":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./dom"),R=B("option-validator"),s=M.interopDefault(R),D=B("../scheme"),g=B("./property"),b=B("./error");K.default=class{constructor(c){this.id=0,this.art=c,this.add=this.add.bind(this)}get show(){return(0,O.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(c){const{$player:C}=this.art.template,x=`art-${this.name}-show`;c?(0,O.addClass)(C,x):(0,O.removeClass)(C,x),this.art.emit(this.name,c)}set toggle(c){c&&(this.show=!this.show)}add(c){const C=typeof c=="function"?c(this.art):c;if(C.html=C.html||"",(0,s.default)(C,D.ComponentOption),!this.$parent||!this.name||C.disable)return;const x=C.name||`${this.name}${this.id}`;(0,b.errorHandle)(!(0,g.has)(this,x),`Cannot add an existing name [${x}] to the [${this.name}]`),this.id+=1;const E=(0,O.createElement)("div");(0,O.addClass)(E,`art-${this.name}`),(0,O.addClass)(E,`art-${this.name}-${x}`);const T=Array.from(this.$parent.children);E.dataset.index=C.index||this.id;const L=T.find(I=>Number(I.dataset.index)>=Number(E.dataset.index));return L?L.insertAdjacentElement("beforebegin",E):(0,O.append)(this.$parent,E),C.html&&(0,O.append)(E,C.html),C.style&&(0,O.setStyles)(E,C.style),C.tooltip&&(0,O.tooltip)(E,C.tooltip),C.click&&this.art.events.proxy(E,"click",I=>{I.preventDefault(),C.click.call(this.art,this,I)}),C.selector&&["left","right"].includes(C.position)&&this.selector(C,E),C.mounted&&C.mounted.call(this.art,E),(0,g.def)(this,x,{value:E}),E}selector(c,C){const{hover:x,proxy:E}=this.art.events;(0,O.addClass)(C,"art-control-selector");const T=(0,O.createElement)("div");(0,O.addClass)(T,"art-selector-value"),(0,O.append)(T,c.html),C.innerText="",(0,O.append)(C,T);const L=c.selector.map((_,v)=>`<div class="art-selector-item ${_.default?"art-current":""}" data-index="${v}">${_.html}</div>`).join(""),I=(0,O.createElement)("div");(0,O.addClass)(I,"art-selector-list"),(0,O.append)(I,L),(0,O.append)(C,I),this.art.option.backdrop&&(0,O.addClass)(I,"art-backdrop-filter");const r=()=>{const _=(0,O.getStyle)(C,"width")/2-(0,O.getStyle)(I,"width")/2;I.style.left=`${_}px`};x(C,r),E(I,"click",async _=>{const v=(_.composedPath()||[]).find(i=>(0,O.hasClass)(i,"art-selector-item"));if(!v)return;(0,O.inverseClass)(v,"art-current");const n=Number(v.dataset.index),l=c.selector[n]||{};if(T.innerText=v.innerText,c.onSelect){const i=await c.onSelect.call(this.art,l,v,_);typeof i!="string"&&typeof i!="number"||(T.innerHTML=i)}r()})}}},{"./dom":"bSNiV","option-validator":"bAWi2","../scheme":"AKEiO","./property":"5NSdr","./error":"hwmZz","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],c61Lj:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>({...O,tooltip:R.i18n.get("Fullscreen"),mounted:s=>{const{proxy:D,icons:g,i18n:b}=R,c=(0,M.append)(s,g.fullscreenOn),C=(0,M.append)(s,g.fullscreenOff);(0,M.setStyle)(C,"display","none"),D(s,"click",()=>{R.fullscreen=!R.fullscreen}),R.on("fullscreen",x=>{x?((0,M.tooltip)(s,b.get("Exit Fullscreen")),(0,M.setStyle)(c,"display","none"),(0,M.setStyle)(C,"display","inline-flex")):((0,M.tooltip)(s,b.get("Fullscreen")),(0,M.setStyle)(c,"display","inline-flex"),(0,M.setStyle)(C,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03jeB":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>({...O,tooltip:R.i18n.get("Web Fullscreen"),mounted:s=>{const{proxy:D,icons:g,i18n:b}=R,c=(0,M.append)(s,g.fullscreenWebOn),C=(0,M.append)(s,g.fullscreenWebOff);(0,M.setStyle)(C,"display","none"),D(s,"click",()=>{R.fullscreenWeb=!R.fullscreenWeb}),R.on("fullscreenWeb",x=>{x?((0,M.tooltip)(s,b.get("Exit Web Fullscreen")),(0,M.setStyle)(c,"display","none"),(0,M.setStyle)(C,"display","inline-flex")):((0,M.tooltip)(s,b.get("Web Fullscreen")),(0,M.setStyle)(c,"display","inline-flex"),(0,M.setStyle)(C,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],u8l8e:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>({...O,tooltip:R.i18n.get("PIP Mode"),mounted:s=>{const{proxy:D,icons:g,i18n:b}=R;(0,M.append)(s,g.pip),D(s,"click",()=>{R.pip=!R.pip}),R.on("pip",c=>{(0,M.tooltip)(s,b.get(c?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ebXtb:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>({...O,mounted:s=>{const{proxy:D,icons:g,i18n:b}=R,c=(0,M.append)(s,g.play),C=(0,M.append)(s,g.pause);function x(){(0,M.setStyle)(c,"display","flex"),(0,M.setStyle)(C,"display","none")}function E(){(0,M.setStyle)(c,"display","none"),(0,M.setStyle)(C,"display","flex")}(0,M.tooltip)(c,b.get("Play")),(0,M.tooltip)(C,b.get("Pause")),D(c,"click",()=>{R.play()}),D(C,"click",()=>{R.pause()}),R.playing?E():x(),R.on("video:playing",()=>{E()}),R.on("video:pause",()=>{x()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bgoVP:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K),M.export(K,"getPosFromEvent",()=>R),M.export(K,"setCurrentTime",()=>s);var O=B("../utils");function R(D,g){const{$progress:b}=D.template,{left:c}=b.getBoundingClientRect(),C=O.isMobile?g.touches[0].clientX:g.pageX,x=(0,O.clamp)(C-c,0,b.clientWidth),E=x/b.clientWidth*D.duration;return{second:E,time:(0,O.secondToTime)(E),width:x,percentage:(0,O.clamp)(x/b.clientWidth,0,1)}}function s(D,g){if(D.isRotate){const b=g.touches[0].clientY/D.height,c=b*D.duration;D.emit("setBar","played",b),D.seek=c}else{const{second:b,percentage:c}=R(D,g);D.emit("setBar","played",c),D.seek=b}}K.default=function(D){return g=>{const{icons:b,option:c,proxy:C}=g;return{...D,html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:x=>{let E=!1;const T=(0,O.query)(".art-progress-loaded",x),L=(0,O.query)(".art-progress-played",x),I=(0,O.query)(".art-progress-highlight",x),r=(0,O.query)(".art-progress-indicator",x),_=(0,O.query)(".art-progress-tip",x),{PROGRESS_HEIGHT:v,INDICATOR_SIZE:n,INDICATOR_SIZE_ICON:l,INDICATOR_SIZE_MOBILE:i,INDICATOR_SIZE_MOBILE_ICON:a}=g.constructor;(0,O.setStyle)(x,"height",`${v}px`),(0,O.setStyle)(L,"backgroundColor","var(--theme)");let m=n;function p(o,d){o==="loaded"&&(0,O.setStyle)(T,"width",100*d+"%"),o==="played"&&((0,O.setStyle)(L,"width",100*d+"%"),(0,O.setStyle)(r,"left",`calc(${100*d}% - ${m/2}px)`))}b.indicator?(m=l,(0,O.append)(r,b.indicator)):(0,O.setStyles)(r,{backgroundColor:"var(--theme)"}),O.isMobile&&(m=i,b.indicator&&(m=a)),(0,O.setStyles)(r,{left:`-${m/2}px`,width:`${m}px`,height:`${m}px`}),g.on("video:loadedmetadata",()=>{for(let o=0;o<c.highlight.length;o++){const d=c.highlight[o],A=(0,O.clamp)(d.time,0,g.duration)/g.duration*100;(0,O.append)(I,`<span data-text="${d.text}" data-time="${d.time}" style="left: ${A}%"></span>`)}}),p("loaded",g.loaded),g.on("setBar",(o,d)=>{p(o,d)}),g.on("video:progress",()=>{p("loaded",g.loaded)}),g.on("video:timeupdate",()=>{p("played",g.played)}),g.on("video:ended",()=>{p("played",1)}),O.isMobile||(C(x,"click",o=>{o.target!==r&&s(g,o)}),C(x,"mousemove",o=>{(0,O.setStyle)(_,"display","block"),(0,O.includeFromEvent)(o,I)?function(d){const{width:A}=R(g,d),{text:u}=d.target.dataset;_.innerHTML=u;const f=_.clientWidth;A<=f/2?(0,O.setStyle)(_,"left",0):A>x.clientWidth-f/2?(0,O.setStyle)(_,"left",x.clientWidth-f+"px"):(0,O.setStyle)(_,"left",A-f/2+"px")}(o):function(d){const{width:A,time:u}=R(g,d);_.innerHTML=u;const f=_.clientWidth;A<=f/2?(0,O.setStyle)(_,"left",0):A>x.clientWidth-f/2?(0,O.setStyle)(_,"left",x.clientWidth-f+"px"):(0,O.setStyle)(_,"left",A-f/2+"px")}(o)}),C(x,"mouseleave",()=>{(0,O.setStyle)(_,"display","none")}),C(x,"mousedown",()=>{E=!0}),C(document,"mousemove",o=>{if(E){const{second:d,percentage:A}=R(g,o);p("played",A),g.seek=d}}),C(document,"mouseup",()=>{E&&(E=!1)}))}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ikc2j:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>({...O,style:{cursor:"auto",marginLeft:"10px"},mounted:s=>{function D(){const b=`${(0,M.secondToTime)(R.currentTime)} / ${(0,M.secondToTime)(R.duration)}`;b!==s.innerText&&(s.innerText=b)}D();const g=["video:loadedmetadata","video:timeupdate","video:progress"];for(let b=0;b<g.length;b++)R.on(g[b],D)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],b8NFx:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>({...O,mounted:s=>{const{proxy:D,icons:g,i18n:b}=R;let c=!1;const C=R.constructor.VOLUME_PANEL_WIDTH,x=R.constructor.VOLUME_HANDLE_WIDTH,E=(0,M.append)(s,g.volume),T=(0,M.append)(s,g.volumeClose),L=(0,M.append)(s,'<div class="art-volume-panel"></div>'),I=(0,M.append)(L,'<div class="art-volume-slider-handle"></div>');function r(v){const{left:n}=L.getBoundingClientRect();return(0,M.clamp)(v.pageX-n-x/2,0,C-x/2)/(C-x)}function _(v=.7){if(R.muted||v===0)(0,M.setStyle)(E,"display","none"),(0,M.setStyle)(T,"display","flex"),(0,M.setStyle)(I,"left","0");else{const n=(C-x)*v;(0,M.setStyle)(E,"display","flex"),(0,M.setStyle)(T,"display","none"),(0,M.setStyle)(I,"left",`${n}px`)}}(0,M.tooltip)(E,b.get("Mute")),(0,M.setStyle)(T,"display","none"),M.isMobile&&(0,M.setStyle)(L,"display","none"),_(R.volume),R.on("video:volumechange",()=>{_(R.volume)}),D(E,"click",()=>{R.muted=!0}),D(T,"click",()=>{R.muted=!1}),D(L,"click",v=>{R.muted=!1,R.volume=r(v)}),D(I,"mousedown",()=>{c=!0}),D(s,"mousemove",v=>{c&&(R.muted=!1,R.volume=r(v))}),D(document,"mouseup",()=>{c&&(c=!1)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03o9l":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>({...O,tooltip:R.i18n.get("Show Setting"),mounted:s=>{const{proxy:D,icons:g,i18n:b}=R;(0,M.append)(s,g.setting),D(s,"click",()=>{R.setting.toggle=!0,R.setting.updateStyle()}),R.on("setting",c=>{(0,M.tooltip)(s,b.get(c?"Hide Setting":"Show Setting"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eCVx2:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils"),O=B("./progress");K.default=function(R){return s=>({...R,mounted:D=>{const{option:g,template:{$progress:b,$video:c},events:{proxy:C,loadImg:x}}=s;let E=null,T=!1,L=!1;C(b,"mousemove",async I=>{T||(T=!0,E=await x(g.thumbnails.url),L=!0),L&&((0,M.setStyle)(D,"display","block"),function(r){const{width:_}=(0,O.getPosFromEvent)(s,r),{url:v,number:n,column:l,width:i,height:a}=g.thumbnails,m=i||E.naturalWidth/l,p=a||m/(c.videoWidth/c.videoHeight),o=b.clientWidth/n,d=Math.floor(_/o),A=Math.ceil(d/l)-1,u=d%l||l-1;(0,M.setStyle)(D,"backgroundImage",`url(${v})`),(0,M.setStyle)(D,"height",`${p}px`),(0,M.setStyle)(D,"width",`${m}px`),(0,M.setStyle)(D,"backgroundPosition",`-${u*m}px -${A*p}px`),_<=m/2?(0,M.setStyle)(D,"left",0):_>b.clientWidth-m/2?(0,M.setStyle)(D,"left",b.clientWidth-m+"px"):(0,M.setStyle)(D,"left",_-m/2+"px")}(I))}),C(b,"mouseleave",()=>{(0,M.setStyle)(D,"display","none")}),s.on("hover",I=>{I||(0,M.setStyle)(D,"display","none")})}})}},{"../utils":"71aH7","./progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4KCF5":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>({...O,tooltip:R.i18n.get("Screenshot"),mounted:s=>{const{proxy:D,icons:g}=R;(0,M.append)(s,g.screenshot),D(s,"click",()=>{R.screenshot()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],efgTY:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default=function(M){return O=>{const R=O.option.quality,s=R.find(D=>D.default)||R[0];return{...M,style:{marginRight:"10px"},html:s?s.html:"",selector:R,onSelect(D){O.switchQuality(D.url,D.html)}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2hIff":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>({...O,mounted:s=>{const D=(0,M.append)(s,'<span class="art-loop-point"></span>'),g=(0,M.append)(s,'<span class="art-loop-point"></span>');R.on("loop",b=>{b&&b.length?((0,M.setStyle)(s,"display","block"),(0,M.setStyle)(D,"left",`calc(${b[0]/R.duration*100}% - ${D.clientWidth}px)`),(0,M.setStyle)(g,"left",b[1]/R.duration*100+"%")):(0,M.setStyle)(s,"display","none")})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4IS2d":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>({...O,tooltip:R.i18n.get("AirPlay"),mounted:s=>{const{proxy:D,icons:g}=R;(0,M.append)(s,g.airplay),D(s,"click",()=>R.airplay())}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2KYsr":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("../utils"),R=B("../utils/component"),s=M.interopDefault(R),D=B("./playbackRate"),g=M.interopDefault(D),b=B("./aspectRatio"),c=M.interopDefault(b),C=B("./flip"),x=M.interopDefault(C),E=B("./info"),T=M.interopDefault(E),L=B("./version"),I=M.interopDefault(L),r=B("./close"),_=M.interopDefault(r);class v extends s.default{constructor(l){super(l),this.name="contextmenu",this.$parent=l.template.$contextmenu,O.isMobile||this.init()}init(){const{option:l,proxy:i,template:{$player:a,$contextmenu:m}}=this.art;l.playbackRate&&this.add((0,g.default)({name:"playbackRate",index:10})),l.aspectRatio&&this.add((0,c.default)({name:"aspectRatio",index:20})),l.flip&&this.add((0,x.default)({name:"flip",index:30})),this.add((0,T.default)({name:"info",index:40})),this.add((0,I.default)({name:"version",index:50})),this.add((0,_.default)({name:"close",index:60}));for(let p=0;p<l.contextmenu.length;p++)this.add(l.contextmenu[p]);i(a,"contextmenu",p=>{if(p.preventDefault(),!this.art.constructor.CONTEXTMENU)return;this.show=!0;const o=p.clientX,d=p.clientY,{height:A,width:u,left:f,top:t}=a.getBoundingClientRect(),{height:h,width:e}=m.getBoundingClientRect();let y=o-f,P=d-t;o+e>f+u&&(y=u-e),d+h>t+A&&(P=A-h),(0,O.setStyles)(m,{top:`${P}px`,left:`${y}px`})}),i(a,"click",p=>{(0,O.includeFromEvent)(p,m)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}K.default=v},{"../utils":"71aH7","../utils/component":"18nVI","./playbackRate":"69eLi","./aspectRatio":"lUefg","./flip":"kysiM","./info":"gqIgJ","./version":"kRU7C","./close":"jQ8Pm","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"69eLi":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>{const{i18n:s,constructor:{PLAYBACK_RATE:D}}=R;return{...O,html:`${s.get("Play Speed")}:
                ${D.map(g=>`<span data-value="${g}">${g===1?s.get("Normal"):g}</span>`).join("")}
            `,click:(g,b)=>{const{value:c}=b.target.dataset;c&&(R.playbackRate=Number(c),g.show=!1)},mounted:g=>{const b=(0,M.query)('[data-value="1"]',g);b&&(0,M.inverseClass)(b,"art-current"),R.on("video:ratechange",()=>{const c=(0,M.queryAll)("span",g).find(C=>Number(C.dataset.value)===R.playbackRate);c&&(0,M.inverseClass)(c,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lUefg:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>{const{i18n:s,constructor:{ASPECT_RATIO:D}}=R;return{...O,html:`${s.get("Aspect Ratio")}:
                ${D.map(g=>`<span data-value="${g}">${g==="default"?s.get("Default"):g}</span>`).join("")}
            `,click:(g,b)=>{const{value:c}=b.target.dataset;c&&(R.aspectRatio=c,g.show=!1)},mounted:g=>{const b=(0,M.query)('[data-value="default"]',g);b&&(0,M.inverseClass)(b,"art-current"),R.on("aspectRatio",c=>{const C=(0,M.queryAll)("span",g).find(x=>x.dataset.value===c);C&&(0,M.inverseClass)(C,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kysiM:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){return R=>{const{i18n:s,constructor:{FLIP:D}}=R;return{...O,html:`${s.get("Video Flip")}:
                ${D.map(g=>`<span data-value="${g}">${s.get((0,M.capitalize)(g))}</span>`).join("")}
            `,click:(g,b)=>{const{value:c}=b.target.dataset;c&&(R.flip=c.toLowerCase(),g.show=!1)},mounted:g=>{const b=(0,M.query)('[data-value="normal"]',g);b&&(0,M.inverseClass)(b,"art-current"),R.on("flip",c=>{const C=(0,M.queryAll)("span",g).find(x=>x.dataset.value===c);C&&(0,M.inverseClass)(C,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gqIgJ:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default=function(M){return O=>({...M,html:O.i18n.get("Video Info"),click:R=>{O.info.show=!0,R.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kRU7C:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default=function(M){return{...M,html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.6.2</a>'}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jQ8Pm:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default=function(M){return O=>({...M,html:O.i18n.get("Close"),click:R=>{R.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"02ajl":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./utils"),R=B("./utils/component"),s=M.interopDefault(R);class D extends s.default{constructor(b){super(b),this.name="info",O.isMobile||this.init()}init(){const{proxy:b,constructor:c,template:{$infoPanel:C,$infoClose:x,$video:E}}=this.art;b(x,"click",()=>{this.show=!1});let T=null;const L=(0,O.queryAll)("[data-video]",C)||[];this.art.on("destroy",()=>{clearTimeout(T)}),function I(){for(let r=0;r<L.length;r++){const _=L[r],v=E[_.dataset.video],n=typeof v=="number"?v.toFixed(2):v;_.innerText!==n&&(_.innerText=n)}T=setTimeout(I,c.INFO_LOOP_TIME)}()}}K.default=D},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eSWto:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./utils"),R=B("./utils/component"),s=M.interopDefault(R),D=B("option-validator"),g=M.interopDefault(D),b=B("./scheme"),c=M.interopDefault(b);class C extends s.default{constructor(E){super(E),this.name="subtitle",this.eventDestroy=()=>null,this.init(E.option.subtitle);let T=!1;E.on("video:timeupdate",()=>{if(!this.url)return;const L=this.art.template.$video.webkitDisplayingFullscreen;typeof L=="boolean"&&L!==T&&(T=L,this.createTrack(L?"subtitles":"metadata",this.url))})}get url(){return this.art.template.$track.src}set url(E){this.switch(E)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(E,T){const{$subtitle:L}=this.art.template;return typeof E=="object"?(0,O.setStyles)(L,E):(0,O.setStyle)(L,E,T)}update(){const{$subtitle:E}=this.art.template;E.innerHTML="",this.activeCue&&(this.art.option.subtitle.escape?E.innerHTML=this.activeCue.text.split(/\r?\n/).map(T=>`<p>${(0,O.escape)(T)}</p>`).join(""):E.innerHTML=this.activeCue.text,this.art.emit("subtitleUpdate",this.activeCue.text))}async switch(E,T={}){const{i18n:L,notice:I,option:r}=this.art,_={...r.subtitle,...T,url:E},v=await this.init(_);return T.name&&(I.show=`${L.get("Switch Subtitle")}: ${T.name}`),v}createTrack(E,T){const{template:L,proxy:I}=this.art,{$video:r,$track:_}=L,v=(0,O.createElement)("track");v.default=!0,v.kind=E,v.src=T,v.track.mode="hidden",this.eventDestroy(),(0,O.remove)(_),(0,O.append)(r,v),L.$track=v,this.eventDestroy=I(this.textTrack,"cuechange",()=>this.update())}async init(E){const{notice:T,template:{$subtitle:L}}=this.art;if((0,g.default)(E,c.default.subtitle),E.url)return this.style(E.style),fetch(E.url).then(I=>I.arrayBuffer()).then(I=>{const r=new TextDecoder(E.encoding).decode(I);switch(this.art.emit("subtitleLoad",E.url),E.type||(0,O.getExt)(E.url)){case"srt":return(0,O.vttToBlob)((0,O.srtToVtt)(r));case"ass":return(0,O.vttToBlob)((0,O.assToVtt)(r));case"vtt":return(0,O.vttToBlob)(r);default:return E.url}}).then(I=>(L.innerHTML="",this.url===I||(URL.revokeObjectURL(this.url),this.createTrack("metadata",I),this.art.emit("subtitleSwitch",I)),I)).catch(I=>{throw T.show=I,I})}}K.default=C},{"./utils":"71aH7","./utils/component":"18nVI","option-validator":"bAWi2","./scheme":"AKEiO","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jo4S1:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("../utils/error"),R=B("./clickInit"),s=M.interopDefault(R),D=B("./hoverInit"),g=M.interopDefault(D),b=B("./mousemoveInit"),c=M.interopDefault(b),C=B("./resizeInit"),x=M.interopDefault(C),E=B("./gestureInit"),T=M.interopDefault(E),L=B("./viewInit"),I=M.interopDefault(L);K.default=class{constructor(r){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),r.whitelist.state&&((0,s.default)(r,this),(0,g.default)(r,this),(0,c.default)(r,this),(0,x.default)(r,this),(0,T.default)(r,this),(0,I.default)(r,this))}proxy(r,_,v,n={}){if(Array.isArray(_))return _.map(i=>this.proxy(r,i,v,n));r.addEventListener(_,v,n);const l=()=>r.removeEventListener(_,v,n);return this.destroyEvents.push(l),l}hover(r,_,v){_&&this.proxy(r,"mouseenter",_),v&&this.proxy(r,"mouseleave",v)}loadImg(r){return new Promise((_,v)=>{let n;if(r instanceof HTMLImageElement)n=r;else{if(typeof r!="string")return v(new O.ArtPlayerError("Unable to get Image"));n=new Image,n.src=r}if(n.complete)return _(n);this.proxy(n,"load",()=>_(n)),this.proxy(n,"error",()=>v(new O.ArtPlayerError(`Failed to load Image: ${n.src}`)))})}destroy(){for(let r=0;r<this.destroyEvents.length;r++)this.destroyEvents[r]()}}},{"../utils/error":"hwmZz","./clickInit":"6UrCm","./hoverInit":"4jWHi","./mousemoveInit":"bMF9b","./resizeInit":"eDXPO","./gestureInit":"95GtS","./viewInit":"InUBx","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6UrCm":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O,R){const{constructor:s,template:{$player:D,$video:g}}=O;R.proxy(document,["click","contextmenu"],c=>{(0,M.includeFromEvent)(c,D)?(O.isInput=c.target.tagName==="INPUT",O.isFocus=!0,O.emit("focus")):(O.isInput=!1,O.isFocus=!1,O.emit("blur"))});let b=0;R.proxy(g,"click",()=>{const c=Date.now();c-b<=s.DB_CLICE_TIME?(O.emit("dblclick"),M.isMobile?O.isLock||O.toggle():O.fullscreen=!O.fullscreen):(O.emit("click"),M.isMobile||O.toggle()),b=c})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4jWHi":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O,R){const{$player:s}=O.template;R.hover(s,D=>{(0,M.addClass)(s,"art-hover"),O.emit("hover",!0,D)},D=>{(0,M.removeClass)(s,"art-hover"),O.emit("hover",!1,D)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bMF9b:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default=function(M,O){const{$player:R}=M.template;O.proxy(R,"mousemove",s=>{M.emit("mousemove",s)})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eDXPO:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O,R){const{option:s}=O,D=(0,M.throttle)(()=>{O.normalSize&&(O.autoSize=s.autoSize),O.aspectRatioReset=!0,O.notice.show="",O.emit("resize")},O.constructor.RESIZE_TIME);R.proxy(window,["orientationchange","resize"],()=>{D()}),screen&&screen.orientation&&screen.orientation.onchange&&R.proxy(screen.orientation,"change",()=>{D()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"95GtS":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils"),O=B("../control/progress");K.default=function(R,s){if(M.isMobile&&!R.option.isLive){const{$video:D,$progress:g}=R.template;let b=null,c=!1,C=0,x=0,E=0;const T=r=>{if(r.touches.length===1&&!R.isLock){b===g&&(0,O.setCurrentTime)(R,r),c=!0;const{clientX:_,clientY:v}=r.touches[0];C=_,x=v,E=R.currentTime}},L=r=>{if(r.touches.length===1&&c&&R.duration){const{clientX:_,clientY:v}=r.touches[0],n=(0,M.clamp)((_-C)/R.width,-1,1),l=(0,M.clamp)((v-x)/R.height,-1,1),i=R.isRotate?l:n,a=b===D?R.constructor.TOUCH_MOVE_RATIO:1,m=(0,M.clamp)(E+R.duration*i*a,0,R.duration);R.seek=m,R.emit("setBar","played",(0,M.clamp)(m/R.duration,0,1)),R.notice.show=`${(0,M.secondToTime)(m)} / ${(0,M.secondToTime)(R.duration)}`}},I=()=>{c&&(C=0,x=0,E=0,c=!1,b=null)};s.proxy(g,"touchstart",r=>{b=g,T(r)}),s.proxy(D,"touchstart",r=>{b=D,T(r)}),s.proxy(D,"touchmove",L),s.proxy(g,"touchmove",L),s.proxy(document,"touchend",I)}}},{"../utils":"71aH7","../control/progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],InUBx:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O,R){const{option:s,constructor:D,template:{$container:g}}=O,b=(0,M.throttle)(()=>{O.emit("view",(0,M.isInViewport)(g,D.SCROLL_GAP))},D.SCROLL_TIME);R.proxy(window,"scroll",()=>{b()}),O.on("view",c=>{s.autoMini&&(O.mini=!c)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6NoFy":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("./utils");K.default=class{constructor(O){this.art=O,this.keys={},O.option.hotkey&&!M.isMobile&&this.init()}init(){const{proxy:O,constructor:R}=this.art;this.add(27,()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add(32,()=>{this.art.toggle()}),this.add(37,()=>{this.art.backward=R.SEEK_STEP}),this.add(38,()=>{this.art.volume+=R.VOLUME_STEP}),this.add(39,()=>{this.art.forward=R.SEEK_STEP}),this.add(40,()=>{this.art.volume-=R.VOLUME_STEP}),O(window,"keydown",s=>{if(this.art.isFocus){const D=document.activeElement.tagName.toUpperCase(),g=document.activeElement.getAttribute("contenteditable");if(D!=="INPUT"&&D!=="TEXTAREA"&&g!==""&&g!=="true"){const b=this.keys[s.keyCode];if(b){s.preventDefault();for(let c=0;c<b.length;c++)b[c].call(this.art,s);this.art.emit("hotkey",s)}}}})}add(O,R){return this.keys[O]?this.keys[O].push(R):this.keys[O]=[R],this}remove(O,R){if(this.keys[O]){const s=this.keys[O].indexOf(R);s!==-1&&this.keys[O].splice(s,1)}return this}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6G6hZ":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./utils/component"),R=M.interopDefault(O);class s extends R.default{constructor(g){super(g);const{option:b,template:{$layer:c}}=g;this.name="layer",this.$parent=c;for(let C=0;C<b.layers.length;C++)this.add(b.layers[C])}}K.default=s},{"./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3dsEe":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./utils"),R=B("./utils/component"),s=M.interopDefault(R);class D extends s.default{constructor(b){super(b),this.name="loading",(0,O.append)(b.template.$loading,b.icons.loading)}}K.default=D},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],dWGTw:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("./utils");K.default=class{constructor(O){this.art=O,this.timer=null}set show(O){const{constructor:R,template:{$player:s,$noticeInner:D}}=this.art;O?(D.innerText=O instanceof Error?O.message.trim():O,(0,M.addClass)(s,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{D.innerText="",(0,M.removeClass)(s,"art-notice-show")},R.NOTICE_TIME)):(0,M.removeClass)(s,"art-notice-show")}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5POkG":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./utils"),R=B("./utils/component"),s=M.interopDefault(R);class D extends s.default{constructor(b){super(b),this.name="mask";const{template:c,icons:C,events:x}=b,E=(0,O.append)(c.$state,C.state),T=(0,O.append)(c.$state,C.error);(0,O.setStyle)(T,"display","none"),b.on("destroy",()=>{(0,O.setStyle)(E,"display","none"),(0,O.setStyle)(T,"display",null)}),x.proxy(c.$state,"click",()=>b.play())}}K.default=D},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6OeNg":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("../utils"),R=B("bundle-text:./loading.svg"),s=M.interopDefault(R),D=B("bundle-text:./state.svg"),g=M.interopDefault(D),b=B("bundle-text:./check.svg"),c=M.interopDefault(b),C=B("bundle-text:./play.svg"),x=M.interopDefault(C),E=B("bundle-text:./pause.svg"),T=M.interopDefault(E),L=B("bundle-text:./volume.svg"),I=M.interopDefault(L),r=B("bundle-text:./volume-close.svg"),_=M.interopDefault(r),v=B("bundle-text:./screenshot.svg"),n=M.interopDefault(v),l=B("bundle-text:./setting.svg"),i=M.interopDefault(l),a=B("bundle-text:./arrow-left.svg"),m=M.interopDefault(a),p=B("bundle-text:./arrow-right.svg"),o=M.interopDefault(p),d=B("bundle-text:./playback-rate.svg"),A=M.interopDefault(d),u=B("bundle-text:./aspect-ratio.svg"),f=M.interopDefault(u),t=B("bundle-text:./config.svg"),h=M.interopDefault(t),e=B("bundle-text:./pip.svg"),y=M.interopDefault(e),P=B("bundle-text:./lock.svg"),S=M.interopDefault(P),w=B("bundle-text:./unlock.svg"),k=M.interopDefault(w),F=B("bundle-text:./fullscreen-off.svg"),U=M.interopDefault(F),N=B("bundle-text:./fullscreen-on.svg"),j=M.interopDefault(N),W=B("bundle-text:./fullscreen-web-off.svg"),H=M.interopDefault(W),G=B("bundle-text:./fullscreen-web-on.svg"),V=M.interopDefault(G),Y=B("bundle-text:./switch-on.svg"),Q=M.interopDefault(Y),z=B("bundle-text:./switch-off.svg"),X=M.interopDefault(z),q=B("bundle-text:./flip.svg"),te=M.interopDefault(q),ee=B("bundle-text:./error.svg"),Z=M.interopDefault(ee),J=B("bundle-text:./close.svg"),ie=M.interopDefault(J),ne=B("bundle-text:./airplay.svg"),ue=M.interopDefault(ne);K.default=class{constructor(oe){const le={loading:s.default,state:g.default,play:x.default,pause:T.default,check:c.default,volume:I.default,volumeClose:_.default,screenshot:n.default,setting:i.default,pip:y.default,arrowLeft:m.default,arrowRight:o.default,playbackRate:A.default,aspectRatio:f.default,config:h.default,lock:S.default,flip:te.default,unlock:k.default,fullscreenOff:U.default,fullscreenOn:j.default,fullscreenWebOff:H.default,fullscreenWebOn:V.default,switchOn:Q.default,switchOff:X.default,error:Z.default,close:ie.default,airplay:ue.default,...oe.option.icons};Object.keys(le).forEach(ae=>{(0,O.def)(this,ae,{get:()=>{const se=(0,O.createElement)("i");return(0,O.addClass)(se,"art-icon"),(0,O.addClass)(se,`art-icon-${ae}`),(0,O.append)(se,le[ae]),se}})})}}},{"../utils":"71aH7","bundle-text:./loading.svg":"7tDub","bundle-text:./state.svg":"1ElZc","bundle-text:./check.svg":"lmgoP","bundle-text:./play.svg":"lVWoQ","bundle-text:./pause.svg":"5Mnax","bundle-text:./volume.svg":"w3eIa","bundle-text:./volume-close.svg":"rHjo1","bundle-text:./screenshot.svg":"2KcqM","bundle-text:./setting.svg":"8rQMV","bundle-text:./arrow-left.svg":"kqGBE","bundle-text:./arrow-right.svg":"aFjpC","bundle-text:./playback-rate.svg":"lx7ZM","bundle-text:./aspect-ratio.svg":"2sEjf","bundle-text:./config.svg":"fQTgE","bundle-text:./pip.svg":"2CaxO","bundle-text:./lock.svg":"aCGnW","bundle-text:./unlock.svg":"bTrAV","bundle-text:./fullscreen-off.svg":"bA3p0","bundle-text:./fullscreen-on.svg":"fTuY8","bundle-text:./fullscreen-web-off.svg":"tvKf4","bundle-text:./fullscreen-web-on.svg":"1F1oB","bundle-text:./switch-on.svg":"7qNHs","bundle-text:./switch-off.svg":"28aV8","bundle-text:./flip.svg":"1uXI6","bundle-text:./error.svg":"9f4dh","bundle-text:./close.svg":"4nTtS","bundle-text:./airplay.svg":"cDPXC","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7tDub":[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],"1ElZc":[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter:drop-shadow(0 1px 1px #000)" viewBox="0 0 24 24"><path d="M20 2H4C1.8 2 0 3.8 0 6v12c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4V6c0-2.2-1.8-4-4-4zm-4.4 10.8L10.5 16c-.6.5-1.5 0-1.5-.8V8.8c0-.8.9-1.3 1.5-.8l5.1 3.2c.7.3.7 1.3 0 1.6z"/></svg>'},{}],lmgoP:[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],lVWoQ:[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],"5Mnax":[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],w3eIa:[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],rHjo1:[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"2KcqM":[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"8rQMV":[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],kqGBE:[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],aFjpC:[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],lx7ZM:[function(B,$,K){$.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2sEjf":[function(B,$,K){$.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#__lottie_element_216')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],fQTgE:[function(B,$,K){$.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2CaxO":[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],aCGnW:[function(B,$,K){$.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],bTrAV:[function(B,$,K){$.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bA3p0:[function(B,$,K){$.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fTuY8:[function(B,$,K){$.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],tvKf4:[function(B,$,K){$.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],"1F1oB":[function(B,$,K){$.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"7qNHs":[function(B,$,K){$.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],"28aV8":[function(B,$,K){$.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],"1uXI6":[function(B,$,K){$.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9f4dh":[function(B,$,K){$.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],"4nTtS":[function(B,$,K){$.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],cDPXC:[function(B,$,K){$.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],"3eYNH":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./flip"),R=M.interopDefault(O),s=B("./aspectRatio"),D=M.interopDefault(s),g=B("./playbackRate"),b=M.interopDefault(g),c=B("./subtitleOffset"),C=M.interopDefault(c),x=B("../utils/component"),E=M.interopDefault(x),T=B("../utils");class L extends E.default{constructor(r){super(r);const{option:_,proxy:v,template:{$setting:n,$player:l}}=r;if(this.name="setting",this.$parent=n,this.option=[],this.events=[],this.cache=new Map,_.setting){_.playbackRate&&this.option.push((0,b.default)(r)),_.aspectRatio&&this.option.push((0,D.default)(r)),_.flip&&this.option.push((0,R.default)(r)),_.subtitleOffset&&this.option.push((0,C.default)(r));for(let i=0;i<_.settings.length;i++)this.option.push(_.settings[i]);this.update(),r.on("blur",()=>{this.show&&(this.show=!1,this.init(this.option))}),v(l,"click",i=>{!this.show||(0,T.includeFromEvent)(i,r.controls.setting)||(0,T.includeFromEvent)(i,this.$parent)||(this.show=!1,this.init(this.option))})}}static makeRecursion(r,_,v){for(let n=0;n<r.length;n++){const l=r[n];l.$parentItem=_,l.$parentList=v,l.selector&&L.makeRecursion(l.selector,l,r)}return r}update(){return this.cache=new Map,this.events.forEach(r=>r()),this.events=[],this.$parent.innerHTML="",this.option=L.makeRecursion(this.option),this.init(this.option),this.option}add(r){return this.option.push(r),this.update(),r}creatHeader(r){const{icons:_,proxy:v}=this.art,n=(0,T.createElement)("div");(0,T.addClass)(n,"art-setting-item"),(0,T.addClass)(n,"art-setting-item-back");const l=(0,T.append)(n,'<div class="art-setting-item-left"></div>'),i=(0,T.createElement)("div");(0,T.addClass)(i,"art-setting-item-left-icon"),(0,T.append)(i,_.arrowLeft),(0,T.append)(l,i),(0,T.append)(l,r.$parentItem.html);const a=v(n,"click",()=>this.init(r.$parentList));return this.events.push(a),n}creatItem(r,_){const{icons:v,proxy:n}=this.art,l=(0,T.createElement)("div");(0,T.addClass)(l,"art-setting-item"),(0,T.isStringOrNumber)(_.name)&&(l.dataset.name=_.name),(0,T.isStringOrNumber)(_.value)&&(l.dataset.value=_.value);const i=(0,T.append)(l,'<div class="art-setting-item-left"></div>'),a=(0,T.append)(l,'<div class="art-setting-item-right"></div>'),m=(0,T.createElement)("div");switch((0,T.addClass)(m,"art-setting-item-left-icon"),r){case"switch":case"range":(0,T.append)(m,(0,T.isStringOrNumber)(_.icon)||_.icon instanceof Element?_.icon:v.config);break;case"selector":_.selector&&_.selector.length?(0,T.append)(m,(0,T.isStringOrNumber)(_.icon)||_.icon instanceof Element?_.icon:v.config):(0,T.append)(m,v.check)}(0,T.append)(i,m),_.$icon=m,(0,T.def)(_,"icon",{configurable:!0,get:()=>m.innerHTML,set(d){(0,T.isStringOrNumber)(d)&&(m.innerHTML=d)}});const p=(0,T.createElement)("div");(0,T.addClass)(p,"art-setting-item-left-text"),(0,T.append)(p,_.html||""),(0,T.append)(i,p),_.$html=p,(0,T.def)(_,"html",{configurable:!0,get:()=>p.innerHTML,set(d){(0,T.isStringOrNumber)(d)&&(p.innerHTML=d)}});const o=(0,T.createElement)("div");switch((0,T.addClass)(o,"art-setting-item-right-tooltip"),(0,T.append)(o,_.tooltip||""),(0,T.append)(a,o),_.$tooltip=o,(0,T.def)(_,"tooltip",{configurable:!0,get:()=>o.innerHTML,set(d){(0,T.isStringOrNumber)(d)&&(o.innerHTML=d)}}),r){case"switch":{const d=(0,T.createElement)("div");(0,T.addClass)(d,"art-setting-item-right-icon");const A=(0,T.append)(d,v.switchOn),u=(0,T.append)(d,v.switchOff);(0,T.setStyle)(_.switch?u:A,"display","none"),(0,T.append)(a,d),_.$switch=_.switch,(0,T.def)(_,"switch",{configurable:!0,get:()=>_.$switch,set(f){_.$switch=f,f?((0,T.setStyle)(u,"display","none"),(0,T.setStyle)(A,"display",null)):((0,T.setStyle)(u,"display",null),(0,T.setStyle)(A,"display","none"))}});break}case"range":{const d=(0,T.createElement)("div");(0,T.addClass)(d,"art-setting-item-right-icon");const A=(0,T.append)(d,'<input type="range">');A.value=_.range[0]||0,A.min=_.range[1]||0,A.max=_.range[2]||10,A.step=_.range[3]||1,(0,T.addClass)(A,"art-setting-range"),(0,T.append)(a,d),_.$range=A,(0,T.def)(_,"range",{configurable:!0,get:()=>A.valueAsNumber,set(u){A.value=Number(u)}})}break;case"selector":if(_.selector&&_.selector.length){const d=(0,T.createElement)("div");(0,T.addClass)(d,"art-setting-item-right-icon"),(0,T.append)(d,v.arrowRight),(0,T.append)(a,d)}}switch(r){case"switch":if(_.onSwitch){const d=n(l,"click",async A=>{_.switch=await _.onSwitch.call(this.art,_,l,A)});this.events.push(d)}break;case"range":if(_.$range){if(_.onRange){const d=n(_.$range,"change",async A=>{_.tooltip=await _.onRange.call(this.art,_,l,A)});this.events.push(d)}if(_.onChange){const d=n(_.$range,"input",async A=>{_.tooltip=await _.onChange.call(this.art,_,l,A)});this.events.push(d)}}break;case"selector":{const d=n(l,"click",async A=>{if(_.selector&&_.selector.length)this.init(_.selector,_.width);else{(0,T.inverseClass)(l,"art-current");for(let u=0;u<_.$parentItem.selector.length;u++){const f=_.$parentItem.selector[u];f.default=f===_}if(_.$parentList&&this.init(_.$parentList),_.$parentItem&&_.$parentItem.onSelect){const u=await _.$parentItem.onSelect.call(this.art,_,l,A);_.$parentItem.$tooltip&&(0,T.isStringOrNumber)(u)&&(_.$parentItem.$tooltip.innerHTML=u)}}});this.events.push(d),_.default&&(0,T.addClass)(l,"art-current")}}return l}updateStyle(r){const{controls:_,constructor:v,template:{$player:n,$setting:l}}=this.art;if(_.setting){const i=r||v.SETTING_WIDTH,{left:a,width:m}=_.setting.getBoundingClientRect(),{left:p,width:o}=n.getBoundingClientRect(),d=a-p+m/2-i/2;d+i>o?((0,T.setStyle)(l,"left","auto"),(0,T.setStyle)(l,"right","10px")):((0,T.setStyle)(l,"left",`${d}px`),(0,T.setStyle)(l,"right","auto"))}else(0,T.setStyle)(l,"left","auto"),(0,T.setStyle)(l,"right","10px")}init(r,_){const{constructor:v}=this.art;if(this.cache.has(r)){const n=this.cache.get(r);(0,T.inverseClass)(n,"art-current"),(0,T.setStyle)(this.$parent,"width",`${n.dataset.width}px`),(0,T.setStyle)(this.$parent,"height",`${n.dataset.height}px`),this.updateStyle(Number(n.dataset.width))}else{const n=(0,T.createElement)("div");(0,T.addClass)(n,"art-setting-panel"),n.dataset.width=_||v.SETTING_WIDTH,n.dataset.height=r.length*v.SETTING_ITEM_HEIGHT,r[0]&&r[0].$parentItem&&((0,T.append)(n,this.creatHeader(r[0])),n.dataset.height=Number(n.dataset.height)+v.SETTING_ITEM_HEIGHT);for(let l=0;l<r.length;l++){const i=r[l];(0,T.has)(i,"switch")?(0,T.append)(n,this.creatItem("switch",i)):(0,T.has)(i,"range")?(0,T.append)(n,this.creatItem("range",i)):(0,T.append)(n,this.creatItem("selector",i))}(0,T.append)(this.$parent,n),this.cache.set(r,n),(0,T.inverseClass)(n,"art-current"),(0,T.setStyle)(this.$parent,"width",`${n.dataset.width}px`),(0,T.setStyle)(this.$parent,"height",`${n.dataset.height}px`),this.updateStyle(Number(n.dataset.width)),r[0]&&r[0].$parentItem&&r[0].$parentItem.mounted&&r[0].$parentItem.mounted.call(this.art,n,r[0].$parentItem)}}}K.default=L},{"./flip":"kONUB","./aspectRatio":"84NBV","./playbackRate":"aetWt","./subtitleOffset":"fIBkO","../utils/component":"18nVI","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kONUB:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{i18n:R,icons:s,constructor:{SETTING_ITEM_WIDTH:D,FLIP:g}}=O;function b(c,C,x){C&&(C.innerText=R.get((0,M.capitalize)(x)));const E=(0,M.queryAll)(".art-setting-item",c).find(T=>T.dataset.value===x);E&&(0,M.inverseClass)(E,"art-current")}return{width:D,html:R.get("Video Flip"),tooltip:R.get((0,M.capitalize)(O.flip)),icon:s.flip,selector:g.map(c=>({value:c,default:c===O.flip,html:R.get((0,M.capitalize)(c))})),onSelect:c=>(O.flip=c.value,c.value),mounted:(c,C)=>{b(c,C.$tooltip,O.flip),O.on("flip",()=>{b(c,C.$tooltip,O.flip)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"84NBV":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{i18n:R,icons:s,constructor:{SETTING_ITEM_WIDTH:D,ASPECT_RATIO:g}}=O;function b(C){return C==="default"?R.get("Default"):C}function c(C,x,E){x&&(x.innerText=b(E));const T=(0,M.queryAll)(".art-setting-item",C).find(L=>L.dataset.value===E);T&&(0,M.inverseClass)(T,"art-current")}return{width:D,html:R.get("Aspect Ratio"),icon:s.aspectRatio,tooltip:b(O.aspectRatio),selector:g.map(C=>({value:C,default:C===O.aspectRatio,html:b(C)})),onSelect:C=>(O.aspectRatio=C.value,C.value),mounted:(C,x)=>{c(C,x.$tooltip,O.aspectRatio),O.on("aspectRatio",()=>{c(C,x.$tooltip,O.aspectRatio)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],aetWt:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{i18n:R,icons:s,constructor:{SETTING_ITEM_WIDTH:D,PLAYBACK_RATE:g}}=O;function b(C){return C===1?R.get("Normal"):C}function c(C,x,E){x&&(x.innerText=b(E));const T=(0,M.queryAll)(".art-setting-item",C).find(L=>Number(L.dataset.value)===E);T&&(0,M.inverseClass)(T,"art-current")}return{width:D,html:R.get("Play Speed"),tooltip:b(O.playbackRate),icon:s.playbackRate,selector:g.map(C=>({value:C,default:C===O.playbackRate,html:b(C)})),onSelect:C=>(O.playbackRate=C.value,C.value),mounted:(C,x)=>{c(C,x.$tooltip,O.playbackRate),O.on("video:ratechange",()=>{c(C,x.$tooltip,O.playbackRate)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fIBkO:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default=function(M){const{i18n:O,icons:R,constructor:s}=M;return{width:s.SETTING_ITEM_WIDTH,html:O.get("Subtitle Offset"),icon:R.subtitle,tooltip:"0s",range:[0,-5,5,.1],onChange:D=>(M.subtitleOffset=D.range,D.range+"s")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2aaJe":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(M){try{const O=JSON.parse(window.localStorage.getItem(this.name))||{};return M?O[M]:O}catch(O){return M?this.settings[M]:this.settings}}set(M,O){try{const R=Object.assign({},this.get(),{[M]:O});window.localStorage.setItem(this.name,JSON.stringify(R))}catch(R){this.settings[M]=O}}del(M){try{const O=this.get();delete O[M],window.localStorage.setItem(this.name,JSON.stringify(O))}catch(O){delete this.settings[M]}}clear(){try{window.localStorage.removeItem(this.name)}catch(M){this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8MTUM":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("../utils"),R=B("./miniProgressBar"),s=M.interopDefault(R),D=B("./autoOrientation"),g=M.interopDefault(D),b=B("./autoPlayback"),c=M.interopDefault(b),C=B("./fastForward"),x=M.interopDefault(C),E=B("./lock"),T=M.interopDefault(E);K.default=class{constructor(L){this.art=L,this.id=0;const{option:I}=L;I.miniProgressBar&&!I.isLive&&this.add(s.default),I.lock&&O.isMobile&&this.add(T.default),I.autoPlayback&&!I.isLive&&this.add(c.default),I.autoOrientation&&O.isMobile&&this.add(g.default),I.fastForward&&O.isMobile&&!I.isLive&&this.add(x.default);for(let r=0;r<I.plugins.length;r++)this.add(I.plugins[r])}add(L){this.id+=1;const I=L.call(this.art,this.art),r=I&&I.name||L.name||`plugin${this.id}`;return(0,O.errorHandle)(!(0,O.has)(this,r),`Cannot add a plugin that already has the same name: ${r}`),(0,O.def)(this,r,{value:I}),this}}},{"../utils":"71aH7","./miniProgressBar":"87pSL","./autoOrientation":"ePEg5","./autoPlayback":"cVO99","./fastForward":"hFDwt","./lock":"1hsTH","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"87pSL":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default=function(M){return M.on("ready",()=>{M.layers.add({name:"miniProgressBar",mounted(O){M.on("destroy",()=>{O.style.display="none"}),M.on("video:timeupdate",()=>{O.style.width=100*M.played+"%"}),M.on("setBar",(R,s)=>{R==="played"&&(O.style.width=100*s+"%")})}})}),{name:"miniProgressBar"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePEg5:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{option:R,constructor:s,template:{$player:D,$video:g}}=O;return O.on("fullscreenWeb",b=>{if(b){const{videoWidth:c,videoHeight:C}=g,{clientWidth:x,clientHeight:E}=document.documentElement;(c>C&&x<E||c<C&&x>E)&&setTimeout(()=>{(0,M.setStyle)(D,"width",`${E}px`),(0,M.setStyle)(D,"height",`${x}px`),(0,M.setStyle)(D,"transform-origin","0 0"),(0,M.setStyle)(D,"transform",`rotate(90deg) translate(0, -${x}px)`),(0,M.addClass)(D,"art-auto-orientation"),O.isRotate=!0,O.emit("resize")},s.MOBILE_AUTO_ORIENTATION_TIME)}else(0,M.hasClass)(D,"art-auto-orientation")&&((0,M.setStyle)(D,"width",null),(0,M.setStyle)(D,"height",null),(0,M.setStyle)(D,"transform",null),(0,M.setStyle)(D,"transform-origin",null),(0,M.removeClass)(D,"art-auto-orientation"),O.isRotate=!1,O.aspectRatioReset=!0,O.autoSize=R.autoSize,O.notice.show="",O.emit("resize"))}),O.on("fullscreen",async b=>{const c=screen.orientation.type;if(b){const{videoWidth:C,videoHeight:x}=g,{clientWidth:E,clientHeight:T}=document.documentElement;if(C>x&&E<T||C<x&&E>T){const L=c.startsWith("portrait")?"landscape":"portrait";await screen.orientation.lock(L),(0,M.addClass)(D,"art-auto-orientation-fullscreen")}}else(0,M.hasClass)(D,"art-auto-orientation-fullscreen")&&(await screen.orientation.lock(c),(0,M.removeClass)(D,"art-auto-orientation-fullscreen"))}),{name:"autoOrientation",get state(){return(0,M.hasClass)(D,"art-auto-orientation")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cVO99:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{i18n:R,icons:s,storage:D,constructor:g,proxy:b,template:{$poster:c}}=O,C=O.layers.add({name:"autoPlayback",html:'<div class="art-autoPlayback-close"></div><div class="art-autoPlayback-last"></div><div class="art-autoPlayback-jump"></div>'}),x=(0,M.query)(".art-autoPlayback-last",C),E=(0,M.query)(".art-autoPlayback-jump",C),T=(0,M.query)(".art-autoPlayback-close",C);return O.on("video:timeupdate",()=>{const L=D.get("times")||{},I=Object.keys(L);I.length>g.AUTO_PLAYBACK_MAX&&delete L[I[0]],L[O.option.id||O.option.url]=O.currentTime,D.set("times",L)}),O.on("ready",()=>{const L=(D.get("times")||{})[O.option.id||O.option.url];L&&L>=g.AUTO_PLAYBACK_MIN&&((0,M.append)(T,s.close),(0,M.setStyle)(C,"display","flex"),x.innerText=`${R.get("Last Seen")} ${(0,M.secondToTime)(L)}`,E.innerText=R.get("Jump Play"),b(T,"click",()=>{(0,M.setStyle)(C,"display","none")}),b(E,"click",()=>{O.seek=L,O.play(),(0,M.setStyle)(c,"display","none"),(0,M.setStyle)(C,"display","none")}),O.once("video:timeupdate",()=>{setTimeout(()=>{(0,M.setStyle)(C,"display","none")},g.AUTO_PLAYBACK_TIMEOUT)}))}),{name:"autoPlayback",get times(){return D.get("times")||{}},clear:()=>D.del("times"),delete(L){const I=D.get("times")||{};return delete I[L],D.set("times",I),I}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hFDwt:[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{constructor:R,proxy:s,template:{$player:D,$video:g}}=O;let b=null,c=!1,C=1;const x=()=>{clearTimeout(b),c&&(c=!1,O.playbackRate=C,(0,M.removeClass)(D,"art-fast-forward"))};return s(g,"touchstart",E=>{E.touches.length===1&&O.playing&&!O.isLock&&(b=setTimeout(()=>{c=!0,C=O.playbackRate,O.playbackRate=R.FAST_FORWARD_VALUE,(0,M.addClass)(D,"art-fast-forward")},R.FAST_FORWARD_TIME))}),s(document,"touchmove",x),s(document,"touchend",x),{name:"fastForward",get state(){return(0,M.hasClass)(D,"art-fast-forward")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1hsTH":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K);var M=B("../utils");K.default=function(O){const{layers:R,icons:s,template:{$player:D}}=O;return R.add({name:"lock",mounted(g){const b=(0,M.append)(g,s.lock),c=(0,M.append)(g,s.unlock);(0,M.setStyle)(b,"display","none"),O.on("lock",C=>{C?((0,M.setStyle)(b,"display","inline-flex"),(0,M.setStyle)(c,"display","none")):((0,M.setStyle)(b,"display","none"),(0,M.setStyle)(c,"display","inline-flex"))})},click(){(0,M.hasClass)(D,"art-lock")?((0,M.removeClass)(D,"art-lock"),this.isLock=!1):((0,M.addClass)(D,"art-lock"),this.isLock=!0)}}),{name:"lock",get state(){return(0,M.hasClass)(D,"art-lock")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7mil2":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./config"),R=M.interopDefault(O),s=B("./utils");K.default=class{constructor(D){const{option:g,proxy:b,template:{$video:c}}=D;for(let E=0;E<R.default.events.length;E++)b(c,R.default.events[E],T=>{D.emit(`video:${T.type}`,T)});Object.keys(g.moreVideoAttr).forEach(E=>{c[E]=g.moreVideoAttr[E]}),c.controls=!0,g.muted&&(c.muted=g.muted),g.volume&&(c.volume=(0,s.clamp)(g.volume,0,1)),g.poster&&(c.poster=g.poster),g.autoplay&&(c.autoplay=g.autoplay),g.playsInline&&(c.playsInline=!0,c["webkit-playsinline"]=!0);const C=g.type||(0,s.getExt)(g.url),x=g.customType[C];C&&x?x(c,g.url,D):(c.src=g.url,D.emit("url",c.src))}}},{"./config":"lyjeQ","./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["5lTcX"],"5lTcX","parcelRequire4dc0")})(Ve);const nt=Ue(Ve.exports);var $e={exports:{}};/*!
 * artplayer-plugin-danmuku.js v4.4.11
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2022 Harvey Zack
 * Released under the MIT License.
 */(function(Ie,Ne){(function(B,$,K,M,O){var R=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Re<"u"?Re:{},s=typeof R.parcelRequire93cf=="function"&&R.parcelRequire93cf,D=s.cache||{},g=typeof we=="function"&&we.bind(Ie);function b(x,E){if(!D[x]){if(!B[x]){var T=typeof R.parcelRequire93cf=="function"&&R.parcelRequire93cf;if(!E&&T)return T(x,!0);if(s)return s(x,!0);if(g&&typeof x=="string")return g(x);var L=new Error("Cannot find module '"+x+"'");throw L.code="MODULE_NOT_FOUND",L}r.resolve=function(_){var v=B[x][1][_];return v!=null?v:_},r.cache={};var I=D[x]=new b.Module(x);B[x][0].call(I.exports,r,I,I.exports,this)}return D[x].exports;function r(_){var v=r.resolve(_);return v===!1?{}:b(v)}}b.isParcelRequire=!0,b.Module=function(x){this.id=x,this.bundle=b,this.exports={}},b.modules=B,b.cache=D,b.parent=s,b.register=function(x,E){B[x]=[function(T,L){L.exports=E},{}]},Object.defineProperty(b,"root",{get:function(){return R.parcelRequire93cf}}),R.parcelRequire93cf=b;for(var c=0;c<$.length;c++)b($[c]);var C=b(K);Ie.exports=C})({E13ST:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./danmuku"),R=M.interopDefault(O),s=B("./setting"),D=M.interopDefault(s);function g(b){return c=>{(function(x){const{version:E,utils:{errorHandle:T}}=x.constructor,L=E.split(".").map(Number);T(L[0]+L[1]/100>=4.04,`Artplayer.js@${E} \u4E0D\u517C\u5BB9\u8BE5\u5F39\u5E55\u5E93\uFF0C\u8BF7\u66F4\u65B0\u5230 4.4.x \u7248\u672C\u4EE5\u4E0A`)})(c);const C=new R.default(c,b);return(0,D.default)(c,C),{name:"artplayerPluginDanmuku",emit:C.emit.bind(C),load:C.load.bind(C),config:C.config.bind(C),hide:C.hide.bind(C),show:C.show.bind(C),reset:C.reset.bind(C),get option(){return C.option},get isHide(){return C.isHide},get isStop(){return C.isStop}}}}K.default=g,g.env="production",g.version="4.4.11",g.build="2022-10-11 10:47:51",typeof window<"u"&&(window.artplayerPluginDanmuku=g)},{"./danmuku":"8Gtnh","./setting":"jAkJm","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],"8Gtnh":[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("./bilibili"),R=B("./getDanmuTop"),s=M.interopDefault(R);class D{constructor(b,c){const{constructor:C,template:x}=b;if(this.utils=C.utils,this.validator=C.validator,this.$danmuku=x.$danmuku,this.$player=x.$player,this.art=b,this.queue=[],this.option={},this.$refs=[],this.isStop=!1,this.isHide=!1,this.timer=null,this.config(c),this.option.useWorker)try{this.worker=new Worker(B("27c3930ee158179a"))}catch(E){}this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.reset=this.reset.bind(this),this.destroy=this.destroy.bind(this),b.on("video:play",this.start),b.on("video:playing",this.start),b.on("video:pause",this.stop),b.on("video:waiting",this.stop),b.on("fullscreen",this.reset),b.on("fullscreenWeb",this.reset),b.on("destroy",this.destroy),this.load()}static get option(){return{danmuku:[],speed:5,margin:["2%","25%"],opacity:1,color:"#FFFFFF",mode:0,fontSize:25,filter:()=>!0,antiOverlap:!0,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,mount:void 0,theme:"dark",beforeEmit:()=>!0}}static get scheme(){return{danmuku:"array|function|string",speed:"number",margin:"array",opacity:"number",color:"string",mode:"number",fontSize:"number|string",filter:"function",antiOverlap:"boolean",useWorker:"boolean",synchronousPlayback:"boolean",lockTime:"number",maxLength:"number",minWidth:"number",maxWidth:"number",mount:"undefined|htmldivelement",theme:"string",beforeEmit:"function"}}get isRotate(){return this.art.plugins.autoOrientation&&this.art.plugins.autoOrientation.state}get marginTop(){const{clamp:b}=this.utils,c=this.option.margin[0],{clientHeight:C}=this.$player;return typeof c=="number"?b(c,0,C):typeof c=="string"&&c.endsWith("%")?b(C*(parseFloat(c)/100),0,C):D.option.margin[0]}get marginBottom(){const{clamp:b}=this.utils,c=this.option.margin[1],{clientHeight:C}=this.$player;return typeof c=="number"?b(c,0,C):typeof c=="string"&&c.endsWith("%")?b(C*(parseFloat(c)/100),0,C):D.option.margin[1]}filter(b,c){return this.queue.filter(C=>C.$state===b).map(c)}getLeft(b){const c=b.getBoundingClientRect();return this.isRotate?c.top:c.left}getRef(){const b=this.$refs.pop();if(b)return b;const c=document.createElement("div");return c.style.cssText=`
            user-select: none;
            position: absolute;
            white-space: pre;
            pointer-events: none;
            perspective: 500px;
            display: inline-block;
            will-change: transform;
            font-weight: normal;
            line-height: 1.125;
            visibility: hidden;
            font-family: SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif;
            text-shadow: rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px;
        `,c}getReady(){const{currentTime:b}=this.art;return this.queue.filter(c=>c.$state==="ready"||c.$state==="wait"&&b+.1>=c.time&&c.time>=b-.1)}getEmits(){const b=[],{clientWidth:c}=this.$player,C=this.getLeft(this.$player);return this.filter("emit",x=>{const E=x.$ref.offsetTop,T=this.getLeft(x.$ref)-C,L=x.$ref.clientHeight,I=x.$ref.clientWidth,r=T+I,_=c-r,v=r/x.$restTime,n={};n.top=E,n.left=T,n.height=L,n.width=I,n.right=_,n.speed=v,n.distance=r,n.time=x.$restTime,n.mode=x.mode,b.push(n)}),b}getFontSize(b){const{clamp:c}=this.utils,{clientHeight:C}=this.$player;return typeof b=="number"?c(b,12,C):typeof b=="string"&&b.endsWith("%")?c(C*(parseFloat(b)/100),12,C):D.option.fontSize}postMessage(b={}){return new Promise(c=>{if(this.option.useWorker&&this.worker&&this.worker.postMessage)b.id=Date.now(),this.worker.postMessage(b),this.worker.onmessage=C=>{const{data:x}=C;x.id===b.id&&c(x)};else{const C=(0,s.default)(b);c({top:C})}})}async load(){try{let b=[];b=typeof this.option.danmuku=="function"?await this.option.danmuku():typeof this.option.danmuku.then=="function"?await this.option.danmuku:typeof this.option.danmuku=="string"?await(0,O.bilibiliDanmuParseFromUrl)(this.option.danmuku):this.option.danmuku,this.utils.errorHandle(Array.isArray(b),"Danmuku need return an array as result"),this.art.emit("artplayerPluginDanmuku:loaded",b),this.queue=[],this.$danmuku.innerText="",b.forEach(c=>this.emit(c))}catch(b){throw this.art.emit("artplayerPluginDanmuku:error",b),b}return this}config(b){const{clamp:c}=this.utils;return this.option=Object.assign({},D.option,this.option,b),this.validator(this.option,D.scheme),this.option.speed=c(this.option.speed,1,10),this.option.opacity=c(this.option.opacity,0,1),this.option.lockTime=c(Math.floor(this.option.lockTime),0,60),this.option.maxLength=c(this.option.maxLength,0,500),this.option.minWidth=c(this.option.minWidth,0,500),this.option.maxWidth=c(this.option.maxWidth,0,1/0),b.fontSize&&(this.option.fontSize=this.getFontSize(this.option.fontSize),this.reset()),this.art.emit("artplayerPluginDanmuku:config",this.option),this}makeWait(b){b.$state="wait",b.$ref&&(b.$ref.style.visibility="hidden",b.$ref.style.marginLeft="0px",b.$ref.style.transform="translateX(0px)",b.$ref.style.transition="transform 0s linear 0s",this.$refs.push(b.$ref),b.$ref=null)}continue(){const{clientWidth:b}=this.$player;return this.filter("stop",c=>{switch(c.$state="emit",c.$lastStartTime=Date.now(),c.mode){case 0:{const C=b+c.$ref.clientWidth;c.$ref.style.transform=`translateX(${-C}px)`,c.$ref.style.transition=`transform ${c.$restTime}s linear 0s`;break}}}),this}suspend(){const{clientWidth:b}=this.$player;return this.filter("emit",c=>{switch(c.$state="stop",c.mode){case 0:{const C=b-(this.getLeft(c.$ref)-this.getLeft(this.$player));c.$ref.style.transform=`translateX(${-C}px)`,c.$ref.style.transition="transform 0s linear 0s";break}}}),this}reset(){return this.queue.forEach(b=>this.makeWait(b)),this}update(){return this.timer=window.requestAnimationFrame(async()=>{if(this.art.playing&&!this.isHide){this.filter("emit",x=>{const E=(Date.now()-x.$lastStartTime)/1e3;x.$restTime-=E,x.$lastStartTime=Date.now(),x.$restTime<=0&&this.makeWait(x)});const b=this.getReady(),{clientWidth:c,clientHeight:C}=this.$player;for(let x=0;x<b.length;x++){const E=b[x];E.$ref=this.getRef(),E.$ref.innerText=E.text,this.$danmuku.appendChild(E.$ref),E.$ref.style.left=`${c}px`,E.$ref.style.opacity=this.option.opacity,E.$ref.style.fontSize=`${this.option.fontSize}px`,E.$ref.style.color=E.color,E.$ref.style.border=E.border?`1px solid ${E.color}`:null,E.$ref.style.backgroundColor=E.border?"rgb(0 0 0 / 50%)":null,E.$ref.style.marginLeft="0px",E.$lastStartTime=Date.now(),E.$restTime=this.option.synchronousPlayback&&this.art.playbackRate?this.option.speed/Number(this.art.playbackRate):this.option.speed;const T={mode:E.mode,height:E.$ref.clientHeight,speed:(c+E.$ref.clientWidth)/E.$restTime},{top:L}=await this.postMessage({target:T,emits:this.getEmits(),antiOverlap:this.option.antiOverlap,clientWidth:c,clientHeight:C,marginBottom:this.marginBottom,marginTop:this.marginTop});if(E.$ref)if(this.isStop||L===void 0)E.$state="ready",this.$refs.push(E.$ref),E.$ref=null;else switch(E.$state="emit",E.$ref.style.visibility="visible",E.mode){case 0:{E.$ref.style.top=`${L}px`;const I=c+E.$ref.clientWidth;E.$ref.style.transform=`translateX(${-I}px)`,E.$ref.style.transition=`transform ${E.$restTime}s linear 0s`;break}case 1:E.$ref.style.left="50%",E.$ref.style.top=`${L}px`,E.$ref.style.marginLeft=`-${E.$ref.clientWidth/2}px`}}}this.isStop||this.update()}),this}stop(){return this.isStop=!0,this.suspend(),window.cancelAnimationFrame(this.timer),this.art.emit("artplayerPluginDanmuku:stop"),this}start(){return this.isStop=!1,this.continue(),this.update(),this.art.emit("artplayerPluginDanmuku:start"),this}show(){return this.isHide=!1,this.start(),this.$danmuku.style.display="block",this.art.emit("artplayerPluginDanmuku:show"),this}hide(){return this.isHide=!0,this.stop(),this.queue.forEach(b=>this.makeWait(b)),this.$danmuku.style.display="none",this.art.emit("artplayerPluginDanmuku:hide"),this}emit(b){return this.validator(b,{text:"string",mode:"number|undefined",color:"string|undefined",time:"number|undefined",border:"boolean|undefined"}),b.text.trim()&&this.option.filter(b)?(b.time?b.time=this.utils.clamp(b.time,0,1/0):b.time=this.art.currentTime+.5,b.mode===void 0&&(b.mode=this.option.mode),b.color===void 0&&(b.color=this.option.color),this.queue.push({...b,$state:"wait",$ref:null,$restTime:0,$lastStartTime:0}),this):this}destroy(){this.stop(),this.worker&&this.worker.terminate&&this.worker.terminate(),this.art.off("video:play",this.start),this.art.off("video:playing",this.start),this.art.off("video:pause",this.stop),this.art.off("video:waiting",this.stop),this.art.off("fullscreen",this.reset),this.art.off("fullscreenWeb",this.reset),this.art.off("destroy",this.destroy),this.art.emit("artplayerPluginDanmuku:destroy")}}K.default=D},{"./bilibili":"KnwDr","./getDanmuTop":"2Abxf","27c3930ee158179a":"anHwN","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],KnwDr:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");function O(D){switch(D){case 1:case 2:case 3:default:return 0;case 4:case 5:return 1}}function R(D){if(typeof D!="string")return[];const g=D.matchAll(new RegExp('<d (?:.*? )??p="(?<p>.+?)"(?: .*?)?>(?<text>.+?)<\\/d>',"gs"));return Array.from(g).map(b=>{const c=b.groups.p.split(",");return c.length>=8?{text:b.groups.text.trim().replaceAll("&quot;",'"').replaceAll("&apos;","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"),time:Number(c[0]),mode:O(Number(c[1])),fontSize:Number(c[2]),color:`#${Number(c[3]).toString(16)}`,timestamp:Number(c[4]),pool:Number(c[5]),userID:c[6],rowID:Number(c[7])}:null}).filter(Boolean)}function s(D){return fetch(D).then(g=>g.text()).then(g=>R(g))}M.defineInteropFlag(K),M.export(K,"getMode",()=>O),M.export(K,"bilibiliDanmuParseFromXml",()=>R),M.export(K,"bilibiliDanmuParseFromUrl",()=>s)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],"9v6Cv":[function(B,$,K){K.interopDefault=function(M){return M&&M.__esModule?M:{default:M}},K.defineInteropFlag=function(M){Object.defineProperty(M,"__esModule",{value:!0})},K.exportAll=function(M,O){return Object.keys(M).forEach(function(R){R==="default"||R==="__esModule"||O.hasOwnProperty(R)||Object.defineProperty(O,R,{enumerable:!0,get:function(){return M[R]}})}),O},K.export=function(M,O,R){Object.defineProperty(M,O,{enumerable:!0,get:R})}},{}],"2Abxf":[function(B,$,K){B("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(K),K.default=function({target:M,emits:O,clientWidth:R,clientHeight:s,marginBottom:D,marginTop:g,antiOverlap:b}){const c=O.filter(x=>x.mode===M.mode&&x.top<=s-D).sort((x,E)=>x.top-E.top);if(c.length===0)return g;c.unshift({top:0,left:0,right:0,height:g,width:R,speed:0,distance:R}),c.push({top:s-D,left:0,right:0,height:D,width:R,speed:0,distance:R});for(let x=1;x<c.length;x+=1){const E=c[x],T=c[x-1],L=T.top+T.height;if(E.top-L>=M.height)return L}const C=[];for(let x=1;x<c.length-1;x+=1){const E=c[x];if(C.length){const T=C[C.length-1];T[0].top===E.top?T.push(E):C.push([E])}else C.push([E])}if(!b){switch(M.mode){case 0:C.sort((x,E)=>{const T=Math.min(...E.map(I=>I.right)),L=Math.min(...x.map(I=>I.right));return T*E.length-L*x.length});break;case 1:C.sort((x,E)=>{const T=Math.max(...E.map(L=>L.width));return Math.max(...x.map(L=>L.width))*x.length-T*E.length})}return C[0][0].top}switch(M.mode){case 0:{const x=C.find(E=>E.every(T=>R<T.distance?!1:M.speed<T.speed?!0:T.right/(M.speed-T.speed)>T.time));return x&&x[0]?x[0].top:void 0}case 1:return}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],anHwN:[function(B,$,K){$.exports="data:application/javascript,function%20getDanmuTop%28%7Btarget%3At%2Cemits%3Ae%2CclientWidth%3An%2CclientHeight%3Ai%2CmarginBottom%3As%2CmarginTop%3Ah%2CantiOverlap%3Ao%7D%29%7Bconst%20r%3De.filter%28%28e%3D%3Ee.mode%3D%3D%3Dt.mode%26%26e.top%3C%3Di-s%29%29.sort%28%28%28t%2Ce%29%3D%3Et.top-e.top%29%29%3Bif%280%3D%3D%3Dr.length%29return%20h%3Br.unshift%28%7Btop%3A0%2Cleft%3A0%2Cright%3A0%2Cheight%3Ah%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%2Cr.push%28%7Btop%3Ai-s%2Cleft%3A0%2Cright%3A0%2Cheight%3As%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%3Bfor%28let%20e%3D1%3Be%3Cr.length%3Be%2B%3D1%29%7Bconst%20n%3Dr%5Be%5D%2Ci%3Dr%5Be-1%5D%2Cs%3Di.top%2Bi.height%3Bif%28n.top-s%3E%3Dt.height%29return%20s%7Dconst%20p%3D%5B%5D%3Bfor%28let%20t%3D1%3Bt%3Cr.length-1%3Bt%2B%3D1%29%7Bconst%20e%3Dr%5Bt%5D%3Bif%28p.length%29%7Bconst%20t%3Dp%5Bp.length-1%5D%3Bt%5B0%5D.top%3D%3D%3De.top%3Ft.push%28e%29%3Ap.push%28%5Be%5D%29%7Delse%20p.push%28%5Be%5D%29%7Dif%28%21o%29%7Bswitch%28t.mode%29%7Bcase%200%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.min%28...e.map%28%28t%3D%3Et.right%29%29%29%2Ci%3DMath.min%28...t.map%28%28t%3D%3Et.right%29%29%29%3Breturn%20n%2ae.length-i%2at.length%7D%29%29%3Bbreak%3Bcase%201%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.max%28...e.map%28%28t%3D%3Et.width%29%29%29%3Breturn%20Math.max%28...t.map%28%28t%3D%3Et.width%29%29%29%2at.length-n%2ae.length%7D%29%29%7Dreturn%20p%5B0%5D%5B0%5D.top%7Dswitch%28t.mode%29%7Bcase%200%3A%7Bconst%20e%3Dp.find%28%28e%3D%3Ee.every%28%28e%3D%3E%7Bif%28n%3Ce.distance%29return%211%3Bif%28t.speed%3Ce.speed%29return%210%3Breturn%20e.right%2F%28t.speed-e.speed%29%3Ee.time%7D%29%29%29%29%3Breturn%20e%26%26e%5B0%5D%3Fe%5B0%5D.top%3Avoid%200%7Dcase%201%3Areturn%7D%7Donmessage%3Dt%3D%3E%7Bconst%7Bdata%3Ae%7D%3Dt%2Cn%3DgetDanmuTop%28e%29%3Bself.postMessage%28%7Btop%3An%2Cid%3Ae.id%7D%29%7D%3B"},{}],jAkJm:[function(B,$,K){var M=B("@parcel/transformer-js/src/esmodule-helpers.js");M.defineInteropFlag(K);var O=B("bundle-text:./style.less"),R=M.interopDefault(O),s=B("bundle-text:./img/danmu-on.svg"),D=M.interopDefault(s),g=B("bundle-text:./img/danmu-off.svg"),b=M.interopDefault(g),c=B("bundle-text:./img/danmu-config.svg"),C=M.interopDefault(c),x=B("bundle-text:./img/danmu-style.svg"),E=M.interopDefault(x);if(K.default=function(T,L){const{option:I}=L,{template:{$controlsCenter:r,$player:_},constructor:{utils:{removeClass:v,addClass:n,append:l,setStyle:i,tooltip:a,query:m,inverseClass:p}}}=T;function o(t,h){const e=document.createElement("i");return l(e,t),n(e,"art-icon"),n(e,`art-icon-${h}`),e}const d=o(D.default,"danmu-on"),A=o(b.default,"danmu-off"),u=o(C.default,"danmu-config"),f=o(E.default,"danmu-style");(function(){const t=["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#89D5FF","#CC0273","#222222","#9B9B9B","#FFFFFF"].map(V=>`<div class="art-danmuku-style-panel-color${I.color===V?" art-current":""}" data-color="${V}" style="background-color:${V}"></div>`),h=l(r,`<div class="art-danmuku-emitter" style="max-width: ${I.maxWidth?`${I.maxWidth}px`:"100%"}"><div class="art-danmuku-left"><div class="art-danmuku-style"><div class="art-danmuku-style-panel"><div class="art-danmuku-style-panel-inner"><div class="art-danmuku-style-panel-title">\u6A21\u5F0F</div><div class="art-danmuku-style-panel-modes"><div class="art-danmuku-style-panel-mode art-current" data-mode="0">\u6EDA\u52A8</div><div class="art-danmuku-style-panel-mode" data-mode="1">\u9759\u6B62</div></div><div class="art-danmuku-style-panel-title">\u989C\u8272</div><div class="art-danmuku-style-panel-colors">${t.join("")}</div></div></div></div><input class="art-danmuku-input" maxlength="${I.maxLength}" placeholder="\u53D1\u4E2A\u5F39\u5E55\u89C1\u8BC1\u5F53\u4E0B" /></div><div class="art-danmuku-send">\u53D1\u9001</div></div>`),e=m(".art-danmuku-style",h),y=m(".art-danmuku-input",h),P=m(".art-danmuku-send",h),S=m(".art-danmuku-style-panel-inner",h),w=m(".art-danmuku-style-panel-modes",h),k=m(".art-danmuku-style-panel-colors",h),F=I.mount||l(_,'<div class="art-layer-danmuku-emitter"></div>');T.option.backdrop&&n(S,"art-backdrop-filter"),I.theme&&n(h,`art-danmuku-theme-${I.theme}`);let U=null,N=I.mode,j=I.color;function W(V){V<=0?(U=null,P.innerText="\u53D1\u9001",v(P,"art-disabled")):(P.innerText=V,U=setTimeout(()=>W(V-1),1e3))}function H(){const V={mode:N,color:j,border:!0,text:y.value.trim()};U===null&&I.beforeEmit(V)&&(y.value="",L.emit(V),n(P,"art-disabled"),W(I.lockTime),T.emit("artplayerPluginDanmuku:emit",V))}function G(){r.clientWidth<I.minWidth?(l(F,h),i(F,"display","flex"),n(h,"art-danmuku-mount"),I.mount||i(_,"marginBottom","40px")):(l(r,h),i(F,"display","none"),v(h,"art-danmuku-mount"),I.mount||i(_,"marginBottom",null))}l(e,f),T.proxy(P,"click",H),T.proxy(y,"keypress",V=>{V.key==="Enter"&&(V.preventDefault(),H())}),T.proxy(w,"click",V=>{const{dataset:Y}=V.target;Y.mode&&(N=Number(Y.mode),p(V.target,"art-current"))}),T.proxy(k,"click",V=>{const{dataset:Y}=V.target;Y.color&&(j=Y.color,p(V.target,"art-current"))}),G(),T.on("resize",()=>{T.isInput||G()}),T.on("destroy",()=>{I.mount&&h.parentElement===I.mount&&I.mount.removeChild(h)})})(),T.controls.add({position:"right",name:"danmuku",click:function(){L.isHide?(L.show(),T.notice.show="\u5F39\u5E55\u663E\u793A",i(d,"display",null),i(A,"display","none")):(L.hide(),T.notice.show="\u5F39\u5E55\u9690\u85CF",i(d,"display","none"),i(A,"display",null))},mounted(t){l(t,d),l(t,A),a(t,"\u5F39\u5E55\u5F00\u5173"),i(A,"display","none")}}),T.setting.add({name:"danmuku",html:"\u5F39\u5E55\u8BBE\u7F6E",tooltip:"\u66F4\u591A",icon:u,selector:[{width:200,html:"\u64AD\u653E\u901F\u5EA6",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u6162",time:10},{html:"\u8F83\u6162",time:7.5},{default:!0,html:"\u9002\u4E2D",time:5},{html:"\u8F83\u5FEB",time:2.5},{html:"\u6781\u5FEB",time:1}],onSelect:function(t){return L.config({speed:t.time}),t.html}},{width:200,html:"\u5B57\u4F53\u5927\u5C0F",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u5C0F",fontSize:"4%"},{html:"\u8F83\u5C0F",fontSize:"5%"},{default:!0,html:"\u9002\u4E2D",fontSize:"6%"},{html:"\u8F83\u5927",fontSize:"7%"},{html:"\u6781\u5927",fontSize:"8%"}],onSelect:function(t){return L.config({fontSize:t.fontSize}),t.html}},{width:200,html:"\u4E0D\u900F\u660E\u5EA6",icon:"",tooltip:"100%",selector:[{default:!0,opacity:1,html:"100%"},{opacity:.75,html:"75%"},{opacity:.5,html:"50%"},{opacity:.25,html:"25%"},{opacity:0,html:"0%"}],onSelect:function(t){return L.config({opacity:t.opacity}),t.html}},{width:200,html:"\u663E\u793A\u8303\u56F4",icon:"",tooltip:"3/4",selector:[{html:"1/4",margin:[10,"75%"]},{html:"\u534A\u5C4F",margin:[10,"50%"]},{default:!0,html:"3/4",margin:[10,"25%"]},{html:"\u6EE1\u5C4F",margin:[10,10]}],onSelect:function(t){return L.config({margin:t.margin}),t.html}},{html:"\u5F39\u5E55\u9632\u91CD\u53E0",icon:"",tooltip:I.antiOverlap?"\u5F00\u542F":"\u5173\u95ED",switch:I.antiOverlap,onSwitch:t=>(L.config({antiOverlap:!t.switch}),t.tooltip=t.switch?"\u5173\u95ED":"\u5F00\u542F",!t.switch)},{html:"\u540C\u6B65\u89C6\u9891\u901F\u5EA6",icon:"",tooltip:I.synchronousPlayback?"\u5F00\u542F":"\u5173\u95ED",switch:I.synchronousPlayback,onSwitch:t=>(L.config({synchronousPlayback:!t.switch}),t.tooltip=t.switch?"\u5173\u95ED":"\u5F00\u542F",!t.switch)}]})},typeof document<"u"&&!document.getElementById("artplayer-plugin-danmuku")){const T=document.createElement("style");T.id="artplayer-plugin-danmuku",T.textContent=R.default,document.head.appendChild(T)}},{"bundle-text:./style.less":"chNhY","bundle-text:./img/danmu-on.svg":"j5M2a","bundle-text:./img/danmu-off.svg":"d9WLf","bundle-text:./img/danmu-config.svg":"8Y3Ij","bundle-text:./img/danmu-style.svg":"hltwt","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],chNhY:[function(B,$,K){$.exports='.art-danmuku-emitter{height:32px;width:100%;max-width:100%;color:#fff;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#ffffff4d;border-radius:3px;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:12px;line-height:1;display:flex;position:relative}.art-danmuku-emitter *,.art-danmuku-emitter :before,.art-danmuku-emitter :after{box-sizing:border-box;margin:0;padding:0}.art-danmuku-emitter .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-danmuku-emitter .art-icon svg{fill:#fff}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-danmuku-emitter .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-danmuku-emitter .art-danmuku-left{border-radius:3px 0 0 3px;flex:1;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style{width:32px;justify-content:center;align-items:center;display:flex;position:relative}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{z-index:999;width:200px;padding-bottom:10px;display:none;position:absolute;bottom:30px;left:-85px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner{background-color:#000000e6;border-radius:3px;flex-direction:column;padding:10px 10px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-title{margin-bottom:10px;font-size:13px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes{justify-content:space-between;margin-bottom:15px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode{width:47%;cursor:pointer;color:#fff;border:1px solid #fff;justify-content:center;padding:5px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode.art-current{background-color:#00a1d6;border:1px solid #00a1d6}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors{flex-wrap:wrap;justify-content:space-between;gap:5px;margin-bottom:10px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color{cursor:pointer;width:20px;height:20px;border:1px solid #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current{position:relative;box-shadow:0 0 2px #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current:before{content:"";width:100%;height:100%;border:2px solid #000;position:absolute;inset:0}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style:hover .art-danmuku-style-panel{display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon{opacity:.75;cursor:pointer}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon:hover{opacity:1}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input{width:100%;color:#fff;background-color:#0000;border:none;outline:none;flex:1;padding:0 10px 0 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#ffffff80}.art-danmuku-emitter .art-danmuku-send{width:50px;cursor:pointer;background-color:#00a1d6;border-radius:0 3px 3px 0;justify-content:center;align-items:center;display:flex}.art-danmuku-emitter .art-danmuku-send:hover{background-color:#00b5e5}.art-danmuku-emitter .art-danmuku-send.art-disabled{opacity:.5;pointer-events:none}.art-danmuku-emitter.art-danmuku-mount{height:34px;max-width:100%!important}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{left:0}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-send{width:60px}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left{background:#f4f4f4;border:1px solid #dadada}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-style .art-icon svg{fill:#666}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input{color:#000}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#00000080}.art-layer-danmuku-emitter{z-index:99;width:100%;position:absolute;bottom:-40px;left:0;right:0}'},{}],j5M2a:[function(B,$,K){$.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.467 661.333c0 4.267-4.267 8.534-8.534 12.8 0 4.267 0 4.267-4.266 8.534h-12.8c-4.267 0-8.534-4.267-17.067-8.534-8.533-8.533-17.067-8.533-25.6-8.533-8.533 0-12.8 4.267-17.067 12.8-4.266 12.8-8.533 21.333-4.266 29.867 4.266 8.533 12.8 17.066 25.6 21.333 17.066 8.533 34.133 17.067 46.933 17.067 12.8 0 21.333-4.267 34.133-8.534 8.534-4.266 17.067-17.066 25.6-29.866 8.534-12.8 12.8-34.134 17.067-55.467 4.267-21.333 4.267-51.2 4.267-85.333 0-12.8 0-21.334-4.267-29.867 0-8.533-4.267-12.8-8.533-17.067-4.267-4.266-8.534-8.533-12.8-8.533-4.267 0-12.8-4.267-21.334-4.267h-55.466s-4.267-4.266 0-8.533l4.266-38.4c0-4.267 0-8.533 4.267-8.533h46.933c17.067 0 25.6-4.267 34.134-12.8 8.533-8.534 12.8-21.334 12.8-42.667v-72.533c0-17.067-4.267-34.134-8.534-42.667-12.8-12.8-25.6-17.067-42.666-17.067H243.2c-8.533 0-17.067 0-21.333 4.267-4.267 8.533-4.267 12.8-4.267 25.6 0 8.533 0 17.067 4.267 21.333 4.266 4.267 12.8 8.534 21.333 8.534h64c4.267 0 8.533 0 8.533 4.266v34.134c0 8.533 0 12.8-4.266 12.8 0 0-4.267 4.266-8.534 4.266H268.8c-8.533 0-12.8 0-21.333 4.267-4.267 0-8.534 4.267-8.534 4.267-4.266 4.266-8.533 12.8-8.533 17.066 0 8.534-4.267 17.067-4.267 25.6l-8.533 72.534v29.866c0 8.534 4.267 12.8 8.533 17.067 4.267 4.267 8.534 4.267 17.067 8.533h68.267c4.266 0 8.533 0 8.533 4.267s4.267 8.533 4.267 17.067c0 21.333 0 42.666-4.267 55.466 0 8.534-4.267 21.334-8.533 25.6zM896 486.4c-93.867 0-174.933 51.2-217.6 123.733H571.733V576H640c21.333 0 34.133-4.267 42.667-12.8 8.533-8.533 12.8-21.333 12.8-42.667V358.4c0-21.333-4.267-34.133-12.8-42.667-8.534-8.533-21.334-12.8-42.667-12.8 0-4.266 4.267-4.266 4.267-8.533-4.267 0-4.267-4.267-4.267-4.267 4.267-12.8 8.533-21.333 4.267-25.6 0-8.533-4.267-12.8-12.8-21.333-8.534-4.267-17.067-4.267-21.334-4.267-8.533 4.267-12.8 8.534-21.333 21.334-4.267 8.533-8.533 12.8-12.8 21.333-4.267 8.533-8.533 12.8-12.8 21.333H512c-4.267-8.533-8.533-17.066-8.533-21.333-4.267-8.533-8.534-12.8-12.8-21.333-4.267-12.8-12.8-17.067-21.334-17.067s-17.066 0-25.6 8.533c-8.533 8.534-12.8 12.8-12.8 21.334s0 17.066 8.534 25.6l4.266 4.266L448 307.2c-17.067 0-29.867 4.267-38.4 12.8-8.533 4.267-12.8 21.333-12.8 38.4v157.867c0 21.333 4.267 34.133 12.8 42.666 8.533 8.534 21.333 12.8 42.667 12.8H512v34.134h-98.133c-12.8 0-21.334 0-25.6 4.266-4.267 4.267-8.534 8.534-8.534 21.334v17.066c0 4.267 4.267 8.534 4.267 8.534 4.267 0 4.267 4.266 8.533 4.266H512V716.8c0 12.8 4.267 21.333 8.533 25.6 4.267 4.267 12.8 8.533 21.334 8.533 12.8 0 21.333-4.266 25.6-8.533 4.266-4.267 4.266-12.8 4.266-25.6v-55.467H652.8c-8.533 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.533-128h55.466c4.267 0 4.267 0 4.267 4.267V409.6h-59.733v-51.2zm0 102.4H627.2V512h-55.467v-51.2zM512 516.267h-55.467v-51.2H512v51.2zm0-102.4h-59.733V362.667H512v51.2zm384 499.2c-93.867 0-170.667-76.8-170.667-170.667S802.133 571.733 896 571.733s170.667 76.8 170.667 170.667S989.867 913.067 896 913.067z"/><path fill="#fff" d="M951.467 669.867 878.933 742.4l-29.866-25.6C832 699.733 806.4 704 789.333 721.067c-17.066 17.066-12.8 42.666 4.267 59.733l59.733 51.2c8.534 8.533 17.067 8.533 29.867 8.533s21.333-4.266 29.867-12.8l102.4-102.4c17.066-17.066 17.066-42.666 0-59.733-21.334-12.8-46.934-12.8-64 4.267zm-371.2 209.066H213.333c-72.533 0-128-55.466-128-119.466V230.4c0-64 55.467-119.467 128-119.467h512c72.534 0 128 55.467 128 119.467v140.8c0 25.6 17.067 42.667 42.667 42.667s42.667-17.067 42.667-42.667V230.4c0-115.2-93.867-204.8-213.334-204.8h-512C93.867 25.6 0 119.467 0 230.4v529.067c0 115.2 93.867 204.8 213.333 204.8h366.934c25.6 0 42.666-17.067 42.666-42.667s-21.333-42.667-42.666-42.667z"/></svg>'},{}],d9WLf:[function(B,$,K){$.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.296 661.504c0 4.096-4.096 8.704-8.704 12.8 0 4.096 0 4.096-4.096 8.704h-12.8c-4.096 0-8.704-4.096-16.896-8.704-8.704-8.704-16.896-8.704-25.6-8.704s-12.8 4.096-16.896 12.8c-4.096 12.8-8.704 21.504-4.096 29.696 4.096 8.704 12.8 16.896 25.6 21.504 16.896 8.704 34.304 16.896 47.104 16.896 12.8 0 21.504-4.096 34.304-8.704 8.704-4.096 16.896-16.896 25.6-29.696s12.8-34.304 16.896-55.296c4.096-21.504 4.096-51.2 4.096-85.504 0-12.8 0-21.504-4.096-29.696 0-8.704-4.096-12.8-8.704-16.896-4.096-4.096-8.704-8.704-12.8-8.704s-12.8-4.096-21.504-4.096h-55.808s-4.096-4.096 0-8.704l4.096-38.4c0-4.096 0-8.704 4.096-8.704h47.104c16.896 0 25.6-4.096 34.304-12.8s12.8-21.504 12.8-42.496v-72.704c0-16.896-4.096-34.304-8.704-42.496-12.8-12.8-25.6-16.896-42.496-16.896H243.2c-8.704 0-16.896 0-21.504 4.096-4.096 8.704-4.096 12.8-4.096 25.6 0 8.704 0 16.896 4.096 21.504 4.096 4.096 12.8 8.704 21.504 8.704h64c4.096 0 8.704 0 8.704 4.096v34.304c0 8.704 0 12.8-4.096 12.8 0 0-4.096 4.096-8.704 4.096H268.8c-8.704 0-12.8 0-21.504 4.096-4.096 0-8.704 4.096-8.704 4.096-4.096 4.096-8.704 12.8-8.704 16.896 0 8.704-4.096 16.896-4.096 25.6l-8.704 72.704v29.696c0 8.704 4.096 12.8 8.704 16.896s8.704 4.096 16.896 8.704h68.096c4.096 0 8.704 0 8.704 4.096s4.096 8.704 4.096 16.896c0 21.504 0 42.496-4.096 55.296.512 9.216-3.584 22.016-8.192 26.624zM896 486.4c-93.696 0-175.104 51.2-217.6 123.904H571.904V576H640c21.504 0 34.304-4.096 42.496-12.8 8.704-8.704 12.8-21.504 12.8-42.496V358.4c0-21.504-4.096-34.304-12.8-42.496-8.704-8.704-21.504-12.8-42.496-12.8 0-4.096 4.096-4.096 4.096-8.704-4.096 0-4.096-4.096-4.096-4.096 4.096-12.8 8.704-21.504 4.096-25.6 0-8.704-4.096-12.8-12.8-21.504-8.704-4.096-16.896-4.096-21.504-4.096-8.704 4.096-12.8 8.704-21.504 21.504-4.096 8.704-8.704 12.8-12.8 21.504s-8.704 12.8-12.8 21.504h-51.2c-4.096-8.704-8.704-16.896-8.704-21.504-4.096-8.704-8.704-12.8-12.8-21.504-4.096-12.8-12.8-16.896-21.504-16.896s-16.896 0-25.6 8.704-12.8 12.8-12.8 21.504 0 16.896 8.704 25.6l4.096 4.096 4.096 4.096c-16.896 0-29.696 4.096-38.4 12.8-8.704 4.096-12.8 21.504-12.8 38.4v157.696c0 21.504 4.096 34.304 12.8 42.496 8.704 8.704 21.504 12.8 42.496 12.8H512v34.304h-98.304c-12.8 0-21.504 0-25.6 4.096s-8.704 8.704-8.704 21.504v16.896c0 4.096 4.096 8.704 4.096 8.704 4.096 0 4.096 4.096 8.704 4.096H512V716.8c0 12.8 4.096 21.504 8.704 25.6 4.096 4.096 12.8 8.704 21.504 8.704 12.8 0 21.504-4.096 25.6-8.704 4.096-4.096 4.096-12.8 4.096-25.6v-55.296H652.8c-8.704 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.704-128h55.296c4.096 0 4.096 0 4.096 4.096V409.6h-59.904v-51.2zm0 102.4H627.2V512h-55.296v-51.2h-4.608zM512 516.096h-55.296v-51.2H512v51.2zm0-102.4h-59.904v-51.2H512v51.2zm384 499.2c-93.696 0-170.496-76.8-170.496-170.496S802.304 571.904 896 571.904s170.496 76.8 170.496 170.496S989.696 912.896 896 912.896z"/><path fill="#fff" d="M580.096 879.104H213.504c-72.704 0-128-55.296-128-119.296V230.4c0-64 55.296-119.296 128-119.296h512c72.704 0 128 55.296 128 119.296v140.8c0 25.6 16.896 42.496 42.496 42.496s42.496-16.896 42.496-42.496V230.4c0-115.2-93.696-204.8-213.504-204.8h-512C93.696 25.6 0 119.296 0 230.4v528.896c0 115.2 93.696 204.8 213.504 204.8h367.104c25.6 0 42.496-16.896 42.496-42.496s-21.504-42.496-43.008-42.496zm171.52 10.752c-15.36-15.36-15.36-40.96 0-56.32l237.568-237.568c15.36-15.36 40.96-15.36 56.32 0s15.36 40.96 0 56.32L807.936 889.856c-15.36 15.36-40.448 15.36-56.32 0z"/></svg>'},{}],"8Y3Ij":[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="M16.5 8c1.289 0 2.49.375 3.5 1.022V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7.022A6.5 6.5 0 0 1 16.5 8zM7 13H5a1 1 0 0 1 0-2h2a1 1 0 0 1 0 2zm2-4H5a1 1 0 0 1 0-2h4a1 1 0 0 1 0 2z"/><path d="m20.587 13.696-.787-.131a3.503 3.503 0 0 0-.593-1.051l.301-.804a.46.46 0 0 0-.21-.56l-1.005-.581a.52.52 0 0 0-.656.113l-.499.607a3.53 3.53 0 0 0-1.276 0l-.499-.607a.52.52 0 0 0-.656-.113l-1.005.581a.46.46 0 0 0-.21.56l.301.804c-.254.31-.456.665-.593 1.051l-.787.131a.48.48 0 0 0-.413.465v1.209a.48.48 0 0 0 .413.465l.811.135c.144.382.353.733.614 1.038l-.292.78a.46.46 0 0 0 .21.56l1.005.581a.52.52 0 0 0 .656-.113l.515-.626a3.549 3.549 0 0 0 1.136 0l.515.626a.52.52 0 0 0 .656.113l1.005-.581a.46.46 0 0 0 .21-.56l-.292-.78c.261-.305.47-.656.614-1.038l.811-.135A.48.48 0 0 0 21 15.37v-1.209a.48.48 0 0 0-.413-.465zM16.5 16.057a1.29 1.29 0 1 1 .002-2.582 1.29 1.29 0 0 1-.002 2.582z"/></svg>'},{}],hltwt:[function(B,$,K){$.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" width="24" height="24"><path d="M17 16H5c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1zM6.96 15c.39 0 .74-.24.89-.6l.65-1.6h5l.66 1.6c.15.36.5.6.89.6.69 0 1.15-.71.88-1.34l-3.88-8.97C11.87 4.27 11.46 4 11 4s-.87.27-1.05.69l-3.88 8.97c-.27.63.2 1.34.89 1.34zM11 5.98 12.87 11H9.13L11 5.98z"/></svg>'},{}]},["E13ST"],"E13ST")})($e);const at=Ue($e.exports);var Ye={exports:{}};(function(Ie,Ne){typeof window<"u"&&function($,K){Ie.exports=K()}(Re,()=>(()=>{var B={"./src/config.ts":(O,R,s)=>{s.r(R),s.d(R,{enableStreamingMode:()=>h,hlsDefaultConfig:()=>u,mergeConfig:()=>t});var D=s("./src/controller/abr-controller.ts"),g=s("./src/controller/audio-stream-controller.ts"),b=s("./src/controller/audio-track-controller.ts"),c=s("./src/controller/subtitle-stream-controller.ts"),C=s("./src/controller/subtitle-track-controller.ts"),x=s("./src/controller/buffer-controller.ts"),E=s("./src/controller/timeline-controller.ts"),T=s("./src/controller/cap-level-controller.ts"),L=s("./src/controller/fps-controller.ts"),I=s("./src/controller/eme-controller.ts"),r=s("./src/controller/cmcd-controller.ts"),_=s("./src/utils/xhr-loader.ts"),v=s("./src/utils/fetch-loader.ts"),n=s("./src/utils/cues.ts"),l=s("./src/utils/mediakeys-helper.ts"),i=s("./src/utils/logger.ts");function a(){return a=Object.assign?Object.assign.bind():function(e){for(var y=1;y<arguments.length;y++){var P=arguments[y];for(var S in P)Object.prototype.hasOwnProperty.call(P,S)&&(e[S]=P[S])}return e},a.apply(this,arguments)}function m(e,y){var P=Object.keys(e);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(e);y&&(S=S.filter(function(w){return Object.getOwnPropertyDescriptor(e,w).enumerable})),P.push.apply(P,S)}return P}function p(e){for(var y=1;y<arguments.length;y++){var P=arguments[y]!=null?arguments[y]:{};y%2?m(Object(P),!0).forEach(function(S){o(e,S,P[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(P)):m(Object(P)).forEach(function(S){Object.defineProperty(e,S,Object.getOwnPropertyDescriptor(P,S))})}return e}function o(e,y,P){return y=d(y),y in e?Object.defineProperty(e,y,{value:P,enumerable:!0,configurable:!0,writable:!0}):e[y]=P,e}function d(e){var y=A(e,"string");return typeof y=="symbol"?y:String(y)}function A(e,y){if(typeof e!="object"||e===null)return e;var P=e[Symbol.toPrimitive];if(P!==void 0){var S=P.call(e,y||"default");if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(e)}var u=p(p({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:_.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:D.default,bufferController:x.default,capLevelController:T.default,fpsController:L.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:l.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},f()),{},{subtitleStreamController:c.SubtitleStreamController,subtitleTrackController:C.default,timelineController:E.TimelineController,audioStreamController:g.default,audioTrackController:b.default,emeController:I.default,cmcdController:r.default});function f(){return{cueHandler:n.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function t(e,y){if((y.liveSyncDurationCount||y.liveMaxLatencyDurationCount)&&(y.liveSyncDuration||y.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(y.liveMaxLatencyDurationCount!==void 0&&(y.liveSyncDurationCount===void 0||y.liveMaxLatencyDurationCount<=y.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(y.liveMaxLatencyDuration!==void 0&&(y.liveSyncDuration===void 0||y.liveMaxLatencyDuration<=y.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return a({},e,y)}function h(e){var y=e.loader;if(y!==v.default&&y!==_.default)i.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{var P=(0,v.fetchSupported)();P&&(e.loader=v.default,e.progressive=!0,e.enableSoftwareAES=!0,i.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>_});var D=s("./src/polyfills/number.ts"),g=s("./src/utils/ewma-bandwidth-estimator.ts"),b=s("./src/events.ts"),c=s("./src/errors.ts"),C=s("./src/types/loader.ts"),x=s("./src/utils/logger.ts");function E(v,n){for(var l=0;l<n.length;l++){var i=n[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(v,L(i.key),i)}}function T(v,n,l){return n&&E(v.prototype,n),l&&E(v,l),Object.defineProperty(v,"prototype",{writable:!1}),v}function L(v){var n=I(v,"string");return typeof n=="symbol"?n:String(n)}function I(v,n){if(typeof v!="object"||v===null)return v;var l=v[Symbol.toPrimitive];if(l!==void 0){var i=l.call(v,n||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(v)}var r=function(){function v(l){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=l;var i=l.config;this.bwEstimator=new g.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var n=v.prototype;return n.registerListeners=function(){var i=this.hls;i.on(b.Events.FRAG_LOADING,this.onFragLoading,this),i.on(b.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(b.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){var i=this.hls;i.off(b.Events.FRAG_LOADING,this.onFragLoading,this),i.off(b.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(b.Events.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},n.onFragLoading=function(i,a){var m=a.frag;if(m.type===C.PlaylistLevelType.MAIN&&!this.timer){var p;this.fragCurrent=m,this.partCurrent=(p=a.part)!=null?p:null,this.timer=self.setInterval(this.onCheck,100)}},n.onLevelLoaded=function(i,a){var m=this.hls.config;a.details.live?this.bwEstimator.update(m.abrEwmaSlowLive,m.abrEwmaFastLive):this.bwEstimator.update(m.abrEwmaSlowVoD,m.abrEwmaFastVoD)},n._abandonRulesCheck=function(){var i=this.fragCurrent,a=this.partCurrent,m=this.hls,p=m.autoLevelEnabled,o=m.media;if(!(!i||!o)){var d=a?a.stats:i.stats,A=a?a.duration:i.duration;if(d.aborted||d.loaded&&d.loaded===d.total||i.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!p||o.paused||!o.playbackRate||!o.readyState)){var u=m.mainForwardBufferInfo;if(u!==null){var f=performance.now()-d.loading.start,t=Math.abs(o.playbackRate);if(!(f<=500*A/t)){var h=d.loaded&&d.loading.first,e=this.bwEstimator.getEstimate(),y=m.levels,P=m.minAutoLevel,S=y[i.level],w=d.total||Math.max(d.loaded,Math.round(A*S.maxBitrate/8)),k=h?d.loaded*1e3/f:0,F=k?(w-d.loaded)/k:w*8/e,U=u.len/t;if(!(F<=U)){var N=Number.POSITIVE_INFINITY,j;for(j=i.level-1;j>P;j--){var W=y[j].maxBitrate;if(N=k?A*W/(8*.8*k):A*W/e,N<U)break}N>=F||(x.logger.warn("Fragment "+i.sn+(a?" part "+a.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+j+`
      Current BW estimate: `+((0,D.isFiniteNumber)(e)?(e/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+F.toFixed(3)+` s
      Estimated load time for the next fragment: `+N.toFixed(3)+` s
      Time to underbuffer: `+U.toFixed(3)+" s"),m.nextLoadLevel=j,h&&this.bwEstimator.sample(f,d.loaded),this.clearTimer(),(i.loader||i.keyLoader)&&(this.fragCurrent=this.partCurrent=null,i.abortRequests()),m.trigger(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:a,stats:d}))}}}}}},n.onFragLoaded=function(i,a){var m=a.frag,p=a.part;if(m.type===C.PlaylistLevelType.MAIN&&(0,D.isFiniteNumber)(m.sn)){var o=p?p.stats:m.stats,d=p?p.duration:m.duration;if(this.clearTimer(),this.lastLoadedFragLevel=m.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var A=this.hls.levels[m.level],u=(A.loaded?A.loaded.bytes:0)+o.loaded,f=(A.loaded?A.loaded.duration:0)+d;A.loaded={bytes:u,duration:f},A.realBitrate=Math.round(8*u/f)}if(m.bitrateTest){var t={stats:o,frag:m,part:p,id:m.type};this.onFragBuffered(b.Events.FRAG_BUFFERED,t)}}},n.onFragBuffered=function(i,a){var m=a.frag,p=a.part,o=p?p.stats:m.stats;if(!o.aborted&&!(m.type!==C.PlaylistLevelType.MAIN||m.sn==="initSegment")){var d=o.parsing.end-o.loading.start;this.bwEstimator.sample(d,o.loaded),o.bwEstimate=this.bwEstimator.getEstimate(),m.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0}},n.onError=function(i,a){var m;if(((m=a.frag)===null||m===void 0?void 0:m.type)===C.PlaylistLevelType.MAIN){if(a.type===c.ErrorTypes.KEY_SYSTEM_ERROR){this.clearTimer();return}switch(a.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer();break}}},n.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},n.getNextABRAutoLevel=function(){var i=this.fragCurrent,a=this.partCurrent,m=this.hls,p=m.maxAutoLevel,o=m.config,d=m.minAutoLevel,A=m.media,u=a?a.duration:i?i.duration:0,f=A&&A.playbackRate!==0?Math.abs(A.playbackRate):1,t=this.bwEstimator?this.bwEstimator.getEstimate():o.abrEwmaDefaultEstimate,h=m.mainForwardBufferInfo,e=(h?h.len:0)/f,y=this.findBestLevel(t,d,p,e,o.abrBandWidthFactor,o.abrBandWidthUpFactor);if(y>=0)return y;x.logger.trace((e?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var P=u?Math.min(u,o.maxStarvationDelay):o.maxStarvationDelay,S=o.abrBandWidthFactor,w=o.abrBandWidthUpFactor;if(!e){var k=this.bitrateTestDelay;if(k){var F=u?Math.min(u,o.maxLoadingDelay):o.maxLoadingDelay;P=F-k,x.logger.trace("bitrate test took "+Math.round(1e3*k)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*P)+" ms"),S=w=1}}return y=this.findBestLevel(t,d,p,e+P,S,w),Math.max(y,0)},n.findBestLevel=function(i,a,m,p,o,d){for(var A,u=this.fragCurrent,f=this.partCurrent,t=this.lastLoadedFragLevel,h=this.hls.levels,e=h[t],y=!!(e!=null&&(A=e.details)!==null&&A!==void 0&&A.live),P=e==null?void 0:e.codecSet,S=f?f.duration:u?u.duration:0,w=m;w>=a;w--){var k=h[w];if(!(!k||P&&k.codecSet!==P)){var F=k.details,U=(f?F==null?void 0:F.partTarget:F==null?void 0:F.averagetargetduration)||S,N=void 0;w<=t?N=o*i:N=d*i;var j=h[w].maxBitrate,W=j*U/N;if(x.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+w+"/"+Math.round(N)+"/"+j+"/"+U+"/"+p+"/"+W),N>j&&(W===0||!(0,D.isFiniteNumber)(W)||y&&!this.bitrateTestDelay||W<p))return w}}return-1},T(v,[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,a=this.bwEstimator;if(i!==-1&&!a.canEstimate())return i;var m=this.getNextABRAutoLevel();return i!==-1&&this.hls.levels[m].loadError?i:(i!==-1&&(m=Math.min(i,m)),m)},set:function(i){this._nextAutoLevel=i}}]),v}();const _=r},"./src/controller/audio-stream-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>o});var D=s("./src/polyfills/number.ts"),g=s("./src/controller/base-stream-controller.ts"),b=s("./src/events.ts"),c=s("./src/utils/buffer-helper.ts"),C=s("./src/controller/fragment-tracker.ts"),x=s("./src/types/level.ts"),E=s("./src/types/loader.ts"),T=s("./src/loader/fragment.ts"),L=s("./src/demux/chunk-cache.ts"),I=s("./src/demux/transmuxer-interface.ts"),r=s("./src/types/transmuxer.ts"),_=s("./src/controller/fragment-finders.ts"),v=s("./src/utils/discontinuities.ts"),n=s("./src/errors.ts");function l(){return l=Object.assign?Object.assign.bind():function(d){for(var A=1;A<arguments.length;A++){var u=arguments[A];for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(d[f]=u[f])}return d},l.apply(this,arguments)}function i(d,A){d.prototype=Object.create(A.prototype),d.prototype.constructor=d,a(d,A)}function a(d,A){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,t){return f.__proto__=t,f},a(d,A)}var m=100,p=function(d){i(A,d);function A(f,t,h){var e;return e=d.call(this,f,t,h,"[audio-stream-controller]")||this,e.videoBuffer=null,e.videoTrackCC=-1,e.waitingVideoCC=-1,e.audioSwitch=!1,e.trackId=-1,e.waitingData=null,e.mainDetails=null,e.bufferFlushed=!1,e.cachedTrackLoadedData=null,e._registerListeners(),e}var u=A.prototype;return u.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},u._registerListeners=function(){var t=this.hls;t.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(b.Events.ERROR,this.onError,this),t.on(b.Events.BUFFER_RESET,this.onBufferReset,this),t.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u._unregisterListeners=function(){var t=this.hls;t.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(b.Events.ERROR,this.onError,this),t.off(b.Events.BUFFER_RESET,this.onBufferReset,this),t.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u.onInitPtsFound=function(t,h){var e=h.frag,y=h.id,P=h.initPTS;if(y==="main"){var S=e.cc;this.initPTS[e.cc]=P,this.log("InitPTS for cc: "+S+" found from main: "+P),this.videoTrackCC=S,this.state===g.State.WAITING_INIT_PTS&&this.tick()}},u.startLoad=function(t){if(!this.levels){this.startPosition=t,this.state=g.State.STOPPED;return}var h=this.lastCurrentTime;this.stopLoad(),this.setInterval(m),this.fragLoadError=0,h>0&&t===-1?(this.log("Override startPosition with lastCurrentTime @"+h.toFixed(3)),t=h,this.state=g.State.IDLE):(this.loadedmetadata=!1,this.state=g.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},u.doTick=function(){switch(this.state){case g.State.IDLE:this.doTickIdle();break;case g.State.WAITING_TRACK:{var t,h=this.levels,e=this.trackId,y=h==null||(t=h[e])===null||t===void 0?void 0:t.details;if(y){if(this.waitForCdnTuneIn(y))break;this.state=g.State.WAITING_INIT_PTS}break}case g.State.FRAG_LOADING_WAITING_RETRY:{var P,S=performance.now(),w=this.retryDate;(!w||S>=w||(P=this.media)!==null&&P!==void 0&&P.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=g.State.IDLE);break}case g.State.WAITING_INIT_PTS:{var k=this.waitingData;if(k){var F=k.frag,U=k.part,N=k.cache,j=k.complete;if(this.initPTS[F.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=g.State.FRAG_LOADING;var W=N.flush(),H={frag:F,part:U,payload:W,networkDetails:null};this._handleFragmentLoadProgress(H),j&&d.prototype._handleFragmentLoadComplete.call(this,H)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+F.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var G=this.getLoadPosition(),V=c.BufferHelper.bufferInfo(this.mediaBuffer,G,this.config.maxBufferHole),Y=(0,_.fragmentWithinToleranceTest)(V.end,this.config.maxFragLookUpTolerance,F);Y<0&&(this.log("Waiting fragment cc ("+F.cc+") @ "+F.start+" cancelled because another fragment at "+V.end+" is needed"),this.clearWaitingFragment())}}else this.state=g.State.IDLE}}this.onTickEnd()},u.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=g.State.IDLE)},u.resetLoadingState=function(){this.clearWaitingFragment(),d.prototype.resetLoadingState.call(this)},u.onTickEnd=function(){var t=this.media;!t||!t.readyState||(this.lastCurrentTime=t.currentTime)},u.doTickIdle=function(){var t=this.hls,h=this.levels,e=this.media,y=this.trackId,P=t.config;if(!(!h||!h[y])&&!(!e&&(this.startFragRequested||!P.startFragPrefetch))){var S=h[y],w=S.details;if(!w||w.live&&this.levelLastLoaded!==y||this.waitForCdnTuneIn(w)){this.state=g.State.WAITING_TRACK;return}var k=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&k&&(this.bufferFlushed=!1,this.afterBufferFlushed(k,T.ElementaryStreamTypes.AUDIO,E.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(k,E.PlaylistLevelType.AUDIO);if(F!==null){var U=this.audioSwitch;if(!U&&this._streamEnded(F,w)){t.trigger(b.Events.BUFFER_EOS,{type:"audio"}),this.state=g.State.ENDED;return}var N=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,E.PlaylistLevelType.MAIN),j=F.len,W=this.getMaxBufferLength(N==null?void 0:N.len);if(!(j>=W&&!U)){var H=w.fragments,G=H[0].start,V=F.end;if(U&&e){var Y=this.getLoadPosition();V=Y,w.PTSKnown&&Y<G&&(F.end>G||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),e.currentTime=G+.05)}if(!(N&&V>N.end+w.targetduration)&&!((!N||!N.len)&&F.len)){var Q=this.getNextFragment(V,w);if(!Q){this.bufferFlushed=!0;return}this.loadFragment(Q,w,V)}}}}},u.getMaxBufferLength=function(t){var h=d.prototype.getMaxBufferLength.call(this);return t?Math.max(h,t):h},u.onMediaDetaching=function(){this.videoBuffer=null,d.prototype.onMediaDetaching.call(this)},u.onAudioTracksUpdated=function(t,h){var e=h.audioTracks;this.resetTransmuxer(),this.levels=e.map(function(y){return new x.Level(y)})},u.onAudioTrackSwitching=function(t,h){var e=!!h.url;this.trackId=h.id;var y=this.fragCurrent;y&&y.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),e?this.setInterval(m):this.resetTransmuxer(),e?(this.audioSwitch=!0,this.state=g.State.IDLE):this.state=g.State.STOPPED,this.tick()},u.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},u.onLevelLoaded=function(t,h){this.mainDetails=h.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(b.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},u.onAudioTrackLoaded=function(t,h){var e;if(this.mainDetails==null){this.cachedTrackLoadedData=h;return}var y=this.levels,P=h.details,S=h.id;if(!y){this.warn("Audio tracks were reset while loading level "+S);return}this.log("Track "+S+" loaded ["+P.startSN+","+P.endSN+"],duration:"+P.totalduration);var w=y[S],k=0;if(P.live||(e=w.details)!==null&&e!==void 0&&e.live){var F=this.mainDetails;if(P.fragments[0]||(P.deltaUpdateFailed=!0),P.deltaUpdateFailed||!F)return;!w.details&&P.hasProgramDateTime&&F.hasProgramDateTime?((0,v.alignMediaPlaylistByPDT)(P,F),k=P.fragments[0].start):k=this.alignPlaylists(P,w.details)}w.details=P,this.levelLastLoaded=S,!this.startFragRequested&&(this.mainDetails||!P.live)&&this.setStartPosition(w.details,k),this.state===g.State.WAITING_TRACK&&!this.waitForCdnTuneIn(P)&&(this.state=g.State.IDLE),this.tick()},u._handleFragmentLoadProgress=function(t){var h,e=t.frag,y=t.part,P=t.payload,S=this.config,w=this.trackId,k=this.levels;if(!k){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered");return}var F=k[w];console.assert(F,"Audio track is defined on fragment load progress");var U=F.details;console.assert(U,"Audio track details are defined on fragment load progress");var N=S.defaultAudioCodec||F.audioCodec||"mp4a.40.2",j=this.transmuxer;j||(j=this.transmuxer=new I.default(this.hls,E.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var W=this.initPTS[e.cc],H=(h=e.initSegment)===null||h===void 0?void 0:h.data;if(W!==void 0){var G=!1,V=y?y.index:-1,Y=V!==-1,Q=new r.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,P.byteLength,V,Y);j.push(P,H,N,"",e,y,U.totalduration,G,Q,W)}else{this.log("Unknown video PTS for cc "+e.cc+", waiting for video PTS before demuxing audio frag "+e.sn+" of ["+U.startSN+" ,"+U.endSN+"],track "+w);var z=this.waitingData=this.waitingData||{frag:e,part:y,cache:new L.default,complete:!1},X=z.cache;X.push(new Uint8Array(P)),this.waitingVideoCC=this.videoTrackCC,this.state=g.State.WAITING_INIT_PTS}},u._handleFragmentLoadComplete=function(t){if(this.waitingData){this.waitingData.complete=!0;return}d.prototype._handleFragmentLoadComplete.call(this,t)},u.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},u.onBufferCreated=function(t,h){var e=h.tracks.audio;e&&(this.mediaBuffer=e.buffer||null),h.tracks.video&&(this.videoBuffer=h.tracks.video.buffer||null)},u.onFragBuffered=function(t,h){var e=h.frag,y=h.part;if(e.type!==E.PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&e.type===E.PlaylistLevelType.MAIN){var P;(P=this.videoBuffer||this.media)!==null&&P!==void 0&&P.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(e)){this.warn("Fragment "+e.sn+(y?" p: "+y.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}e.sn!=="initSegment"&&(this.fragPrevious=e,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(e,y)},u.onError=function(t,h){if(h.type===n.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(E.PlaylistLevelType.AUDIO,h);return}switch(h.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.FRAG_PARSING_ERROR:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(E.PlaylistLevelType.AUDIO,h);break;case n.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case n.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==g.State.ERROR&&this.state!==g.State.STOPPED&&(this.state=h.fatal?g.State.ERROR:g.State.IDLE,this.warn(h.details+" while loading frag, switching to "+this.state+" state"));break;case n.ErrorDetails.BUFFER_FULL_ERROR:if(h.parent==="audio"&&(this.state===g.State.PARSING||this.state===g.State.PARSED)){var e=!0,y=this.getFwdBufferInfo(this.mediaBuffer,E.PlaylistLevelType.AUDIO);y&&y.len>.5&&(e=!this.reduceMaxBufferLength(y.len)),e&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},u.onBufferFlushed=function(t,h){var e=h.type;e===T.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===g.State.ENDED&&(this.state=g.State.IDLE))},u._handleTransmuxComplete=function(t){var h,e="audio",y=this.hls,P=t.remuxResult,S=t.chunkMeta,w=this.getCurrentContext(S);if(!w){this.warn("The loading context changed while buffering fragment "+S.sn+" of level "+S.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(S.level);return}var k=w.frag,F=w.part,U=w.level.details,N=P.audio,j=P.text,W=P.id3,H=P.initSegment;if(!(this.fragContextChanged(k)||!U)){if(this.state=g.State.PARSING,this.audioSwitch&&N&&this.completeAudioSwitch(),H!=null&&H.tracks&&(this._bufferInitSegment(H.tracks,k,S),y.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:k,id:e,tracks:H.tracks})),N){var G=N.startPTS,V=N.endPTS,Y=N.startDTS,Q=N.endDTS;F&&(F.elementaryStreams[T.ElementaryStreamTypes.AUDIO]={startPTS:G,endPTS:V,startDTS:Y,endDTS:Q}),k.setElementaryStreamInfo(T.ElementaryStreamTypes.AUDIO,G,V,Y,Q),this.bufferFragmentData(N,k,F,S)}if(W!=null&&(h=W.samples)!==null&&h!==void 0&&h.length){var z=l({id:e,frag:k,details:U},W);y.trigger(b.Events.FRAG_PARSING_METADATA,z)}if(j){var X=l({id:e,frag:k,details:U},j);y.trigger(b.Events.FRAG_PARSING_USERDATA,X)}}},u._bufferInitSegment=function(t,h,e){if(this.state===g.State.PARSING){t.video&&delete t.video;var y=t.audio;if(!!y){y.levelCodec=y.codec,y.id="audio",this.log("Init audio buffer, container:"+y.container+", codecs[parsed]=["+y.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,t);var P=y.initSegment;if(P!=null&&P.byteLength){var S={type:"audio",frag:h,part:null,chunkMeta:e,parent:h.type,data:P};this.hls.trigger(b.Events.BUFFER_APPENDING,S)}this.tick()}}},u.loadFragment=function(t,h,e){var y=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||y===C.FragmentState.NOT_LOADED||y===C.FragmentState.PARTIAL)&&(t.sn==="initSegment"?this._loadInitSegment(t,h):h.live&&!(0,D.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=g.State.WAITING_INIT_PTS):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,t,h,e)))},u.completeAudioSwitch=function(){var t=this.hls,h=this.media,e=this.trackId;h&&(this.log("Switching audio track : flushing all audio"),d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:e})},A}(g.default);const o=p},"./src/controller/audio-track-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>_});var D=s("./src/events.ts"),g=s("./src/errors.ts"),b=s("./src/controller/base-playlist-controller.ts"),c=s("./src/types/loader.ts");function C(v,n){for(var l=0;l<n.length;l++){var i=n[l];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(v,E(i.key),i)}}function x(v,n,l){return n&&C(v.prototype,n),l&&C(v,l),Object.defineProperty(v,"prototype",{writable:!1}),v}function E(v){var n=T(v,"string");return typeof n=="symbol"?n:String(n)}function T(v,n){if(typeof v!="object"||v===null)return v;var l=v[Symbol.toPrimitive];if(l!==void 0){var i=l.call(v,n||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(v)}function L(v,n){v.prototype=Object.create(n.prototype),v.prototype.constructor=v,I(v,n)}function I(v,n){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},I(v,n)}var r=function(v){L(n,v);function n(i){var a;return a=v.call(this,i,"[audio-track-controller]")||this,a.tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.trackName="",a.selectDefaultTrack=!0,a.registerListeners(),a}var l=n.prototype;return l.registerListeners=function(){var a=this.hls;a.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(D.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var a=this.hls;a.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(D.Events.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,v.prototype.destroy.call(this)},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},l.onManifestParsed=function(a,m){this.tracks=m.audioTracks||[]},l.onAudioTrackLoaded=function(a,m){var p=m.id,o=m.details,d=this.tracksInGroup[p];if(!d){this.warn("Invalid audio track id "+p);return}var A=d.details;d.details=m.details,this.log("audioTrack "+p+" loaded ["+o.startSN+"-"+o.endSN+"]"),p===this.trackId&&(this.retryCount=0,this.playlistLoaded(p,m,A))},l.onLevelLoading=function(a,m){this.switchLevel(m.level)},l.onLevelSwitching=function(a,m){this.switchLevel(m.level)},l.switchLevel=function(a){var m=this.hls.levels[a];if(!!(m!=null&&m.audioGroupIds)){var p=m.audioGroupIds[m.urlId];if(this.groupId!==p){this.groupId=p;var o=this.tracks.filter(function(A){return!p||A.groupId===p});this.selectDefaultTrack&&!o.some(function(A){return A.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=o;var d={audioTracks:o};this.log("Updating audio tracks, "+o.length+' track(s) found in "'+p+'" group-id'),this.hls.trigger(D.Events.AUDIO_TRACKS_UPDATED,d),this.selectInitialTrack()}}},l.onError=function(a,m){v.prototype.onError.call(this,a,m),!(m.fatal||!m.context)&&m.context.type===c.PlaylistContextType.AUDIO_TRACK&&m.context.id===this.trackId&&m.context.groupId===this.groupId&&this.retryLoadingOrFail(m)},l.setAudioTrack=function(a){var m=this.tracksInGroup;if(a<0||a>=m.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var p=m[this.trackId];this.log("Now switching to audio-track index "+a);var o=m[a],d=o.id,A=o.groupId,u=A===void 0?"":A,f=o.name,t=o.type,h=o.url;if(this.trackId=a,this.trackName=f,this.selectDefaultTrack=!1,this.hls.trigger(D.Events.AUDIO_TRACK_SWITCHING,{id:d,groupId:u,name:f,type:t,url:h}),!(o.details&&!o.details.live)){var e=this.switchParams(o.url,p==null?void 0:p.details);this.loadPlaylist(e)}},l.selectInitialTrack=function(){var a=this.tracksInGroup;console.assert(a.length,"Initial audio track should be selected when tracks are known");var m=this.trackName,p=this.findTrackId(m)||this.findTrackId();p!==-1?this.setAudioTrack(p):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},l.findTrackId=function(a){for(var m=this.tracksInGroup,p=0;p<m.length;p++){var o=m[p];if((!this.selectDefaultTrack||o.default)&&(!a||a===o.name))return o.id}return-1},l.loadPlaylist=function(a){v.prototype.loadPlaylist.call(this);var m=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(m)){var p=m.id,o=m.groupId,d=m.url;if(a)try{d=a.addDirectives(d)}catch(A){this.warn("Could not construct new URL with HLS Delivery Directives: "+A)}this.log("loading audio-track playlist for id: "+p),this.clearTimer(),this.hls.trigger(D.Events.AUDIO_TRACK_LOADING,{url:d,id:p,groupId:o,deliveryDirectives:a||null})}},x(n,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1,this.setAudioTrack(a)}}]),n}(b.default);const _=r},"./src/controller/base-playlist-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>C});var D=s("./src/types/level.ts"),g=s("./src/controller/level-helper.ts"),b=s("./src/utils/logger.ts"),c=s("./src/errors.ts"),C=function(){function x(T,L){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,L+":"),this.warn=b.logger.warn.bind(b.logger,L+":"),this.hls=T}var E=x.prototype;return E.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},E.onError=function(L,I){I.fatal&&(I.type===c.ErrorTypes.NETWORK_ERROR||I.type===c.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},E.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},E.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},E.stopLoad=function(){this.canLoad=!1,this.clearTimer()},E.switchParams=function(L,I){var r=I==null?void 0:I.renditionReports;if(r)for(var _=0;_<r.length;_++){var v=r[_],n=void 0;try{n=new self.URL(v.URI,I.url).href}catch(m){b.logger.warn("Could not construct new URL for Rendition Report: "+m),n=v.URI||""}if(n===L.slice(-n.length)){var l=parseInt(v["LAST-MSN"])||(I==null?void 0:I.lastPartSn),i=parseInt(v["LAST-PART"])||(I==null?void 0:I.lastPartIndex);if(this.hls.config.lowLatencyMode){var a=Math.min(I.age-I.partTarget,I.targetduration);i>=0&&a>I.partTarget&&(i+=1)}return new D.HlsUrlParameters(l,i>=0?i:void 0,D.HlsSkip.No)}}},E.loadPlaylist=function(L){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},E.shouldLoadTrack=function(L){return this.canLoad&&L&&!!L.url&&(!L.details||L.details.live)},E.playlistLoaded=function(L,I,r){var _=this,v=I.details,n=I.stats,l=self.performance.now(),i=n.loading.first?Math.max(0,l-n.loading.first):0;if(v.advancedDateTime=Date.now()-i,v.live||r!=null&&r.live){if(v.reloaded(r),r&&this.log("live playlist "+L+" "+(v.advanced?"REFRESHED "+v.lastPartSn+"-"+v.lastPartIndex:"MISSED")),r&&v.fragments.length>0&&(0,g.mergeDetails)(r,v),!this.canLoad||!v.live)return;var a,m=void 0,p=void 0;if(v.canBlockReload&&v.endSN&&v.advanced){var o=this.hls.config.lowLatencyMode,d=v.lastPartSn,A=v.endSN,u=v.lastPartIndex,f=u!==-1,t=d===A,h=o?0:u;f?(m=t?A+1:d,p=t?h:u+1):m=A+1;var e=v.age,y=e+v.ageHeader,P=Math.min(y-v.partTarget,v.targetduration*1.5);if(P>0){if(r&&P>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+P+" with playlist age: "+v.age),P=0;else{var S=Math.floor(P/v.targetduration);if(m+=S,p!==void 0){var w=Math.round(P%v.targetduration/v.partTarget);p+=w}this.log("CDN Tune-in age: "+v.ageHeader+"s last advanced "+e.toFixed(2)+"s goal: "+P+" skip sn "+S+" to part "+p)}v.tuneInGoal=P}if(a=this.getDeliveryDirectives(v,I.deliveryDirectives,m,p),o||!t){this.loadPlaylist(a);return}}else a=this.getDeliveryDirectives(v,I.deliveryDirectives,m,p);var k=this.hls.mainForwardBufferInfo,F=k?k.end-k.len:0,U=(v.edge-F)*1e3,N=(0,g.computeReloadInterval)(v,U);v.updated?l>this.requestScheduled+N&&(this.requestScheduled=n.loading.start):this.requestScheduled=-1,m!==void 0&&v.canBlockReload?this.requestScheduled=n.loading.first+N-(v.partTarget*1e3||1e3):this.requestScheduled=(this.requestScheduled===-1?l:this.requestScheduled)+N;var j=this.requestScheduled-l;j=Math.max(0,j),this.log("reload live playlist "+L+" in "+Math.round(j)+" ms"),this.timer=self.setTimeout(function(){return _.loadPlaylist(a)},j)}else this.clearTimer()},E.getDeliveryDirectives=function(L,I,r,_){var v=(0,D.getSkipValue)(L,r);return I!=null&&I.skip&&L.deltaUpdateFailed&&(r=I.msn,_=I.part,v=D.HlsSkip.No),new D.HlsUrlParameters(r,_,v)},E.retryLoadingOrFail=function(L){var I=this,r=this.hls.config,_=this.retryCount<r.levelLoadingMaxRetry;if(_){var v;if(this.requestScheduled=-1,this.retryCount++,L.details.indexOf("LoadTimeOut")>-1&&(v=L.context)!==null&&v!==void 0&&v.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+L.details+'"'),this.loadPlaylist();else{var n=Math.min(Math.pow(2,this.retryCount)*r.levelLoadingRetryDelay,r.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return I.loadPlaylist()},n),this.warn("retry playlist loading #"+this.retryCount+" in "+n+' ms after "'+L.details+'"')}}else this.warn('cannot recover from error "'+L.details+'"'),this.clearTimer(),L.fatal=!0;return _},x}()},"./src/controller/base-stream-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{State:()=>f,default:()=>t});var D=s("./src/polyfills/number.ts"),g=s("./src/task-loop.ts"),b=s("./src/controller/fragment-tracker.ts"),c=s("./src/utils/buffer-helper.ts"),C=s("./src/utils/logger.ts"),x=s("./src/events.ts"),E=s("./src/errors.ts"),T=s("./src/types/transmuxer.ts"),L=s("./src/utils/mp4-tools.ts"),I=s("./src/utils/discontinuities.ts"),r=s("./src/controller/fragment-finders.ts"),_=s("./src/controller/level-helper.ts"),v=s("./src/loader/fragment-loader.ts"),n=s("./src/crypt/decrypter.ts"),l=s("./src/utils/time-ranges.ts"),i=s("./src/types/loader.ts");function a(h,e){for(var y=0;y<e.length;y++){var P=e[y];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(h,p(P.key),P)}}function m(h,e,y){return e&&a(h.prototype,e),y&&a(h,y),Object.defineProperty(h,"prototype",{writable:!1}),h}function p(h){var e=o(h,"string");return typeof e=="symbol"?e:String(e)}function o(h,e){if(typeof h!="object"||h===null)return h;var y=h[Symbol.toPrimitive];if(y!==void 0){var P=y.call(h,e||"default");if(typeof P!="object")return P;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(h)}function d(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function A(h,e){h.prototype=Object.create(e.prototype),h.prototype.constructor=h,u(h,e)}function u(h,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(P,S){return P.__proto__=S,P},u(h,e)}var f={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},t=function(h){A(e,h);function e(P,S,w,k){var F;return F=h.call(this)||this,F.hls=void 0,F.fragPrevious=null,F.fragCurrent=null,F.fragmentTracker=void 0,F.transmuxer=null,F._state=f.STOPPED,F.media=null,F.mediaBuffer=null,F.config=void 0,F.bitrateTest=!1,F.lastCurrentTime=0,F.nextLoadPosition=0,F.startPosition=0,F.loadedmetadata=!1,F.fragLoadError=0,F.retryDate=0,F.levels=null,F.fragmentLoader=void 0,F.keyLoader=void 0,F.levelLastLoaded=null,F.startFragRequested=!1,F.decrypter=void 0,F.initPTS=[],F.onvseeking=null,F.onvended=null,F.logPrefix="",F.log=void 0,F.warn=void 0,F.logPrefix=k,F.log=C.logger.log.bind(C.logger,k+":"),F.warn=C.logger.warn.bind(C.logger,k+":"),F.hls=P,F.fragmentLoader=new v.default(P.config),F.keyLoader=w,F.fragmentTracker=S,F.config=P.config,F.decrypter=new n.default(P.config),P.on(x.Events.LEVEL_SWITCHING,F.onLevelSwitching,d(F)),F}var y=e.prototype;return y.doTick=function(){this.onTickEnd()},y.onTickEnd=function(){},y.startLoad=function(S){},y.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var S=this.fragCurrent;S&&(S.abortRequests(),this.fragmentTracker.removeFragment(S)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=f.STOPPED},y._streamEnded=function(S,w){if(w.live||S.nextStart||!S.end||!this.media)return!1;var k=w.partList;if(k!=null&&k.length){var F=k[k.length-1],U=c.BufferHelper.isBuffered(this.media,F.start+F.duration/2);return U}var N=w.fragments[w.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(N)},y.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var S;return(S=this.levels[this.levelLastLoaded])===null||S===void 0?void 0:S.details}},y.onMediaAttached=function(S,w){var k=this.media=this.mediaBuffer=w.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),k.addEventListener("seeking",this.onvseeking),k.addEventListener("ended",this.onvended);var F=this.config;this.levels&&F.autoStartLoad&&this.state===f.STOPPED&&this.startLoad(F.startPosition)},y.onMediaDetaching=function(){var S=this.media;S!=null&&S.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),S&&this.onvseeking&&this.onvended&&(S.removeEventListener("seeking",this.onvseeking),S.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},y.onMediaSeeking=function(){var S=this.config,w=this.fragCurrent,k=this.media,F=this.mediaBuffer,U=this.state,N=k?k.currentTime:0,j=c.BufferHelper.bufferInfo(F||k,N,S.maxBufferHole);if(this.log("media seeking to "+((0,D.isFiniteNumber)(N)?N.toFixed(3):N)+", state: "+U),this.state===f.ENDED)this.resetLoadingState();else if(w){var W=S.maxFragLookUpTolerance,H=w.start-W,G=w.start+w.duration+W;if(!j.len||G<j.start||H>j.end){var V=N>G;(N<H||V)&&(V&&w.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),w.abortRequests()),this.resetLoadingState())}}k&&(this.lastCurrentTime=N),!this.loadedmetadata&&!j.len&&(this.nextLoadPosition=this.startPosition=N),this.tickImmediate()},y.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},y.onLevelSwitching=function(S,w){this.fragLoadError=0},y.onHandlerDestroying=function(){this.stopLoad(),h.prototype.onHandlerDestroying.call(this)},y.onHandlerDestroyed=function(){this.state=f.STOPPED,this.hls.off(x.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,h.prototype.onHandlerDestroyed.call(this)},y.loadFragment=function(S,w,k){this._loadFragForPlayback(S,w,k)},y._loadFragForPlayback=function(S,w,k){var F=this,U=function(j){if(F.fragContextChanged(S)){F.warn("Fragment "+S.sn+(j.part?" p: "+j.part.index:"")+" of level "+S.level+" was dropped during download."),F.fragmentTracker.removeFragment(S);return}S.stats.chunkCount++,F._handleFragmentLoadProgress(j)};this._doFragLoad(S,w,k,U).then(function(N){if(!!N){F.fragLoadError=0;var j=F.state;if(F.fragContextChanged(S)){(j===f.FRAG_LOADING||!F.fragCurrent&&j===f.PARSING)&&(F.fragmentTracker.removeFragment(S),F.state=f.IDLE);return}"payload"in N&&(F.log("Loaded fragment "+S.sn+" of level "+S.level),F.hls.trigger(x.Events.FRAG_LOADED,N)),F._handleFragmentLoadComplete(N)}}).catch(function(N){F.state===f.STOPPED||F.state===f.ERROR||(F.warn(N),F.resetFragmentLoading(S))})},y.flushMainBuffer=function(S,w,k){if(k===void 0&&(k=null),!!(S-w)){var F={startOffset:S,endOffset:w,type:k};this.fragLoadError=0,this.hls.trigger(x.Events.BUFFER_FLUSHING,F)}},y._loadInitSegment=function(S,w){var k=this;this._doFragLoad(S,w).then(function(F){if(!F||k.fragContextChanged(S)||!k.levels)throw new Error("init load aborted");return F}).then(function(F){var U=k.hls,N=F.payload,j=S.decryptdata;if(N&&N.byteLength>0&&j&&j.key&&j.iv&&j.method==="AES-128"){var W=self.performance.now();return k.decrypter.decrypt(new Uint8Array(N),j.key.buffer,j.iv.buffer).then(function(H){var G=self.performance.now();return U.trigger(x.Events.FRAG_DECRYPTED,{frag:S,payload:H,stats:{tstart:W,tdecrypt:G}}),F.payload=H,F})}return F}).then(function(F){var U=k.fragCurrent,N=k.hls,j=k.levels;if(!j)throw new Error("init load aborted, missing levels");var W=j[S.level].details;console.assert(W,"Level details are defined when init segment is loaded");var H=S.stats;k.state=f.IDLE,k.fragLoadError=0,S.data=new Uint8Array(F.payload),H.parsing.start=H.buffering.start=self.performance.now(),H.parsing.end=H.buffering.end=self.performance.now(),F.frag===U&&N.trigger(x.Events.FRAG_BUFFERED,{stats:H,frag:U,part:null,id:S.type}),k.tick()}).catch(function(F){k.state===f.STOPPED||k.state===f.ERROR||(k.warn(F),k.resetFragmentLoading(S))})},y.fragContextChanged=function(S){var w=this.fragCurrent;return!S||!w||S.level!==w.level||S.sn!==w.sn||S.urlId!==w.urlId},y.fragBufferedComplete=function(S,w){var k,F,U,N,j=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+S.type+" sn: "+S.sn+(w?" part: "+w.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+S.level+" (frag:["+((k=S.startPTS)!=null?k:NaN).toFixed(3)+"-"+((F=S.endPTS)!=null?F:NaN).toFixed(3)+"] > buffer:"+(j?l.default.toString(c.BufferHelper.getBuffered(j)):"(detached)")+")"),this.state=f.IDLE,j&&(!this.loadedmetadata&&S.type==i.PlaylistLevelType.MAIN&&j.buffered.length&&((U=this.fragCurrent)===null||U===void 0?void 0:U.sn)===((N=this.fragPrevious)===null||N===void 0?void 0:N.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},y.seekToStartPos=function(){},y._handleFragmentLoadComplete=function(S){var w=this.transmuxer;if(!!w){var k=S.frag,F=S.part,U=S.partsLoaded,N=!U||U.length===0||U.some(function(W){return!W}),j=new T.ChunkMetadata(k.level,k.sn,k.stats.chunkCount+1,0,F?F.index:-1,!N);w.flush(j)}},y._handleFragmentLoadProgress=function(S){},y._doFragLoad=function(S,w,k,F){var U,N=this;if(k===void 0&&(k=null),!this.levels)throw new Error("frag load aborted, missing levels");var j=null;if(S.encrypted&&!((U=S.decryptdata)!==null&&U!==void 0&&U.key)?(this.log("Loading key for "+S.sn+" of ["+w.startSN+"-"+w.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+S.level),this.state=f.KEY_LOADING,this.fragCurrent=S,j=this.keyLoader.load(S).then(function(Y){if(!N.fragContextChanged(Y.frag))return N.hls.trigger(x.Events.KEY_LOADED,Y),N.state===f.KEY_LOADING&&(N.state=f.IDLE),Y}),this.hls.trigger(x.Events.KEY_LOADING,{frag:S}),this.throwIfFragContextChanged("KEY_LOADING")):!S.encrypted&&w.encryptedFragments.length&&this.keyLoader.loadClear(S,w.encryptedFragments),k=Math.max(S.start,k||0),this.config.lowLatencyMode&&w){var W=w.partList;if(W&&F){k>S.end&&w.fragmentHint&&(S=w.fragmentHint);var H=this.getNextPart(W,S,k);if(H>-1){var G=W[H];return this.log("Loading part sn: "+S.sn+" p: "+G.index+" cc: "+S.cc+" of playlist ["+w.startSN+"-"+w.endSN+"] parts [0-"+H+"-"+(W.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+S.level+", target: "+parseFloat(k.toFixed(3))),this.nextLoadPosition=G.start+G.duration,this.state=f.FRAG_LOADING,this.hls.trigger(x.Events.FRAG_LOADING,{frag:S,part:W[H],targetBufferTime:k}),this.throwIfFragContextChanged("FRAG_LOADING parts"),j?j.then(function(Y){return!Y||N.fragContextChanged(Y.frag)?null:N.doFragPartsLoad(S,W,H,F)}).catch(function(Y){return N.handleFragLoadError(Y)}):this.doFragPartsLoad(S,W,H,F).catch(function(Y){return N.handleFragLoadError(Y)})}else if(!S.url||this.loadedEndOfParts(W,k))return Promise.resolve(null)}}this.log("Loading fragment "+S.sn+" cc: "+S.cc+" "+(w?"of ["+w.startSN+"-"+w.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+S.level+", target: "+parseFloat(k.toFixed(3))),(0,D.isFiniteNumber)(S.sn)&&!this.bitrateTest&&(this.nextLoadPosition=S.start+S.duration),this.state=f.FRAG_LOADING,this.hls.trigger(x.Events.FRAG_LOADING,{frag:S,targetBufferTime:k}),this.throwIfFragContextChanged("FRAG_LOADING");var V=this.config.progressive;return V&&j?j.then(function(Y){return!Y||N.fragContextChanged(Y==null?void 0:Y.frag)?null:N.fragmentLoader.load(S,F)}).catch(function(Y){return N.handleFragLoadError(Y)}):Promise.all([this.fragmentLoader.load(S,V?F:void 0),j]).then(function(Y){var Q=Y[0];return!V&&Q&&F&&F(Q),Q}).catch(function(Y){return N.handleFragLoadError(Y)})},y.throwIfFragContextChanged=function(S){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+S)},y.doFragPartsLoad=function(S,w,k,F){var U=this;return new Promise(function(N,j){var W=[],H=function G(V){var Y=w[V];U.fragmentLoader.loadPart(S,Y,F).then(function(Q){W[Y.index]=Q;var z=Q.part;U.hls.trigger(x.Events.FRAG_LOADED,Q);var X=w[V+1];if(X&&X.fragment===S)G(V+1);else return N({frag:S,part:z,partsLoaded:W})}).catch(j)};H(k)})},y.handleFragLoadError=function(S){if("data"in S){var w=S.data;S.data&&w.details===E.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(w.frag,w.part):this.hls.trigger(x.Events.ERROR,w)}else this.hls.trigger(x.Events.ERROR,{type:E.ErrorTypes.OTHER_ERROR,details:E.ErrorDetails.INTERNAL_EXCEPTION,err:S,fatal:!0});return null},y._handleTransmuxerFlush=function(S){var w=this.getCurrentContext(S);if(!w||this.state!==f.PARSING){!this.fragCurrent&&this.state!==f.STOPPED&&this.state!==f.ERROR&&(this.state=f.IDLE);return}var k=w.frag,F=w.part,U=w.level,N=self.performance.now();k.stats.parsing.end=N,F&&(F.stats.parsing.end=N),this.updateLevelTiming(k,F,U,S.partial)},y.getCurrentContext=function(S){var w=this.levels,k=S.level,F=S.sn,U=S.part;if(!w||!w[k])return this.warn("Levels object was unset while buffering fragment "+F+" of level "+k+". The current chunk will not be buffered."),null;var N=w[k],j=U>-1?(0,_.getPartWith)(N,F,U):null,W=j?j.fragment:(0,_.getFragmentWithSN)(N,F,this.fragCurrent);return W?{frag:W,part:j,level:N}:null},y.bufferFragmentData=function(S,w,k,F){if(!(!S||this.state!==f.PARSING)){var U=S.data1,N=S.data2,j=U;if(U&&N&&(j=(0,L.appendUint8Array)(U,N)),!(!j||!j.length)){var W={type:S.type,frag:w,part:k,chunkMeta:F,parent:w.type,data:j};this.hls.trigger(x.Events.BUFFER_APPENDING,W),S.dropped&&S.independent&&!k&&this.flushBufferGap(w)}}},y.flushBufferGap=function(S){var w=this.media;if(!!w){if(!c.BufferHelper.isBuffered(w,w.currentTime)){this.flushMainBuffer(0,S.start);return}var k=w.currentTime,F=c.BufferHelper.bufferInfo(w,k,0),U=S.duration,N=Math.min(this.config.maxFragLookUpTolerance*2,U*.25),j=Math.max(Math.min(S.start-N,F.end-N),k+N);S.start-j>N&&this.flushMainBuffer(j,S.start)}},y.getFwdBufferInfo=function(S,w){var k=this.config,F=this.getLoadPosition();if(!(0,D.isFiniteNumber)(F))return null;var U=c.BufferHelper.bufferInfo(S,F,k.maxBufferHole);if(U.len===0&&U.nextStart!==void 0){var N=this.fragmentTracker.getBufferedFrag(F,w);if(N&&U.nextStart<N.end)return c.BufferHelper.bufferInfo(S,F,Math.max(U.nextStart,k.maxBufferHole))}return U},y.getMaxBufferLength=function(S){var w=this.config,k;return S?k=Math.max(8*w.maxBufferSize/S,w.maxBufferLength):k=w.maxBufferLength,Math.min(k,w.maxMaxBufferLength)},y.reduceMaxBufferLength=function(S){var w=this.config,k=S||w.maxBufferLength;return w.maxMaxBufferLength>=k?(w.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+w.maxMaxBufferLength+"s"),!0):!1},y.getNextFragment=function(S,w){var k=w.fragments,F=k.length;if(!F)return null;var U=this.config,N=k[0].start,j;if(w.live){var W=U.initialLiveManifestSize;if(F<W)return this.warn("Not enough fragments to start playback (have: "+F+", need: "+W+")"),null;!w.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(j=this.getInitialLiveFragment(w,k),this.startPosition=j?this.hls.liveSyncPosition||j.start:S)}else S<=N&&(j=k[0]);if(!j){var H=U.lowLatencyMode?w.partEnd:w.fragmentEnd;j=this.getFragmentAtPosition(S,H,w)}return this.mapToInitFragWhenRequired(j)},y.mapToInitFragWhenRequired=function(S){return S!=null&&S.initSegment&&!(S!=null&&S.initSegment.data)&&!this.bitrateTest?S.initSegment:S},y.getNextPart=function(S,w,k){for(var F=-1,U=!1,N=!0,j=0,W=S.length;j<W;j++){var H=S[j];if(N=N&&!H.independent,F>-1&&k<H.start)break;var G=H.loaded;G?F=-1:(U||H.independent||N)&&H.fragment===w&&(F=j),U=G}return F},y.loadedEndOfParts=function(S,w){var k=S[S.length-1];return k&&w>k.start&&k.loaded},y.getInitialLiveFragment=function(S,w){var k=this.fragPrevious,F=null;if(k){if(S.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+k.programDateTime),F=(0,r.findFragmentByPDT)(w,k.endProgramDateTime,this.config.maxFragLookUpTolerance)),!F){var U=k.sn+1;if(U>=S.startSN&&U<=S.endSN){var N=w[U-S.startSN];k.cc===N.cc&&(F=N,this.log("Live playlist, switching playlist, load frag with next SN: "+F.sn))}F||(F=(0,r.findFragWithCC)(w,k.cc),F&&this.log("Live playlist, switching playlist, load frag with same CC: "+F.sn))}}else{var j=this.hls.liveSyncPosition;j!==null&&(F=this.getFragmentAtPosition(j,this.bitrateTest?S.fragmentEnd:S.edge,S))}return F},y.getFragmentAtPosition=function(S,w,k){var F=this.config,U=this.fragPrevious,N=k.fragments,j=k.endSN,W=k.fragmentHint,H=F.maxFragLookUpTolerance,G=!!(F.lowLatencyMode&&k.partList&&W);G&&W&&!this.bitrateTest&&(N=N.concat(W),j=W.sn);var V;if(S<w){var Y=S>w-H?0:H;V=(0,r.findFragmentByPTS)(U,N,S,Y)}else V=N[N.length-1];if(V){var Q=V.sn-k.startSN;if(this.fragmentTracker.getState(V)===b.FragmentState.OK&&(U=V),U&&V.sn===U.sn&&!G){var z=U&&V.level===U.level;if(z){var X=N[Q+1];V.sn<j&&this.fragmentTracker.getState(X)!==b.FragmentState.OK?(this.log("SN "+V.sn+" just loaded, load next one: "+X.sn),V=X):V=null}}}return V},y.synchronizeToLiveEdge=function(S){var w=this.config,k=this.media;if(!!k){var F=this.hls.liveSyncPosition,U=k.currentTime,N=S.fragments[0].start,j=S.edge,W=U>=N-w.maxFragLookUpTolerance&&U<=j;if(F!==null&&k.duration>F&&(U<F||!W)){var H=w.liveMaxLatencyDuration!==void 0?w.liveMaxLatencyDuration:w.liveMaxLatencyDurationCount*S.targetduration;(!W&&k.readyState<4||U<j-H)&&(this.loadedmetadata||(this.nextLoadPosition=F),k.readyState&&(this.warn("Playback: "+U.toFixed(3)+" is located too far from the end of live sliding playlist: "+j+", reset currentTime to : "+F.toFixed(3)),k.currentTime=F))}}},y.alignPlaylists=function(S,w){var k=this.levels,F=this.levelLastLoaded,U=this.fragPrevious,N=F!==null?k[F]:null,j=S.fragments.length;if(!j)return this.warn("No fragments in live playlist"),0;var W=S.fragments[0].start,H=!w,G=S.alignedSliding&&(0,D.isFiniteNumber)(W);if(H||!G&&!W){(0,I.alignStream)(U,N,S);var V=S.fragments[0].start;return this.log("Live playlist sliding: "+V.toFixed(2)+" start-sn: "+(w?w.startSN:"na")+"->"+S.startSN+" prev-sn: "+(U?U.sn:"na")+" fragments: "+j),V}return W},y.waitForCdnTuneIn=function(S){var w=3;return S.live&&S.canBlockReload&&S.partTarget&&S.tuneInGoal>Math.max(S.partHoldBack,S.partTarget*w)},y.setStartPosition=function(S,w){var k=this.startPosition;if(k<w&&(k=-1),k===-1||this.lastCurrentTime===-1){var F=S.startTimeOffset;(0,D.isFiniteNumber)(F)?(k=w+F,F<0&&(k+=S.totalduration),k=Math.min(Math.max(w,k),w+S.totalduration),this.log("Start time offset "+F+" found in playlist, adjust startPosition to "+k),this.startPosition=k):S.live?k=this.hls.liveSyncPosition||w:this.startPosition=k=0,this.lastCurrentTime=k}this.nextLoadPosition=k},y.getLoadPosition=function(){var S=this.media,w=0;return this.loadedmetadata&&S?w=S.currentTime:this.nextLoadPosition&&(w=this.nextLoadPosition),w},y.handleFragLoadAborted=function(S,w){this.transmuxer&&S.sn!=="initSegment"&&S.stats.aborted&&(this.warn("Fragment "+S.sn+(w?" part"+w.index:"")+" of level "+S.level+" was aborted"),this.resetFragmentLoading(S))},y.resetFragmentLoading=function(S){(!this.fragCurrent||!this.fragContextChanged(S)&&this.state!==f.FRAG_LOADING_WAITING_RETRY)&&(this.state=f.IDLE)},y.onFragmentOrKeyLoadError=function(S,w){if(w.fatal){this.stopLoad(),this.state=f.ERROR;return}var k=this.config;if(w.chunkMeta){var F=this.getCurrentContext(w.chunkMeta);F&&(w.frag=F.frag,w.levelRetry=!0,this.fragLoadError=k.fragLoadingMaxRetry)}var U=w.frag;if(!(!U||U.type!==S)){var N=this.fragCurrent;if(console.assert(N&&U.sn===N.sn&&U.level===N.level&&U.urlId===N.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=k.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var j=Math.min(Math.pow(2,this.fragLoadError)*k.fragLoadingRetryDelay,k.fragLoadingMaxRetryTimeout);this.warn("Fragment "+U.sn+" of "+S+" "+U.level+" failed to load, retrying in "+j+"ms"),this.retryDate=self.performance.now()+j,this.fragLoadError++,this.state=f.FRAG_LOADING_WAITING_RETRY}else w.levelRetry?(S===i.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=f.IDLE):(C.logger.error(w.details+" reaches max retry, redispatch as fatal ..."),w.fatal=!0,this.hls.stopLoad(),this.state=f.ERROR)}},y.afterBufferFlushed=function(S,w,k){if(!!S){var F=c.BufferHelper.getBuffered(S);this.fragmentTracker.detectEvictedFragments(w,F,k),this.state===f.ENDED&&this.resetLoadingState()}},y.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=f.IDLE},y.resetStartWhenNotLoaded=function(S){if(!this.loadedmetadata){this.startFragRequested=!1;var w=this.levels?this.levels[S].details:null;w!=null&&w.live?(this.startPosition=-1,this.setStartPosition(w,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},y.updateLevelTiming=function(S,w,k,F){var U=this,N=k.details;console.assert(!!N,"level.details must be defined");var j=Object.keys(S.elementaryStreams).reduce(function(W,H){var G=S.elementaryStreams[H];if(G){var V=G.endPTS-G.startPTS;if(V<=0)return U.warn("Could not parse fragment "+S.sn+" "+H+" duration reliably ("+V+")"),W||!1;var Y=F?0:(0,_.updateFragPTSDTS)(N,S,G.startPTS,G.endPTS,G.startDTS,G.endDTS);return U.hls.trigger(x.Events.LEVEL_PTS_UPDATED,{details:N,level:k,drift:Y,type:H,frag:S,start:G.startPTS,end:G.endPTS}),!0}return W},!1);j||(this.warn("Found no media in fragment "+S.sn+" of level "+k.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=f.PARSED,this.hls.trigger(x.Events.FRAG_PARSED,{frag:S,part:w})},y.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},m(e,[{key:"state",get:function(){return this._state},set:function(S){var w=this._state;w!==S&&(this._state=S,this.log(w+"->"+S))}}]),e}(g.default)},"./src/controller/buffer-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>r});var D=s("./src/polyfills/number.ts"),g=s("./src/events.ts"),b=s("./src/utils/logger.ts"),c=s("./src/errors.ts"),C=s("./src/utils/buffer-helper.ts"),x=s("./src/utils/mediasource-helper.ts"),E=s("./src/loader/fragment.ts"),T=s("./src/controller/buffer-operation-queue.ts"),L=(0,x.getMediaSource)(),I=/([ha]vc.)(?:\.[^.,]+)+/,r=function(){function _(n){var l=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=l.media,a=l.mediaSource;b.logger.log("[buffer-controller]: Media source opened"),i&&(i.removeEventListener("emptied",l._onMediaEmptied),l.updateMediaElementDuration(),l.hls.trigger(g.Events.MEDIA_ATTACHED,{media:i})),a&&a.removeEventListener("sourceopen",l._onMediaSourceOpen),l.checkPendingTracks()},this._onMediaSourceClose=function(){b.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){b.logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var i=l.media,a=l._objectUrl;i&&i.src!==a&&b.logger.error("Media element src was set while attaching MediaSource ("+a+" > "+i.src+")")},this.hls=n,this._initSourceBuffer(),this.registerListeners()}var v=_.prototype;return v.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},v.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},v.registerListeners=function(){var l=this.hls;l.on(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(g.Events.BUFFER_RESET,this.onBufferReset,this),l.on(g.Events.BUFFER_APPENDING,this.onBufferAppending,this),l.on(g.Events.BUFFER_CODECS,this.onBufferCodecs,this),l.on(g.Events.BUFFER_EOS,this.onBufferEos,this),l.on(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),l.on(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this),l.on(g.Events.FRAG_PARSED,this.onFragParsed,this),l.on(g.Events.FRAG_CHANGED,this.onFragChanged,this)},v.unregisterListeners=function(){var l=this.hls;l.off(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(g.Events.BUFFER_RESET,this.onBufferReset,this),l.off(g.Events.BUFFER_APPENDING,this.onBufferAppending,this),l.off(g.Events.BUFFER_CODECS,this.onBufferCodecs,this),l.off(g.Events.BUFFER_EOS,this.onBufferEos,this),l.off(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),l.off(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this),l.off(g.Events.FRAG_PARSED,this.onFragParsed,this),l.off(g.Events.FRAG_CHANGED,this.onFragChanged,this)},v._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new T.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},v.onManifestParsed=function(l,i){var a=2;(i.audio&&!i.video||!i.altAudio)&&(a=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=a,this.details=null,b.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},v.onMediaAttaching=function(l,i){var a=this.media=i.media;if(a&&L){var m=this.mediaSource=new L;m.addEventListener("sourceopen",this._onMediaSourceOpen),m.addEventListener("sourceended",this._onMediaSourceEnded),m.addEventListener("sourceclose",this._onMediaSourceClose),a.src=self.URL.createObjectURL(m),this._objectUrl=a.src,a.addEventListener("emptied",this._onMediaEmptied)}},v.onMediaDetaching=function(){var l=this.media,i=this.mediaSource,a=this._objectUrl;if(i){if(b.logger.log("[buffer-controller]: media source detaching"),i.readyState==="open")try{i.endOfStream()}catch(m){b.logger.warn("[buffer-controller]: onMediaDetaching: "+m.message+" while calling endOfStream")}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),l&&(l.removeEventListener("emptied",this._onMediaEmptied),a&&self.URL.revokeObjectURL(a),l.src===a?(l.removeAttribute("src"),l.load()):b.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(g.Events.MEDIA_DETACHED,void 0)},v.onBufferReset=function(){var l=this;this.getSourceBufferTypes().forEach(function(i){var a=l.sourceBuffer[i];try{a&&(l.removeBufferListeners(i),l.mediaSource&&l.mediaSource.removeSourceBuffer(a),l.sourceBuffer[i]=void 0)}catch(m){b.logger.warn("[buffer-controller]: Failed to reset the "+i+" buffer",m)}}),this._initSourceBuffer()},v.onBufferCodecs=function(l,i){var a=this,m=this.getSourceBufferTypes().length;Object.keys(i).forEach(function(p){if(m){var o=a.tracks[p];if(o&&typeof o.buffer.changeType=="function"){var d=i[p],A=d.id,u=d.codec,f=d.levelCodec,t=d.container,h=d.metadata,e=(o.levelCodec||o.codec).replace(I,"$1"),y=(f||u).replace(I,"$1");if(e!==y){var P=t+";codecs="+(f||u);a.appendChangeType(p,P),b.logger.log("[buffer-controller]: switching codec "+e+" to "+y),a.tracks[p]={buffer:o.buffer,codec:u,container:t,levelCodec:f,metadata:h,id:A}}}}else a.pendingTracks[p]=i[p]}),!m&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},v.appendChangeType=function(l,i){var a=this,m=this.operationQueue,p={execute:function(){var d=a.sourceBuffer[l];d&&(b.logger.log("[buffer-controller]: changing "+l+" sourceBuffer type to "+i),d.changeType(i)),m.shiftAndExecuteNext(l)},onStart:function(){},onComplete:function(){},onError:function(d){b.logger.warn("[buffer-controller]: Failed to change "+l+" SourceBuffer type",d)}};m.append(p,l)},v.onBufferAppending=function(l,i){var a=this,m=this.hls,p=this.operationQueue,o=this.tracks,d=i.data,A=i.type,u=i.frag,f=i.part,t=i.chunkMeta,h=t.buffering[A],e=self.performance.now();h.start=e;var y=u.stats.buffering,P=f?f.stats.buffering:null;y.start===0&&(y.start=e),P&&P.start===0&&(P.start=e);var S=o.audio,w=!1;A==="audio"&&(S==null?void 0:S.container)==="audio/mpeg"&&(w=!this.lastMpegAudioChunk||t.id===1||this.lastMpegAudioChunk.sn!==t.sn,this.lastMpegAudioChunk=t);var k=u.start,F={execute:function(){if(h.executeStart=self.performance.now(),w){var N=a.sourceBuffer[A];if(N){var j=k-N.timestampOffset;Math.abs(j)>=.1&&(b.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+k+" (delta: "+j+") sn: "+u.sn+")"),N.timestampOffset=k)}}a.appendExecutor(d,A)},onStart:function(){},onComplete:function(){var N=self.performance.now();h.executeEnd=h.end=N,y.first===0&&(y.first=N),P&&P.first===0&&(P.first=N);var j=a.sourceBuffer,W={};for(var H in j)W[H]=C.BufferHelper.getBuffered(j[H]);a.appendError=0,a.hls.trigger(g.Events.BUFFER_APPENDED,{type:A,frag:u,part:f,chunkMeta:t,parent:u.type,timeRanges:W})},onError:function(N){b.logger.error("[buffer-controller]: Error encountered while trying to append to the "+A+" SourceBuffer",N);var j={type:c.ErrorTypes.MEDIA_ERROR,parent:u.type,details:c.ErrorDetails.BUFFER_APPEND_ERROR,err:N,fatal:!1};N.code===DOMException.QUOTA_EXCEEDED_ERR?j.details=c.ErrorDetails.BUFFER_FULL_ERROR:(a.appendError++,j.details=c.ErrorDetails.BUFFER_APPEND_ERROR,a.appendError>m.config.appendErrorMaxRetry&&(b.logger.error("[buffer-controller]: Failed "+m.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),j.fatal=!0,m.stopLoad())),m.trigger(g.Events.ERROR,j)}};p.append(F,A)},v.onBufferFlushing=function(l,i){var a=this,m=this.operationQueue,p=function(d){return{execute:a.removeExecutor.bind(a,d,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){a.hls.trigger(g.Events.BUFFER_FLUSHED,{type:d})},onError:function(u){b.logger.warn("[buffer-controller]: Failed to remove from "+d+" SourceBuffer",u)}}};i.type?m.append(p(i.type),i.type):this.getSourceBufferTypes().forEach(function(o){m.append(p(o),o)})},v.onFragParsed=function(l,i){var a=this,m=i.frag,p=i.part,o=[],d=p?p.elementaryStreams:m.elementaryStreams;d[E.ElementaryStreamTypes.AUDIOVIDEO]?o.push("audiovideo"):(d[E.ElementaryStreamTypes.AUDIO]&&o.push("audio"),d[E.ElementaryStreamTypes.VIDEO]&&o.push("video"));var A=function(){var f=self.performance.now();m.stats.buffering.end=f,p&&(p.stats.buffering.end=f);var t=p?p.stats:m.stats;a.hls.trigger(g.Events.FRAG_BUFFERED,{frag:m,part:p,stats:t,id:m.type})};o.length===0&&b.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+m.type+" level: "+m.level+" sn: "+m.sn),this.blockBuffers(A,o)},v.onFragChanged=function(l,i){this.flushBackBuffer()},v.onBufferEos=function(l,i){var a=this,m=this.getSourceBufferTypes().reduce(function(p,o){var d=a.sourceBuffer[o];return d&&(!i.type||i.type===o)&&(d.ending=!0,d.ended||(d.ended=!0,b.logger.log("[buffer-controller]: "+o+" sourceBuffer now EOS"))),p&&!!(!d||d.ended)},!0);m&&(b.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){a.getSourceBufferTypes().forEach(function(o){var d=a.sourceBuffer[o];d&&(d.ending=!1)});var p=a.mediaSource;if(!p||p.readyState!=="open"){p&&b.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+p.readyState);return}b.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),p.endOfStream()}))},v.onLevelUpdated=function(l,i){var a=i.details;!a.fragments.length||(this.details=a,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},v.flushBackBuffer=function(){var l=this.hls,i=this.details,a=this.media,m=this.sourceBuffer;if(!(!a||i===null)){var p=this.getSourceBufferTypes();if(!!p.length){var o=i.live&&l.config.liveBackBufferLength!==null?l.config.liveBackBufferLength:l.config.backBufferLength;if(!(!(0,D.isFiniteNumber)(o)||o<0)){var d=a.currentTime,A=i.levelTargetDuration,u=Math.max(o,A),f=Math.floor(d/A)*A-u;p.forEach(function(t){var h=m[t];if(h){var e=C.BufferHelper.getBuffered(h);if(e.length>0&&f>e.start(0)){if(l.trigger(g.Events.BACK_BUFFER_REACHED,{bufferEnd:f}),i.live)l.trigger(g.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:f});else if(h.ended&&e.end(e.length-1)-d<A*2){b.logger.info("[buffer-controller]: Cannot flush "+t+" back buffer while SourceBuffer is in ended state");return}l.trigger(g.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:f,type:t})}}})}}}},v.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var l=this.details,i=this.hls,a=this.media,m=this.mediaSource,p=l.fragments[0].start+l.totalduration,o=a.duration,d=(0,D.isFiniteNumber)(m.duration)?m.duration:0;l.live&&i.config.liveDurationInfinity?(b.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),m.duration=1/0,this.updateSeekableRange(l)):(p>d&&p>o||!(0,D.isFiniteNumber)(o))&&(b.logger.log("[buffer-controller]: Updating Media Source duration to "+p.toFixed(3)),m.duration=p)}},v.updateSeekableRange=function(l){var i=this.mediaSource,a=l.fragments,m=a.length;if(m&&l.live&&i!==null&&i!==void 0&&i.setLiveSeekableRange){var p=Math.max(0,a[0].start),o=Math.max(p,p+l.totalduration);i.setLiveSeekableRange(p,o)}},v.checkPendingTracks=function(){var l=this.bufferCodecEventsExpected,i=this.operationQueue,a=this.pendingTracks,m=Object.keys(a).length;if(m&&!l||m===2){this.createSourceBuffers(a),this.pendingTracks={};var p=this.getSourceBufferTypes();if(p.length===0){this.hls.trigger(g.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}p.forEach(function(o){i.executeNext(o)})}},v.createSourceBuffers=function(l){var i=this.sourceBuffer,a=this.mediaSource;if(!a)throw Error("createSourceBuffers called when mediaSource was null");var m=0;for(var p in l)if(!i[p]){var o=l[p];if(!o)throw Error("source buffer exists for track "+p+", however track does not");var d=o.levelCodec||o.codec,A=o.container+";codecs="+d;b.logger.log("[buffer-controller]: creating sourceBuffer("+A+")");try{var u=i[p]=a.addSourceBuffer(A),f=p;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[p]={buffer:u,codec:d,container:o.container,levelCodec:o.levelCodec,metadata:o.metadata,id:o.id},m++}catch(t){b.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(g.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:A})}}m&&this.hls.trigger(g.Events.BUFFER_CREATED,{tracks:this.tracks})},v._onSBUpdateStart=function(l){var i=this.operationQueue,a=i.current(l);a.onStart()},v._onSBUpdateEnd=function(l){var i=this.operationQueue,a=i.current(l);a.onComplete(),i.shiftAndExecuteNext(l)},v._onSBUpdateError=function(l,i){b.logger.error("[buffer-controller]: "+l+" SourceBuffer error",i),this.hls.trigger(g.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var a=this.operationQueue.current(l);a&&a.onError(i)},v.removeExecutor=function(l,i,a){var m=this.media,p=this.mediaSource,o=this.operationQueue,d=this.sourceBuffer,A=d[l];if(!m||!p||!A){b.logger.warn("[buffer-controller]: Attempting to remove from the "+l+" SourceBuffer, but it does not exist"),o.shiftAndExecuteNext(l);return}var u=(0,D.isFiniteNumber)(m.duration)?m.duration:1/0,f=(0,D.isFiniteNumber)(p.duration)?p.duration:1/0,t=Math.max(0,i),h=Math.min(a,u,f);h>t&&!A.ending?(A.ended=!1,b.logger.log("[buffer-controller]: Removing ["+t+","+h+"] from the "+l+" SourceBuffer"),console.assert(!A.updating,l+" sourceBuffer must not be updating"),A.remove(t,h)):o.shiftAndExecuteNext(l)},v.appendExecutor=function(l,i){var a=this.operationQueue,m=this.sourceBuffer,p=m[i];if(!p){b.logger.warn("[buffer-controller]: Attempting to append to the "+i+" SourceBuffer, but it does not exist"),a.shiftAndExecuteNext(i);return}p.ended=!1,console.assert(!p.updating,i+" sourceBuffer must not be updating"),p.appendBuffer(l)},v.blockBuffers=function(l,i){var a=this;if(i===void 0&&(i=this.getSourceBufferTypes()),!i.length){b.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(l);return}var m=this.operationQueue,p=i.map(function(o){return m.appendBlocker(o)});Promise.all(p).then(function(){l(),i.forEach(function(o){var d=a.sourceBuffer[o];(!d||!d.updating)&&m.shiftAndExecuteNext(o)})})},v.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},v.addBufferListener=function(l,i,a){var m=this.sourceBuffer[l];if(!!m){var p=a.bind(this,l);this.listeners[l].push({event:i,listener:p}),m.addEventListener(i,p)}},v.removeBufferListeners=function(l){var i=this.sourceBuffer[l];!i||this.listeners[l].forEach(function(a){i.removeEventListener(a.event,a.listener)})},_}()},"./src/controller/buffer-operation-queue.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>g});var D=s("./src/utils/logger.ts"),g=function(){function b(C){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=C}var c=b.prototype;return c.append=function(x,E){var T=this.queues[E];T.push(x),T.length===1&&this.buffers[E]&&this.executeNext(E)},c.insertAbort=function(x,E){var T=this.queues[E];T.unshift(x),this.executeNext(E)},c.appendBlocker=function(x){var E,T=new Promise(function(I){E=I}),L={execute:E,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(L,x),T},c.executeNext=function(x){var E=this.buffers,T=this.queues,L=E[x],I=T[x];if(I.length){var r=I[0];try{r.execute()}catch(_){D.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),r.onError(_),(!L||!L.updating)&&(I.shift(),this.executeNext(x))}}},c.shiftAndExecuteNext=function(x){this.queues[x].shift(),this.executeNext(x)},c.current=function(x){return this.queues[x][0]},b}()},"./src/controller/cap-level-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>E});var D=s("./src/events.ts");function g(T,L){for(var I=0;I<L.length;I++){var r=L[I];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(T,c(r.key),r)}}function b(T,L,I){return L&&g(T.prototype,L),I&&g(T,I),Object.defineProperty(T,"prototype",{writable:!1}),T}function c(T){var L=C(T,"string");return typeof L=="symbol"?L:String(L)}function C(T,L){if(typeof T!="object"||T===null)return T;var I=T[Symbol.toPrimitive];if(I!==void 0){var r=I.call(T,L||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(L==="string"?String:Number)(T)}var x=function(){function T(I){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=I,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var L=T.prototype;return L.setStreamController=function(r){this.streamController=r},L.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},L.registerListeners=function(){var r=this.hls;r.on(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},L.unregisterListener=function(){var r=this.hls;r.off(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},L.onFpsDropLevelCapping=function(r,_){T.isLevelAllowed(_.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(_.droppedLevel)},L.onMediaAttaching=function(r,_){this.media=_.media instanceof HTMLVideoElement?_.media:null,this.clientRect=null},L.onManifestParsed=function(r,_){var v=this.hls;this.restrictedLevels=[],this.firstLevel=_.firstLevel,v.config.capLevelToPlayerSize&&_.video&&this.startCapping()},L.onBufferCodecs=function(r,_){var v=this.hls;v.config.capLevelToPlayerSize&&_.video&&this.startCapping()},L.onMediaDetaching=function(){this.stopCapping()},L.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var r=this.hls.levels;if(r.length){var _=this.hls;_.autoLevelCapping=this.getMaxLevel(r.length-1),_.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=_.autoLevelCapping}}},L.getMaxLevel=function(r){var _=this,v=this.hls.levels;if(!v.length)return-1;var n=v.filter(function(l,i){return T.isLevelAllowed(i,_.restrictedLevels)&&i<=r});return this.clientRect=null,T.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},L.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},L.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},L.getDimensions=function(){if(this.clientRect)return this.clientRect;var r=this.media,_={width:0,height:0};if(r){var v=r.getBoundingClientRect();_.width=v.width,_.height=v.height,!_.width&&!_.height&&(_.width=v.right-v.left||r.width||0,_.height=v.bottom-v.top||r.height||0)}return this.clientRect=_,_},T.isLevelAllowed=function(r,_){return _===void 0&&(_=[]),_.indexOf(r)===-1},T.getMaxLevelByMediaSize=function(r,_,v){if(!r||!r.length)return-1;for(var n=function(p,o){return o?p.width!==o.width||p.height!==o.height:!0},l=r.length-1,i=0;i<r.length;i+=1){var a=r[i];if((a.width>=_||a.height>=v)&&n(a,r[i+1])){l=i;break}}return l},b(T,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var r=1;if(!this.hls.config.ignoreDevicePixelRatio)try{r=self.devicePixelRatio}catch(_){}return r}}]),T}();const E=x},"./src/controller/cmcd-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>v});var D=s("./src/events.ts"),g=s("./src/types/cmcd.ts"),b=s("./src/utils/buffer-helper.ts"),c=s("./src/utils/logger.ts");function C(n,l){for(var i=0;i<l.length;i++){var a=l[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,E(a.key),a)}}function x(n,l,i){return l&&C(n.prototype,l),i&&C(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}function E(n){var l=T(n,"string");return typeof l=="symbol"?l:String(l)}function T(n,l){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,l||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(n)}function L(n,l){var i=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i)return(i=i.call(n)).next.bind(i);if(Array.isArray(n)||(i=I(n))||l&&n&&typeof n.length=="number"){i&&(n=i);var a=0;return function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I(n,l){if(!!n){if(typeof n=="string")return r(n,l);var i=Object.prototype.toString.call(n).slice(8,-1);if(i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set")return Array.from(n);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return r(n,l)}}function r(n,l){(l==null||l>n.length)&&(l=n.length);for(var i=0,a=new Array(l);i<l;i++)a[i]=n[i];return a}function _(){return _=Object.assign?Object.assign.bind():function(n){for(var l=1;l<arguments.length;l++){var i=arguments[l];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},_.apply(this,arguments)}var v=function(){function n(i){var a=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){a.initialized&&(a.starved=!0),a.buffering=!0},this.onPlaying=function(){a.initialized||(a.initialized=!0),a.buffering=!1},this.applyPlaylistData=function(o){try{a.apply(o,{ot:g.CMCDObjectType.MANIFEST,su:!a.initialized})}catch(d){c.logger.warn("Could not generate manifest CMCD data.",d)}},this.applyFragmentData=function(o){try{var d=o.frag,A=a.hls.levels[d.level],u=a.getObjectType(d),f={d:d.duration*1e3,ot:u};(u===g.CMCDObjectType.VIDEO||u===g.CMCDObjectType.AUDIO||u==g.CMCDObjectType.MUXED)&&(f.br=A.bitrate/1e3,f.tb=a.getTopBandwidth(u)/1e3,f.bl=a.getBufferLength(u)),a.apply(o,f)}catch(t){c.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=i;var m=this.config=i.config,p=m.cmcd;p!=null&&(m.pLoader=this.createPlaylistLoader(),m.fLoader=this.createFragmentLoader(),this.sid=p.sessionId||n.uuid(),this.cid=p.contentId,this.useHeaders=p.useHeaders===!0,this.registerListeners())}var l=n.prototype;return l.registerListeners=function(){var a=this.hls;a.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),a.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this)},l.unregisterListeners=function(){var a=this.hls;a.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),a.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},l.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},l.onMediaAttached=function(a,m){this.media=m.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},l.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},l.onBufferCreated=function(a,m){var p,o;this.audioBuffer=(p=m.tracks.audio)===null||p===void 0?void 0:p.buffer,this.videoBuffer=(o=m.tracks.video)===null||o===void 0?void 0:o.buffer},l.createData=function(){var a;return{v:g.CMCDVersion,sf:g.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(a=this.media)===null||a===void 0?void 0:a.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},l.apply=function(a,m){m===void 0&&(m={}),_(m,this.createData());var p=m.ot===g.CMCDObjectType.INIT||m.ot===g.CMCDObjectType.VIDEO||m.ot===g.CMCDObjectType.MUXED;if(this.starved&&p&&(m.bs=!0,m.su=!0,this.starved=!1),m.su==null&&(m.su=this.buffering),this.useHeaders){var o=n.toHeaders(m);if(!Object.keys(o).length)return;a.headers||(a.headers={}),_(a.headers,o)}else{var d=n.toQuery(m);if(!d)return;a.url=n.appendQueryToUri(a.url,d)}},l.getObjectType=function(a){var m=a.type;if(m==="subtitle")return g.CMCDObjectType.TIMED_TEXT;if(a.sn==="initSegment")return g.CMCDObjectType.INIT;if(m==="audio")return g.CMCDObjectType.AUDIO;if(m==="main")return this.hls.audioTracks.length?g.CMCDObjectType.VIDEO:g.CMCDObjectType.MUXED},l.getTopBandwidth=function(a){var m=0,p,o=this.hls;if(a===g.CMCDObjectType.AUDIO)p=o.audioTracks;else{var d=o.maxAutoLevel,A=d>-1?d+1:o.levels.length;p=o.levels.slice(0,A)}for(var u=L(p),f;!(f=u()).done;){var t=f.value;t.bitrate>m&&(m=t.bitrate)}return m>0?m:NaN},l.getBufferLength=function(a){var m=this.hls.media,p=a===g.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!p||!m)return NaN;var o=b.BufferHelper.bufferInfo(p,m.currentTime,this.config.maxBufferHole);return o.len*1e3},l.createPlaylistLoader=function(){var a=this.config.pLoader,m=this.applyPlaylistData,p=a||this.config.loader;return function(){function o(A){this.loader=void 0,this.loader=new p(A)}var d=o.prototype;return d.destroy=function(){this.loader.destroy()},d.abort=function(){this.loader.abort()},d.load=function(u,f,t){m(u),this.loader.load(u,f,t)},x(o,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),o}()},l.createFragmentLoader=function(){var a=this.config.fLoader,m=this.applyFragmentData,p=a||this.config.loader;return function(){function o(A){this.loader=void 0,this.loader=new p(A)}var d=o.prototype;return d.destroy=function(){this.loader.destroy()},d.abort=function(){this.loader.abort()},d.load=function(u,f,t){m(u),this.loader.load(u,f,t)},x(o,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),o}()},n.uuid=function(){var a=URL.createObjectURL(new Blob),m=a.toString();return URL.revokeObjectURL(a),m.slice(m.lastIndexOf("/")+1)},n.serialize=function(a){for(var m=[],p=function(F){return!Number.isNaN(F)&&F!=null&&F!==""&&F!==!1},o=function(F){return Math.round(F)},d=function(F){return o(F/100)*100},A=function(F){return encodeURIComponent(F)},u={br:o,d:o,bl:d,dl:d,mtp:d,nor:A,rtp:d,tb:o},f=Object.keys(a||{}).sort(),t=L(f),h;!(h=t()).done;){var e=h.value,y=a[e];if(!!p(y)&&!(e==="v"&&y===1)&&!(e=="pr"&&y===1)){var P=u[e];P&&(y=P(y));var S=typeof y,w=void 0;e==="ot"||e==="sf"||e==="st"?w=e+"="+y:S==="boolean"?w=e:S==="number"?w=e+"="+y:w=e+"="+JSON.stringify(y),m.push(w)}}return m.join(",")},n.toHeaders=function(a){for(var m=Object.keys(a),p={},o=["Object","Request","Session","Status"],d=[{},{},{},{}],A={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},u=0,f=m;u<f.length;u++){var t=f[u],h=A[t]!=null?A[t]:1;d[h][t]=a[t]}for(var e=0;e<d.length;e++){var y=n.serialize(d[e]);y&&(p["CMCD-"+o[e]]=y)}return p},n.toQuery=function(a){return"CMCD="+encodeURIComponent(n.serialize(a))},n.appendQueryToUri=function(a,m){if(!m)return a;var p=a.includes("?")?"&":"?";return""+a+p+m},n}()},"./src/controller/eme-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>u});var D=s("./src/events.ts"),g=s("./src/errors.ts"),b=s("./src/utils/logger.ts"),c=s("./src/utils/mediakeys-helper.ts"),C=s("./src/utils/keysystem-util.ts"),x=s("./src/utils/numeric-encoding-utils.ts"),E=s("./src/loader/level-key.ts"),T=s("./src/utils/hex.ts"),L=s("./src/utils/mp4-tools.ts"),I=s("./node_modules/eventemitter3/index.js"),r=s.n(I);function _(f,t){f.prototype=Object.create(t.prototype),f.prototype.constructor=f,a(f,t)}function v(f){var t=typeof Map=="function"?new Map:void 0;return v=function(e){if(e===null||!i(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(e))return t.get(e);t.set(e,y)}function y(){return n(e,arguments,m(this).constructor)}return y.prototype=Object.create(e.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),a(y,e)},v(f)}function n(f,t,h){return l()?n=Reflect.construct.bind():n=function(y,P,S){var w=[null];w.push.apply(w,P);var k=Function.bind.apply(y,w),F=new k;return S&&a(F,S.prototype),F},n.apply(null,arguments)}function l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(f){return!1}}function i(f){return Function.toString.call(f).indexOf("[native code]")!==-1}function a(f,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,y){return e.__proto__=y,e},a(f,t)}function m(f){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(h){return h.__proto__||Object.getPrototypeOf(h)},m(f)}var p=3,o="[eme]",d=function(){function f(h){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=f.CDMCleanupPromise?[f.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=b.logger.debug.bind(b.logger,o),this.log=b.logger.log.bind(b.logger,o),this.warn=b.logger.warn.bind(b.logger,o),this.error=b.logger.error.bind(b.logger,o),this.hls=h,this.config=h.config,this.registerListeners()}var t=f.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},t.registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.getLicenseServerUrl=function(e){var y=this.config,P=y.drmSystems,S=y.widevineLicenseUrl,w=P[e];if(w)return w.licenseUrl;if(e===c.KeySystems.WIDEVINE&&S)return S;throw new Error('no license server URL configured for key-system "'+e+'"')},t.getServerCertificateUrl=function(e){var y=this.config.drmSystems,P=y[e];if(P)return P.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},t.attemptKeySystemAccess=function(e){var y=this,P=this.hls.levels,S=function(U,N,j){return!!U&&j.indexOf(U)===N},w=P.map(function(F){return F.audioCodec}).filter(S),k=P.map(function(F){return F.videoCodec}).filter(S);return w.length+k.length===0&&k.push("avc1.42e01e"),new Promise(function(F,U){var N=function j(W){var H=W.shift();y.getMediaKeysPromise(H,w,k).then(function(G){return F({keySystem:H,mediaKeys:G})}).catch(function(G){W.length?j(W):G instanceof A?U(G):U(new A({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:G,fatal:!0},G.message))})};N(e)})},t.requestMediaKeySystemAccess=function(e,y){var P=this.config.requestMediaKeySystemAccessFunc;if(typeof P!="function"){var S="Configured requestMediaKeySystemAccess is not a function "+P;return c.requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(S="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(S))}return P(e,y)},t.getMediaKeysPromise=function(e,y,P){var S=this,w=(0,c.getSupportedMediaKeySystemConfigurations)(e,y,P,this.config.drmSystemOptions),k=this.keySystemAccessPromises[e],F=k==null?void 0:k.keySystemAccess;if(!F){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(w)),F=this.requestMediaKeySystemAccess(e,w);var U=this.keySystemAccessPromises[e]={keySystemAccess:F};return F.catch(function(N){S.log('Failed to obtain access to key-system "'+e+'": '+N)}),F.then(function(N){S.log('Access for key-system "'+N.keySystem+'" obtained');var j=S.fetchServerCertificate(e);return S.log('Create media-keys for "'+e+'"'),U.mediaKeys=N.createMediaKeys().then(function(W){return S.log('Media-keys created for "'+e+'"'),j.then(function(H){return H?S.setMediaKeysServerCertificate(W,e,H):W})}),U.mediaKeys.catch(function(W){S.error('Failed to create media-keys for "'+e+'"}: '+W)}),U.mediaKeys})}return F.then(function(){return k.mediaKeys})},t.createMediaKeySessionContext=function(e){var y=e.decryptdata,P=e.keySystem,S=e.mediaKeys;console.assert(!!S,"mediaKeys is defined"),this.log('Creating key-system session "'+P+'" keyId: '+T.default.hexDump(y.keyId||[]));var w=S.createSession(),k={decryptdata:y,keySystem:P,mediaKeys:S,mediaKeysSession:w,keyStatus:"status-pending"};return this.mediaKeySessions.push(k),k},t.renewKeySession=function(e){var y=e.decryptdata;if(y.pssh){var P=this.createMediaKeySessionContext(e),S=this.getKeyIdString(y),w="cenc";this.keyIdToKeySessionPromise[S]=this.generateRequestWithPreferredKeySession(P,w,y.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},t.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return T.default.hexDump(e.keyId)},t.updateKeySession=function(e,y){var P,S=e.mediaKeysSession;return this.log('Updating key-session "'+S.sessionId+'" for keyID '+T.default.hexDump(((P=e.decryptdata)===null||P===void 0?void 0:P.keyId)||[])+`
      } (data length: `+(y&&y.byteLength)+")"),S.update(y)},t.selectKeySystemFormat=function(e){var y=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+y.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(y)),this.keyFormatPromise},t.getKeyFormatPromise=function(e){var y=this;return new Promise(function(P,S){var w=(0,c.getKeySystemsForConfig)(y.config),k=e.map(c.keySystemFormatToKeySystemDomain).filter(function(F){return!!F&&w.indexOf(F)!==-1});return y.getKeySystemSelectionPromise(k).then(function(F){var U=F.keySystem,N=(0,c.keySystemDomainToKeySystemFormat)(U);N?P(N):S(new Error('Unable to find format for key-system "'+U+'"'))}).catch(S)})},t.loadKey=function(e){var y=this,P=e.keyInfo.decryptdata,S=this.getKeyIdString(P),w="(keyId: "+S+' format: "'+P.keyFormat+'" method: '+P.method+" uri: "+P.uri+")";this.log("Starting session for key "+w);var k=this.keyIdToKeySessionPromise[S];return k||(k=this.keyIdToKeySessionPromise[S]=this.getKeySystemForKeyPromise(P).then(function(F){var U=F.keySystem,N=F.mediaKeys;return y.throwIfDestroyed(),y.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+w),y.attemptSetMediaKeys(U,N).then(function(){y.throwIfDestroyed();var j=y.createMediaKeySessionContext({keySystem:U,mediaKeys:N,decryptdata:P}),W="cenc";return y.generateRequestWithPreferredKeySession(j,W,P.pssh,"playlist-key")})}),k.catch(function(F){return y.handleError(F)})),k},t.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},t.handleError=function(e){!this.hls||(this.error(e.message),e instanceof A?this.hls.trigger(D.Events.ERROR,e.data):this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},t.getKeySystemForKeyPromise=function(e){var y=this.getKeyIdString(e),P=this.keyIdToKeySessionPromise[y];if(!P){var S=(0,c.keySystemFormatToKeySystemDomain)(e.keyFormat),w=S?[S]:(0,c.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(w)}return P},t.getKeySystemSelectionPromise=function(e){if(e.length||(e=(0,c.getKeySystemsForConfig)(this.config)),e.length===0)throw new A({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},t._onMediaEncrypted=function(e){var y=this,P=e.initDataType,S=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+P+'"'),S!==null){var w,k;if(P==="sinf"&&this.config.drmSystems[c.KeySystems.FAIRPLAY]){var F=(0,L.bin2str)(new Uint8Array(S));try{var U=(0,x.base64Decode)(JSON.parse(F).sinf),N=(0,L.parseSinf)(new Uint8Array(U));if(!N)return;w=N.subarray(8,24),k=c.KeySystems.FAIRPLAY}catch(X){this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{var j=(0,L.parsePssh)(S);if(j===null)return;j.version===0&&j.systemId===c.KeySystemIds.WIDEVINE&&j.data&&(w=j.data.subarray(8,24)),k=(0,c.keySystemIdToKeySystemDomain)(j.systemId)}if(!(!k||!w)){for(var W=T.default.hexDump(w),H=this.keyIdToKeySessionPromise,G=this.mediaKeySessions,V=H[W],Y=function(q){var te=G[q],ee=te.decryptdata;if(ee.pssh||!ee.keyId)return"continue";var Z=T.default.hexDump(ee.keyId);if(W===Z||ee.uri.replace(/-/g,"").indexOf(W)!==-1)return V=H[Z],delete H[Z],ee.pssh=new Uint8Array(S),ee.keyId=w,V=H[W]=V.then(function(){return y.generateRequestWithPreferredKeySession(te,P,S,"encrypted-event-key-match")}),"break"},Q=0;Q<G.length;Q++){var z=Y(Q);if(z!=="continue"&&z==="break")break}V||(V=H[W]=this.getKeySystemSelectionPromise([k]).then(function(X){var q,te=X.keySystem,ee=X.mediaKeys;y.throwIfDestroyed();var Z=new E.LevelKey("ISO-23001-7",W,(q=(0,c.keySystemDomainToKeySystemFormat)(te))!=null?q:"");return Z.pssh=new Uint8Array(S),Z.keyId=w,y.attemptSetMediaKeys(te,ee).then(function(){y.throwIfDestroyed();var J=y.createMediaKeySessionContext({decryptdata:Z,keySystem:te,mediaKeys:ee});return y.generateRequestWithPreferredKeySession(J,P,S,"encrypted-event-no-match")})})),V.catch(function(X){return y.handleError(X)})}}},t._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},t.attemptSetMediaKeys=function(e,y){var P=this,S=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var w=Promise.all(S).then(function(){if(!P.media)throw new Error("Attempted to set mediaKeys without media element attached");return P.media.setMediaKeys(y)});return this.setMediaKeysQueue.push(w),w.then(function(){P.log('Media-keys set for "'+e+'"'),S.push(w),P.setMediaKeysQueue=P.setMediaKeysQueue.filter(function(k){return S.indexOf(k)===-1})})},t.generateRequestWithPreferredKeySession=function(e,y,P,S){var w,k,F=this,U=(w=this.config.drmSystems)===null||w===void 0||(k=w[e.keySystem])===null||k===void 0?void 0:k.generateRequest;if(U)try{var N=U.call(this.hls,y,P,e);if(!N)throw new Error("Invalid response from configured generateRequest filter");y=N.initDataType,P=e.decryptdata.pssh=N.initData?new Uint8Array(N.initData):null}catch(V){var j;if(this.warn(V.message),(j=this.hls)!==null&&j!==void 0&&j.config.debug)throw V}if(P===null)return this.log('Skipping key-session request for "'+S+'" (no initData)'),Promise.resolve(e);var W=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+S+'": '+W+" (init data type: "+y+" length: "+(P?P.byteLength:null)+")");var H=new(r());e.mediaKeysSession.onmessage=function(V){var Y=e.mediaKeysSession;if(!Y){H.emit("error",new Error("invalid state"));return}var Q=V.messageType,z=V.message;F.log('"'+Q+'" message event for session "'+Y.sessionId+'" message size: '+z.byteLength),Q==="license-request"||Q==="license-renewal"?F.renewLicense(e,z).catch(function(X){F.handleError(X),H.emit("error",X)}):Q==="license-release"?e.keySystem===c.KeySystems.FAIRPLAY&&(F.updateKeySession(e,(0,C.strToUtf8array)("acknowledged")),F.removeSession(e)):F.warn('unhandled media key message type "'+Q+'"')},e.mediaKeysSession.onkeystatuseschange=function(V){var Y=e.mediaKeysSession;if(!Y){H.emit("error",new Error("invalid state"));return}F.onKeyStatusChange(e);var Q=e.keyStatus;H.emit("keyStatus",Q),Q==="expired"&&(F.warn(e.keySystem+" expired for key "+W),F.renewKeySession(e))};var G=new Promise(function(V,Y){H.on("error",Y),H.on("keyStatus",function(Q){Q.startsWith("usable")?V():Q==="output-restricted"?Y(new A({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):Q==="internal-error"?Y(new A({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+Q+'"')):Q==="expired"?Y(new Error("key expired while generating request")):F.warn('unhandled key status change "'+Q+'"')})});return e.mediaKeysSession.generateRequest(y,P).then(function(){var V;F.log('Request generated for key-session "'+((V=e.mediaKeysSession)===null||V===void 0?void 0:V.sessionId)+'" keyId: '+W)}).catch(function(V){throw new A({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:V,fatal:!1},"Error generating key-session request: "+V)}).then(function(){return G}).catch(function(V){throw H.removeAllListeners(),F.removeSession(e),V}).then(function(){return H.removeAllListeners(),e})},t.onKeyStatusChange=function(e){var y=this;e.mediaKeysSession.keyStatuses.forEach(function(P,S){y.log('key status change "'+P+'" for keyStatuses keyId: '+T.default.hexDump("buffer"in S?new Uint8Array(S.buffer,S.byteOffset,S.byteLength):new Uint8Array(S))+" session keyId: "+T.default.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=P})},t.fetchServerCertificate=function(e){var y=this;return new Promise(function(P,S){var w=y.getServerCertificateUrl(e);if(!w)return P();y.log('Fetching serverCertificate for "'+e+'"');var k=new XMLHttpRequest;k.open("GET",w,!0),k.responseType="arraybuffer",k.onreadystatechange=function(){k.readyState===XMLHttpRequest.DONE&&(k.status===200?P(k.response):S(new A({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:k},'"'+e+'" certificate request XHR failed ('+w+"). Status: "+k.status+" ("+k.statusText+")")))},k.send()})},t.setMediaKeysServerCertificate=function(e,y,P){var S=this;return new Promise(function(w,k){e.setServerCertificate(P).then(function(F){S.log("setServerCertificate "+(F?"success":"not supported by CDM")+" ("+(P==null?void 0:P.byteLength)+') on "'+y+'"'),w(e)}).catch(function(F){k(new A({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:F,fatal:!0},F.message))})})},t.renewLicense=function(e,y){var P=this;return this.requestLicense(e,new Uint8Array(y)).then(function(S){return P.updateKeySession(e,new Uint8Array(S)).catch(function(w){throw new A({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:w,fatal:!0},w.message)})})},t.setupLicenseXHR=function(e,y,P,S){var w=this,k=this.config.licenseXhrSetup;return k?Promise.resolve().then(function(){if(!P.decryptdata)throw new Error("Key removed");return k.call(w.hls,e,y,P,S)}).catch(function(F){if(!P.decryptdata)throw F;return e.open("POST",y,!0),k.call(w.hls,e,y,P,S)}).then(function(F){e.readyState||e.open("POST",y,!0);var U=F||S;return{xhr:e,licenseChallenge:U}}):(e.open("POST",y,!0),Promise.resolve({xhr:e,licenseChallenge:S}))},t.requestLicense=function(e,y){var P=this;return new Promise(function(S,w){var k=P.getLicenseServerUrl(e.keySystem);P.log("Sending license request to URL: "+k);var F=new XMLHttpRequest;F.responseType="arraybuffer",F.onreadystatechange=function(){if(!P.hls||!e.mediaKeysSession)return w(new Error("invalid state"));if(F.readyState===4)if(F.status===200){P._requestLicenseFailureCount=0;var U=F.response;P.log("License received "+(U instanceof ArrayBuffer?U.byteLength:U));var N=P.config.licenseResponseCallback;if(N)try{U=N.call(P.hls,F,k,e)}catch(W){P.error(W)}S(U)}else if(P._requestLicenseFailureCount++,P._requestLicenseFailureCount>p||F.status>=400&&F.status<500)w(new A({type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:F},"License Request XHR failed ("+k+"). Status: "+F.status+" ("+F.statusText+")"));else{var j=p-P._requestLicenseFailureCount+1;P.warn("Retrying license request, "+j+" attempts left"),P.requestLicense(e,y).then(S,w)}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=F,P.setupLicenseXHR(F,k,e,y).then(function(U){var N=U.xhr,j=U.licenseChallenge;N.send(j)})})},t.onMediaAttached=function(e,y){if(!!this.config.emeEnabled){var P=y.media;this.media=P,P.addEventListener("encrypted",this.onMediaEncrypted),P.addEventListener("waitingforkey",this.onWaitingForKey)}},t.onMediaDetached=function(){var e=this,y=this.media,P=this.mediaKeySessions;y&&(y.removeEventListener("encrypted",this.onMediaEncrypted),y.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},E.LevelKey.clearKeyUriToKeyIdMap();var S=P.length;f.CDMCleanupPromise=Promise.all(P.map(function(w){return e.removeSession(w)}).concat(y==null?void 0:y.setMediaKeys(null).catch(function(w){e.log("Could not clear media keys: "+w+". media.src: "+(y==null?void 0:y.src))}))).then(function(){S&&(e.log("finished closing key sessions and clearing media keys"),P.length=0)}).catch(function(w){e.log("Could not close sessions and clear media keys: "+w+". media.src: "+(y==null?void 0:y.src))})},t.onManifestLoaded=function(e,y){var P=y.sessionKeys;if(!(!P||!this.config.emeEnabled)&&!this.keyFormatPromise){var S=P.reduce(function(w,k){return w.indexOf(k.keyFormat)===-1&&w.push(k.keyFormat),w},[]);this.log("Selecting key-system from session-keys "+S.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(S)}},t.removeSession=function(e){var y=this,P=e.mediaKeysSession,S=e.licenseXhr;if(P){this.log("Remove licenses and keys and close session "+P.sessionId),P.onmessage=null,P.onkeystatuseschange=null,S&&S.readyState!==XMLHttpRequest.DONE&&S.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var w=this.mediaKeySessions.indexOf(e);return w>-1&&this.mediaKeySessions.splice(w,1),P.remove().catch(function(k){y.log("Could not remove session: "+k)}).then(function(){return P.close()}).catch(function(k){y.log("Could not close session: "+k)})}},f}();d.CDMCleanupPromise=void 0;var A=function(f){_(t,f);function t(h,e){var y;return y=f.call(this,e)||this,y.data=void 0,y.data=h,h.err=h.error,y}return t}(v(Error));const u=d},"./src/controller/fps-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>c});var D=s("./src/events.ts"),g=s("./src/utils/logger.ts"),b=function(){function C(E){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=E,this.registerListeners()}var x=C.prototype;return x.setStreamController=function(T){this.streamController=T},x.registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},x.unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching)},x.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},x.onMediaAttaching=function(T,L){var I=this.hls.config;if(I.capLevelOnFPSDrop){var r=L.media instanceof self.HTMLVideoElement?L.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),I.fpsDroppedMonitoringPeriod)}},x.checkFPS=function(T,L,I){var r=performance.now();if(L){if(this.lastTime){var _=r-this.lastTime,v=I-this.lastDroppedFrames,n=L-this.lastDecodedFrames,l=1e3*v/_,i=this.hls;if(i.trigger(D.Events.FPS_DROP,{currentDropped:v,currentDecoded:n,totalDroppedFrames:I}),l>0&&v>i.config.fpsDroppedMonitoringThreshold*n){var a=i.currentLevel;g.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),a>0&&(i.autoLevelCapping===-1||i.autoLevelCapping>=a)&&(a=a-1,i.trigger(D.Events.FPS_DROP_LEVEL_CAPPING,{level:a,droppedLevel:i.currentLevel}),i.autoLevelCapping=a,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=I,this.lastDecodedFrames=L}},x.checkFPSInterval=function(){var T=this.media;if(T)if(this.isVideoPlaybackQualityAvailable){var L=T.getVideoPlaybackQuality();this.checkFPS(T,L.totalVideoFrames,L.droppedVideoFrames)}else this.checkFPS(T,T.webkitDecodedFrameCount,T.webkitDroppedFrameCount)},C}();const c=b},"./src/controller/fragment-finders.ts":(O,R,s)=>{s.r(R),s.d(R,{findFragWithCC:()=>E,findFragmentByPDT:()=>b,findFragmentByPTS:()=>c,fragmentWithinToleranceTest:()=>C,pdtWithinToleranceTest:()=>x});var D=s("./src/polyfills/number.ts"),g=s("./src/utils/binary-search.ts");function b(T,L,I){if(L===null||!Array.isArray(T)||!T.length||!(0,D.isFiniteNumber)(L))return null;var r=T[0].programDateTime;if(L<(r||0))return null;var _=T[T.length-1].endProgramDateTime;if(L>=(_||0))return null;I=I||0;for(var v=0;v<T.length;++v){var n=T[v];if(x(L,I,n))return n}return null}function c(T,L,I,r){I===void 0&&(I=0),r===void 0&&(r=0);var _=null;if(T?_=L[T.sn-L[0].sn+1]||null:I===0&&L[0].start===0&&(_=L[0]),_&&C(I,r,_)===0)return _;var v=g.default.search(L,C.bind(null,I,r));return v&&(v!==T||!_)?v:_}function C(T,L,I){if(T===void 0&&(T=0),L===void 0&&(L=0),I.start<=T&&I.start+I.duration>T)return 0;var r=Math.min(L,I.duration+(I.deltaPTS?I.deltaPTS:0));return I.start+I.duration-r<=T?1:I.start-r>T&&I.start?-1:0}function x(T,L,I){var r=Math.min(L,I.duration+(I.deltaPTS?I.deltaPTS:0))*1e3,_=I.endProgramDateTime||0;return _-r>T}function E(T,L){return g.default.search(T,function(I){return I.cc<L?1:I.cc>L?-1:0})}},"./src/controller/fragment-tracker.ts":(O,R,s)=>{s.r(R),s.d(R,{FragmentState:()=>b,FragmentTracker:()=>c});var D=s("./src/events.ts"),g=s("./src/types/loader.ts"),b;(function(E){E.NOT_LOADED="NOT_LOADED",E.APPENDING="APPENDING",E.PARTIAL="PARTIAL",E.OK="OK"})(b||(b={}));var c=function(){function E(L){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=L,this._registerListeners()}var T=E.prototype;return T._registerListeners=function(){var I=this.hls;I.on(D.Events.BUFFER_APPENDED,this.onBufferAppended,this),I.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.on(D.Events.FRAG_LOADED,this.onFragLoaded,this)},T._unregisterListeners=function(){var I=this.hls;I.off(D.Events.BUFFER_APPENDED,this.onBufferAppended,this),I.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.off(D.Events.FRAG_LOADED,this.onFragLoaded,this)},T.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},T.getAppendedFrag=function(I,r){if(r===g.PlaylistLevelType.MAIN){var _=this.activeFragment,v=this.activeParts;if(!_)return null;if(v)for(var n=v.length;n--;){var l=v[n],i=l?l.end:_.appendedPTS;if(l.start<=I&&i!==void 0&&I<=i)return n>9&&(this.activeParts=v.slice(n-9)),l}else if(_.start<=I&&_.appendedPTS!==void 0&&I<=_.appendedPTS)return _}return this.getBufferedFrag(I,r)},T.getBufferedFrag=function(I,r){for(var _=this.fragments,v=Object.keys(_),n=v.length;n--;){var l=_[v[n]];if((l==null?void 0:l.body.type)===r&&l.buffered){var i=l.body;if(i.start<=I&&I<=i.end)return i}}return null},T.detectEvictedFragments=function(I,r,_){var v=this;this.timeRanges&&(this.timeRanges[I]=r),Object.keys(this.fragments).forEach(function(n){var l=v.fragments[n];if(!!l){if(!l.buffered&&!l.loaded){l.body.type===_&&v.removeFragment(l.body);return}var i=l.range[I];!i||i.time.some(function(a){var m=!v.isTimeBuffered(a.startPTS,a.endPTS,r);return m&&v.removeFragment(l.body),m})}})},T.detectPartialFragments=function(I){var r=this,_=this.timeRanges,v=I.frag,n=I.part;if(!(!_||v.sn==="initSegment")){var l=x(v),i=this.fragments[l];!i||(Object.keys(_).forEach(function(a){var m=v.elementaryStreams[a];if(!!m){var p=_[a],o=n!==null||m.partial===!0;i.range[a]=r.getBufferedTimes(v,n,o,p)}}),i.loaded=null,Object.keys(i.range).length?(i.buffered=!0,i.body.endList&&(this.endListFragments[i.body.type]=i)):this.removeFragment(i.body))}},T.fragBuffered=function(I){var r=x(I),_=this.fragments[r];_&&(_.loaded=null,_.buffered=!0)},T.getBufferedTimes=function(I,r,_,v){for(var n={time:[],partial:_},l=r?r.start:I.start,i=r?r.end:I.end,a=I.minEndPTS||i,m=I.maxStartPTS||l,p=0;p<v.length;p++){var o=v.start(p)-this.bufferPadding,d=v.end(p)+this.bufferPadding;if(m>=o&&a<=d){n.time.push({startPTS:Math.max(l,v.start(p)),endPTS:Math.min(i,v.end(p))});break}else if(l<d&&i>o)n.partial=!0,n.time.push({startPTS:Math.max(l,v.start(p)),endPTS:Math.min(i,v.end(p))});else if(i<=o)break}return n},T.getPartialFragment=function(I){var r=null,_,v,n,l=0,i=this.bufferPadding,a=this.fragments;return Object.keys(a).forEach(function(m){var p=a[m];!p||C(p)&&(v=p.body.start-i,n=p.body.end+i,I>=v&&I<=n&&(_=Math.min(I-v,n-I),l<=_&&(r=p.body,l=_)))}),r},T.isEndListAppended=function(I){var r=this.endListFragments[I];return r!==void 0&&(r.buffered||C(r))},T.getState=function(I){var r=x(I),_=this.fragments[r];return _?_.buffered?C(_)?b.PARTIAL:b.OK:b.APPENDING:b.NOT_LOADED},T.isTimeBuffered=function(I,r,_){for(var v,n,l=0;l<_.length;l++){if(v=_.start(l)-this.bufferPadding,n=_.end(l)+this.bufferPadding,I>=v&&r<=n)return!0;if(r<=v)return!1}return!1},T.onFragLoaded=function(I,r){var _=r.frag,v=r.part;if(!(_.sn==="initSegment"||_.bitrateTest||v)){var n=x(_);this.fragments[n]={body:_,loaded:r,buffered:!1,range:Object.create(null)}}},T.onBufferAppended=function(I,r){var _=this,v=r.frag,n=r.part,l=r.timeRanges;if(v.type===g.PlaylistLevelType.MAIN)if(this.activeFragment!==v&&(this.activeFragment=v,v.appendedPTS=void 0),n){var i=this.activeParts;i||(this.activeParts=i=[]),i.push(n)}else this.activeParts=null;this.timeRanges=l,Object.keys(l).forEach(function(a){var m=l[a];if(_.detectEvictedFragments(a,m),!n&&v.type===g.PlaylistLevelType.MAIN){var p=v.elementaryStreams[a];if(!p)return;for(var o=0;o<m.length;o++){var d=m.end(o);d<=p.endPTS&&d>p.startPTS?v.appendedPTS=Math.max(d,v.appendedPTS||0):v.appendedPTS=p.endPTS}}})},T.onFragBuffered=function(I,r){this.detectPartialFragments(r)},T.hasFragment=function(I){var r=x(I);return!!this.fragments[r]},T.removeFragmentsInRange=function(I,r,_){var v=this;Object.keys(this.fragments).forEach(function(n){var l=v.fragments[n];if(!!l&&l.buffered){var i=l.body;i.type===_&&i.start<r&&i.end>I&&v.removeFragment(i)}})},T.removeFragment=function(I){var r=x(I);I.stats.loaded=0,I.clearElementaryStreamInfo(),I.appendedPTS=void 0,delete this.fragments[r],I.endList&&delete this.endListFragments[I.type]},T.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},E}();function C(E){var T,L;return E.buffered&&(((T=E.range.video)===null||T===void 0?void 0:T.partial)||((L=E.range.audio)===null||L===void 0?void 0:L.partial))}function x(E){return E.type+"_"+E.level+"_"+E.urlId+"_"+E.sn}},"./src/controller/gap-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{MAX_START_GAP_JUMP:()=>x,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>E,SKIP_BUFFER_RANGE_START:()=>T,STALL_MINIMUM_DURATION_MS:()=>C,default:()=>L});var D=s("./src/utils/buffer-helper.ts"),g=s("./src/errors.ts"),b=s("./src/events.ts"),c=s("./src/utils/logger.ts"),C=250,x=2,E=.1,T=.05,L=function(){function I(_,v,n,l){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=_,this.media=v,this.fragmentTracker=n,this.hls=l}var r=I.prototype;return r.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},r.poll=function(v,n){var l=this.config,i=this.media,a=this.stalled;if(i!==null){var m=i.currentTime,p=i.seeking,o=this.seeking&&!p,d=!this.seeking&&p;if(this.seeking=p,m!==v){if(this.moved=!0,a!==null){if(this.stallReported){var A=self.performance.now()-a;c.logger.warn("playback not stuck anymore @"+m+", after "+Math.round(A)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((d||o)&&(this.stalled=null),!(i.paused&&!p||i.ended||i.playbackRate===0||!D.BufferHelper.getBuffered(i).length)){var u=D.BufferHelper.bufferInfo(i,m,0),f=u.len>0,t=u.nextStart||0;if(!(!f&&!t)){if(p){var h=u.len>x,e=!t||n&&n.start<=m||t-m>x&&!this.fragmentTracker.getPartialFragment(m);if(h||e)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var y,P=Math.max(t,u.start||0)-m,S=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,w=S==null||(y=S.details)===null||y===void 0?void 0:y.live,k=w?S.details.targetduration*2:x;if(P>0&&P<=k){this._trySkipBufferHole(null);return}}var F=self.performance.now();if(a===null){this.stalled=F;return}var U=F-a;if(!(!p&&U>=C&&(this._reportStall(u),!this.media))){var N=D.BufferHelper.bufferInfo(i,m,l.maxBufferHole);this._tryFixBufferStall(N,U)}}}}},r._tryFixBufferStall=function(v,n){var l=this.config,i=this.fragmentTracker,a=this.media;if(a!==null){var m=a.currentTime,p=i.getPartialFragment(m);if(p){var o=this._trySkipBufferHole(p);if(o||!this.media)return}v.len>l.maxBufferHole&&n>l.highBufferWatchdogPeriod*1e3&&(c.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},r._reportStall=function(v){var n=this.hls,l=this.media,i=this.stallReported;!i&&l&&(this.stallReported=!0,c.logger.warn("Playback stalling at @"+l.currentTime+" due to low buffer ("+JSON.stringify(v)+")"),n.trigger(b.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:v.len}))},r._trySkipBufferHole=function(v){var n=this.config,l=this.hls,i=this.media;if(i===null)return 0;for(var a=i.currentTime,m=0,p=D.BufferHelper.getBuffered(i),o=0;o<p.length;o++){var d=p.start(o);if(a+n.maxBufferHole>=m&&a<d){var A=Math.max(d+T,i.currentTime+E);return c.logger.warn("skipping hole, adjusting currentTime from "+a+" to "+A),this.moved=!0,this.stalled=null,i.currentTime=A,v&&l.trigger(b.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+a+" to "+A,frag:v}),A}m=p.end(o)}return 0},r._tryNudgeBuffer=function(){var v=this.config,n=this.hls,l=this.media,i=this.nudgeRetry;if(l!==null){var a=l.currentTime;if(this.nudgeRetry++,i<v.nudgeMaxRetry){var m=a+(i+1)*v.nudgeOffset;c.logger.warn("Nudging 'currentTime' from "+a+" to "+m),l.currentTime=m,n.trigger(b.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else c.logger.error("Playhead still not moving while enough data buffered @"+a+" after "+v.nudgeMaxRetry+" nudges"),n.trigger(b.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},I}()},"./src/controller/id3-track-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>v});var D=s("./src/polyfills/number.ts"),g=s("./src/events.ts"),b=s("./src/utils/texttrack-utils.ts"),c=s("./src/demux/id3.ts"),C=s("./src/loader/date-range.ts"),x=s("./src/types/demuxer.ts"),E=.25;function T(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var L=function(){var n=T();try{new n(0,Number.POSITIVE_INFINITY,"")}catch(l){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function I(n,l){return n.getTime()/1e3-l}function r(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var _=function(){function n(i){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=i,this._registerListeners()}var l=n.prototype;return l.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},l._registerListeners=function(){var a=this.hls;a.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(g.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),a.on(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.on(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l._unregisterListeners=function(){var a=this.hls;a.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(g.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),a.off(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),a.off(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l.onMediaAttached=function(a,m){this.media=m.media},l.onMediaDetaching=function(){!this.id3Track||((0,b.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},l.onManifestLoading=function(){this.dateRangeCuesAppended={}},l.createTrack=function(a){var m=this.getID3Track(a.textTracks);return m.mode="hidden",m},l.getID3Track=function(a){if(!!this.media){for(var m=0;m<a.length;m++){var p=a[m];if(p.kind==="metadata"&&p.label==="id3")return(0,b.sendAddTrackEvent)(p,this.media),p}return this.media.addTextTrack("metadata","id3")}},l.onFragParsingMetadata=function(a,m){if(!!this.media){var p=this.hls.config,o=p.enableEmsgMetadataCues,d=p.enableID3MetadataCues;if(!(!o&&!d)){var A=m.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var u=T(),f=0;f<A.length;f++){var t=A[f].type;if(!(t===x.MetadataSchema.emsg&&!o||!d)){var h=c.getID3Frames(A[f].data);if(h){var e=A[f].pts,y=e+A[f].duration;y>L&&(y=L);var P=y-e;P<=0&&(y=e+E);for(var S=0;S<h.length;S++){var w=h[S];if(!c.isTimeStampFrame(w)){this.updateId3CueEnds(e);var k=new u(e,y,"");k.value=w,t&&(k.type=t),this.id3Track.addCue(k)}}}}}}}},l.updateId3CueEnds=function(a){var m,p=(m=this.id3Track)===null||m===void 0?void 0:m.cues;if(p)for(var o=p.length;o--;){var d=p[o];d.startTime<a&&d.endTime===L&&(d.endTime=a)}},l.onBufferFlushing=function(a,m){var p=m.startOffset,o=m.endOffset,d=m.type,A=this.id3Track,u=this.hls;if(!!u){var f=u.config,t=f.enableEmsgMetadataCues,h=f.enableID3MetadataCues;if(A&&(t||h)){var e;d==="audio"?e=function(P){return P.type===x.MetadataSchema.audioId3&&h}:d==="video"?e=function(P){return P.type===x.MetadataSchema.emsg&&t}:e=function(P){return P.type===x.MetadataSchema.audioId3&&h||P.type===x.MetadataSchema.emsg&&t},(0,b.removeCuesInRange)(A,p,o,e)}}},l.onLevelUpdated=function(a,m){var p=this,o=m.details;if(!(!this.media||!o.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var d=this.dateRangeCuesAppended,A=this.id3Track,u=o.dateRanges,f=Object.keys(u);if(A)for(var t=Object.keys(d).filter(function(F){return!f.includes(F)}),h=function(U){var N=t[U];Object.keys(d[N].cues).forEach(function(j){A.removeCue(d[N].cues[j])}),delete d[N]},e=t.length;e--;)h(e);var y=o.fragments[o.fragments.length-1];if(!(f.length===0||!(0,D.isFiniteNumber)(y==null?void 0:y.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var P=y.programDateTime/1e3-y.start,S=T(),w=function(U){var N=f[U],j=u[N],W=d[N],H=(W==null?void 0:W.cues)||{},G=(W==null?void 0:W.durationKnown)||!1,V=I(j.startDate,P),Y=L,Q=j.endDate;if(Q)Y=I(Q,P),G=!0;else if(j.endOnNext&&!G){var z=f.reduce(function(J,ie){var ne=u[ie];return ne.class===j.class&&ne.id!==ie&&ne.startDate>j.startDate&&J.push(ne),J},[]).sort(function(J,ie){return J.startDate.getTime()-ie.startDate.getTime()})[0];z&&(Y=I(z.startDate,P),G=!0)}for(var X=Object.keys(j.attr),q=0;q<X.length;q++){var te=X[q];if(!(te===C.DateRangeAttribute.ID||te===C.DateRangeAttribute.CLASS||te===C.DateRangeAttribute.START_DATE||te===C.DateRangeAttribute.DURATION||te===C.DateRangeAttribute.END_DATE||te===C.DateRangeAttribute.END_ON_NEXT)){var ee=H[te];if(ee)G&&!W.durationKnown&&(ee.endTime=Y);else{var Z=j.attr[te];ee=new S(V,Y,""),(te===C.DateRangeAttribute.SCTE35_OUT||te===C.DateRangeAttribute.SCTE35_IN)&&(Z=r(Z)),ee.value={key:te,data:Z},ee.type=x.MetadataSchema.dateRange,p.id3Track.addCue(ee),H[te]=ee}}}d[N]={cues:H,dateRange:j,durationKnown:G}},k=0;k<f.length;k++)w(k)}}},n}();const v=_},"./src/controller/latency-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>T});var D=s("./src/errors.ts"),g=s("./src/events.ts"),b=s("./src/utils/logger.ts");function c(L,I){for(var r=0;r<I.length;r++){var _=I[r];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(L,x(_.key),_)}}function C(L,I,r){return I&&c(L.prototype,I),r&&c(L,r),Object.defineProperty(L,"prototype",{writable:!1}),L}function x(L){var I=E(L,"string");return typeof I=="symbol"?I:String(I)}function E(L,I){if(typeof L!="object"||L===null)return L;var r=L[Symbol.toPrimitive];if(r!==void 0){var _=r.call(L,I||"default");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return(I==="string"?String:Number)(L)}var T=function(){function L(r){var _=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return _.timeupdate()},this.hls=r,this.config=r.config,this.registerListeners()}var I=L.prototype;return I.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},I.registerListeners=function(){this.hls.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(g.Events.ERROR,this.onError,this)},I.unregisterListeners=function(){this.hls.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(g.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(g.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(g.Events.ERROR,this.onError)},I.onMediaAttached=function(_,v){this.media=v.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},I.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},I.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},I.onLevelUpdated=function(_,v){var n=v.details;this.levelDetails=n,n.advanced&&this.timeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},I.onError=function(_,v){v.details===D.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,b.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},I.timeupdate=function(){var _=this.media,v=this.levelDetails;if(!(!_||!v)){this.currentTime=_.currentTime;var n=this.computeLatency();if(n!==null){this._latency=n;var l=this.config,i=l.lowLatencyMode,a=l.maxLiveSyncPlaybackRate;if(!(!i||a===1)){var m=this.targetLatency;if(m!==null){var p=n-m,o=Math.min(this.maxLatency,m+v.targetduration),d=p<o;if(v.live&&d&&p>.05&&this.forwardBufferLength>1){var A=Math.min(2,Math.max(1,a)),u=Math.round(2/(1+Math.exp(-.75*p-this.edgeStalled))*20)/20;_.playbackRate=Math.min(A,Math.max(1,u))}else _.playbackRate!==1&&_.playbackRate!==0&&(_.playbackRate=1)}}}}},I.estimateLiveEdge=function(){var _=this.levelDetails;return _===null?null:_.edge+_.age},I.computeLatency=function(){var _=this.estimateLiveEdge();return _===null?null:_-this.currentTime},C(L,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var _=this.config,v=this.levelDetails;return _.liveMaxLatencyDuration!==void 0?_.liveMaxLatencyDuration:v?_.liveMaxLatencyDurationCount*v.targetduration:0}},{key:"targetLatency",get:function(){var _=this.levelDetails;if(_===null)return null;var v=_.holdBack,n=_.partHoldBack,l=_.targetduration,i=this.config,a=i.liveSyncDuration,m=i.liveSyncDurationCount,p=i.lowLatencyMode,o=this.hls.userConfig,d=p&&n||v;(o.liveSyncDuration||o.liveSyncDurationCount||d===0)&&(d=a!==void 0?a:m*l);var A=l,u=1;return d+Math.min(this.stallCount*u,A)}},{key:"liveSyncPosition",get:function(){var _=this.estimateLiveEdge(),v=this.targetLatency,n=this.levelDetails;if(_===null||v===null||n===null)return null;var l=n.edge,i=_-v-this.edgeStalled,a=l-n.totalduration,m=l-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,i),m)}},{key:"drift",get:function(){var _=this.levelDetails;return _===null?1:_.drift}},{key:"edgeStalled",get:function(){var _=this.levelDetails;if(_===null)return 0;var v=(this.config.lowLatencyMode&&_.partTarget||_.targetduration)*3;return Math.max(_.age-v,0)}},{key:"forwardBufferLength",get:function(){var _=this.media,v=this.levelDetails;if(!_||!v)return 0;var n=_.buffered.length;return(n?_.buffered.end(n-1):v.edge)-this.currentTime}}]),L}()},"./src/controller/level-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>i});var D=s("./src/types/level.ts"),g=s("./src/events.ts"),b=s("./src/errors.ts"),c=s("./src/utils/codecs.ts"),C=s("./src/controller/level-helper.ts"),x=s("./src/controller/base-playlist-controller.ts"),E=s("./src/types/loader.ts");function T(){return T=Object.assign?Object.assign.bind():function(a){for(var m=1;m<arguments.length;m++){var p=arguments[m];for(var o in p)Object.prototype.hasOwnProperty.call(p,o)&&(a[o]=p[o])}return a},T.apply(this,arguments)}function L(a,m){for(var p=0;p<m.length;p++){var o=m[p];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(a,r(o.key),o)}}function I(a,m,p){return m&&L(a.prototype,m),p&&L(a,p),Object.defineProperty(a,"prototype",{writable:!1}),a}function r(a){var m=_(a,"string");return typeof m=="symbol"?m:String(m)}function _(a,m){if(typeof a!="object"||a===null)return a;var p=a[Symbol.toPrimitive];if(p!==void 0){var o=p.call(a,m||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(a)}function v(a,m){a.prototype=Object.create(m.prototype),a.prototype.constructor=a,n(a,m)}function n(a,m){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},n(a,m)}var l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),i=function(a){v(m,a);function m(o){var d;return d=a.call(this,o,"[level-controller]")||this,d._levels=[],d._firstLevel=-1,d._startLevel=void 0,d.currentLevelIndex=-1,d.manualLevelIndex=-1,d.onParsedComplete=void 0,d._registerListeners(),d}var p=m.prototype;return p._registerListeners=function(){var d=this.hls;d.on(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.on(g.Events.FRAG_LOADED,this.onFragLoaded,this),d.on(g.Events.ERROR,this.onError,this)},p._unregisterListeners=function(){var d=this.hls;d.off(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.off(g.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(g.Events.ERROR,this.onError,this)},p.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,a.prototype.destroy.call(this)},p.startLoad=function(){var d=this._levels;d.forEach(function(A){A.loadError=0}),a.prototype.startLoad.call(this)},p.onManifestLoaded=function(d,A){var u=[],f=[],t=[],h,e={},y,P=!1,S=!1,w=!1;if(A.levels.forEach(function(N){var j=N.attrs;P=P||!!(N.width&&N.height),S=S||!!N.videoCodec,w=w||!!N.audioCodec,l&&N.audioCodec&&N.audioCodec.indexOf("mp4a.40.34")!==-1&&(N.audioCodec=void 0);var W=N.bitrate+"-"+N.attrs.RESOLUTION+"-"+N.attrs.CODECS;y=e[W],y?y.url.push(N.url):(y=new D.Level(N),e[W]=y,u.push(y)),j&&(j.AUDIO&&(0,C.addGroupId)(y,"audio",j.AUDIO),j.SUBTITLES&&(0,C.addGroupId)(y,"text",j.SUBTITLES))}),(P||S)&&w&&(u=u.filter(function(N){var j=N.videoCodec,W=N.width,H=N.height;return!!j||!!(W&&H)})),u=u.filter(function(N){var j=N.audioCodec,W=N.videoCodec;return(!j||(0,c.isCodecSupportedInMp4)(j,"audio"))&&(!W||(0,c.isCodecSupportedInMp4)(W,"video"))}),A.audioTracks&&(f=A.audioTracks.filter(function(N){return!N.audioCodec||(0,c.isCodecSupportedInMp4)(N.audioCodec,"audio")}),(0,C.assignTrackIdsByGroup)(f)),A.subtitles&&(t=A.subtitles,(0,C.assignTrackIdsByGroup)(t)),u.length>0){h=u[0].bitrate,u.sort(function(N,j){return N.attrs["HDCP-LEVEL"]!==j.attrs["HDCP-LEVEL"]?(N.attrs["HDCP-LEVEL"]||"")>(j.attrs["HDCP-LEVEL"]||"")?1:-1:N.bitrate!==j.bitrate?N.bitrate-j.bitrate:N.attrs.SCORE!==j.attrs.SCORE?N.attrs.decimalFloatingPoint("SCORE")-j.attrs.decimalFloatingPoint("SCORE"):P&&N.height!==j.height?N.height-j.height:0}),this._levels=u;for(var k=0;k<u.length;k++)if(u[k].bitrate===h){this._firstLevel=k,this.log("manifest loaded, "+u.length+" level(s) found, first bitrate: "+h);break}var F=w&&!S,U={levels:u,audioTracks:f,subtitleTracks:t,sessionData:A.sessionData,sessionKeys:A.sessionKeys,firstLevel:this._firstLevel,stats:A.stats,audio:w,video:S,altAudio:!F&&f.some(function(N){return!!N.url})};this.hls.trigger(g.Events.MANIFEST_PARSED,U),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(g.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:A.url,reason:"no level with compatible codecs found in manifest"})},p.onError=function(d,A){var u,f;if(a.prototype.onError.call(this,d,A),!A.fatal){var t=A.context,h=this._levels[this.currentLevelIndex];if(t&&(t.type===E.PlaylistContextType.AUDIO_TRACK&&h.audioGroupIds&&t.groupId===h.audioGroupIds[h.urlId]||t.type===E.PlaylistContextType.SUBTITLE_TRACK&&h.textGroupIds&&t.groupId===h.textGroupIds[h.urlId])){this.redundantFailover(this.currentLevelIndex);return}var e=!1,y=!0,P;switch(A.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:if(A.frag){var S=A.frag.type===E.PlaylistLevelType.MAIN?A.frag.level:this.currentLevelIndex,w=this._levels[S];w?(w.fragmentError++,w.fragmentError>this.hls.config.fragLoadingMaxRetry&&(P=S)):P=S}break;case b.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var k=h.attrs["HDCP-LEVEL"];k&&(this.hls.maxHdcpLevel=D.HdcpLevels[D.HdcpLevels.indexOf(k)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'))}case b.ErrorDetails.FRAG_PARSING_ERROR:case b.ErrorDetails.KEY_SYSTEM_NO_SESSION:P=((u=A.frag)===null||u===void 0?void 0:u.type)===E.PlaylistLevelType.MAIN?A.frag.level:this.currentLevelIndex,A.levelRetry=!1;break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:t&&(t.deliveryDirectives&&(y=!1),P=t.level),e=!0;break;case b.ErrorDetails.REMUX_ALLOC_ERROR:P=(f=A.level)!=null?f:this.currentLevelIndex,e=!0;break}P!==void 0&&this.recoverLevel(A,P,e,y)}},p.recoverLevel=function(d,A,u,f){var t=d.details,h=this._levels[A];if(h.loadError++,u){var e=this.retryLoadingOrFail(d);if(e)d.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(f){var y=h.url.length;if(y>1&&h.loadError<y)d.levelRetry=!0,this.redundantFailover(A);else if(this.manualLevelIndex===-1){for(var P=-1,S=this._levels,w=S.length;w--;){var k=(w+this.currentLevelIndex)%S.length;if(k!==this.currentLevelIndex&&S[k].loadError===0){P=k;break}}P>-1&&this.currentLevelIndex!==P?(this.warn(t+": switch to "+P),d.levelRetry=!0,this.hls.nextAutoLevel=P):d.levelRetry===!1&&(d.fatal=!0)}}},p.redundantFailover=function(d){var A=this._levels[d],u=A.url.length;if(u>1){var f=(A.urlId+1)%u;this.warn("Switching to redundant URL-id "+f),this._levels.forEach(function(t){t.urlId=f}),this.level=d}},p.onFragLoaded=function(d,A){var u=A.frag;if(u!==void 0&&u.type===E.PlaylistLevelType.MAIN){var f=this._levels[u.level];f!==void 0&&(f.fragmentError=0,f.loadError=0)}},p.onLevelLoaded=function(d,A){var u,f=A.level,t=A.details,h=this._levels[f];if(!h){var e;this.warn("Invalid level index "+f),(e=A.deliveryDirectives)!==null&&e!==void 0&&e.skip&&(t.deltaUpdateFailed=!0);return}f===this.currentLevelIndex?(h.fragmentError===0&&(h.loadError=0,this.retryCount=0),this.playlistLoaded(f,A,h.details)):(u=A.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(t.deltaUpdateFailed=!0)},p.onAudioTrackSwitched=function(d,A){var u=this.hls.levels[this.currentLevelIndex];if(!!u&&u.audioGroupIds){for(var f=-1,t=this.hls.audioTracks[A.id].groupId,h=0;h<u.audioGroupIds.length;h++)if(u.audioGroupIds[h]===t){f=h;break}f!==u.urlId&&(u.urlId=f,this.startLoad())}},p.loadPlaylist=function(d){a.prototype.loadPlaylist.call(this);var A=this.currentLevelIndex,u=this._levels[A];if(this.canLoad&&u&&u.url.length>0){var f=u.urlId,t=u.url[f];if(d)try{t=d.addDirectives(t)}catch(h){this.warn("Could not construct new URL with HLS Delivery Directives: "+h)}this.log("Attempt loading level index "+A+((d==null?void 0:d.msn)!==void 0?" at sn "+d.msn+" part "+d.part:"")+" with URL-id "+f+" "+t),this.clearTimer(),this.hls.trigger(g.Events.LEVEL_LOADING,{url:t,level:A,id:f,deliveryDirectives:d||null})}},p.removeLevel=function(d,A){var u=function(h,e){return e!==A},f=this._levels.filter(function(t,h){return h!==d?!0:t.url.length>1&&A!==void 0?(t.url=t.url.filter(u),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(u)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(u)),t.urlId=0,!0):!1}).map(function(t,h){var e=t.details;return e!=null&&e.fragments&&e.fragments.forEach(function(y){y.level=h}),t});this._levels=f,this.hls.trigger(g.Events.LEVELS_UPDATED,{levels:f})},I(m,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(d){var A,u=this._levels;if(u.length!==0&&!(this.currentLevelIndex===d&&(A=u[d])!==null&&A!==void 0&&A.details)){if(d<0||d>=u.length){var f=d<0;if(this.hls.trigger(g.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.LEVEL_SWITCH_ERROR,level:d,fatal:f,reason:"invalid level idx"}),f)return;d=Math.min(d,u.length-1)}this.clearTimer();var t=this.currentLevelIndex,h=u[t],e=u[d];this.log("switching to level "+d+" from "+t),this.currentLevelIndex=d;var y=T({},e,{level:d,maxBitrate:e.maxBitrate,uri:e.uri,urlId:e.urlId});delete y._urlId,this.hls.trigger(g.Events.LEVEL_SWITCHING,y);var P=e.details;if(!P||P.live){var S=this.switchParams(e.uri,h==null?void 0:h.details);this.loadPlaylist(S)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(d){this.manualLevelIndex=d,this._startLevel===void 0&&(this._startLevel=d),d!==-1&&(this.level=d)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(d){this._firstLevel=d}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var d=this.hls.config.startLevel;return d!==void 0?d:this._firstLevel}else return this._startLevel},set:function(d){this._startLevel=d}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(d){this.level=d,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=d)}}]),m}(x.default)},"./src/controller/level-helper.ts":(O,R,s)=>{s.r(R),s.d(R,{addGroupId:()=>C,addSliding:()=>l,adjustSliding:()=>n,assignTrackIdsByGroup:()=>x,computeReloadInterval:()=>i,getFragmentWithSN:()=>a,getPartWith:()=>m,mapFragmentIntersection:()=>v,mapPartIntersection:()=>_,mergeDetails:()=>I,updateFragPTSDTS:()=>L,updatePTS:()=>E});var D=s("./src/polyfills/number.ts"),g=s("./src/utils/logger.ts"),b=s("./src/loader/date-range.ts");function c(){return c=Object.assign?Object.assign.bind():function(p){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var A in d)Object.prototype.hasOwnProperty.call(d,A)&&(p[A]=d[A])}return p},c.apply(this,arguments)}function C(p,o,d){switch(o){case"audio":p.audioGroupIds||(p.audioGroupIds=[]),p.audioGroupIds.push(d);break;case"text":p.textGroupIds||(p.textGroupIds=[]),p.textGroupIds.push(d);break}}function x(p){var o={};p.forEach(function(d){var A=d.groupId||"";d.id=o[A]=o[A]||0,o[A]++})}function E(p,o,d){var A=p[o],u=p[d];T(A,u)}function T(p,o){var d=o.startPTS;if((0,D.isFiniteNumber)(d)){var A=0,u;o.sn>p.sn?(A=d-p.start,u=p):(A=p.start-d,u=o),u.duration!==A&&(u.duration=A)}else if(o.sn>p.sn){var f=p.cc===o.cc;f&&p.minEndPTS?o.start=p.start+(p.minEndPTS-p.start):o.start=p.start+p.duration}else o.start=Math.max(p.start-o.duration,0)}function L(p,o,d,A,u,f){var t=A-d;t<=0&&(g.logger.warn("Fragment should have a positive duration",o),A=d+o.duration,f=u+o.duration);var h=d,e=A,y=o.startPTS,P=o.endPTS;if((0,D.isFiniteNumber)(y)){var S=Math.abs(y-d);(0,D.isFiniteNumber)(o.deltaPTS)?o.deltaPTS=Math.max(S,o.deltaPTS):o.deltaPTS=S,h=Math.max(d,y),d=Math.min(d,y),u=Math.min(u,o.startDTS),e=Math.min(A,P),A=Math.max(A,P),f=Math.max(f,o.endDTS)}o.duration=A-d;var w=d-o.start;o.start=o.startPTS=d,o.maxStartPTS=h,o.startDTS=u,o.endPTS=A,o.minEndPTS=e,o.endDTS=f;var k=o.sn;if(!p||k<p.startSN||k>p.endSN)return 0;var F,U=k-p.startSN,N=p.fragments;for(N[U]=o,F=U;F>0;F--)T(N[F],N[F-1]);for(F=U;F<N.length-1;F++)T(N[F],N[F+1]);return p.fragmentHint&&T(N[N.length-1],p.fragmentHint),p.PTSKnown=p.alignedSliding=!0,w}function I(p,o){for(var d=null,A=p.fragments,u=A.length-1;u>=0;u--){var f=A[u].initSegment;if(f){d=f;break}}p.fragmentHint&&delete p.fragmentHint.endPTS;var t=0,h;if(v(p,o,function(F,U){F.relurl&&(t=F.cc-U.cc),(0,D.isFiniteNumber)(F.startPTS)&&(0,D.isFiniteNumber)(F.endPTS)&&(U.start=U.startPTS=F.startPTS,U.startDTS=F.startDTS,U.appendedPTS=F.appendedPTS,U.maxStartPTS=F.maxStartPTS,U.endPTS=F.endPTS,U.endDTS=F.endDTS,U.minEndPTS=F.minEndPTS,U.duration=F.endPTS-F.startPTS,U.duration&&(h=U),o.PTSKnown=o.alignedSliding=!0),U.elementaryStreams=F.elementaryStreams,U.loader=F.loader,U.stats=F.stats,U.urlId=F.urlId,F.initSegment&&(U.initSegment=F.initSegment,d=F.initSegment)}),d){var e=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments;e.forEach(function(F){var U;(!F.initSegment||F.initSegment.relurl===((U=d)===null||U===void 0?void 0:U.relurl))&&(F.initSegment=d)})}if(o.skippedSegments)if(o.deltaUpdateFailed=o.fragments.some(function(F){return!F}),o.deltaUpdateFailed){g.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var y=o.skippedSegments;y--;)o.fragments.shift();o.startSN=o.fragments[0].sn,o.startCC=o.fragments[0].cc}else o.canSkipDateRanges&&(o.dateRanges=r(p.dateRanges,o.dateRanges,o.recentlyRemovedDateranges));var P=o.fragments;if(t){g.logger.warn("discontinuity sliding from playlist, take drift into account");for(var S=0;S<P.length;S++)P[S].cc+=t}o.skippedSegments&&(o.startCC=o.fragments[0].cc),_(p.partList,o.partList,function(F,U){U.elementaryStreams=F.elementaryStreams,U.stats=F.stats}),h?L(o,h,h.startPTS,h.endPTS,h.startDTS,h.endDTS):n(p,o),P.length&&(o.totalduration=o.edge-P[0].start),o.driftStartTime=p.driftStartTime,o.driftStart=p.driftStart;var w=o.advancedDateTime;if(o.advanced&&w){var k=o.edge;o.driftStart||(o.driftStartTime=w,o.driftStart=k),o.driftEndTime=w,o.driftEnd=k}else o.driftEndTime=p.driftEndTime,o.driftEnd=p.driftEnd,o.advancedDateTime=p.advancedDateTime}function r(p,o,d){var A=c({},p);return d&&d.forEach(function(u){delete A[u]}),Object.keys(o).forEach(function(u){var f=new b.DateRange(o[u].attr,A[u]);f.isValid?A[u]=f:g.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(o[u].attr)+'"')}),A}function _(p,o,d){if(p&&o)for(var A=0,u=0,f=p.length;u<=f;u++){var t=p[u],h=o[u+A];t&&h&&t.index===h.index&&t.fragment.sn===h.fragment.sn?d(t,h):A--}}function v(p,o,d){for(var A=o.skippedSegments,u=Math.max(p.startSN,o.startSN)-o.startSN,f=(p.fragmentHint?1:0)+(A?o.endSN:Math.min(p.endSN,o.endSN))-o.startSN,t=o.startSN-p.startSN,h=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,e=p.fragmentHint?p.fragments.concat(p.fragmentHint):p.fragments,y=u;y<=f;y++){var P=e[t+y],S=h[y];A&&!S&&y<A&&(S=o.fragments[y]=P),P&&S&&d(P,S)}}function n(p,o){var d=o.startSN+o.skippedSegments-p.startSN,A=p.fragments;d<0||d>=A.length||l(o,A[d].start)}function l(p,o){if(o){for(var d=p.fragments,A=p.skippedSegments;A<d.length;A++)d[A].start+=o;p.fragmentHint&&(p.fragmentHint.start+=o)}}function i(p,o){o===void 0&&(o=1/0);var d=1e3*p.targetduration;if(p.updated){var A=p.fragments,u=4;if(A.length&&d*u>o){var f=A[A.length-1].duration*1e3;f<d&&(d=f)}}else d/=2;return Math.round(d)}function a(p,o,d){if(!p||!p.details)return null;var A=p.details,u=A.fragments[o-A.startSN];return u||(u=A.fragmentHint,u&&u.sn===o)?u:o<A.startSN&&d&&d.sn===o?d:null}function m(p,o,d){if(!p||!p.details)return null;var A=p.details.partList;if(A)for(var u=A.length;u--;){var f=A[u];if(f.index===d&&f.fragment.sn===o)return f}return null}},"./src/controller/stream-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>o});var D=s("./src/polyfills/number.ts"),g=s("./src/controller/base-stream-controller.ts"),b=s("./src/is-supported.ts"),c=s("./src/events.ts"),C=s("./src/utils/buffer-helper.ts"),x=s("./src/controller/fragment-tracker.ts"),E=s("./src/types/loader.ts"),T=s("./src/loader/fragment.ts"),L=s("./src/demux/transmuxer-interface.ts"),I=s("./src/types/transmuxer.ts"),r=s("./src/controller/gap-controller.ts"),_=s("./src/errors.ts");function v(d,A){for(var u=0;u<A.length;u++){var f=A[u];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(d,l(f.key),f)}}function n(d,A,u){return A&&v(d.prototype,A),u&&v(d,u),Object.defineProperty(d,"prototype",{writable:!1}),d}function l(d){var A=i(d,"string");return typeof A=="symbol"?A:String(A)}function i(d,A){if(typeof d!="object"||d===null)return d;var u=d[Symbol.toPrimitive];if(u!==void 0){var f=u.call(d,A||"default");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(d)}function a(d,A){d.prototype=Object.create(A.prototype),d.prototype.constructor=d,m(d,A)}function m(d,A){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,t){return f.__proto__=t,f},m(d,A)}var p=100,o=function(d){a(A,d);function A(f,t,h){var e;return e=d.call(this,f,t,h,"[stream-controller]")||this,e.audioCodecSwap=!1,e.gapController=null,e.level=-1,e._forceStartLoad=!1,e.altAudio=!1,e.audioOnly=!1,e.fragPlaying=null,e.onvplaying=null,e.onvseeked=null,e.fragLastKbps=0,e.couldBacktrack=!1,e.backtrackFragment=null,e.audioCodecSwitch=!1,e.videoBuffer=null,e._registerListeners(),e}var u=A.prototype;return u._registerListeners=function(){var t=this.hls;t.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(c.Events.ERROR,this.onError,this),t.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u._unregisterListeners=function(){var t=this.hls;t.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(c.Events.ERROR,this.onError,this),t.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},u.startLoad=function(t){if(this.levels){var h=this.lastCurrentTime,e=this.hls;if(this.stopLoad(),this.setInterval(p),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var y=e.startLevel;y===-1&&(e.config.testBandwidth&&this.levels.length>1?(y=0,this.bitrateTest=!0):y=e.nextAutoLevel),this.level=e.nextLoadLevel=y,this.loadedmetadata=!1}h>0&&t===-1&&(this.log("Override startPosition with lastCurrentTime @"+h.toFixed(3)),t=h),this.state=g.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=g.State.STOPPED},u.stopLoad=function(){this._forceStartLoad=!1,d.prototype.stopLoad.call(this)},u.doTick=function(){switch(this.state){case g.State.IDLE:this.doTickIdle();break;case g.State.WAITING_LEVEL:{var t,h=this.levels,e=this.level,y=h==null||(t=h[e])===null||t===void 0?void 0:t.details;if(y&&(!y.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(y))break;this.state=g.State.IDLE;break}break}case g.State.FRAG_LOADING_WAITING_RETRY:{var P,S=self.performance.now(),w=this.retryDate;(!w||S>=w||(P=this.media)!==null&&P!==void 0&&P.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=g.State.IDLE)}break}this.onTickEnd()},u.onTickEnd=function(){d.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},u.doTickIdle=function(){var t=this.hls,h=this.levelLastLoaded,e=this.levels,y=this.media,P=t.config,S=t.nextLoadLevel;if(!(h===null||!y&&(this.startFragRequested||!P.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!e||!e[S])){var w=e[S],k=this.getMainFwdBufferInfo();if(k!==null){var F=this.getLevelDetails();if(F&&this._streamEnded(k,F)){var U={};this.altAudio&&(U.type="video"),this.hls.trigger(c.Events.BUFFER_EOS,U),this.state=g.State.ENDED;return}this.level=t.nextLoadLevel=S;var N=w.details;if(!N||this.state===g.State.WAITING_LEVEL||N.live&&this.levelLastLoaded!==S){this.level=S,this.state=g.State.WAITING_LEVEL;return}var j=k.len,W=this.getMaxBufferLength(w.maxBitrate);if(!(j>=W)){this.backtrackFragment&&this.backtrackFragment.start>k.end&&(this.backtrackFragment=null);var H=this.backtrackFragment?this.backtrackFragment.start:k.end,G=this.getNextFragment(H,N);if(this.couldBacktrack&&!this.fragPrevious&&G&&G.sn!=="initSegment"&&this.fragmentTracker.getState(G)!==x.FragmentState.OK){var V,Y=((V=this.backtrackFragment)!=null?V:G).sn,Q=Y-N.startSN,z=N.fragments[Q-1];z&&G.cc===z.cc&&(G=z,this.fragmentTracker.removeFragment(z))}else this.backtrackFragment&&k.len&&(this.backtrackFragment=null);if(G&&this.fragmentTracker.getState(G)===x.FragmentState.OK&&this.nextLoadPosition>H){var X=this.audioOnly&&!this.altAudio?T.ElementaryStreamTypes.AUDIO:T.ElementaryStreamTypes.VIDEO,q=(X===T.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;q&&this.afterBufferFlushed(q,X,E.PlaylistLevelType.MAIN),G=this.getNextFragment(this.nextLoadPosition,N)}!G||(G.initSegment&&!G.initSegment.data&&!this.bitrateTest&&(G=G.initSegment),this.loadFragment(G,N,H))}}}},u.loadFragment=function(t,h,e){var y,P=this.fragmentTracker.getState(t);this.fragCurrent=t,P===x.FragmentState.NOT_LOADED?t.sn==="initSegment"?this._loadInitSegment(t,h):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,h)):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,t,h,e)):P===x.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):((y=this.media)===null||y===void 0?void 0:y.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},u.getAppendedFrag=function(t){var h=this.fragmentTracker.getAppendedFrag(t,E.PlaylistLevelType.MAIN);return h&&"fragment"in h?h.fragment:h},u.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,E.PlaylistLevelType.MAIN)},u.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},u.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},u.nextLevelSwitch=function(){var t=this.levels,h=this.media;if(h!=null&&h.readyState){var e,y=this.getAppendedFrag(h.currentTime);if(y&&y.start>1&&this.flushMainBuffer(0,y.start-1),!h.paused&&t){var P=this.hls.nextLoadLevel,S=t[P],w=this.fragLastKbps;w&&this.fragCurrent?e=this.fragCurrent.duration*S.maxBitrate/(1e3*w)+1:e=0}else e=0;var k=this.getBufferedFrag(h.currentTime+e);if(k){var F=this.followingBufferedFrag(k);if(F){this.abortCurrentFrag();var U=F.maxStartPTS?F.maxStartPTS:F.start,N=F.duration,j=Math.max(k.end,U+Math.min(Math.max(N-this.config.maxFragLookUpTolerance,N*.5),N*.75));this.flushMainBuffer(j,Number.POSITIVE_INFINITY)}}}},u.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&t.abortRequests(),this.state){case g.State.KEY_LOADING:case g.State.FRAG_LOADING:case g.State.FRAG_LOADING_WAITING_RETRY:case g.State.PARSING:case g.State.PARSED:this.state=g.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},u.flushMainBuffer=function(t,h){d.prototype.flushMainBuffer.call(this,t,h,this.altAudio?"video":null)},u.onMediaAttached=function(t,h){d.prototype.onMediaAttached.call(this,t,h);var e=h.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new r.default(this.config,e,this.fragmentTracker,this.hls)},u.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),d.prototype.onMediaDetaching.call(this)},u.onMediaPlaying=function(){this.tick()},u.onMediaSeeked=function(){var t=this.media,h=t?t.currentTime:null;(0,D.isFiniteNumber)(h)&&this.log("Media seeked to "+h.toFixed(3)),this.tick()},u.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(c.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},u.onManifestParsed=function(t,h){var e=!1,y=!1,P;h.levels.forEach(function(S){P=S.audioCodec,P&&(P.indexOf("mp4a.40.2")!==-1&&(e=!0),P.indexOf("mp4a.40.5")!==-1&&(y=!0))}),this.audioCodecSwitch=e&&y&&!(0,b.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=h.levels,this.startFragRequested=!1},u.onLevelLoading=function(t,h){var e=this.levels;if(!(!e||this.state!==g.State.IDLE)){var y=e[h.level];(!y.details||y.details.live&&this.levelLastLoaded!==h.level||this.waitForCdnTuneIn(y.details))&&(this.state=g.State.WAITING_LEVEL)}},u.onLevelLoaded=function(t,h){var e,y=this.levels,P=h.level,S=h.details,w=S.totalduration;if(!y){this.warn("Levels were reset while loading level "+P);return}this.log("Level "+P+" loaded ["+S.startSN+","+S.endSN+"], cc ["+S.startCC+", "+S.endCC+"] duration:"+w);var k=this.fragCurrent;k&&(this.state===g.State.FRAG_LOADING||this.state===g.State.FRAG_LOADING_WAITING_RETRY)&&k.level!==h.level&&k.loader&&(this.state=g.State.IDLE,this.backtrackFragment=null,k.abortRequests());var F=y[P],U=0;if(S.live||(e=F.details)!==null&&e!==void 0&&e.live){if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed)return;U=this.alignPlaylists(S,F.details)}if(F.details=S,this.levelLastLoaded=P,this.hls.trigger(c.Events.LEVEL_UPDATED,{details:S,level:P}),this.state===g.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(S))return;this.state=g.State.IDLE}this.startFragRequested?S.live&&this.synchronizeToLiveEdge(S):this.setStartPosition(S,U),this.tick()},u._handleFragmentLoadProgress=function(t){var h,e=t.frag,y=t.part,P=t.payload,S=this.levels;if(!S){this.warn("Levels were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered");return}var w=S[e.level],k=w.details;if(!k){this.warn("Dropping fragment "+e.sn+" of level "+e.level+" after level details were reset");return}var F=w.videoCodec,U=k.PTSKnown||!k.live,N=(h=e.initSegment)===null||h===void 0?void 0:h.data,j=this._getAudioCodec(w),W=this.transmuxer=this.transmuxer||new L.default(this.hls,E.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),H=y?y.index:-1,G=H!==-1,V=new I.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,P.byteLength,H,G),Y=this.initPTS[e.cc];W.push(P,N,j,F,e,y,k.totalduration,U,V,Y)},u.onAudioTrackSwitching=function(t,h){var e=this.altAudio,y=!!h.url,P=h.id;if(!y){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var S=this.fragCurrent;S&&(this.log("Switching to main audio track, cancel main fragment load"),S.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var w=this.hls;e&&w.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),w.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:P})}},u.onAudioTrackSwitched=function(t,h){var e=h.id,y=!!this.hls.audioTracks[e].url;if(y){var P=this.videoBuffer;P&&this.mediaBuffer!==P&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=P)}this.altAudio=y,this.tick()},u.onBufferCreated=function(t,h){var e=h.tracks,y,P,S=!1;for(var w in e){var k=e[w];if(k.id==="main"){if(P=w,y=k,w==="video"){var F=e[w];F&&(this.videoBuffer=F.buffer)}}else S=!0}S&&y?(this.log("Alternate track found, use "+P+".buffered to schedule main fragment loading"),this.mediaBuffer=y.buffer):this.mediaBuffer=this.media},u.onFragBuffered=function(t,h){var e=h.frag,y=h.part;if(!(e&&e.type!==E.PlaylistLevelType.MAIN)){if(this.fragContextChanged(e)){this.warn("Fragment "+e.sn+(y?" p: "+y.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state),this.state===g.State.PARSED&&(this.state=g.State.IDLE);return}var P=y?y.stats:e.stats;this.fragLastKbps=Math.round(8*P.total/(P.buffering.end-P.loading.first)),e.sn!=="initSegment"&&(this.fragPrevious=e),this.fragBufferedComplete(e,y)}},u.onError=function(t,h){if(h.type===_.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(E.PlaylistLevelType.MAIN,h);return}switch(h.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:case _.ErrorDetails.FRAG_PARSING_ERROR:case _.ErrorDetails.KEY_LOAD_ERROR:case _.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(E.PlaylistLevelType.MAIN,h);break;case _.ErrorDetails.LEVEL_LOAD_ERROR:case _.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==g.State.ERROR&&(h.fatal?(this.warn(""+h.details),this.state=g.State.ERROR):!h.levelRetry&&this.state===g.State.WAITING_LEVEL&&(this.state=g.State.IDLE));break;case _.ErrorDetails.BUFFER_FULL_ERROR:if(h.parent==="main"&&(this.state===g.State.PARSING||this.state===g.State.PARSED)){var e=!0,y=this.getFwdBufferInfo(this.media,E.PlaylistLevelType.MAIN);y&&y.len>.5&&(e=!this.reduceMaxBufferLength(y.len)),e&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},u.checkBuffer=function(){var t=this.media,h=this.gapController;if(!(!t||!h||!t.readyState)){if(this.loadedmetadata||!C.BufferHelper.getBuffered(t).length){var e=this.state!==g.State.IDLE?this.fragCurrent:null;h.poll(this.lastCurrentTime,e)}this.lastCurrentTime=t.currentTime}},u.onFragLoadEmergencyAborted=function(){this.state=g.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},u.onBufferFlushed=function(t,h){var e=h.type;if(e!==T.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var y=(e===T.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(y,e,E.PlaylistLevelType.MAIN)}},u.onLevelsUpdated=function(t,h){this.levels=h.levels},u.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},u.seekToStartPos=function(){var t=this.media;if(!!t){var h=t.currentTime,e=this.startPosition;if(e>=0&&h<e){if(t.seeking){this.log("could not seek to "+e+", already seeking at "+h);return}var y=C.BufferHelper.getBuffered(t),P=y.length?y.start(0):0,S=P-e;S>0&&(S<this.config.maxBufferHole||S<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+S+" to match buffer start"),e+=S,this.startPosition=e),this.log("seek to target start position "+e+" from current time "+h),t.currentTime=e}}},u._getAudioCodec=function(t){var h=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&h&&(this.log("Swapping audio codec"),h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5"),h},u._loadBitrateTestFrag=function(t,h){var e=this;t.bitrateTest=!0,this._doFragLoad(t,h).then(function(y){var P=e.hls;if(!(!y||e.fragContextChanged(t))){e.fragLoadError=0,e.state=g.State.IDLE,e.startFragRequested=!1,e.bitrateTest=!1;var S=t.stats;S.parsing.start=S.parsing.end=S.buffering.start=S.buffering.end=self.performance.now(),P.trigger(c.Events.FRAG_LOADED,y),t.bitrateTest=!1}})},u._handleTransmuxComplete=function(t){var h,e="main",y=this.hls,P=t.remuxResult,S=t.chunkMeta,w=this.getCurrentContext(S);if(!w){this.warn("The loading context changed while buffering fragment "+S.sn+" of level "+S.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(S.level);return}var k=w.frag,F=w.part,U=w.level,N=P.video,j=P.text,W=P.id3,H=P.initSegment,G=U.details,V=this.altAudio?void 0:P.audio;if(!this.fragContextChanged(k)){if(this.state=g.State.PARSING,H){H.tracks&&(this._bufferInitSegment(U,H.tracks,k,S),y.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:k,id:e,tracks:H.tracks}));var Y=H.initPTS,Q=H.timescale;(0,D.isFiniteNumber)(Y)&&(this.initPTS[k.cc]=Y,y.trigger(c.Events.INIT_PTS_FOUND,{frag:k,id:e,initPTS:Y,timescale:Q}))}if(N&&P.independent!==!1){if(G){var z=N.startPTS,X=N.endPTS,q=N.startDTS,te=N.endDTS;if(F)F.elementaryStreams[N.type]={startPTS:z,endPTS:X,startDTS:q,endDTS:te};else if(N.firstKeyFrame&&N.independent&&S.id===1&&(this.couldBacktrack=!0),N.dropped&&N.independent){var ee=this.getMainFwdBufferInfo(),Z=(ee?ee.end:this.getLoadPosition())+this.config.maxBufferHole,J=N.firstKeyFramePTS?N.firstKeyFramePTS:z;if(Z<J-this.config.maxBufferHole){this.backtrack(k);return}k.setElementaryStreamInfo(N.type,k.start,X,k.start,te,!0)}k.setElementaryStreamInfo(N.type,z,X,q,te),this.backtrackFragment&&(this.backtrackFragment=k),this.bufferFragmentData(N,k,F,S)}}else if(P.independent===!1){this.backtrack(k);return}if(V){var ie=V.startPTS,ne=V.endPTS,ue=V.startDTS,oe=V.endDTS;F&&(F.elementaryStreams[T.ElementaryStreamTypes.AUDIO]={startPTS:ie,endPTS:ne,startDTS:ue,endDTS:oe}),k.setElementaryStreamInfo(T.ElementaryStreamTypes.AUDIO,ie,ne,ue,oe),this.bufferFragmentData(V,k,F,S)}if(G&&W!==null&&W!==void 0&&(h=W.samples)!==null&&h!==void 0&&h.length){var le={id:e,frag:k,details:G,samples:W.samples};y.trigger(c.Events.FRAG_PARSING_METADATA,le)}if(G&&j){var ae={id:e,frag:k,details:G,samples:j.samples};y.trigger(c.Events.FRAG_PARSING_USERDATA,ae)}}},u._bufferInitSegment=function(t,h,e,y){var P=this;if(this.state===g.State.PARSING){this.audioOnly=!!h.audio&&!h.video,this.altAudio&&!this.audioOnly&&delete h.audio;var S=h.audio,w=h.video,k=h.audiovideo;if(S){var F=t.audioCodec,U=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(F&&(F.indexOf("mp4a.40.5")!==-1?F="mp4a.40.2":F="mp4a.40.5"),S.metadata.channelCount!==1&&U.indexOf("firefox")===-1&&(F="mp4a.40.5")),U.indexOf("android")!==-1&&S.container!=="audio/mpeg"&&(F="mp4a.40.2",this.log("Android: force audio codec to "+F)),t.audioCodec&&t.audioCodec!==F&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+F+'"'),S.levelCodec=F,S.id="main",this.log("Init audio buffer, container:"+S.container+", codecs[selected/level/parsed]=["+(F||"")+"/"+(t.audioCodec||"")+"/"+S.codec+"]")}w&&(w.levelCodec=t.videoCodec,w.id="main",this.log("Init video buffer, container:"+w.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+w.codec+"]")),k&&this.log("Init audiovideo buffer, container:"+k.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+k.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,h),Object.keys(h).forEach(function(N){var j=h[N],W=j.initSegment;W!=null&&W.byteLength&&P.hls.trigger(c.Events.BUFFER_APPENDING,{type:N,data:W,frag:e,part:null,chunkMeta:y,parent:e.type})}),this.tick()}},u.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,E.PlaylistLevelType.MAIN)},u.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=g.State.IDLE},u.checkFragmentChanged=function(){var t=this.media,h=null;if(t&&t.readyState>1&&t.seeking===!1){var e=t.currentTime;if(C.BufferHelper.isBuffered(t,e)?h=this.getAppendedFrag(e):C.BufferHelper.isBuffered(t,e+.1)&&(h=this.getAppendedFrag(e+.1)),h){this.backtrackFragment=null;var y=this.fragPlaying,P=h.level;(!y||h.sn!==y.sn||y.level!==P||h.urlId!==y.urlId)&&(this.fragPlaying=h,this.hls.trigger(c.Events.FRAG_CHANGED,{frag:h}),(!y||y.level!==P)&&this.hls.trigger(c.Events.LEVEL_SWITCHED,{level:P}))}}},n(A,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var h=t.currentTime,e=this.currentFrag;if(e&&(0,D.isFiniteNumber)(h)&&(0,D.isFiniteNumber)(e.programDateTime)){var y=e.programDateTime+(h-e.start)*1e3;return new Date(y)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),A}(g.default)},"./src/controller/subtitle-stream-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{SubtitleStreamController:()=>a});var D=s("./src/events.ts"),g=s("./src/utils/buffer-helper.ts"),b=s("./src/controller/fragment-finders.ts"),c=s("./src/utils/discontinuities.ts"),C=s("./src/controller/level-helper.ts"),x=s("./src/controller/fragment-tracker.ts"),E=s("./src/controller/base-stream-controller.ts"),T=s("./src/types/loader.ts"),L=s("./src/types/level.ts");function I(p,o){for(var d=0;d<o.length;d++){var A=o[d];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(p,_(A.key),A)}}function r(p,o,d){return o&&I(p.prototype,o),d&&I(p,d),Object.defineProperty(p,"prototype",{writable:!1}),p}function _(p){var o=v(p,"string");return typeof o=="symbol"?o:String(o)}function v(p,o){if(typeof p!="object"||p===null)return p;var d=p[Symbol.toPrimitive];if(d!==void 0){var A=d.call(p,o||"default");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(p)}function n(p,o){p.prototype=Object.create(o.prototype),p.prototype.constructor=p,l(p,o)}function l(p,o){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(A,u){return A.__proto__=u,A},l(p,o)}var i=500,a=function(p){n(o,p);function o(A,u,f){var t;return t=p.call(this,A,u,f,"[subtitle-stream-controller]")||this,t.levels=[],t.currentTrackId=-1,t.tracksBuffered=[],t.mainDetails=null,t._registerListeners(),t}var d=o.prototype;return d.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},d._registerListeners=function(){var u=this.hls;u.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(D.Events.ERROR,this.onError,this),u.on(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.on(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),u.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),u.on(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),u.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d._unregisterListeners=function(){var u=this.hls;u.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(D.Events.ERROR,this.onError,this),u.off(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.off(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),u.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),u.off(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),u.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d.startLoad=function(u){this.stopLoad(),this.state=E.State.IDLE,this.setInterval(i),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()},d.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},d.onLevelLoaded=function(u,f){this.mainDetails=f.details},d.onSubtitleFragProcessed=function(u,f){var t=f.frag,h=f.success;if(this.fragPrevious=t,this.state=E.State.IDLE,!!h){var e=this.tracksBuffered[this.currentTrackId];if(!!e){for(var y,P=t.start,S=0;S<e.length;S++)if(P>=e[S].start&&P<=e[S].end){y=e[S];break}var w=t.start+t.duration;y?y.end=w:(y={start:P,end:w},e.push(y)),this.fragmentTracker.fragBuffered(t)}}},d.onBufferFlushing=function(u,f){var t=f.startOffset,h=f.endOffset;if(t===0&&h!==Number.POSITIVE_INFINITY){var e=this.currentTrackId,y=this.levels;if(!y.length||!y[e]||!y[e].details)return;var P=y[e].details,S=P.targetduration,w=h-S;if(w<=0)return;f.endOffsetSubtitles=Math.max(0,w),this.tracksBuffered.forEach(function(k){for(var F=0;F<k.length;){if(k[F].end<=w){k.shift();continue}else if(k[F].start<w)k[F].start=w;else break;F++}}),this.fragmentTracker.removeFragmentsInRange(t,w,T.PlaylistLevelType.SUBTITLE)}},d.onFragBuffered=function(u,f){if(!this.loadedmetadata&&f.frag.type===T.PlaylistLevelType.MAIN){var t;(t=this.media)!==null&&t!==void 0&&t.buffered.length&&(this.loadedmetadata=!0)}},d.onError=function(u,f){var t=f.frag;!t||t.type!==T.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=E.State.IDLE)},d.onSubtitleTracksUpdated=function(u,f){var t=this,h=f.subtitleTracks;this.tracksBuffered=[],this.levels=h.map(function(e){return new L.Level(e)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(e){t.tracksBuffered[e.id]=[]}),this.mediaBuffer=null},d.onSubtitleTrackSwitch=function(u,f){if(this.currentTrackId=f.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var t=this.levels[this.currentTrackId];t!=null&&t.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,t&&this.setInterval(i)},d.onSubtitleTrackLoaded=function(u,f){var t,h=f.details,e=f.id,y=this.currentTrackId,P=this.levels;if(!!P.length){var S=P[y];if(!(e>=P.length||e!==y||!S)){this.mediaBuffer=this.mediaBufferTimeRanges;var w=0;if(h.live||(t=S.details)!==null&&t!==void 0&&t.live){var k=this.mainDetails;if(h.deltaUpdateFailed||!k)return;var F=k.fragments[0];S.details?(w=this.alignPlaylists(h,S.details),w===0&&F&&(w=F.start,(0,C.addSliding)(h,w))):h.hasProgramDateTime&&k.hasProgramDateTime?((0,c.alignMediaPlaylistByPDT)(h,k),w=h.fragments[0].start):F&&(w=F.start,(0,C.addSliding)(h,w))}if(S.details=h,this.levelLastLoaded=e,!this.startFragRequested&&(this.mainDetails||!h.live)&&this.setStartPosition(S.details,w),this.tick(),h.live&&!this.fragCurrent&&this.media&&this.state===E.State.IDLE){var U=(0,b.findFragmentByPTS)(null,h.fragments,this.media.currentTime,0);U||(this.warn("Subtitle playlist not aligned with playback"),S.details=void 0)}}}},d._handleFragmentLoadComplete=function(u){var f=this,t=u.frag,h=u.payload,e=t.decryptdata,y=this.hls;if(!this.fragContextChanged(t)&&h&&h.byteLength>0&&e&&e.key&&e.iv&&e.method==="AES-128"){var P=performance.now();this.decrypter.decrypt(new Uint8Array(h),e.key.buffer,e.iv.buffer).then(function(S){var w=performance.now();y.trigger(D.Events.FRAG_DECRYPTED,{frag:t,payload:S,stats:{tstart:P,tdecrypt:w}})}).catch(function(S){f.warn(S.name+": "+S.message),f.state=E.State.IDLE})}},d.doTick=function(){if(!this.media){this.state=E.State.IDLE;return}if(this.state===E.State.IDLE){var u=this.currentTrackId,f=this.levels;if(!f.length||!f[u]||!f[u].details)return;var t=f[u].details,h=t.targetduration,e=this.config,y=this.getLoadPosition(),P=g.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],y-h,e.maxBufferHole),S=P.end,w=P.len,k=this.getFwdBufferInfo(this.media,T.PlaylistLevelType.MAIN),F=this.getMaxBufferLength(k==null?void 0:k.len)+h;if(w>F)return;console.assert(t,"Subtitle track details are defined on idle subtitle stream controller tick");var U=t.fragments,N=U.length,j=t.edge,W=null,H=this.fragPrevious;if(S<j){var G=e.maxFragLookUpTolerance;W=(0,b.findFragmentByPTS)(H,U,Math.max(U[0].start,S),G),!W&&H&&H.start<U[0].start&&(W=U[0])}else W=U[N-1];if(!W)return;W=this.mapToInitFragWhenRequired(W),this.fragmentTracker.getState(W)===x.FragmentState.NOT_LOADED&&this.loadFragment(W,t,S)}},d.getMaxBufferLength=function(u){var f=p.prototype.getMaxBufferLength.call(this);return u?Math.max(f,u):f},d.loadFragment=function(u,f,t){this.fragCurrent=u,u.sn==="initSegment"?this._loadInitSegment(u,f):(this.startFragRequested=!0,p.prototype.loadFragment.call(this,u,f,t))},r(o,[{key:"mediaBufferTimeRanges",get:function(){return new m(this.tracksBuffered[this.currentTrackId]||[])}}]),o}(E.default),m=function(o){this.buffered=void 0;var d=function(u,f,t){if(f=f>>>0,f>t-1)throw new DOMException("Failed to execute '"+u+"' on 'TimeRanges': The index provided ("+f+") is greater than the maximum bound ("+t+")");return o[f][u]};this.buffered={get length(){return o.length},end:function(u){return d("end",u,o.length)},start:function(u){return d("start",u,o.length)}}}},"./src/controller/subtitle-track-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>v});var D=s("./src/events.ts"),g=s("./src/utils/texttrack-utils.ts"),b=s("./src/controller/base-playlist-controller.ts"),c=s("./src/types/loader.ts");function C(n,l){for(var i=0;i<l.length;i++){var a=l[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,E(a.key),a)}}function x(n,l,i){return l&&C(n.prototype,l),i&&C(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}function E(n){var l=T(n,"string");return typeof l=="symbol"?l:String(l)}function T(n,l){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,l||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(n)}function L(n,l){n.prototype=Object.create(l.prototype),n.prototype.constructor=n,I(n,l)}function I(n,l){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,m){return a.__proto__=m,a},I(n,l)}var r=function(n){L(l,n);function l(a){var m;return m=n.call(this,a,"[subtitle-track-controller]")||this,m.media=null,m.tracks=[],m.groupId=null,m.tracksInGroup=[],m.trackId=-1,m.selectDefaultTrack=!0,m.queuedDefaultTrack=-1,m.trackChangeListener=function(){return m.onTextTracksChanged()},m.asyncPollTrackChange=function(){return m.pollTrackChange(0)},m.useTextTrackPolling=!1,m.subtitlePollingInterval=-1,m._subtitleDisplay=!0,m.registerListeners(),m}var i=l.prototype;return i.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,n.prototype.destroy.call(this)},i.registerListeners=function(){var m=this.hls;m.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),m.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),m.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),m.on(D.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){var m=this.hls;m.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),m.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),m.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),m.off(D.Events.ERROR,this.onError,this)},i.onMediaAttached=function(m,p){this.media=p.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},i.pollTrackChange=function(m){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,m)},i.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var m=_(this.media.textTracks);m.forEach(function(p){(0,g.clearCurrentCues)(p)}),this.subtitleTrack=-1,this.media=null}},i.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},i.onManifestParsed=function(m,p){this.tracks=p.subtitleTracks},i.onSubtitleTrackLoaded=function(m,p){var o=p.id,d=p.details,A=this.trackId,u=this.tracksInGroup[A];if(!u){this.warn("Invalid subtitle track id "+o);return}var f=u.details;u.details=p.details,this.log("subtitle track "+o+" loaded ["+d.startSN+"-"+d.endSN+"]"),o===this.trackId&&(this.retryCount=0,this.playlistLoaded(o,p,f))},i.onLevelLoading=function(m,p){this.switchLevel(p.level)},i.onLevelSwitching=function(m,p){this.switchLevel(p.level)},i.switchLevel=function(m){var p=this.hls.levels[m];if(!!(p!=null&&p.textGroupIds)){var o=p.textGroupIds[p.urlId];if(this.groupId!==o){var d=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,A=this.tracks.filter(function(t){return!o||t.groupId===o});this.tracksInGroup=A;var u=this.findTrackId(d==null?void 0:d.name)||this.findTrackId();this.groupId=o;var f={subtitleTracks:A};this.log("Updating subtitle tracks, "+A.length+' track(s) found in "'+o+'" group-id'),this.hls.trigger(D.Events.SUBTITLE_TRACKS_UPDATED,f),u!==-1&&this.setSubtitleTrack(u,d)}}},i.findTrackId=function(m){for(var p=this.tracksInGroup,o=0;o<p.length;o++){var d=p[o];if((!this.selectDefaultTrack||d.default)&&(!m||m===d.name))return d.id}return-1},i.onError=function(m,p){n.prototype.onError.call(this,m,p),!(p.fatal||!p.context)&&p.context.type===c.PlaylistContextType.SUBTITLE_TRACK&&p.context.id===this.trackId&&p.context.groupId===this.groupId&&this.retryLoadingOrFail(p)},i.loadPlaylist=function(m){n.prototype.loadPlaylist.call(this);var p=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(p)){var o=p.id,d=p.groupId,A=p.url;if(m)try{A=m.addDirectives(A)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}this.log("Loading subtitle playlist for id "+o),this.hls.trigger(D.Events.SUBTITLE_TRACK_LOADING,{url:A,id:o,groupId:d,deliveryDirectives:m||null})}},i.toggleTrackModes=function(m){var p=this,o=this.media,d=this.trackId;if(!!o){var A=_(o.textTracks),u=A.filter(function(h){return h.groupId===p.groupId});if(m===-1)[].slice.call(A).forEach(function(h){h.mode="disabled"});else{var f=u[d];f&&(f.mode="disabled")}var t=u[m];t&&(t.mode=this.subtitleDisplay?"showing":"hidden")}},i.setSubtitleTrack=function(m,p){var o,d=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=m;return}if(this.trackId!==m&&this.toggleTrackModes(m),!(this.trackId===m&&(m===-1||(o=d[m])!==null&&o!==void 0&&o.details)||m<-1||m>=d.length)){this.clearTimer();var A=d[m];if(this.log("Switching to subtitle track "+m),this.trackId=m,A){var u=A.id,f=A.groupId,t=f===void 0?"":f,h=A.name,e=A.type,y=A.url;this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:u,groupId:t,name:h,type:e,url:y});var P=this.switchParams(A.url,p==null?void 0:p.details);this.loadPlaylist(P)}else this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:m})}},i.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var m=-1,p=_(this.media.textTracks),o=0;o<p.length;o++)if(p[o].mode==="hidden")m=o;else if(p[o].mode==="showing"){m=o;break}this.subtitleTrack!==m&&(this.subtitleTrack=m)}},x(l,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(m){this._subtitleDisplay=m,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(m){this.selectDefaultTrack=!1;var p=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(m,p)}}]),l}(b.default);function _(n){for(var l=[],i=0;i<n.length;i++){var a=n[i];a.kind==="subtitles"&&a.label&&l.push(n[i])}return l}const v=r},"./src/controller/timeline-controller.ts":(O,R,s)=>{s.r(R),s.d(R,{TimelineController:()=>r});var D=s("./src/polyfills/number.ts"),g=s("./src/events.ts"),b=s("./src/utils/cea-608-parser.ts"),c=s("./src/utils/output-filter.ts"),C=s("./src/utils/webvtt-parser.ts"),x=s("./src/utils/texttrack-utils.ts"),E=s("./src/utils/imsc1-ttml-parser.ts"),T=s("./src/utils/mp4-tools.ts"),L=s("./src/types/loader.ts"),I=s("./src/utils/logger.ts"),r=function(){function l(a){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=n(),this.captionsProperties=void 0,this.hls=a,this.config=a.config,this.Cues=a.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var m=new c.default(this,"textTrack1"),p=new c.default(this,"textTrack2"),o=new c.default(this,"textTrack3"),d=new c.default(this,"textTrack4");this.cea608Parser1=new b.default(1,m,p),this.cea608Parser2=new b.default(3,o,d)}a.on(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(g.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(g.Events.FRAG_LOADING,this.onFragLoading,this),a.on(g.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(g.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),a.on(g.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),a.on(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(g.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),a.on(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var i=l.prototype;return i.destroy=function(){var m=this.hls;m.off(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),m.off(g.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),m.off(g.Events.FRAG_LOADING,this.onFragLoading,this),m.off(g.Events.FRAG_LOADED,this.onFragLoaded,this),m.off(g.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),m.off(g.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),m.off(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),m.off(g.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),m.off(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},i.addCues=function(m,p,o,d,A){for(var u=!1,f=A.length;f--;){var t=A[f],h=v(t[0],t[1],p,o);if(h>=0&&(t[0]=Math.min(t[0],p),t[1]=Math.max(t[1],o),u=!0,h/(o-p)>.5))return}if(u||A.push([p,o]),this.config.renderTextTracksNatively){var e=this.captionsTracks[m];this.Cues.newCue(e,p,o,d)}else{var y=this.Cues.newCue(null,p,o,d);this.hls.trigger(g.Events.CUES_PARSED,{type:"captions",cues:y,track:m})}},i.onInitPtsFound=function(m,p){var o=this,d=p.frag,A=p.id,u=p.initPTS,f=p.timescale,t=this.unparsedVttFrags;A==="main"&&(this.initPTS[d.cc]=u,this.timescale[d.cc]=f),t.length&&(this.unparsedVttFrags=[],t.forEach(function(h){o.onFragLoaded(g.Events.FRAG_LOADED,h)}))},i.getExistingTrack=function(m){var p=this.media;if(p)for(var o=0;o<p.textTracks.length;o++){var d=p.textTracks[o];if(d[m])return d}return null},i.createCaptionsTrack=function(m){this.config.renderTextTracksNatively?this.createNativeTrack(m):this.createNonNativeTrack(m)},i.createNativeTrack=function(m){if(!this.captionsTracks[m]){var p=this.captionsProperties,o=this.captionsTracks,d=this.media,A=p[m],u=A.label,f=A.languageCode,t=this.getExistingTrack(m);if(t)o[m]=t,(0,x.clearCurrentCues)(o[m]),(0,x.sendAddTrackEvent)(o[m],d);else{var h=this.createTextTrack("captions",u,f);h&&(h[m]=!0,o[m]=h)}}},i.createNonNativeTrack=function(m){if(!this.nonNativeCaptionsTracks[m]){var p=this.captionsProperties[m];if(!!p){var o=p.label,d={_id:m,label:o,kind:"captions",default:p.media?!!p.media.default:!1,closedCaptions:p.media};this.nonNativeCaptionsTracks[m]=d,this.hls.trigger(g.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[d]})}}},i.createTextTrack=function(m,p,o){var d=this.media;if(!!d)return d.addTextTrack(m,p,o)},i.onMediaAttaching=function(m,p){this.media=p.media,this._cleanTracks()},i.onMediaDetaching=function(){var m=this.captionsTracks;Object.keys(m).forEach(function(p){(0,x.clearCurrentCues)(m[p]),delete m[p]}),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=n(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},i._cleanTracks=function(){var m=this.media;if(!!m){var p=m.textTracks;if(p)for(var o=0;o<p.length;o++)(0,x.clearCurrentCues)(p[o])}},i.onSubtitleTracksUpdated=function(m,p){var o=this;this.textTracks=[];var d=p.subtitleTracks||[],A=d.some(function(h){return h.textCodec===E.IMSC1_CODEC});if(this.config.enableWebVTT||A&&this.config.enableIMSC1){var u=this.tracks&&d&&this.tracks.length===d.length;if(this.tracks=d||[],this.config.renderTextTracksNatively){var f=this.media?this.media.textTracks:[];this.tracks.forEach(function(h,e){var y;if(e<f.length){for(var P=null,S=0;S<f.length;S++)if(_(f[S],h)){P=f[S];break}P&&(y=P)}if(y)(0,x.clearCurrentCues)(y);else{var w=o._captionsOrSubtitlesFromCharacteristics(h);y=o.createTextTrack(w,h.name,h.lang),y&&(y.mode="disabled")}y&&(y.groupId=h.groupId,o.textTracks.push(y))})}else if(!u&&this.tracks&&this.tracks.length){var t=this.tracks.map(function(h){return{label:h.name,kind:h.type.toLowerCase(),default:h.default,subtitleTrack:h}});this.hls.trigger(g.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:t})}}},i._captionsOrSubtitlesFromCharacteristics=function(m){var p;if((p=m.attrs)!==null&&p!==void 0&&p.CHARACTERISTICS){var o=/transcribes-spoken-dialog/gi.test(m.attrs.CHARACTERISTICS),d=/describes-music-and-sound/gi.test(m.attrs.CHARACTERISTICS);if(o&&d)return"captions"}return"subtitles"},i.onManifestLoaded=function(m,p){var o=this;this.config.enableCEA708Captions&&p.captions&&p.captions.forEach(function(d){var A=/(?:CC|SERVICE)([1-4])/.exec(d.instreamId);if(!!A){var u="textTrack"+A[1],f=o.captionsProperties[u];!f||(f.label=d.name,d.lang&&(f.languageCode=d.lang),f.media=d)}})},i.closedCaptionsForLevel=function(m){var p=this.hls.levels[m.level];return p==null?void 0:p.attrs["CLOSED-CAPTIONS"]},i.onFragLoading=function(m,p){var o=this.cea608Parser1,d=this.cea608Parser2,A=this.lastSn,u=this.lastPartIndex;if(!(!this.enabled||!(o&&d))&&p.frag.type===L.PlaylistLevelType.MAIN){var f,t,h=p.frag.sn,e=(f=p==null||(t=p.part)===null||t===void 0?void 0:t.index)!=null?f:-1;h===A+1||h===A&&e===u+1||(o.reset(),d.reset()),this.lastSn=h,this.lastPartIndex=e}},i.onFragLoaded=function(m,p){var o=p.frag,d=p.payload,A=this.initPTS,u=this.unparsedVttFrags;if(o.type===L.PlaylistLevelType.SUBTITLE)if(d.byteLength){if(!(0,D.isFiniteNumber)(A[o.cc])){u.push(p),A.length&&this.hls.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Missing initial subtitle PTS")});return}var f=o.decryptdata,t="stats"in p;if(f==null||!f.encrypted||t){var h=this.tracks[o.level],e=this.vttCCs;e[o.cc]||(e[o.cc]={start:o.start,prevCC:this.prevCC,new:!0},this.prevCC=o.cc),h&&h.textCodec===E.IMSC1_CODEC?this._parseIMSC1(o,d):this._parseVTTs(o,d,e)}}else this.hls.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Empty subtitle payload")})},i._parseIMSC1=function(m,p){var o=this,d=this.hls;(0,E.parseIMSC1)(p,this.initPTS[m.cc],this.timescale[m.cc],function(A){o._appendCues(A,m.level),d.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:m})},function(A){I.logger.log("Failed to parse IMSC1: "+A),d.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:m,error:A})})},i._parseVTTs=function(m,p,o){var d,A=this,u=this.hls,f=(d=m.initSegment)!==null&&d!==void 0&&d.data?(0,T.appendUint8Array)(m.initSegment.data,new Uint8Array(p)):p;(0,C.parseWebVTT)(f,this.initPTS[m.cc],this.timescale[m.cc],o,m.cc,m.start,function(t){A._appendCues(t,m.level),u.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:m})},function(t){A._fallbackToIMSC1(m,p),I.logger.log("Failed to parse VTT cue: "+t),u.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:m,error:t})})},i._fallbackToIMSC1=function(m,p){var o=this,d=this.tracks[m.level];d.textCodec||(0,E.parseIMSC1)(p,this.initPTS[m.cc],this.timescale[m.cc],function(){d.textCodec=E.IMSC1_CODEC,o._parseIMSC1(m,p)},function(){d.textCodec="wvtt"})},i._appendCues=function(m,p){var o=this.hls;if(this.config.renderTextTracksNatively){var d=this.textTracks[p];if(!d||d.mode==="disabled")return;m.forEach(function(f){return(0,x.addCueToTrack)(d,f)})}else{var A=this.tracks[p];if(!A)return;var u=A.default?"default":"subtitles"+p;o.trigger(g.Events.CUES_PARSED,{type:"subtitles",cues:m,track:u})}},i.onFragDecrypted=function(m,p){var o=p.frag;if(o.type===L.PlaylistLevelType.SUBTITLE){if(!(0,D.isFiniteNumber)(this.initPTS[o.cc])){this.unparsedVttFrags.push(p);return}this.onFragLoaded(g.Events.FRAG_LOADED,p)}},i.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},i.onFragParsingUserdata=function(m,p){var o=this.cea608Parser1,d=this.cea608Parser2;if(!(!this.enabled||!(o&&d))){var A=p.frag,u=p.samples;if(!(A.type===L.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(A)==="NONE"))for(var f=0;f<u.length;f++){var t=u[f].bytes;if(t){var h=this.extractCea608Data(t);o.addData(u[f].pts,h[0]),d.addData(u[f].pts,h[1])}}}},i.onBufferFlushing=function(m,p){var o=p.startOffset,d=p.endOffset,A=p.endOffsetSubtitles,u=p.type,f=this.media;if(!(!f||f.currentTime<d)){if(!u||u==="video"){var t=this.captionsTracks;Object.keys(t).forEach(function(e){return(0,x.removeCuesInRange)(t[e],o,d)})}if(this.config.renderTextTracksNatively&&o===0&&A!==void 0){var h=this.textTracks;Object.keys(h).forEach(function(e){return(0,x.removeCuesInRange)(h[e],o,A)})}}},i.extractCea608Data=function(m){for(var p=[[],[]],o=m[0]&31,d=2,A=0;A<o;A++){var u=m[d++],f=127&m[d++],t=127&m[d++];if(!(f===0&&t===0)){var h=(4&u)!==0;if(h){var e=3&u;(e===0||e===1)&&(p[e].push(f),p[e].push(t))}}}return p},l}();function _(l,i){return l&&l.label===i.name&&!(l.textTrack1||l.textTrack2)}function v(l,i,a,m){return Math.min(i,m)-Math.max(l,a)}function n(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>D});var D=function(){function g(c,C){this.subtle=void 0,this.aesIV=void 0,this.subtle=c,this.aesIV=C}var b=g.prototype;return b.decrypt=function(C,x){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},x,C)},g}()},"./src/crypt/aes-decryptor.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>b,removePadding:()=>g});var D=s("./src/utils/typed-array.ts");function g(c){var C=c.byteLength,x=C&&new DataView(c.buffer).getUint8(C-1);return x?(0,D.sliceUint8)(c,0,C-x):c}var b=function(){function c(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var C=c.prototype;return C.uint8ArrayToUint32Array_=function(E){for(var T=new DataView(E),L=new Uint32Array(4),I=0;I<4;I++)L[I]=T.getUint32(I*4);return L},C.initTable=function(){var E=this.sBox,T=this.invSBox,L=this.subMix,I=L[0],r=L[1],_=L[2],v=L[3],n=this.invSubMix,l=n[0],i=n[1],a=n[2],m=n[3],p=new Uint32Array(256),o=0,d=0,A=0;for(A=0;A<256;A++)A<128?p[A]=A<<1:p[A]=A<<1^283;for(A=0;A<256;A++){var u=d^d<<1^d<<2^d<<3^d<<4;u=u>>>8^u&255^99,E[o]=u,T[u]=o;var f=p[o],t=p[f],h=p[t],e=p[u]*257^u*16843008;I[o]=e<<24|e>>>8,r[o]=e<<16|e>>>16,_[o]=e<<8|e>>>24,v[o]=e,e=h*16843009^t*65537^f*257^o*16843008,l[u]=e<<24|e>>>8,i[u]=e<<16|e>>>16,a[u]=e<<8|e>>>24,m[u]=e,o?(o=f^p[p[p[h^f]]],d^=p[p[d]]):o=d=1}},C.expandKey=function(E){for(var T=this.uint8ArrayToUint32Array_(E),L=!0,I=0;I<T.length&&L;)L=T[I]===this.key[I],I++;if(!L){this.key=T;var r=this.keySize=T.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);var _=this.ksRows=(r+6+1)*4,v,n,l=this.keySchedule=new Uint32Array(_),i=this.invKeySchedule=new Uint32Array(_),a=this.sBox,m=this.rcon,p=this.invSubMix,o=p[0],d=p[1],A=p[2],u=p[3],f,t;for(v=0;v<_;v++){if(v<r){f=l[v]=T[v];continue}t=f,v%r===0?(t=t<<8|t>>>24,t=a[t>>>24]<<24|a[t>>>16&255]<<16|a[t>>>8&255]<<8|a[t&255],t^=m[v/r|0]<<24):r>6&&v%r===4&&(t=a[t>>>24]<<24|a[t>>>16&255]<<16|a[t>>>8&255]<<8|a[t&255]),l[v]=f=(l[v-r]^t)>>>0}for(n=0;n<_;n++)v=_-n,n&3?t=l[v]:t=l[v-4],n<4||v<=4?i[n]=t:i[n]=o[a[t>>>24]]^d[a[t>>>16&255]]^A[a[t>>>8&255]]^u[a[t&255]],i[n]=i[n]>>>0}},C.networkToHostOrderSwap=function(E){return E<<24|(E&65280)<<8|(E&16711680)>>8|E>>>24},C.decrypt=function(E,T,L){for(var I=this.keySize+6,r=this.invKeySchedule,_=this.invSBox,v=this.invSubMix,n=v[0],l=v[1],i=v[2],a=v[3],m=this.uint8ArrayToUint32Array_(L),p=m[0],o=m[1],d=m[2],A=m[3],u=new Int32Array(E),f=new Int32Array(u.length),t,h,e,y,P,S,w,k,F,U,N,j,W,H,G=this.networkToHostOrderSwap;T<u.length;){for(F=G(u[T]),U=G(u[T+1]),N=G(u[T+2]),j=G(u[T+3]),P=F^r[0],S=j^r[1],w=N^r[2],k=U^r[3],W=4,H=1;H<I;H++)t=n[P>>>24]^l[S>>16&255]^i[w>>8&255]^a[k&255]^r[W],h=n[S>>>24]^l[w>>16&255]^i[k>>8&255]^a[P&255]^r[W+1],e=n[w>>>24]^l[k>>16&255]^i[P>>8&255]^a[S&255]^r[W+2],y=n[k>>>24]^l[P>>16&255]^i[S>>8&255]^a[w&255]^r[W+3],P=t,S=h,w=e,k=y,W=W+4;t=_[P>>>24]<<24^_[S>>16&255]<<16^_[w>>8&255]<<8^_[k&255]^r[W],h=_[S>>>24]<<24^_[w>>16&255]<<16^_[k>>8&255]<<8^_[P&255]^r[W+1],e=_[w>>>24]<<24^_[k>>16&255]<<16^_[P>>8&255]<<8^_[S&255]^r[W+2],y=_[k>>>24]<<24^_[P>>16&255]<<16^_[S>>8&255]<<8^_[w&255]^r[W+3],f[T]=G(t^p),f[T+1]=G(y^o),f[T+2]=G(e^d),f[T+3]=G(h^A),p=F,o=U,d=N,A=j,T=T+4}return f.buffer},c}()},"./src/crypt/decrypter.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>T});var D=s("./src/crypt/aes-crypto.ts"),g=s("./src/crypt/fast-aes-key.ts"),b=s("./src/crypt/aes-decryptor.ts"),c=s("./src/utils/logger.ts"),C=s("./src/utils/mp4-tools.ts"),x=s("./src/utils/typed-array.ts"),E=16,T=function(){function L(r,_){var v=_===void 0?{}:_,n=v.removePKCS7Padding,l=n===void 0?!0:n;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=r.enableSoftwareAES,this.removePKCS7Padding=l,l)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch(a){}this.subtle===null&&(this.useSoftware=!0)}var I=L.prototype;return I.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},I.isSync=function(){return this.useSoftware},I.flush=function(){var _=this.currentResult,v=this.remainderData;if(!_||v)return this.reset(),null;var n=new Uint8Array(_);return this.reset(),this.removePKCS7Padding?(0,b.removePadding)(n):n},I.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},I.decrypt=function(_,v,n){var l=this;return this.useSoftware?new Promise(function(i,a){l.softwareDecrypt(new Uint8Array(_),v,n);var m=l.flush();m?i(m.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(_),v,n)},I.softwareDecrypt=function(_,v,n){var l=this.currentIV,i=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(_=(0,C.appendUint8Array)(a,_),this.remainderData=null);var m=this.getValidChunk(_);if(!m.length)return null;l&&(n=l);var p=this.softwareDecrypter;p||(p=this.softwareDecrypter=new b.default),p.expandKey(v);var o=i;return this.currentResult=p.decrypt(m.buffer,0,n),this.currentIV=(0,x.sliceUint8)(m,-16).buffer,o||null},I.webCryptoDecrypt=function(_,v,n){var l=this,i=this.subtle;return(this.key!==v||!this.fastAesKey)&&(this.key=v,this.fastAesKey=new g.default(i,v)),this.fastAesKey.expandKey().then(function(a){if(!i)return Promise.reject(new Error("web crypto not initialized"));l.logOnce("WebCrypto AES decrypt");var m=new D.default(i,new Uint8Array(n));return m.decrypt(_.buffer,a)}).catch(function(a){return c.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+a.name+": "+a.message),l.onWebCryptoError(_,v,n)})},I.onWebCryptoError=function(_,v,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(_,v,n);var l=this.flush();if(l)return l.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},I.getValidChunk=function(_){var v=_,n=_.length-_.length%E;return n!==_.length&&(v=(0,x.sliceUint8)(_,0,n),this.remainderData=(0,x.sliceUint8)(_,n)),v},I.logOnce=function(_){!this.logEnabled||(c.logger.log("[decrypter]: "+_),this.logEnabled=!1)},L}()},"./src/crypt/fast-aes-key.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>D});var D=function(){function g(c,C){this.subtle=void 0,this.key=void 0,this.subtle=c,this.key=C}var b=g.prototype;return b.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},g}()},"./src/demux/aacdemuxer.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>T});var D=s("./src/demux/base-audio-demuxer.ts"),g=s("./src/demux/adts.ts"),b=s("./src/utils/logger.ts"),c=s("./src/demux/id3.ts");function C(L,I){L.prototype=Object.create(I.prototype),L.prototype.constructor=L,x(L,I)}function x(L,I){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,v){return _.__proto__=v,_},x(L,I)}var E=function(L){C(I,L);function I(_,v){var n;return n=L.call(this)||this,n.observer=void 0,n.config=void 0,n.observer=_,n.config=v,n}var r=I.prototype;return r.resetInitSegment=function(v,n,l,i){L.prototype.resetInitSegment.call(this,v,n,l,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:n,duration:i,inputTimeScale:9e4,dropped:0}},I.probe=function(v){if(!v)return!1;for(var n=c.getID3Data(v,0)||[],l=n.length,i=v.length;l<i;l++)if(g.probe(v,l))return b.logger.log("ADTS sync word found !"),!0;return!1},r.canParse=function(v,n){return g.canParse(v,n)},r.appendFrame=function(v,n,l){g.initTrackConfig(v,this.observer,n,l,v.manifestCodec);var i=g.appendFrame(v,n,l,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i},I}(D.default);const T=E},"./src/demux/adts.ts":(O,R,s)=>{s.r(R),s.d(R,{appendFrame:()=>l,canGetFrameLength:()=>T,canParse:()=>I,getAudioConfig:()=>c,getFrameDuration:()=>v,getFullFrameLength:()=>E,getHeaderLength:()=>x,initTrackConfig:()=>_,isHeader:()=>L,isHeaderPattern:()=>C,parseFrameHeader:()=>n,probe:()=>r});var D=s("./src/utils/logger.ts"),g=s("./src/errors.ts"),b=s("./src/events.ts");function c(i,a,m,p){var o,d,A,u,f=navigator.userAgent.toLowerCase(),t=p,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=((a[m+2]&192)>>>6)+1;var e=(a[m+2]&60)>>>2;if(e>h.length-1){i.trigger(b.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+e});return}return A=(a[m+2]&1)<<2,A|=(a[m+3]&192)>>>6,D.logger.log("manifest codec:"+p+", ADTS type:"+o+", samplingIndex:"+e),/firefox/i.test(f)?e>=6?(o=5,u=new Array(4),d=e-3):(o=2,u=new Array(2),d=e):f.indexOf("android")!==-1?(o=2,u=new Array(2),d=e):(o=5,u=new Array(4),p&&(p.indexOf("mp4a.40.29")!==-1||p.indexOf("mp4a.40.5")!==-1)||!p&&e>=6?d=e-3:((p&&p.indexOf("mp4a.40.2")!==-1&&(e>=6&&A===1||/vivaldi/i.test(f))||!p&&A===1)&&(o=2,u=new Array(2)),d=e)),u[0]=o<<3,u[0]|=(e&14)>>1,u[1]|=(e&1)<<7,u[1]|=A<<3,o===5&&(u[1]|=(d&14)>>1,u[2]=(d&1)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:h[e],channelCount:A,codec:"mp4a.40."+o,manifestCodec:t}}function C(i,a){return i[a]===255&&(i[a+1]&246)===240}function x(i,a){return i[a+1]&1?7:9}function E(i,a){return(i[a+3]&3)<<11|i[a+4]<<3|(i[a+5]&224)>>>5}function T(i,a){return a+5<i.length}function L(i,a){return a+1<i.length&&C(i,a)}function I(i,a){return T(i,a)&&C(i,a)&&E(i,a)<=i.length-a}function r(i,a){if(L(i,a)){var m=x(i,a);if(a+m>=i.length)return!1;var p=E(i,a);if(p<=m)return!1;var o=a+p;return o===i.length||L(i,o)}return!1}function _(i,a,m,p,o){if(!i.samplerate){var d=c(a,m,p,o);if(!d)return;i.config=d.config,i.samplerate=d.samplerate,i.channelCount=d.channelCount,i.codec=d.codec,i.manifestCodec=d.manifestCodec,D.logger.log("parsed codec:"+i.codec+", rate:"+d.samplerate+", channels:"+d.channelCount)}}function v(i){return 9216e4/i}function n(i,a){var m=x(i,a);if(a+m<=i.length){var p=E(i,a)-m;if(p>0)return{headerLength:m,frameLength:p}}}function l(i,a,m,p,o){var d=v(i.samplerate),A=p+o*d,u=n(a,m),f;if(u){var t=u.frameLength,h=u.headerLength,e=h+t,y=Math.max(0,m+e-a.length);y?(f=new Uint8Array(e-h),f.set(a.subarray(m+h,a.length),0)):f=a.subarray(m+h,m+e);var P={unit:f,pts:A};return y||i.samples.push(P),{sample:P,length:e,missing:y}}var S=a.length-m;f=new Uint8Array(S),f.set(a.subarray(m,a.length),0);var w={unit:f,pts:A};return{sample:w,length:S,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>L,initPTSFn:()=>T});var D=s("./src/polyfills/number.ts"),g=s("./src/demux/id3.ts"),b=s("./src/types/demuxer.ts"),c=s("./src/demux/dummy-demuxed-track.ts"),C=s("./src/utils/mp4-tools.ts"),x=s("./src/utils/typed-array.ts"),E=function(){function I(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var r=I.prototype;return r.resetInitSegment=function(v,n,l,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},r.resetTimeStamp=function(v){this.initPTS=v,this.resetContiguity()},r.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},r.canParse=function(v,n){return!1},r.appendFrame=function(v,n,l){},r.demux=function(v,n){this.cachedData&&(v=(0,C.appendUint8Array)(this.cachedData,v),this.cachedData=null);var l=g.getID3Data(v,0),i=l?l.length:0,a,m=this._audioTrack,p=this._id3Track,o=l?g.getTimeStamp(l):void 0,d=v.length;for((this.basePTS===null||this.frameIndex===0&&(0,D.isFiniteNumber)(o))&&(this.basePTS=T(o,n,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),l&&l.length>0&&p.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:l,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});i<d;){if(this.canParse(v,i)){var A=this.appendFrame(m,v,i);A?(this.frameIndex++,this.lastPTS=A.sample.pts,i+=A.length,a=i):i=d}else g.canParse(v,i)?(l=g.getID3Data(v,i),p.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:l,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),i+=l.length,a=i):i++;if(i===d&&a!==d){var u=(0,x.sliceUint8)(v,a);this.cachedData?this.cachedData=(0,C.appendUint8Array)(this.cachedData,u):this.cachedData=u}}return{audioTrack:m,videoTrack:(0,c.dummyTrack)(),id3Track:p,textTrack:(0,c.dummyTrack)()}},r.demuxSampleAes=function(v,n,l){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},r.flush=function(v){var n=this.cachedData;return n&&(this.cachedData=null,this.demux(n,0)),{audioTrack:this._audioTrack,videoTrack:(0,c.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,c.dummyTrack)()}},r.destroy=function(){},I}(),T=function(r,_,v){return(0,D.isFiniteNumber)(r)?r*90:_*9e4+(v||0)};const L=E},"./src/demux/chunk-cache.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>D});var D=function(){function b(){this.chunks=[],this.dataLength=0}var c=b.prototype;return c.push=function(x){this.chunks.push(x),this.dataLength+=x.length},c.flush=function(){var x=this.chunks,E=this.dataLength,T;if(x.length)x.length===1?T=x[0]:T=g(x,E);else return new Uint8Array(0);return this.reset(),T},c.reset=function(){this.chunks.length=0,this.dataLength=0},b}();function g(b,c){for(var C=new Uint8Array(c),x=0,E=0;E<b.length;E++){var T=b[E];C.set(T,x),x+=T.length}return C}},"./src/demux/dummy-demuxed-track.ts":(O,R,s)=>{s.r(R),s.d(R,{dummyTrack:()=>D});function D(g,b){return g===void 0&&(g=""),b===void 0&&(b=9e4),{type:g,id:-1,pid:-1,inputTimeScale:b,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>b});var D=s("./src/utils/logger.ts"),g=function(){function c(x){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=x,this.bytesAvailable=x.byteLength,this.word=0,this.bitsAvailable=0}var C=c.prototype;return C.loadWord=function(){var E=this.data,T=this.bytesAvailable,L=E.byteLength-T,I=new Uint8Array(4),r=Math.min(4,T);if(r===0)throw new Error("no bytes available");I.set(E.subarray(L,L+r)),this.word=new DataView(I.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r},C.skipBits=function(E){var T;E=Math.min(E,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>E?(this.word<<=E,this.bitsAvailable-=E):(E-=this.bitsAvailable,T=E>>3,E-=T<<3,this.bytesAvailable-=T,this.loadWord(),this.word<<=E,this.bitsAvailable-=E)},C.readBits=function(E){var T=Math.min(this.bitsAvailable,E),L=this.word>>>32-T;if(E>32&&D.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=T,this.bitsAvailable>0)this.word<<=T;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return T=E-T,T>0&&this.bitsAvailable?L<<T|this.readBits(T):L},C.skipLZ=function(){var E;for(E=0;E<this.bitsAvailable;++E)if((this.word&2147483648>>>E)!==0)return this.word<<=E,this.bitsAvailable-=E,E;return this.loadWord(),E+this.skipLZ()},C.skipUEG=function(){this.skipBits(1+this.skipLZ())},C.skipEG=function(){this.skipBits(1+this.skipLZ())},C.readUEG=function(){var E=this.skipLZ();return this.readBits(E+1)-1},C.readEG=function(){var E=this.readUEG();return 1&E?1+E>>>1:-1*(E>>>1)},C.readBoolean=function(){return this.readBits(1)===1},C.readUByte=function(){return this.readBits(8)},C.readUShort=function(){return this.readBits(16)},C.readUInt=function(){return this.readBits(32)},C.skipScalingList=function(E){for(var T=8,L=8,I,r=0;r<E;r++)L!==0&&(I=this.readEG(),L=(T+I+256)%256),T=L===0?T:L},C.readSPS=function(){var E=0,T=0,L=0,I=0,r,_,v,n=this.readUByte.bind(this),l=this.readBits.bind(this),i=this.readUEG.bind(this),a=this.readBoolean.bind(this),m=this.skipBits.bind(this),p=this.skipEG.bind(this),o=this.skipUEG.bind(this),d=this.skipScalingList.bind(this);n();var A=n();if(l(5),m(3),n(),o(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){var u=i();if(u===3&&m(1),o(),o(),m(1),a())for(_=u!==3?8:12,v=0;v<_;v++)a()&&(v<6?d(16):d(64))}o();var f=i();if(f===0)i();else if(f===1)for(m(1),p(),p(),r=i(),v=0;v<r;v++)p();o(),m(1);var t=i(),h=i(),e=l(1);e===0&&m(1),m(1),a()&&(E=i(),T=i(),L=i(),I=i());var y=[1,1];if(a()&&a()){var P=n();switch(P){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:{y=[n()<<8|n(),n()<<8|n()];break}}}return{width:Math.ceil((t+1)*16-E*2-T*2),height:(2-e)*(h+1)*16-(e?2:4)*(L+I),pixelRatio:y}},C.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},c}();const b=g},"./src/demux/id3.ts":(O,R,s)=>{s.r(R),s.d(R,{canParse:()=>C,decodeFrame:()=>I,getID3Data:()=>b,getID3Frames:()=>L,getTimeStamp:()=>x,isFooter:()=>g,isHeader:()=>D,isTimeStampFrame:()=>E,testables:()=>i,utf8ArrayToStr:()=>l});var D=function(o,d){return d+10<=o.length&&o[d]===73&&o[d+1]===68&&o[d+2]===51&&o[d+3]<255&&o[d+4]<255&&o[d+6]<128&&o[d+7]<128&&o[d+8]<128&&o[d+9]<128},g=function(o,d){return d+10<=o.length&&o[d]===51&&o[d+1]===68&&o[d+2]===73&&o[d+3]<255&&o[d+4]<255&&o[d+6]<128&&o[d+7]<128&&o[d+8]<128&&o[d+9]<128},b=function(o,d){for(var A=d,u=0;D(o,d);){u+=10;var f=c(o,d+6);u+=f,g(o,d+10)&&(u+=10),d+=u}if(u>0)return o.subarray(A,A+u)},c=function(o,d){var A=0;return A=(o[d]&127)<<21,A|=(o[d+1]&127)<<14,A|=(o[d+2]&127)<<7,A|=o[d+3]&127,A},C=function(o,d){return D(o,d)&&c(o,d+6)+10<=o.length-d},x=function(o){for(var d=L(o),A=0;A<d.length;A++){var u=d[A];if(E(u))return n(u)}},E=function(o){return o&&o.key==="PRIV"&&o.info==="com.apple.streaming.transportStreamTimestamp"},T=function(o){var d=String.fromCharCode(o[0],o[1],o[2],o[3]),A=c(o,4),u=10;return{type:d,size:A,data:o.subarray(u,u+A)}},L=function(o){for(var d=0,A=[];D(o,d);){var u=c(o,d+6);d+=10;for(var f=d+u;d+8<f;){var t=T(o.subarray(d)),h=I(t);h&&A.push(h),d+=t.size+10}g(o,d)&&(d+=10)}return A},I=function(o){return o.type==="PRIV"?r(o):o.type[0]==="W"?v(o):_(o)},r=function(o){if(!(o.size<2)){var d=l(o.data,!0),A=new Uint8Array(o.data.subarray(d.length+1));return{key:o.type,info:d,data:A.buffer}}},_=function(o){if(!(o.size<2)){if(o.type==="TXXX"){var d=1,A=l(o.data.subarray(d),!0);d+=A.length+1;var u=l(o.data.subarray(d));return{key:o.type,info:A,data:u}}var f=l(o.data.subarray(1));return{key:o.type,data:f}}},v=function(o){if(o.type==="WXXX"){if(o.size<2)return;var d=1,A=l(o.data.subarray(d),!0);d+=A.length+1;var u=l(o.data.subarray(d));return{key:o.type,info:A,data:u}}var f=l(o.data);return{key:o.type,data:f}},n=function(o){if(o.data.byteLength===8){var d=new Uint8Array(o.data),A=d[3]&1,u=(d[4]<<23)+(d[5]<<15)+(d[6]<<7)+d[7];return u/=45,A&&(u+=4772185884e-2),Math.round(u)}},l=function(o,d){d===void 0&&(d=!1);var A=m();if(A){var u=A.decode(o);if(d){var f=u.indexOf("\0");return f!==-1?u.substring(0,f):u}return u.replace(/\0/g,"")}for(var t=o.length,h,e,y,P="",S=0;S<t;){if(h=o[S++],h===0&&d)return P;if(h===0||h===3)continue;switch(h>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:P+=String.fromCharCode(h);break;case 12:case 13:e=o[S++],P+=String.fromCharCode((h&31)<<6|e&63);break;case 14:e=o[S++],y=o[S++],P+=String.fromCharCode((h&15)<<12|(e&63)<<6|(y&63)<<0);break}}return P},i={decodeTextFrame:_},a;function m(){return!a&&typeof self.TextDecoder<"u"&&(a=new self.TextDecoder("utf-8")),a}},"./src/demux/mp3demuxer.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>T});var D=s("./src/demux/base-audio-demuxer.ts"),g=s("./src/demux/id3.ts"),b=s("./src/utils/logger.ts"),c=s("./src/demux/mpegaudio.ts");function C(L,I){L.prototype=Object.create(I.prototype),L.prototype.constructor=L,x(L,I)}function x(L,I){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,v){return _.__proto__=v,_},x(L,I)}var E=function(L){C(I,L);function I(){return L.apply(this,arguments)||this}var r=I.prototype;return r.resetInitSegment=function(v,n,l,i){L.prototype.resetInitSegment.call(this,v,n,l,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:n,duration:i,inputTimeScale:9e4,dropped:0}},I.probe=function(v){if(!v)return!1;for(var n=g.getID3Data(v,0)||[],l=n.length,i=v.length;l<i;l++)if(c.probe(v,l))return b.logger.log("MPEG Audio sync word found !"),!0;return!1},r.canParse=function(v,n){return c.canParse(v,n)},r.appendFrame=function(v,n,l){if(this.basePTS!==null)return c.appendFrame(v,n,l,this.basePTS,this.frameIndex)},I}(D.default);const T=E},"./src/demux/mp4demuxer.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>E});var D=s("./src/polyfills/number.ts"),g=s("./src/types/demuxer.ts"),b=s("./src/utils/mp4-tools.ts"),c=s("./src/demux/dummy-demuxed-track.ts"),C=/\/emsg[-/]ID3/i,x=function(){function T(I,r){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=r}var L=T.prototype;return L.resetTimeStamp=function(){},L.resetInitSegment=function(r,_,v,n){var l=this.videoTrack=(0,c.dummyTrack)("video",1),i=this.audioTrack=(0,c.dummyTrack)("audio",1),a=this.txtTrack=(0,c.dummyTrack)("text",1);if(this.id3Track=(0,c.dummyTrack)("id3",1),this.timeOffset=0,!(!r||!r.byteLength)){var m=(0,b.parseInitSegment)(r);if(m.video){var p=m.video,o=p.id,d=p.timescale,A=p.codec;l.id=o,l.timescale=a.timescale=d,l.codec=A}if(m.audio){var u=m.audio,f=u.id,t=u.timescale,h=u.codec;i.id=f,i.timescale=t,i.codec=h}a.id=b.RemuxerTrackIdConfig.text,l.sampleDuration=0,l.duration=i.duration=n}},L.resetContiguity=function(){},T.probe=function(r){return r=r.length>16384?r.subarray(0,16384):r,(0,b.findBox)(r,["moof"]).length>0},L.demux=function(r,_){this.timeOffset=_;var v=r,n=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(v=(0,b.appendUint8Array)(this.remainderData,r));var i=(0,b.segmentValidRange)(v);this.remainderData=i.remainder,n.samples=i.valid||new Uint8Array}else n.samples=v;var a=this.extractID3Track(n,_);return l.samples=(0,b.parseSamples)(_,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}},L.flush=function(){var r=this.timeOffset,_=this.videoTrack,v=this.txtTrack;_.samples=this.remainderData||new Uint8Array,this.remainderData=null;var n=this.extractID3Track(_,this.timeOffset);return v.samples=(0,b.parseSamples)(r,_),{videoTrack:_,audioTrack:(0,c.dummyTrack)(),id3Track:n,textTrack:(0,c.dummyTrack)()}},L.extractID3Track=function(r,_){var v=this.id3Track;if(r.samples.length){var n=(0,b.findBox)(r.samples,["emsg"]);n&&n.forEach(function(l){var i=(0,b.parseEmsg)(l);if(C.test(i.schemeIdUri)){var a=(0,D.isFiniteNumber)(i.presentationTime)?i.presentationTime/i.timeScale:_+i.presentationTimeDelta/i.timeScale,m=i.eventDuration===4294967295?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;m<=.001&&(m=Number.POSITIVE_INFINITY);var p=i.payload;v.samples.push({data:p,len:p.byteLength,dts:a,pts:a,type:g.MetadataSchema.emsg,duration:m})}})}return v},L.demuxSampleAes=function(r,_,v){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},L.destroy=function(){},T}();const E=x},"./src/demux/mpegaudio.ts":(O,R,s)=>{s.r(R),s.d(R,{appendFrame:()=>x,canParse:()=>I,isHeader:()=>L,isHeaderPattern:()=>T,parseHeader:()=>E,probe:()=>r});var D=null,g=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],b=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],c=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],C=[0,1,1,4];function x(_,v,n,l,i){if(!(n+24>v.length)){var a=E(v,n);if(a&&n+a.frameLength<=v.length){var m=a.samplesPerFrame*9e4/a.sampleRate,p=l+i*m,o={unit:v.subarray(n,n+a.frameLength),pts:p,dts:p};return _.config=[],_.channelCount=a.channelCount,_.samplerate=a.sampleRate,_.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}}function E(_,v){var n=_[v+1]>>3&3,l=_[v+1]>>1&3,i=_[v+2]>>4&15,a=_[v+2]>>2&3;if(n!==1&&i!==0&&i!==15&&a!==3){var m=_[v+2]>>1&1,p=_[v+3]>>6,o=n===3?3-l:l===3?3:4,d=g[o*14+i-1]*1e3,A=n===3?0:n===2?1:2,u=b[A*3+a],f=p===3?1:2,t=c[n][l],h=C[l],e=t*8*h,y=Math.floor(t*d/u+m)*h;if(D===null){var P=navigator.userAgent||"",S=P.match(/Chrome\/(\d+)/i);D=S?parseInt(S[1]):0}var w=!!D&&D<=87;return w&&l===2&&d>=224e3&&p===0&&(_[v+3]=_[v+3]|128),{sampleRate:u,channelCount:f,frameLength:y,samplesPerFrame:e}}}function T(_,v){return _[v]===255&&(_[v+1]&224)===224&&(_[v+1]&6)!==0}function L(_,v){return v+1<_.length&&T(_,v)}function I(_,v){var n=4;return T(_,v)&&n<=_.length-v}function r(_,v){if(v+1<_.length&&T(_,v)){var n=4,l=E(_,v),i=n;l!=null&&l.frameLength&&(i=l.frameLength);var a=v+i;return a===_.length||L(_,a)}return!1}},"./src/demux/sample-aes.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>c});var D=s("./src/crypt/decrypter.ts"),g=s("./src/utils/mp4-tools.ts"),b=function(){function C(E,T,L){this.keyData=void 0,this.decrypter=void 0,this.keyData=L,this.decrypter=new D.default(T,{removePKCS7Padding:!1})}var x=C.prototype;return x.decryptBuffer=function(T){return this.decrypter.decrypt(T,this.keyData.key.buffer,this.keyData.iv.buffer)},x.decryptAacSample=function(T,L,I){var r=this,_=T[L].unit;if(!(_.length<=16)){var v=_.subarray(16,_.length-_.length%16),n=v.buffer.slice(v.byteOffset,v.byteOffset+v.length);this.decryptBuffer(n).then(function(l){var i=new Uint8Array(l);_.set(i,16),r.decrypter.isSync()||r.decryptAacSamples(T,L+1,I)})}},x.decryptAacSamples=function(T,L,I){for(;;L++){if(L>=T.length){I();return}if(!(T[L].unit.length<32)&&(this.decryptAacSample(T,L,I),!this.decrypter.isSync()))return}},x.getAvcEncryptedData=function(T){for(var L=Math.floor((T.length-48)/160)*16+16,I=new Int8Array(L),r=0,_=32;_<T.length-16;_+=160,r+=16)I.set(T.subarray(_,_+16),r);return I},x.getAvcDecryptedUnit=function(T,L){for(var I=new Uint8Array(L),r=0,_=32;_<T.length-16;_+=160,r+=16)T.set(I.subarray(r,r+16),_);return T},x.decryptAvcSample=function(T,L,I,r,_){var v=this,n=(0,g.discardEPB)(_.data),l=this.getAvcEncryptedData(n);this.decryptBuffer(l.buffer).then(function(i){_.data=v.getAvcDecryptedUnit(n,i),v.decrypter.isSync()||v.decryptAvcSamples(T,L,I+1,r)})},x.decryptAvcSamples=function(T,L,I,r){if(T instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;L++,I=0){if(L>=T.length){r();return}for(var _=T[L].units;!(I>=_.length);I++){var v=_[I];if(!(v.data.length<=48||v.type!==1&&v.type!==5)&&(this.decryptAvcSample(T,L,I,r,v),!this.decrypter.isSync()))return}}},C}();const c=b},"./src/demux/transmuxer-interface.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>L});var D=s("./src/demux/webworkify-webpack.js"),g=s("./src/events.ts"),b=s("./src/demux/transmuxer.ts"),c=s("./src/utils/logger.ts"),C=s("./src/errors.ts"),x=s("./src/utils/mediasource-helper.ts"),E=s("./node_modules/eventemitter3/index.js"),T=(0,x.getMediaSource)()||{isTypeSupported:function(){return!1}},L=function(){function I(_,v,n,l){var i=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var a=_.config;this.hls=_,this.id=v,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=n,this.onFlush=l;var m=function(u,f){f=f||{},f.frag=i.frag,f.id=i.id,i.hls.trigger(u,f)};this.observer=new E.EventEmitter,this.observer.on(g.Events.FRAG_DECRYPTED,m),this.observer.on(g.Events.ERROR,m);var p={mp4:T.isTypeSupported("video/mp4"),mpeg:T.isTypeSupported("audio/mpeg"),mp3:T.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){c.logger.log("demuxing in webworker");var d;try{d=this.worker=(0,D.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(A){i.useWorker=!1,c.logger.warn("Exception in webworker, fallback to inline"),i.hls.trigger(g.Events.ERROR,{type:C.ErrorTypes.OTHER_ERROR,details:C.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(A.message+"  ("+A.filename+":"+A.lineno+")")})},d.postMessage({cmd:"init",typeSupported:p,vendor:o,id:v,config:JSON.stringify(a)})}catch(A){c.logger.warn("Error in worker:",A),c.logger.error("Error while initializing DemuxerWorker, fallback to inline"),d&&self.URL.revokeObjectURL(d.objectURL),this.transmuxer=new b.default(this.observer,p,a,o,v),this.worker=null}}else this.transmuxer=new b.default(this.observer,p,a,o,v)}var r=I.prototype;return r.destroy=function(){var v=this.worker;if(v)v.removeEventListener("message",this.onwmsg),v.terminate(),this.worker=null,this.onwmsg=void 0;else{var n=this.transmuxer;n&&(n.destroy(),this.transmuxer=null)}var l=this.observer;l&&l.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},r.push=function(v,n,l,i,a,m,p,o,d,A){var u,f,t=this;d.transmuxing.start=self.performance.now();var h=this.transmuxer,e=this.worker,y=m?m.start:a.start,P=a.decryptdata,S=this.frag,w=!(S&&a.cc===S.cc),k=!(S&&d.level===S.level),F=S?d.sn-S.sn:-1,U=this.part?d.part-this.part.index:-1,N=F===0&&d.id>1&&d.id===(S==null?void 0:S.stats.chunkCount),j=!k&&(F===1||F===0&&(U===1||N&&U<=0)),W=self.performance.now();(k||F||a.stats.parsing.start===0)&&(a.stats.parsing.start=W),m&&(U||!j)&&(m.stats.parsing.start=W);var H=!(S&&((u=a.initSegment)===null||u===void 0?void 0:u.url)===((f=S.initSegment)===null||f===void 0?void 0:f.url)),G=new b.TransmuxState(w,j,o,k,y,H);if(!j||w||H){c.logger.log("[transmuxer-interface, "+a.type+"]: Starting new transmux session for sn: "+d.sn+" p: "+d.part+" level: "+d.level+" id: "+d.id+`
        discontinuity: `+w+`
        trackSwitch: `+k+`
        contiguous: `+j+`
        accurateTimeOffset: `+o+`
        timeOffset: `+y+`
        initSegmentChange: `+H);var V=new b.TransmuxConfig(l,i,n,p,A);this.configureTransmuxer(V)}if(this.frag=a,this.part=m,e)e.postMessage({cmd:"demux",data:v,decryptdata:P,chunkMeta:d,state:G},v instanceof ArrayBuffer?[v]:[]);else if(h){var Y=h.push(v,P,d,G);(0,b.isPromise)(Y)?(h.async=!0,Y.then(function(Q){t.handleTransmuxComplete(Q)}).catch(function(Q){t.transmuxerError(Q,d,"transmuxer-interface push error")})):(h.async=!1,this.handleTransmuxComplete(Y))}},r.flush=function(v){var n=this;v.transmuxing.start=self.performance.now();var l=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:v});else if(l){var a=l.flush(v),m=(0,b.isPromise)(a);m||l.async?((0,b.isPromise)(a)||(a=Promise.resolve(a)),a.then(function(p){n.handleFlushResult(p,v)}).catch(function(p){n.transmuxerError(p,v,"transmuxer-interface flush error")})):this.handleFlushResult(a,v)}},r.transmuxerError=function(v,n,l){!this.hls||this.hls.trigger(g.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:n,fatal:!1,error:v,err:v,reason:l})},r.handleFlushResult=function(v,n){var l=this;v.forEach(function(i){l.handleTransmuxComplete(i)}),this.onFlush(n)},r.onWorkerMessage=function(v){var n=v.data,l=this.hls;switch(n.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(n.data);break}case"flush":{this.onFlush(n.data);break}case"workerLog":c.logger[n.data.logType]&&c.logger[n.data.logType](n.data.message);break;default:{n.data=n.data||{},n.data.frag=this.frag,n.data.id=this.id,l.trigger(n.event,n.data);break}}},r.configureTransmuxer=function(v){var n=this.worker,l=this.transmuxer;n?n.postMessage({cmd:"configure",config:v}):l&&l.configure(v)},r.handleTransmuxComplete=function(v){v.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(v)},I}()},"./src/demux/transmuxer-worker.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>x});var D=s("./src/demux/transmuxer.ts"),g=s("./src/events.ts"),b=s("./src/utils/logger.ts"),c=s("./node_modules/eventemitter3/index.js"),C=s("./src/errors.ts");function x(r){var _=new c.EventEmitter,v=function(i,a){r.postMessage({event:i,data:a})};_.on(g.Events.FRAG_DECRYPTED,v),_.on(g.Events.ERROR,v);var n=function(){var i=function(p){var o=function(A){v("workerLog",{logType:p,message:A})};b.logger[p]=o};for(var a in b.logger)i(a)};r.addEventListener("message",function(l){var i=l.data;switch(i.cmd){case"init":{var a=JSON.parse(i.config);r.transmuxer=new D.default(_,i.typeSupported,a,i.vendor,i.id),(0,b.enableLogs)(a.debug,i.id),n(),v("init",null);break}case"configure":{r.transmuxer.configure(i.config);break}case"demux":{var m=r.transmuxer.push(i.data,i.decryptdata,i.chunkMeta,i.state);(0,D.isPromise)(m)?(r.transmuxer.async=!0,m.then(function(A){E(r,A)}).catch(function(A){v(g.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:A,err:A,reason:"transmuxer-worker push error"})})):(r.transmuxer.async=!1,E(r,m));break}case"flush":{var p=i.chunkMeta,o=r.transmuxer.flush(p),d=(0,D.isPromise)(o);d||r.transmuxer.async?((0,D.isPromise)(o)||(o=Promise.resolve(o)),o.then(function(A){L(r,A,p)}).catch(function(A){v(g.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:A,err:A,reason:"transmuxer-worker flush error"})})):L(r,o,p);break}}})}function E(r,_){if(I(_.remuxResult))return!1;var v=[],n=_.remuxResult,l=n.audio,i=n.video;return l&&T(v,l),i&&T(v,i),r.postMessage({event:"transmuxComplete",data:_},v),!0}function T(r,_){_.data1&&r.push(_.data1.buffer),_.data2&&r.push(_.data2.buffer)}function L(r,_,v){var n=_.reduce(function(l,i){return E(r,i)||l},!1);n||r.postMessage({event:"transmuxComplete",data:_[0]}),r.postMessage({event:"flush",data:v})}function I(r){return!r.audio&&!r.video&&!r.text&&!r.id3&&!r.initSegment}},"./src/demux/transmuxer.ts":(O,R,s)=>{s.r(R),s.d(R,{TransmuxConfig:()=>a,TransmuxState:()=>m,default:()=>v,isPromise:()=>i});var D=s("./src/events.ts"),g=s("./src/errors.ts"),b=s("./src/crypt/decrypter.ts"),c=s("./src/demux/aacdemuxer.ts"),C=s("./src/demux/mp4demuxer.ts"),x=s("./src/demux/tsdemuxer.ts"),E=s("./src/demux/mp3demuxer.ts"),T=s("./src/remux/mp4-remuxer.ts"),L=s("./src/remux/passthrough-remuxer.ts"),I=s("./src/utils/logger.ts"),r;try{r=self.performance.now.bind(self.performance)}catch(p){I.logger.debug("Unable to use Performance API on this environment"),r=self.Date.now}var _=[{demux:C.default,remux:L.default},{demux:x.default,remux:T.default},{demux:c.default,remux:T.default},{demux:E.default,remux:T.default}],v=function(){function p(d,A,u,f,t){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=d,this.typeSupported=A,this.config=u,this.vendor=f,this.id=t}var o=p.prototype;return o.configure=function(A){this.transmuxConfig=A,this.decrypter&&this.decrypter.reset()},o.push=function(A,u,f,t){var h=this,e=f.transmuxing;e.executeStart=r();var y=new Uint8Array(A),P=this.currentTransmuxState,S=this.transmuxConfig;t&&(this.currentTransmuxState=t);var w=t||P,k=w.contiguous,F=w.discontinuity,U=w.trackSwitch,N=w.accurateTimeOffset,j=w.timeOffset,W=w.initSegmentChange,H=S.audioCodec,G=S.videoCodec,V=S.defaultInitPts,Y=S.duration,Q=S.initSegmentData,z=n(y,u);if(z&&z.method==="AES-128"){var X=this.getDecrypter();if(X.isSync()){var q=X.softwareDecrypt(y,z.key.buffer,z.iv.buffer),te=f.part>-1;if(te&&(q=X.flush()),!q)return e.executeEnd=r(),l(f);y=new Uint8Array(q)}else return this.decryptionPromise=X.webCryptoDecrypt(y,z.key.buffer,z.iv.buffer).then(function(ie){var ne=h.push(ie,null,f);return h.decryptionPromise=null,ne}),this.decryptionPromise}var ee=this.needsProbing(F,U);ee&&this.configureTransmuxer(y),(F||U||W||ee)&&this.resetInitSegment(Q,H,G,Y,u),(F||W||ee)&&this.resetInitialTimestamp(V),k||this.resetContiguity();var Z=this.transmux(y,z,j,N,f),J=this.currentTransmuxState;return J.contiguous=!0,J.discontinuity=!1,J.trackSwitch=!1,e.executeEnd=r(),Z},o.flush=function(A){var u=this,f=A.transmuxing;f.executeStart=r();var t=this.decrypter,h=this.currentTransmuxState,e=this.decryptionPromise;if(e)return e.then(function(){return u.flush(A)});var y=[],P=h.timeOffset;if(t){var S=t.flush();S&&y.push(this.push(S,null,A))}var w=this.demuxer,k=this.remuxer;if(!w||!k)return this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),f.executeEnd=r(),[l(A)];var F=w.flush(P);return i(F)?F.then(function(U){return u.flushRemux(y,U,A),y}):(this.flushRemux(y,F,A),y)},o.flushRemux=function(A,u,f){var t=u.audioTrack,h=u.videoTrack,e=u.id3Track,y=u.textTrack,P=this.currentTransmuxState,S=P.accurateTimeOffset,w=P.timeOffset;I.logger.log("[transmuxer.ts]: Flushed fragment "+f.sn+(f.part>-1?" p: "+f.part:"")+" of level "+f.level);var k=this.remuxer.remux(t,h,e,y,w,S,!0,this.id);A.push({remuxResult:k,chunkMeta:f}),f.transmuxing.executeEnd=r()},o.resetInitialTimestamp=function(A){var u=this.demuxer,f=this.remuxer;!u||!f||(u.resetTimeStamp(A),f.resetTimeStamp(A))},o.resetContiguity=function(){var A=this.demuxer,u=this.remuxer;!A||!u||(A.resetContiguity(),u.resetNextTimestamp())},o.resetInitSegment=function(A,u,f,t,h){var e=this.demuxer,y=this.remuxer;!e||!y||(e.resetInitSegment(A,u,f,t),y.resetInitSegment(A,u,f,h))},o.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},o.transmux=function(A,u,f,t,h){var e;return u&&u.method==="SAMPLE-AES"?e=this.transmuxSampleAes(A,u,f,t,h):e=this.transmuxUnencrypted(A,f,t,h),e},o.transmuxUnencrypted=function(A,u,f,t){var h=this.demuxer.demux(A,u,!1,!this.config.progressive),e=h.audioTrack,y=h.videoTrack,P=h.id3Track,S=h.textTrack,w=this.remuxer.remux(e,y,P,S,u,f,!1,this.id);return{remuxResult:w,chunkMeta:t}},o.transmuxSampleAes=function(A,u,f,t,h){var e=this;return this.demuxer.demuxSampleAes(A,u,f).then(function(y){var P=e.remuxer.remux(y.audioTrack,y.videoTrack,y.id3Track,y.textTrack,f,t,!1,e.id);return{remuxResult:P,chunkMeta:h}})},o.configureTransmuxer=function(A){for(var u=this.config,f=this.observer,t=this.typeSupported,h=this.vendor,e,y=0,P=_.length;y<P;y++)if(_[y].demux.probe(A)){e=_[y];break}e||(I.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),e={demux:C.default,remux:L.default});var S=this.demuxer,w=this.remuxer,k=e.remux,F=e.demux;(!w||!(w instanceof k))&&(this.remuxer=new k(f,u,t,h)),(!S||!(S instanceof F))&&(this.demuxer=new F(f,u,t),this.probe=F.probe)},o.needsProbing=function(A,u){return!this.demuxer||!this.remuxer||A||u},o.getDecrypter=function(){var A=this.decrypter;return A||(A=this.decrypter=new b.default(this.config)),A},p}();function n(p,o){var d=null;return p.byteLength>0&&o!=null&&o.key!=null&&o.iv!==null&&o.method!=null&&(d=o),d}var l=function(o){return{remuxResult:{},chunkMeta:o}};function i(p){return"then"in p&&p.then instanceof Function}var a=function(o,d,A,u,f){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=o,this.videoCodec=d,this.initSegmentData=A,this.duration=u,this.defaultInitPts=f},m=function(o,d,A,u,f,t){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=o,this.contiguous=d,this.accurateTimeOffset=A,this.trackSwitch=u,this.timeOffset=f,this.initSegmentChange=t}},"./src/demux/tsdemuxer.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>p});var D=s("./src/demux/adts.ts"),g=s("./src/demux/mpegaudio.ts"),b=s("./src/demux/exp-golomb.ts"),c=s("./src/demux/sample-aes.ts"),C=s("./src/events.ts"),x=s("./src/utils/mp4-tools.ts"),E=s("./src/utils/logger.ts"),T=s("./src/errors.ts"),L=s("./src/types/demuxer.ts");function I(){return I=Object.assign?Object.assign.bind():function(o){for(var d=1;d<arguments.length;d++){var A=arguments[d];for(var u in A)Object.prototype.hasOwnProperty.call(A,u)&&(o[u]=A[u])}return o},I.apply(this,arguments)}var r=188,_=function(){function o(A,u,f){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=A,this.config=u,this.typeSupported=f}o.probe=function(u){var f=o.syncOffset(u);return f>0&&E.logger.warn("MPEG2-TS detected but first sync word found @ offset "+f),f!==-1},o.syncOffset=function(u){for(var f=u.length,t=Math.min(r*5,u.length-r)+1,h=0;h<t;){for(var e=!1,y=h;y<f&&u[y]===71;y+=r)if(!e&&n(u,y)===0&&(e=!0),e&&y+r>t)return h;h++}return-1},o.createTrack=function(u,f){return{container:u==="video"||u==="audio"?"video/mp2t":void 0,type:u,id:x.RemuxerTrackIdConfig[u],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:u==="audio"?f:void 0}};var d=o.prototype;return d.resetInitSegment=function(u,f,t,h){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=o.createTrack("video"),this._audioTrack=o.createTrack("audio",h),this._id3Track=o.createTrack("id3"),this._txtTrack=o.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=f,this.videoCodec=t,this._duration=h},d.resetTimeStamp=function(){},d.resetContiguity=function(){var u=this._audioTrack,f=this._avcTrack,t=this._id3Track;u&&(u.pesData=null),f&&(f.pesData=null),t&&(t.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},d.demux=function(u,f,t,h){t===void 0&&(t=!1),h===void 0&&(h=!1),t||(this.sampleAes=null);var e,y=this._avcTrack,P=this._audioTrack,S=this._id3Track,w=this._txtTrack,k=y.pid,F=y.pesData,U=P.pid,N=S.pid,j=P.pesData,W=S.pesData,H=null,G=this.pmtParsed,V=this._pmtId,Y=u.length;if(this.remainderData&&(u=(0,x.appendUint8Array)(this.remainderData,u),Y=u.length,this.remainderData=null),Y<r&&!h)return this.remainderData=u,{audioTrack:P,videoTrack:y,id3Track:S,textTrack:w};var Q=Math.max(0,o.syncOffset(u));Y-=(Y-Q)%r,Y<u.byteLength&&!h&&(this.remainderData=new Uint8Array(u.buffer,Y,u.buffer.byteLength-Y));for(var z=0,X=Q;X<Y;X+=r)if(u[X]===71){var q=!!(u[X+1]&64),te=n(u,X),ee=(u[X+3]&48)>>4,Z=void 0;if(ee>1){if(Z=X+5+u[X+4],Z===X+r)continue}else Z=X+4;switch(te){case k:q&&(F&&(e=a(F))&&this.parseAVCPES(y,w,e,!1),F={data:[],size:0}),F&&(F.data.push(u.subarray(Z,X+r)),F.size+=X+r-Z);break;case U:if(q){if(j&&(e=a(j)))switch(P.segmentCodec){case"aac":this.parseAACPES(P,e);break;case"mp3":this.parseMPEGPES(P,e);break}j={data:[],size:0}}j&&(j.data.push(u.subarray(Z,X+r)),j.size+=X+r-Z);break;case N:q&&(W&&(e=a(W))&&this.parseID3PES(S,e),W={data:[],size:0}),W&&(W.data.push(u.subarray(Z,X+r)),W.size+=X+r-Z);break;case 0:q&&(Z+=u[Z]+1),V=this._pmtId=l(u,Z);break;case V:{q&&(Z+=u[Z]+1);var J=i(u,Z,this.typeSupported,t);k=J.avc,k>0&&(y.pid=k),U=J.audio,U>0&&(P.pid=U,P.segmentCodec=J.segmentCodec),N=J.id3,N>0&&(S.pid=N),H!==null&&!G&&(E.logger.warn("MPEG-TS PMT found at "+X+" after unknown PID '"+H+"'. Backtracking to sync byte @"+Q+" to parse all TS packets."),H=null,X=Q-188),G=this.pmtParsed=!0;break}case 17:case 8191:break;default:H=te;break}}else z++;z>0&&this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+z+" TS packet/s that do not start with 0x47"}),y.pesData=F,P.pesData=j,S.pesData=W;var ie={audioTrack:P,videoTrack:y,id3Track:S,textTrack:w};return h&&this.extractRemainingSamples(ie),ie},d.flush=function(){var u=this.remainderData;this.remainderData=null;var f;return u?f=this.demux(u,-1,!1,!0):f={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(f),this.sampleAes?this.decrypt(f,this.sampleAes):f},d.extractRemainingSamples=function(u){var f=u.audioTrack,t=u.videoTrack,h=u.id3Track,e=u.textTrack,y=t.pesData,P=f.pesData,S=h.pesData,w;if(y&&(w=a(y))?(this.parseAVCPES(t,e,w,!0),t.pesData=null):t.pesData=y,P&&(w=a(P))){switch(f.segmentCodec){case"aac":this.parseAACPES(f,w);break;case"mp3":this.parseMPEGPES(f,w);break}f.pesData=null}else P!=null&&P.size&&E.logger.log("last AAC PES packet truncated,might overlap between fragments"),f.pesData=P;S&&(w=a(S))?(this.parseID3PES(h,w),h.pesData=null):h.pesData=S},d.demuxSampleAes=function(u,f,t){var h=this.demux(u,t,!0,!this.config.progressive),e=this.sampleAes=new c.default(this.observer,this.config,f);return this.decrypt(h,e)},d.decrypt=function(u,f){return new Promise(function(t){var h=u.audioTrack,e=u.videoTrack;h.samples&&h.segmentCodec==="aac"?f.decryptAacSamples(h.samples,0,function(){e.samples?f.decryptAvcSamples(e.samples,0,0,function(){t(u)}):t(u)}):e.samples&&f.decryptAvcSamples(e.samples,0,0,function(){t(u)})})},d.destroy=function(){this._duration=0},d.parseAVCPES=function(u,f,t,h){var e=this,y=this.parseAVCNALu(u,t.data),P=this.avcSample,S,w=!1;t.data=null,P&&y.length&&!u.audFound&&(m(P,u),P=this.avcSample=v(!1,t.pts,t.dts,"")),y.forEach(function(k){switch(k.type){case 1:{S=!0,P||(P=e.avcSample=v(!0,t.pts,t.dts,"")),P.frame=!0;var F=k.data;if(w&&F.length>4){var U=new b.default(F).readSliceType();(U===2||U===4||U===7||U===9)&&(P.key=!0)}break}case 5:S=!0,P||(P=e.avcSample=v(!0,t.pts,t.dts,"")),P.key=!0,P.frame=!0;break;case 6:{S=!0,(0,x.parseSEIMessageFromNALu)(k.data,1,t.pts,f.samples);break}case 7:if(S=!0,w=!0,!u.sps){var N=new b.default(k.data),j=N.readSPS();u.width=j.width,u.height=j.height,u.pixelRatio=j.pixelRatio,u.sps=[k.data],u.duration=e._duration;for(var W=k.data.subarray(1,4),H="avc1.",G=0;G<3;G++){var V=W[G].toString(16);V.length<2&&(V="0"+V),H+=V}u.codec=H}break;case 8:S=!0,u.pps||(u.pps=[k.data]);break;case 9:S=!1,u.audFound=!0,P&&m(P,u),P=e.avcSample=v(!1,t.pts,t.dts,"");break;case 12:S=!0;break;default:S=!1,P&&(P.debug+="unknown NAL "+k.type+" ");break}if(P&&S){var Y=P.units;Y.push(k)}}),h&&P&&(m(P,u),this.avcSample=null)},d.getLastNalUnit=function(u){var f,t=this.avcSample,h;if((!t||t.units.length===0)&&(t=u[u.length-1]),(f=t)!==null&&f!==void 0&&f.units){var e=t.units;h=e[e.length-1]}return h},d.parseAVCNALu=function(u,f){var t=f.byteLength,h=u.naluState||0,e=h,y=[],P=0,S,w,k,F=-1,U=0;for(h===-1&&(F=0,U=f[0]&31,h=0,P=1);P<t;){if(S=f[P++],!h){h=S?0:1;continue}if(h===1){h=S?0:2;continue}if(!S)h=3;else if(S===1){if(F>=0){var N={data:f.subarray(F,P-h-1),type:U};y.push(N)}else{var j=this.getLastNalUnit(u.samples);if(j&&(e&&P<=4-e&&j.state&&(j.data=j.data.subarray(0,j.data.byteLength-e)),w=P-h-1,w>0)){var W=new Uint8Array(j.data.byteLength+w);W.set(j.data,0),W.set(f.subarray(0,w),j.data.byteLength),j.data=W,j.state=0}}P<t?(k=f[P]&31,F=P,U=k,h=0):h=-1}else h=0}if(F>=0&&h>=0){var H={data:f.subarray(F,t),type:U,state:h};y.push(H)}if(y.length===0){var G=this.getLastNalUnit(u.samples);if(G){var V=new Uint8Array(G.data.byteLength+f.byteLength);V.set(G.data,0),V.set(f,G.data.byteLength),G.data=V}}return u.naluState=h,y},d.parseAACPES=function(u,f){var t=0,h=this.aacOverFlow,e=f.data;if(h){this.aacOverFlow=null;var y=h.missing,P=h.sample.unit.byteLength;if(y===-1){var S=new Uint8Array(P+e.byteLength);S.set(h.sample.unit,0),S.set(e,P),e=S}else{var w=P-y;h.sample.unit.set(e.subarray(0,y),w),u.samples.push(h.sample),t=h.missing}}var k,F;for(k=t,F=e.length;k<F-1&&!D.isHeader(e,k);k++);if(k!==t){var U,N;if(k<F-1?(U="AAC PES did not start with ADTS header,offset:"+k,N=!1):(U="no ADTS header found in AAC PES",N=!0),E.logger.warn("parsing error:"+U),this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:N,reason:U}),N)return}D.initTrackConfig(u,this.observer,e,k,this.audioCodec);var j;if(f.pts!==void 0)j=f.pts;else if(h){var W=D.getFrameDuration(u.samplerate);j=h.sample.pts+W}else{E.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var H=0,G;k<F;)if(G=D.appendFrame(u,e,k,j,H),k+=G.length,G.missing){this.aacOverFlow=G;break}else for(H++;k<F-1&&!D.isHeader(e,k);k++);},d.parseMPEGPES=function(u,f){var t=f.data,h=t.length,e=0,y=0,P=f.pts;if(P===void 0){E.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;y<h;)if(g.isHeader(t,y)){var S=g.appendFrame(u,t,y,P,e);if(S)y+=S.length,e++;else break}else y++},d.parseID3PES=function(u,f){if(f.pts===void 0){E.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var t=I({},f,{type:this._avcTrack?L.MetadataSchema.emsg:L.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});u.samples.push(t)},o}();function v(o,d,A,u){return{key:o,frame:!1,pts:d,dts:A,units:[],debug:u,length:0}}function n(o,d){return((o[d+1]&31)<<8)+o[d+2]}function l(o,d){return(o[d+10]&31)<<8|o[d+11]}function i(o,d,A,u){var f={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},t=(o[d+1]&15)<<8|o[d+2],h=d+3+t-4,e=(o[d+10]&15)<<8|o[d+11];for(d+=12+e;d<h;){var y=n(o,d);switch(o[d]){case 207:if(!u){E.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:f.audio===-1&&(f.audio=y);break;case 21:f.id3===-1&&(f.id3=y);break;case 219:if(!u){E.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:f.avc===-1&&(f.avc=y);break;case 3:case 4:A.mpeg!==!0&&A.mp3!==!0?E.logger.log("MPEG audio found, not supported in this browser"):f.audio===-1&&(f.audio=y,f.segmentCodec="mp3");break;case 36:E.logger.warn("Unsupported HEVC stream type found");break}d+=((o[d+3]&15)<<8|o[d+4])+5}return f}function a(o){var d=0,A,u,f,t,h,e=o.data;if(!o||o.size===0)return null;for(;e[0].length<19&&e.length>1;){var y=new Uint8Array(e[0].length+e[1].length);y.set(e[0]),y.set(e[1],e[0].length),e[0]=y,e.splice(1,1)}A=e[0];var P=(A[0]<<16)+(A[1]<<8)+A[2];if(P===1){if(u=(A[4]<<8)+A[5],u&&u>o.size-6)return null;var S=A[7];S&192&&(t=(A[9]&14)*536870912+(A[10]&255)*4194304+(A[11]&254)*16384+(A[12]&255)*128+(A[13]&254)/2,S&64?(h=(A[14]&14)*536870912+(A[15]&255)*4194304+(A[16]&254)*16384+(A[17]&255)*128+(A[18]&254)/2,t-h>54e5&&(E.logger.warn(Math.round((t-h)/9e4)+"s delta between PTS and DTS, align them"),t=h)):h=t),f=A[8];var w=f+9;if(o.size<=w)return null;o.size-=w;for(var k=new Uint8Array(o.size),F=0,U=e.length;F<U;F++){A=e[F];var N=A.byteLength;if(w)if(w>N){w-=N;continue}else A=A.subarray(w),N-=w,w=0;k.set(A,d),d+=N}return u&&(u-=f+3),{data:k,pts:t,dts:h,len:u}}return null}function m(o,d){if(o.units.length&&o.frame){if(o.pts===void 0){var A=d.samples,u=A.length;if(u){var f=A[u-1];o.pts=f.pts,o.dts=f.dts}else{d.dropped++;return}}d.samples.push(o)}o.debug.length&&E.logger.log(o.pts+"/"+o.dts+":"+o.debug)}const p=_},"./src/demux/webworkify-webpack.js":(O,R,s)=>{s.r(R),s.d(R,{default:()=>r});var D=function(){var v=ENTRY_MODULE,n={},l=function a(m){var p=n[m];if(p!==void 0)return p.exports;var o=n[m]={exports:{}};return v[m].call(o.exports,o,o.exports,a),o.exports};l.m=v,function(){l.n=function(a){var m=a&&a.__esModule?function(){return a.default}:function(){return a};return l.d(m,{a:m}),m}}(),function(){l.d=function(a,m){for(var p in m)l.o(m,p)&&!l.o(a,p)&&Object.defineProperty(a,p,{enumerable:!0,get:m[p]})}}(),function(){l.o=function(a,m){return Object.prototype.hasOwnProperty.call(a,m)}}(),function(){l.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})}}();var i=l(ENTRY_MODULE);return i.default||i},g=D.toString().split("ENTRY_MODULE"),b="[\\.|\\-|\\+|\\w|/|@]+",c="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+b+").*?\\)";function C(_){return(_+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function x(_){return!isNaN(1*_)}function E(_,v,n){var l={};l[n]=[];var i=v.toString().replace(/^"[^"]+"/,"function"),a=i.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||i.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!a)return l;for(var m=a[1],p=new RegExp("(\\\\n|\\W)"+C(m)+c,"g"),o;o=p.exec(i);)o[3]!=="dll-reference"&&l[n].push(o[3]);for(p=new RegExp("\\("+C(m)+'\\("(dll-reference\\s('+b+'))"\\)\\)'+c,"g");o=p.exec(i);)_[o[2]]||(l[n].push(o[1]),_[o[2]]=s(o[1]).m),l[o[2]]=l[o[2]]||[],l[o[2]].push(o[4]);for(var d=Object.keys(l),A=0;A<d.length;A++)for(var u=0;u<l[d[A]].length;u++)x(l[d[A]][u])&&(l[d[A]][u]=1*l[d[A]][u]);return l}function T(_){var v=Object.keys(_);return v.reduce(function(n,l){return n||_[l].length>0},!1)}function L(_,v){for(var n={main:[v]},l={main:[]},i={main:{}};T(n);)for(var a=Object.keys(n),m=0;m<a.length;m++){var p=a[m],o=n[p],d=o.pop();if(i[p]=i[p]||{},!(i[p][d]||!_[p][d])){i[p][d]=!0,l[p]=l[p]||[],l[p].push(d);for(var A=E(_,_[p][d],p),u=Object.keys(A),f=0;f<u.length;f++)n[u[f]]=n[u[f]]||[],n[u[f]]=n[u[f]].concat(A[u[f]])}}return l}function I(_,v,n,l){var i=_[l].map(function(a){return'"'+a+'": '+v[l][a].toString().replace(/^"[^"]+"/,"function")}).join(",");return g[0]+"{"+i+"}"+g[1]+'"'+n+'"'+g[2]}function r(_,v){v=v||{};var n={main:s.m},l=v.all?{main:Object.keys(n.main)}:L(n,_),i="";Object.keys(l).filter(function(d){return d!=="main"}).forEach(function(d){for(var A=0;l[d][A];)A++;l[d].push(A),n[d][A]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",i=i+("var "+d+" = ("+I(l,n,A,modules)+`)();
`)}),i=i+("new (("+I(l,n,_,"main")+")())(self);");var a=new window.Blob([i],{type:"text/javascript"}),m=window.URL||window.webkitURL||window.mozURL||window.msURL,p=m.createObjectURL(a),o=new window.Worker(p);return o.objectURL=p,o}},"./src/errors.ts":(O,R,s)=>{s.r(R),s.d(R,{ErrorDetails:()=>g,ErrorTypes:()=>D});var D;(function(b){b.NETWORK_ERROR="networkError",b.MEDIA_ERROR="mediaError",b.KEY_SYSTEM_ERROR="keySystemError",b.MUX_ERROR="muxError",b.OTHER_ERROR="otherError"})(D||(D={}));var g;(function(b){b.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",b.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",b.KEY_SYSTEM_NO_SESSION="keySystemNoSession",b.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",b.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",b.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",b.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",b.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",b.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",b.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",b.MANIFEST_LOAD_ERROR="manifestLoadError",b.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",b.MANIFEST_PARSING_ERROR="manifestParsingError",b.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",b.LEVEL_EMPTY_ERROR="levelEmptyError",b.LEVEL_LOAD_ERROR="levelLoadError",b.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",b.LEVEL_SWITCH_ERROR="levelSwitchError",b.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",b.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",b.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",b.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",b.FRAG_LOAD_ERROR="fragLoadError",b.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",b.FRAG_DECRYPT_ERROR="fragDecryptError",b.FRAG_PARSING_ERROR="fragParsingError",b.REMUX_ALLOC_ERROR="remuxAllocError",b.KEY_LOAD_ERROR="keyLoadError",b.KEY_LOAD_TIMEOUT="keyLoadTimeOut",b.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",b.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",b.BUFFER_APPEND_ERROR="bufferAppendError",b.BUFFER_APPENDING_ERROR="bufferAppendingError",b.BUFFER_STALLED_ERROR="bufferStalledError",b.BUFFER_FULL_ERROR="bufferFullError",b.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",b.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",b.INTERNAL_EXCEPTION="internalException",b.INTERNAL_ABORTED="aborted",b.UNKNOWN="unknown"})(g||(g={}))},"./src/events.ts":(O,R,s)=>{s.r(R),s.d(R,{Events:()=>D});var D;(function(g){g.MEDIA_ATTACHING="hlsMediaAttaching",g.MEDIA_ATTACHED="hlsMediaAttached",g.MEDIA_DETACHING="hlsMediaDetaching",g.MEDIA_DETACHED="hlsMediaDetached",g.BUFFER_RESET="hlsBufferReset",g.BUFFER_CODECS="hlsBufferCodecs",g.BUFFER_CREATED="hlsBufferCreated",g.BUFFER_APPENDING="hlsBufferAppending",g.BUFFER_APPENDED="hlsBufferAppended",g.BUFFER_EOS="hlsBufferEos",g.BUFFER_FLUSHING="hlsBufferFlushing",g.BUFFER_FLUSHED="hlsBufferFlushed",g.MANIFEST_LOADING="hlsManifestLoading",g.MANIFEST_LOADED="hlsManifestLoaded",g.MANIFEST_PARSED="hlsManifestParsed",g.LEVEL_SWITCHING="hlsLevelSwitching",g.LEVEL_SWITCHED="hlsLevelSwitched",g.LEVEL_LOADING="hlsLevelLoading",g.LEVEL_LOADED="hlsLevelLoaded",g.LEVEL_UPDATED="hlsLevelUpdated",g.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",g.LEVELS_UPDATED="hlsLevelsUpdated",g.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",g.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",g.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",g.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",g.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",g.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",g.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",g.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",g.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",g.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",g.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",g.CUES_PARSED="hlsCuesParsed",g.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",g.INIT_PTS_FOUND="hlsInitPtsFound",g.FRAG_LOADING="hlsFragLoading",g.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",g.FRAG_LOADED="hlsFragLoaded",g.FRAG_DECRYPTED="hlsFragDecrypted",g.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",g.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",g.FRAG_PARSING_METADATA="hlsFragParsingMetadata",g.FRAG_PARSED="hlsFragParsed",g.FRAG_BUFFERED="hlsFragBuffered",g.FRAG_CHANGED="hlsFragChanged",g.FPS_DROP="hlsFpsDrop",g.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",g.ERROR="hlsError",g.DESTROYING="hlsDestroying",g.KEY_LOADING="hlsKeyLoading",g.KEY_LOADED="hlsKeyLoaded",g.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",g.BACK_BUFFER_REACHED="hlsBackBufferReached"})(D||(D={}))},"./src/hls.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>o});var D=s("./node_modules/url-toolkit/src/url-toolkit.js"),g=s("./src/loader/playlist-loader.ts"),b=s("./src/controller/id3-track-controller.ts"),c=s("./src/controller/latency-controller.ts"),C=s("./src/controller/level-controller.ts"),x=s("./src/controller/fragment-tracker.ts"),E=s("./src/loader/key-loader.ts"),T=s("./src/controller/stream-controller.ts"),L=s("./src/is-supported.ts"),I=s("./src/utils/logger.ts"),r=s("./src/config.ts"),_=s("./node_modules/eventemitter3/index.js"),v=s("./src/events.ts"),n=s("./src/errors.ts"),l=s("./src/types/level.ts");function i(d,A){for(var u=0;u<A.length;u++){var f=A[u];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(d,m(f.key),f)}}function a(d,A,u){return A&&i(d.prototype,A),u&&i(d,u),Object.defineProperty(d,"prototype",{writable:!1}),d}function m(d){var A=p(d,"string");return typeof A=="symbol"?A:String(A)}function p(d,A){if(typeof d!="object"||d===null)return d;var u=d[Symbol.toPrimitive];if(u!==void 0){var f=u.call(d,A||"default");if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(d)}var o=function(){d.isSupported=function(){return(0,L.isSupported)()};function d(u){u===void 0&&(u={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new _.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var f=this.config=(0,r.mergeConfig)(d.DefaultConfig,u);this.userConfig=u,(0,I.enableLogs)(f.debug,"Hls instance"),this._autoLevelCapping=-1,f.progressive&&(0,r.enableStreamingMode)(f);var t=f.abrController,h=f.bufferController,e=f.capLevelController,y=f.fpsController,P=this.abrController=new t(this),S=this.bufferController=new h(this),w=this.capLevelController=new e(this),k=new y(this),F=new g.default(this),U=new b.default(this),N=this.levelController=new C.default(this),j=new x.FragmentTracker(this),W=new E.default(this.config),H=this.streamController=new T.default(this,j,W);w.setStreamController(H),k.setStreamController(H);var G=[F,N,H];this.networkControllers=G;var V=[P,S,w,k,U,j];this.audioTrackController=this.createController(f.audioTrackController,G);var Y=f.audioStreamController;Y&&G.push(new Y(this,j,W)),this.subtitleTrackController=this.createController(f.subtitleTrackController,G);var Q=f.subtitleStreamController;Q&&G.push(new Q(this,j,W)),this.createController(f.timelineController,V),W.emeController=this.emeController=this.createController(f.emeController,V),this.cmcdController=this.createController(f.cmcdController,V),this.latencyController=this.createController(c.default,V),this.coreComponents=V}var A=d.prototype;return A.createController=function(f,t){if(f){var h=new f(this);return t&&t.push(h),h}return null},A.on=function(f,t,h){h===void 0&&(h=this),this._emitter.on(f,t,h)},A.once=function(f,t,h){h===void 0&&(h=this),this._emitter.once(f,t,h)},A.removeAllListeners=function(f){this._emitter.removeAllListeners(f)},A.off=function(f,t,h,e){h===void 0&&(h=this),this._emitter.off(f,t,h,e)},A.listeners=function(f){return this._emitter.listeners(f)},A.emit=function(f,t,h){return this._emitter.emit(f,t,h)},A.trigger=function(f,t){if(this.config.debug)return this.emit(f,f,t);try{return this.emit(f,f,t)}catch(h){I.logger.error("An internal error happened while handling event "+f+'. Error message: "'+h.message+'". Here is a stacktrace:',h),this.trigger(v.Events.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:f,error:h})}return!1},A.listenerCount=function(f){return this._emitter.listenerCount(f)},A.destroy=function(){I.logger.log("destroy"),this.trigger(v.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(f){return f.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(f){return f.destroy()}),this.coreComponents.length=0},A.attachMedia=function(f){I.logger.log("attachMedia"),this._media=f,this.trigger(v.Events.MEDIA_ATTACHING,{media:f})},A.detachMedia=function(){I.logger.log("detachMedia"),this.trigger(v.Events.MEDIA_DETACHING,void 0),this._media=null},A.loadSource=function(f){this.stopLoad();var t=this.media,h=this.url,e=this.url=D.buildAbsoluteURL(self.location.href,f,{alwaysNormalize:!0});I.logger.log("loadSource:"+e),t&&h&&h!==e&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(v.Events.MANIFEST_LOADING,{url:f})},A.startLoad=function(f){f===void 0&&(f=-1),I.logger.log("startLoad("+f+")"),this.networkControllers.forEach(function(t){t.startLoad(f)})},A.stopLoad=function(){I.logger.log("stopLoad"),this.networkControllers.forEach(function(f){f.stopLoad()})},A.swapAudioCodec=function(){I.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},A.recoverMediaError=function(){I.logger.log("recoverMediaError");var f=this._media;this.detachMedia(),f&&this.attachMedia(f)},A.removeLevel=function(f,t){t===void 0&&(t=0),this.levelController.removeLevel(f,t)},a(d,[{key:"levels",get:function(){var f=this.levelController.levels;return f||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(f){I.logger.log("set currentLevel:"+f),this.loadLevel=f,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(f){I.logger.log("set nextLevel:"+f),this.levelController.manualLevel=f,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(f){I.logger.log("set loadLevel:"+f),this.levelController.manualLevel=f}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(f){this.levelController.nextLoadLevel=f}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(f){I.logger.log("set firstLevel:"+f),this.levelController.firstLevel=f}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(f){I.logger.log("set startLevel:"+f),f!==-1&&(f=Math.max(f,this.minAutoLevel)),this.levelController.startLevel=f}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(f){var t=!!f;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(f){this._autoLevelCapping!==f&&(I.logger.log("set autoLevelCapping:"+f),this._autoLevelCapping=f)}},{key:"bandwidthEstimate",get:function(){var f=this.abrController.bwEstimator;return f?f.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(f){l.HdcpLevels.indexOf(f)>-1&&(this._maxHdcpLevel=f)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var f=this.levels,t=this.config.minAutoBitrate;if(!f)return 0;for(var h=f.length,e=0;e<h;e++)if(f[e].maxBitrate>=t)return e;return 0}},{key:"maxAutoLevel",get:function(){var f=this.levels,t=this.autoLevelCapping,h=this.maxHdcpLevel,e;if(t===-1&&f&&f.length?e=f.length-1:e=t,h)for(var y=e;y--;){var P=f[y].attrs["HDCP-LEVEL"];if(P&&P<=h)return y}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(f){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,f)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var f=this.audioTrackController;return f?f.audioTracks:[]}},{key:"audioTrack",get:function(){var f=this.audioTrackController;return f?f.audioTrack:-1},set:function(f){var t=this.audioTrackController;t&&(t.audioTrack=f)}},{key:"subtitleTracks",get:function(){var f=this.subtitleTrackController;return f?f.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var f=this.subtitleTrackController;return f?f.subtitleTrack:-1},set:function(f){var t=this.subtitleTrackController;t&&(t.subtitleTrack=f)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var f=this.subtitleTrackController;return f?f.subtitleDisplay:!1},set:function(f){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=f)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(f){this.config.lowLatencyMode=f}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.4"}},{key:"Events",get:function(){return v.Events}},{key:"ErrorTypes",get:function(){return n.ErrorTypes}},{key:"ErrorDetails",get:function(){return n.ErrorDetails}},{key:"DefaultConfig",get:function(){return d.defaultConfig?d.defaultConfig:r.hlsDefaultConfig},set:function(f){d.defaultConfig=f}}]),d}();o.defaultConfig=void 0},"./src/is-supported.ts":(O,R,s)=>{s.r(R),s.d(R,{changeTypeSupported:()=>c,isSupported:()=>b});var D=s("./src/utils/mediasource-helper.ts");function g(){return self.SourceBuffer||self.WebKitSourceBuffer}function b(){var C=(0,D.getMediaSource)();if(!C)return!1;var x=g(),E=C&&typeof C.isTypeSupported=="function"&&C.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),T=!x||x.prototype&&typeof x.prototype.appendBuffer=="function"&&typeof x.prototype.remove=="function";return!!E&&!!T}function c(){var C,x=g();return typeof(x==null||(C=x.prototype)===null||C===void 0?void 0:C.changeType)=="function"}},"./src/loader/date-range.ts":(O,R,s)=>{s.r(R),s.d(R,{DateRange:()=>I,DateRangeAttribute:()=>L});var D=s("./src/polyfills/number.ts"),g=s("./src/utils/attr-list.ts"),b=s("./src/utils/logger.ts");function c(){return c=Object.assign?Object.assign.bind():function(r){for(var _=1;_<arguments.length;_++){var v=arguments[_];for(var n in v)Object.prototype.hasOwnProperty.call(v,n)&&(r[n]=v[n])}return r},c.apply(this,arguments)}function C(r,_){for(var v=0;v<_.length;v++){var n=_[v];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,E(n.key),n)}}function x(r,_,v){return _&&C(r.prototype,_),v&&C(r,v),Object.defineProperty(r,"prototype",{writable:!1}),r}function E(r){var _=T(r,"string");return typeof _=="symbol"?_:String(_)}function T(r,_){if(typeof r!="object"||r===null)return r;var v=r[Symbol.toPrimitive];if(v!==void 0){var n=v.call(r,_||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(r)}var L;(function(r){r.ID="ID",r.CLASS="CLASS",r.START_DATE="START-DATE",r.DURATION="DURATION",r.END_DATE="END-DATE",r.END_ON_NEXT="END-ON-NEXT",r.PLANNED_DURATION="PLANNED-DURATION",r.SCTE35_OUT="SCTE35-OUT",r.SCTE35_IN="SCTE35-IN"})(L||(L={}));var I=function(){function r(_,v){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,v){var n=v.attr;for(var l in n)if(Object.prototype.hasOwnProperty.call(_,l)&&_[l]!==n[l]){b.logger.warn('DATERANGE tag attribute: "'+l+'" does not match for tags with ID: "'+_.ID+'"'),this._badValueForSameId=l;break}_=c(new g.AttrList({}),n,_)}if(this.attr=_,this._startDate=new Date(_[L.START_DATE]),L.END_DATE in this.attr){var i=new Date(this.attr[L.END_DATE]);(0,D.isFiniteNumber)(i.getTime())&&(this._endDate=i)}}return x(r,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var v=this.duration;return v!==null?new Date(this._startDate.getTime()+v*1e3):null}},{key:"duration",get:function(){if(L.DURATION in this.attr){var v=this.attr.decimalFloatingPoint(L.DURATION);if((0,D.isFiniteNumber)(v))return v}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return L.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(L.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(L.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,D.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),r}()},"./src/loader/fragment-loader.ts":(O,R,s)=>{s.r(R),s.d(R,{LoadError:()=>v,default:()=>r});var D=s("./src/polyfills/number.ts"),g=s("./src/errors.ts");function b(n,l){n.prototype=Object.create(l.prototype),n.prototype.constructor=n,T(n,l)}function c(n){var l=typeof Map=="function"?new Map:void 0;return c=function(a){if(a===null||!E(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof l<"u"){if(l.has(a))return l.get(a);l.set(a,m)}function m(){return C(a,arguments,L(this).constructor)}return m.prototype=Object.create(a.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),T(m,a)},c(n)}function C(n,l,i){return x()?C=Reflect.construct.bind():C=function(m,p,o){var d=[null];d.push.apply(d,p);var A=Function.bind.apply(m,d),u=new A;return o&&T(u,o.prototype),u},C.apply(null,arguments)}function x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function E(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function T(n,l){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,m){return a.__proto__=m,a},T(n,l)}function L(n){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},L(n)}var I=Math.pow(2,17),r=function(){function n(i){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=i}var l=n.prototype;return l.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},l.abort=function(){this.loader&&this.loader.abort()},l.load=function(a,m){var p=this,o=a.url;if(!o)return Promise.reject(new v({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,networkDetails:null},"Fragment does not have a "+(o?"part list":"url")));this.abort();var d=this.config,A=d.fLoader,u=d.loader;return new Promise(function(f,t){p.loader&&p.loader.destroy();var h=p.loader=a.loader=A?new A(d):new u(d),e=_(a),y={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:d.fragLoadingMaxRetryTimeout,highWaterMark:a.sn==="initSegment"?1/0:I};a.stats=h.stats,h.load(e,y,{onSuccess:function(S,w,k,F){p.resetLoader(a,h);var U=S.data;k.resetIV&&a.decryptdata&&(a.decryptdata.iv=new Uint8Array(U.slice(0,16)),U=U.slice(16)),f({frag:a,part:null,payload:U,networkDetails:F})},onError:function(S,w,k){p.resetLoader(a,h),t(new v({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,response:S,networkDetails:k}))},onAbort:function(S,w,k){p.resetLoader(a,h),t(new v({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,networkDetails:k}))},onTimeout:function(S,w,k){p.resetLoader(a,h),t(new v({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,networkDetails:k}))},onProgress:function(S,w,k,F){m&&m({frag:a,part:null,payload:k,networkDetails:F})}})})},l.loadPart=function(a,m,p){var o=this;this.abort();var d=this.config,A=d.fLoader,u=d.loader;return new Promise(function(f,t){o.loader&&o.loader.destroy();var h=o.loader=a.loader=A?new A(d):new u(d),e=_(a,m),y={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:d.fragLoadingMaxRetryTimeout,highWaterMark:I};m.stats=h.stats,h.load(e,y,{onSuccess:function(S,w,k,F){o.resetLoader(a,h),o.updateStatsFromPart(a,m);var U={frag:a,part:m,payload:S.data,networkDetails:F};p(U),f(U)},onError:function(S,w,k){o.resetLoader(a,h),t(new v({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,part:m,response:S,networkDetails:k}))},onAbort:function(S,w,k){a.stats.aborted=m.stats.aborted,o.resetLoader(a,h),t(new v({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,part:m,networkDetails:k}))},onTimeout:function(S,w,k){o.resetLoader(a,h),t(new v({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,part:m,networkDetails:k}))}})})},l.updateStatsFromPart=function(a,m){var p=a.stats,o=m.stats,d=o.total;if(p.loaded+=o.loaded,d){var A=Math.round(a.duration/m.duration),u=Math.min(Math.round(p.loaded/d),A),f=A-u,t=f*Math.round(p.loaded/u);p.total=p.loaded+t}else p.total=Math.max(p.loaded,p.total);var h=p.loading,e=o.loading;h.start?h.first+=e.first-e.start:(h.start=e.start,h.first=e.first),h.end=e.end},l.resetLoader=function(a,m){a.loader=null,this.loader===m&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),m.destroy()},n}();function _(n,l){l===void 0&&(l=null);var i=l||n,a={frag:n,part:l,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},m=i.byteRangeStartOffset,p=i.byteRangeEndOffset;if((0,D.isFiniteNumber)(m)&&(0,D.isFiniteNumber)(p)){var o,d=m,A=p;if(n.sn==="initSegment"&&((o=n.decryptdata)===null||o===void 0?void 0:o.method)==="AES-128"){var u=p-m;u%16&&(A=p+(16-u%16)),m!==0&&(a.resetIV=!0,d=m-16)}a.rangeStart=d,a.rangeEnd=A}return a}var v=function(n){b(l,n);function l(i){for(var a,m=arguments.length,p=new Array(m>1?m-1:0),o=1;o<m;o++)p[o-1]=arguments[o];return a=n.call.apply(n,[this].concat(p))||this,a.data=void 0,a.data=i,a}return l}(c(Error))},"./src/loader/fragment.ts":(O,R,s)=>{s.r(R),s.d(R,{BaseSegment:()=>r,ElementaryStreamTypes:()=>I,Fragment:()=>_,Part:()=>v});var D=s("./src/polyfills/number.ts"),g=s("./node_modules/url-toolkit/src/url-toolkit.js"),b=s("./src/loader/load-stats.ts");function c(n,l){n.prototype=Object.create(l.prototype),n.prototype.constructor=n,C(n,l)}function C(n,l){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,m){return a.__proto__=m,a},C(n,l)}function x(n,l){for(var i=0;i<l.length;i++){var a=l[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,T(a.key),a)}}function E(n,l,i){return l&&x(n.prototype,l),i&&x(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}function T(n){var l=L(n,"string");return typeof l=="symbol"?l:String(l)}function L(n,l){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,l||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(n)}var I;(function(n){n.AUDIO="audio",n.VIDEO="video",n.AUDIOVIDEO="audiovideo"})(I||(I={}));var r=function(){function n(i){var a;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(a={},a[I.AUDIO]=null,a[I.VIDEO]=null,a[I.AUDIOVIDEO]=null,a),this.baseurl=i}var l=n.prototype;return l.setByteRange=function(a,m){var p=a.split("@",2),o=[];p.length===1?o[0]=m?m.byteRangeEndOffset:0:o[0]=parseInt(p[1]),o[1]=parseInt(p[0])+o[0],this._byteRange=o},E(n,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,g.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(a){this._url=a}}]),n}(),_=function(n){c(l,n);function l(a,m){var p;return p=n.call(this,m)||this,p._decryptdata=null,p.rawProgramDateTime=null,p.programDateTime=null,p.tagList=[],p.duration=0,p.sn=0,p.levelkeys=void 0,p.type=void 0,p.loader=null,p.keyLoader=null,p.level=-1,p.cc=0,p.startPTS=void 0,p.endPTS=void 0,p.appendedPTS=void 0,p.startDTS=void 0,p.endDTS=void 0,p.start=0,p.deltaPTS=void 0,p.maxStartPTS=void 0,p.minEndPTS=void 0,p.stats=new b.LoadStats,p.urlId=0,p.data=void 0,p.bitrateTest=!1,p.title=null,p.initSegment=null,p.endList=void 0,p.type=a,p}var i=l.prototype;return i.setKeyFormat=function(m){if(this.levelkeys){var p=this.levelkeys[m];p&&!this._decryptdata&&(this._decryptdata=p.getDecryptData(this.sn))}},i.abortRequests=function(){var m,p;(m=this.loader)===null||m===void 0||m.abort(),(p=this.keyLoader)===null||p===void 0||p.abort()},i.setElementaryStreamInfo=function(m,p,o,d,A,u){u===void 0&&(u=!1);var f=this.elementaryStreams,t=f[m];if(!t){f[m]={startPTS:p,endPTS:o,startDTS:d,endDTS:A,partial:u};return}t.startPTS=Math.min(t.startPTS,p),t.endPTS=Math.max(t.endPTS,o),t.startDTS=Math.min(t.startDTS,d),t.endDTS=Math.max(t.endDTS,A)},i.clearElementaryStreamInfo=function(){var m=this.elementaryStreams;m[I.AUDIO]=null,m[I.VIDEO]=null,m[I.AUDIOVIDEO]=null},E(l,[{key:"decryptdata",get:function(){var m=this.levelkeys;if(!m&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var p=this.levelkeys.identity;if(p)this._decryptdata=p.getDecryptData(this.sn);else{var o=Object.keys(this.levelkeys);if(o.length===1)return this._decryptdata=this.levelkeys[o[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,D.isFiniteNumber)(this.programDateTime))return null;var m=(0,D.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+m*1e3}},{key:"encrypted",get:function(){var m;if((m=this._decryptdata)!==null&&m!==void 0&&m.encrypted)return!0;if(this.levelkeys){var p=Object.keys(this.levelkeys),o=p.length;if(o>1||o===1&&this.levelkeys[p[0]].encrypted)return!0}return!1}}]),l}(r),v=function(n){c(l,n);function l(i,a,m,p,o){var d;d=n.call(this,m)||this,d.fragOffset=0,d.duration=0,d.gap=!1,d.independent=!1,d.relurl=void 0,d.fragment=void 0,d.index=void 0,d.stats=new b.LoadStats,d.duration=i.decimalFloatingPoint("DURATION"),d.gap=i.bool("GAP"),d.independent=i.bool("INDEPENDENT"),d.relurl=i.enumeratedString("URI"),d.fragment=a,d.index=p;var A=i.enumeratedString("BYTERANGE");return A&&d.setByteRange(A,o),o&&(d.fragOffset=o.fragOffset+o.duration),d}return E(l,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var a=this.elementaryStreams;return!!(a.audio||a.video||a.audiovideo)}}]),l}(r)},"./src/loader/key-loader.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>b});var D=s("./src/errors.ts"),g=s("./src/loader/fragment-loader.ts"),b=function(){function c(x){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=x}var C=c.prototype;return C.abort=function(){for(var E in this.keyUriToKeyInfo){var T=this.keyUriToKeyInfo[E].loader;T&&T.abort()}},C.detach=function(){for(var E in this.keyUriToKeyInfo){var T=this.keyUriToKeyInfo[E];(T.mediaKeySessionContext||T.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[E]}},C.destroy=function(){this.detach();for(var E in this.keyUriToKeyInfo){var T=this.keyUriToKeyInfo[E].loader;T&&T.destroy()}this.keyUriToKeyInfo={}},C.createKeyLoadError=function(E,T,L,I){return T===void 0&&(T=D.ErrorDetails.KEY_LOAD_ERROR),new g.LoadError({type:D.ErrorTypes.NETWORK_ERROR,details:T,fatal:!1,frag:E,networkDetails:L})},C.loadClear=function(E,T){var L=this;if(this.emeController&&this.config.emeEnabled)for(var I=E.sn,r=E.cc,_=function(i){var a=T[i];if(r<=a.cc&&(I==="initSegment"||I<a.sn))return L.emeController.selectKeySystemFormat(a).then(function(m){a.setKeyFormat(m)}),"break"},v=0;v<T.length;v++){var n=_(v);if(n==="break")break}},C.load=function(E){var T=this;return!E.decryptdata&&E.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(E).then(function(L){return T.loadInternal(E,L)}):this.loadInternal(E)},C.loadInternal=function(E,T){var L,I;T&&E.setKeyFormat(T);var r=E.decryptdata;if(!r){var _=T?"Expected frag.decryptdata to be defined after setting format "+T:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(E,D.ErrorDetails.KEY_LOAD_ERROR,null,_))}var v=r.uri;if(!v)return Promise.reject(this.createKeyLoadError(E,D.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+v+'"'));var n=this.keyUriToKeyInfo[v];if((L=n)!==null&&L!==void 0&&L.decryptdata.key)return r.key=n.decryptdata.key,Promise.resolve({frag:E,keyInfo:n});if((I=n)!==null&&I!==void 0&&I.keyLoadPromise){var l;switch((l=n.mediaKeySessionContext)===null||l===void 0?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return n.keyLoadPromise.then(function(i){return r.key=i.keyInfo.decryptdata.key,{frag:E,keyInfo:n}})}}switch(n=this.keyUriToKeyInfo[v]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(n,E):this.loadKeyEME(n,E);case"AES-128":return this.loadKeyHTTP(n,E);default:return Promise.reject(this.createKeyLoadError(E,D.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+r.method+'"'))}},C.loadKeyEME=function(E,T){var L={frag:T,keyInfo:E};if(this.emeController&&this.config.emeEnabled){var I=this.emeController.loadKey(L);if(I)return(E.keyLoadPromise=I.then(function(r){return E.mediaKeySessionContext=r,L})).catch(function(r){throw E.keyLoadPromise=null,r})}return Promise.resolve(L)},C.loadKeyHTTP=function(E,T){var L=this,I=this.config,r=I.loader,_=new r(I);return T.keyLoader=E.loader=_,E.keyLoadPromise=new Promise(function(v,n){var l={keyInfo:E,frag:T,responseType:"arraybuffer",url:E.decryptdata.uri},i={timeout:I.fragLoadingTimeOut,maxRetry:0,retryDelay:I.fragLoadingRetryDelay,maxRetryDelay:I.fragLoadingMaxRetryTimeout,highWaterMark:0},a={onSuccess:function(p,o,d,A){var u=d.frag,f=d.keyInfo,t=d.url;if(!u.decryptdata||f!==L.keyUriToKeyInfo[t])return n(L.createKeyLoadError(u,D.ErrorDetails.KEY_LOAD_ERROR,A,"after key load, decryptdata unset or changed"));f.decryptdata.key=u.decryptdata.key=new Uint8Array(p.data),u.keyLoader=null,f.loader=null,v({frag:u,keyInfo:f})},onError:function(p,o,d){L.resetLoader(o),n(L.createKeyLoadError(T,D.ErrorDetails.KEY_LOAD_ERROR,d))},onTimeout:function(p,o,d){L.resetLoader(o),n(L.createKeyLoadError(T,D.ErrorDetails.KEY_LOAD_TIMEOUT,d))},onAbort:function(p,o,d){L.resetLoader(o),n(L.createKeyLoadError(T,D.ErrorDetails.INTERNAL_ABORTED,d))}};_.load(l,i,a)})},C.resetLoader=function(E){var T=E.frag,L=E.keyInfo,I=E.url,r=L.loader;T.keyLoader===r&&(T.keyLoader=null,L.loader=null),delete this.keyUriToKeyInfo[I],r&&r.destroy()},c}()},"./src/loader/level-details.ts":(O,R,s)=>{s.r(R),s.d(R,{LevelDetails:()=>E});var D=s("./src/polyfills/number.ts");function g(T,L){for(var I=0;I<L.length;I++){var r=L[I];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(T,c(r.key),r)}}function b(T,L,I){return L&&g(T.prototype,L),I&&g(T,I),Object.defineProperty(T,"prototype",{writable:!1}),T}function c(T){var L=C(T,"string");return typeof L=="symbol"?L:String(L)}function C(T,L){if(typeof T!="object"||T===null)return T;var I=T[Symbol.toPrimitive];if(I!==void 0){var r=I.call(T,L||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(L==="string"?String:Number)(T)}var x=10,E=function(){function T(I){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=I}var L=T.prototype;return L.reloaded=function(r){if(!r){this.advanced=!0,this.updated=!0;return}var _=this.lastPartSn-r.lastPartSn,v=this.lastPartIndex-r.lastPartIndex;this.updated=this.endSN!==r.endSN||!!v||!!_,this.advanced=this.endSN>r.endSN||_>0||_===0&&v>0,this.updated||this.advanced?this.misses=Math.floor(r.misses*.6):this.misses=r.misses+1,this.availabilityDelay=r.availabilityDelay},b(T,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,D.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||x}},{key:"drift",get:function(){var r=this.driftEndTime-this.driftStartTime;if(r>0){var _=this.driftEnd-this.driftStart;return _*1e3/r}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var r;return(r=this.partList)!==null&&r!==void 0&&r.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var r;return(r=this.fragments)!==null&&r!==void 0&&r.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var r;return(r=this.partList)!==null&&r!==void 0&&r.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var r;return(r=this.partList)!==null&&r!==void 0&&r.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),T}()},"./src/loader/level-key.ts":(O,R,s)=>{s.r(R),s.d(R,{LevelKey:()=>E});var D=s("./src/utils/keysystem-util.ts"),g=s("./src/utils/mediakeys-helper.ts"),b=s("./src/utils/mp4-tools.ts"),c=s("./src/utils/logger.ts"),C=s("./src/utils/numeric-encoding-utils.ts"),x={},E=function(){L.clearKeyUriToKeyIdMap=function(){x={}};function L(r,_,v,n,l){n===void 0&&(n=[1]),l===void 0&&(l=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=r,this.uri=_,this.keyFormat=v,this.keyFormatVersions=n,this.iv=l,this.encrypted=r?r!=="NONE":!1,this.isCommonEncryption=this.encrypted&&r!=="AES-128"}var I=L.prototype;return I.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case g.KeySystemFormats.FAIRPLAY:case g.KeySystemFormats.WIDEVINE:case g.KeySystemFormats.PLAYREADY:case g.KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},I.getDecryptData=function(_){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof _!="number"&&(this.method==="AES-128"&&!this.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),_=0);var v=T(_),n=new L(this.method,this.uri,"identity",this.keyFormatVersions,v);return n}var l=(0,D.convertDataUriToArrayBytes)(this.uri);if(l)switch(this.keyFormat){case g.KeySystemFormats.WIDEVINE:this.pssh=l,l.length>=22&&(this.keyId=l.subarray(l.length-22,l.length-6));break;case g.KeySystemFormats.PLAYREADY:{var i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,b.mp4pssh)(i,null,l);var a=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/2),m=String.fromCharCode.apply(null,Array.from(a)),p=m.substring(m.indexOf("<"),m.length),o=new DOMParser,d=o.parseFromString(p,"text/xml"),A=d.getElementsByTagName("KID")[0];if(A){var u=A.childNodes[0]?A.childNodes[0].nodeValue:A.getAttribute("VALUE");if(u){var f=(0,C.base64Decode)(u).subarray(0,16);(0,D.changeEndianness)(f),this.keyId=f}}break}default:{var t=l.subarray(0,16);if(t.length!==16){var h=new Uint8Array(16);h.set(t,16-t.length),t=h}this.keyId=t;break}}if(!this.keyId||this.keyId.byteLength!==16){var e=x[this.uri];if(!e){var y=Object.keys(x).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);var P=new DataView(e.buffer,12,4);P.setUint32(0,y),x[this.uri]=e}this.keyId=e}return this},L}();function T(L){for(var I=new Uint8Array(16),r=12;r<16;r++)I[r]=L>>8*(15-r)&255;return I}},"./src/loader/load-stats.ts":(O,R,s)=>{s.r(R),s.d(R,{LoadStats:()=>D});var D=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>l});var D=s("./src/polyfills/number.ts"),g=s("./node_modules/url-toolkit/src/url-toolkit.js"),b=s("./src/loader/date-range.ts"),c=s("./src/loader/fragment.ts"),C=s("./src/loader/level-details.ts"),x=s("./src/loader/level-key.ts"),E=s("./src/utils/attr-list.ts"),T=s("./src/utils/logger.ts"),L=s("./src/utils/codecs.ts");function I(){return I=Object.assign?Object.assign.bind():function(u){for(var f=1;f<arguments.length;f++){var t=arguments[f];for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&(u[h]=t[h])}return u},I.apply(this,arguments)}var r=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,_=/#EXT-X-MEDIA:(.*)/g,v=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),n=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),l=function(){function u(){}return u.findGroup=function(t,h){for(var e=0;e<t.length;e++){var y=t[e];if(y.id===h)return y}},u.convertAVC1ToAVCOTI=function(t){var h=t.split(".");if(h.length>2){var e=h.shift()+".";return e+=parseInt(h.shift()).toString(16),e+=("000"+parseInt(h.shift()).toString(16)).slice(-4),e}return t},u.resolve=function(t,h){return(0,g.buildAbsoluteURL)(h,t,{alwaysNormalize:!0})},u.parseMasterPlaylist=function(t,h){var e=[],y=[],P={},S=[],w=!1;r.lastIndex=0;for(var k;(k=r.exec(t))!=null;)if(k[1]){var F,U=new E.AttrList(k[1]),N={attrs:U,bitrate:U.decimalInteger("AVERAGE-BANDWIDTH")||U.decimalInteger("BANDWIDTH"),name:U.NAME,url:u.resolve(k[2],h)},j=U.decimalResolution("RESOLUTION");j&&(N.width=j.width,N.height=j.height),a((U.CODECS||"").split(/[ ,]+/).filter(function(Y){return Y}),N),N.videoCodec&&N.videoCodec.indexOf("avc1")!==-1&&(N.videoCodec=u.convertAVC1ToAVCOTI(N.videoCodec)),(F=N.unknownCodecs)!==null&&F!==void 0&&F.length||y.push(N),e.push(N)}else if(k[3]){var W=new E.AttrList(k[3]);W["DATA-ID"]&&(w=!0,P[W["DATA-ID"]]=W)}else if(k[4]){var H=k[4],G=i(H,h);G.encrypted&&G.isSupported()?S.push(G):T.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+H+'"')}var V=y.length>0&&y.length<e.length;return{levels:V?y:e,sessionData:w?P:null,sessionKeys:S.length?S:null}},u.parseMasterPlaylistMedia=function(t,h,e,y){y===void 0&&(y=[]);var P,S=[],w=0;for(_.lastIndex=0;(P=_.exec(t))!==null;){var k=new E.AttrList(P[1]);if(k.TYPE===e){var F={attrs:k,bitrate:0,id:w++,groupId:k["GROUP-ID"],instreamId:k["INSTREAM-ID"],name:k.NAME||k.LANGUAGE||"",type:e,default:k.bool("DEFAULT"),autoselect:k.bool("AUTOSELECT"),forced:k.bool("FORCED"),lang:k.LANGUAGE,url:k.URI?u.resolve(k.URI,h):""};if(y.length){var U=u.findGroup(y,F.groupId)||y[0];m(F,U,"audioCodec"),m(F,U,"textCodec")}S.push(F)}}return S},u.parseLevelPlaylist=function(t,h,e,y,P){var S=new C.LevelDetails(h),w=S.fragments,k=null,F=0,U=0,N=0,j=0,W=null,H=new c.Fragment(y,h),G,V,Y,Q=-1,z=!1;for(v.lastIndex=0,S.m3u8=t;(G=v.exec(t))!==null;){z&&(z=!1,H=new c.Fragment(y,h),H.start=N,H.sn=F,H.cc=j,H.level=e,k&&(H.initSegment=k,H.rawProgramDateTime=k.rawProgramDateTime,k.rawProgramDateTime=null));var X=G[1];if(X){H.duration=parseFloat(X);var q=(" "+G[2]).slice(1);H.title=q||null,H.tagList.push(q?["INF",X,q]:["INF",X])}else if(G[3])(0,D.isFiniteNumber)(H.duration)&&(H.start=N,Y&&A(H,Y,S),H.sn=F,H.level=e,H.cc=j,H.urlId=P,w.push(H),H.relurl=(" "+G[3]).slice(1),o(H,W),W=H,N+=H.duration,F++,U=0,z=!0);else if(G[4]){var te=(" "+G[4]).slice(1);W?H.setByteRange(te,W):H.setByteRange(te)}else if(G[5])H.rawProgramDateTime=(" "+G[5]).slice(1),H.tagList.push(["PROGRAM-DATE-TIME",H.rawProgramDateTime]),Q===-1&&(Q=w.length);else{if(G=G[0].match(n),!G){T.logger.warn("No matches on slow regex match for level playlist!");continue}for(V=1;V<G.length&&!(typeof G[V]<"u");V++);var ee=(" "+G[V]).slice(1),Z=(" "+G[V+1]).slice(1),J=G[V+2]?(" "+G[V+2]).slice(1):"";switch(ee){case"PLAYLIST-TYPE":S.type=Z.toUpperCase();break;case"MEDIA-SEQUENCE":F=S.startSN=parseInt(Z);break;case"SKIP":{var ie=new E.AttrList(Z),ne=ie.decimalInteger("SKIPPED-SEGMENTS");if((0,D.isFiniteNumber)(ne)){S.skippedSegments=ne;for(var ue=ne;ue--;)w.unshift(null);F+=ne}var oe=ie.enumeratedString("RECENTLY-REMOVED-DATERANGES");oe&&(S.recentlyRemovedDateranges=oe.split("	"));break}case"TARGETDURATION":S.targetduration=parseFloat(Z);break;case"VERSION":S.version=parseInt(Z);break;case"EXTM3U":break;case"ENDLIST":S.live=!1;break;case"#":(Z||J)&&H.tagList.push(J?[Z,J]:[Z]);break;case"DISCONTINUITY":j++,H.tagList.push(["DIS"]);break;case"GAP":H.tagList.push([ee]);break;case"BITRATE":H.tagList.push([ee,Z]);break;case"DATERANGE":{var le=new E.AttrList(Z),ae=new b.DateRange(le,S.dateRanges[le.ID]);ae.isValid||S.skippedSegments?S.dateRanges[ae.id]=ae:T.logger.warn('Ignoring invalid DATERANGE tag: "'+Z+'"'),H.tagList.push(["EXT-X-DATERANGE",Z]);break}case"DISCONTINUITY-SEQUENCE":j=parseInt(Z);break;case"KEY":{var se=i(Z,h);if(se.isSupported()){if(se.method==="NONE"){Y=void 0;break}Y||(Y={}),Y[se.keyFormat]&&(Y=I({},Y)),Y[se.keyFormat]=se}else T.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+Z+'"');break}case"START":{var de=new E.AttrList(Z),fe=de.decimalFloatingPoint("TIME-OFFSET");(0,D.isFiniteNumber)(fe)&&(S.startTimeOffset=fe);break}case"MAP":{var ve=new E.AttrList(Z);if(H.duration){var ce=new c.Fragment(y,h);d(ce,ve,e,Y),k=ce,H.initSegment=k,k.rawProgramDateTime&&!H.rawProgramDateTime&&(H.rawProgramDateTime=k.rawProgramDateTime)}else d(H,ve,e,Y),k=H,z=!0;break}case"SERVER-CONTROL":{var pe=new E.AttrList(Z);S.canBlockReload=pe.bool("CAN-BLOCK-RELOAD"),S.canSkipUntil=pe.optionalFloat("CAN-SKIP-UNTIL",0),S.canSkipDateRanges=S.canSkipUntil>0&&pe.bool("CAN-SKIP-DATERANGES"),S.partHoldBack=pe.optionalFloat("PART-HOLD-BACK",0),S.holdBack=pe.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var xe=new E.AttrList(Z);S.partTarget=xe.decimalFloatingPoint("PART-TARGET");break}case"PART":{var me=S.partList;me||(me=S.partList=[]);var _e=U>0?me[me.length-1]:void 0,Ee=U++,re=new c.Part(new E.AttrList(Z),H,h,Ee,_e);me.push(re),H.duration+=re.duration;break}case"PRELOAD-HINT":{var Te=new E.AttrList(Z);S.preloadHint=Te;break}case"RENDITION-REPORT":{var ye=new E.AttrList(Z);S.renditionReports=S.renditionReports||[],S.renditionReports.push(ye);break}default:T.logger.warn("line parsed but not handled: "+G);break}}}W&&!W.relurl?(w.pop(),N-=W.duration,S.partList&&(S.fragmentHint=W)):S.partList&&(o(H,W),H.cc=j,S.fragmentHint=H,Y&&A(H,Y,S));var ge=w.length,Se=w[0],be=w[ge-1];if(N+=S.skippedSegments*S.targetduration,N>0&&ge&&be){S.averagetargetduration=N/ge;var he=be.sn;S.endSN=he!=="initSegment"?he:0,S.live||(be.endList=!0),Se&&(S.startCC=Se.cc)}else S.endSN=0,S.startCC=0;return S.fragmentHint&&(N+=S.fragmentHint.duration),S.totalduration=N,S.endCC=j,Q>0&&p(w,Q),S},u}();function i(u,f){var t,h,e=new E.AttrList(u),y=(t=e.enumeratedString("METHOD"))!=null?t:"",P=e.URI,S=e.hexadecimalInteger("IV"),w=e.enumeratedString("KEYFORMATVERSIONS"),k=(h=e.enumeratedString("KEYFORMAT"))!=null?h:"identity";P&&e.IV&&!S&&T.logger.error("Invalid IV: "+e.IV);var F=P?l.resolve(P,f):"",U=(w||"1").split("/").map(Number).filter(Number.isFinite);return new x.LevelKey(y,F,k,U,S)}function a(u,f){["video","audio","text"].forEach(function(t){var h=u.filter(function(y){return(0,L.isCodecType)(y,t)});if(h.length){var e=h.filter(function(y){return y.lastIndexOf("avc1",0)===0||y.lastIndexOf("mp4a",0)===0});f[t+"Codec"]=e.length>0?e[0]:h[0],u=u.filter(function(y){return h.indexOf(y)===-1})}}),f.unknownCodecs=u}function m(u,f,t){var h=f[t];h&&(u[t]=h)}function p(u,f){for(var t=u[f],h=f;h--;){var e=u[h];if(!e)return;e.programDateTime=t.programDateTime-e.duration*1e3,t=e}}function o(u,f){u.rawProgramDateTime?u.programDateTime=Date.parse(u.rawProgramDateTime):f!=null&&f.programDateTime&&(u.programDateTime=f.endProgramDateTime),(0,D.isFiniteNumber)(u.programDateTime)||(u.programDateTime=null,u.rawProgramDateTime=null)}function d(u,f,t,h){u.relurl=f.URI,f.BYTERANGE&&u.setByteRange(f.BYTERANGE),u.level=t,u.sn="initSegment",h&&(u.levelkeys=h),u.initSegment=null}function A(u,f,t){u.levelkeys=f;var h=t.encryptedFragments;(!h.length||h[h.length-1].levelkeys!==f)&&Object.keys(f).some(function(e){return f[e].isCommonEncryption})&&h.push(u)}},"./src/loader/playlist-loader.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>r});var D=s("./src/polyfills/number.ts"),g=s("./src/events.ts"),b=s("./src/errors.ts"),c=s("./src/utils/logger.ts"),C=s("./src/loader/m3u8-parser.ts"),x=s("./src/types/loader.ts"),E=s("./src/utils/attr-list.ts");function T(_){var v=_.type;switch(v){case x.PlaylistContextType.AUDIO_TRACK:return x.PlaylistLevelType.AUDIO;case x.PlaylistContextType.SUBTITLE_TRACK:return x.PlaylistLevelType.SUBTITLE;default:return x.PlaylistLevelType.MAIN}}function L(_,v){var n=_.url;return(n===void 0||n.indexOf("data:")===0)&&(n=v.url),n}var I=function(){function _(n){this.hls=void 0,this.loaders=Object.create(null),this.hls=n,this.registerListeners()}var v=_.prototype;return v.startLoad=function(l){},v.stopLoad=function(){this.destroyInternalLoaders()},v.registerListeners=function(){var l=this.hls;l.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),l.on(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},v.unregisterListeners=function(){var l=this.hls;l.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(g.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),l.off(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},v.createInternalLoader=function(l){var i=this.hls.config,a=i.pLoader,m=i.loader,p=a||m,o=new p(i);return l.loader=o,this.loaders[l.type]=o,o},v.getInternalLoader=function(l){return this.loaders[l.type]},v.resetInternalLoader=function(l){this.loaders[l]&&delete this.loaders[l]},v.destroyInternalLoaders=function(){for(var l in this.loaders){var i=this.loaders[l];i&&i.destroy(),this.resetInternalLoader(l)}},v.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},v.onManifestLoading=function(l,i){var a=i.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:x.PlaylistContextType.MANIFEST,url:a,deliveryDirectives:null})},v.onLevelLoading=function(l,i){var a=i.id,m=i.level,p=i.url,o=i.deliveryDirectives;this.load({id:a,groupId:null,level:m,responseType:"text",type:x.PlaylistContextType.LEVEL,url:p,deliveryDirectives:o})},v.onAudioTrackLoading=function(l,i){var a=i.id,m=i.groupId,p=i.url,o=i.deliveryDirectives;this.load({id:a,groupId:m,level:null,responseType:"text",type:x.PlaylistContextType.AUDIO_TRACK,url:p,deliveryDirectives:o})},v.onSubtitleTrackLoading=function(l,i){var a=i.id,m=i.groupId,p=i.url,o=i.deliveryDirectives;this.load({id:a,groupId:m,level:null,responseType:"text",type:x.PlaylistContextType.SUBTITLE_TRACK,url:p,deliveryDirectives:o})},v.load=function(l){var i,a=this.hls.config,m=this.getInternalLoader(l);if(m){var p=m.context;if(p&&p.url===l.url){c.logger.trace("[playlist-loader]: playlist request ongoing");return}c.logger.log("[playlist-loader]: aborting previous loader for type: "+l.type),m.abort()}var o,d,A,u;switch(l.type){case x.PlaylistContextType.MANIFEST:o=a.manifestLoadingMaxRetry,d=a.manifestLoadingTimeOut,A=a.manifestLoadingRetryDelay,u=a.manifestLoadingMaxRetryTimeout;break;case x.PlaylistContextType.LEVEL:case x.PlaylistContextType.AUDIO_TRACK:case x.PlaylistContextType.SUBTITLE_TRACK:o=0,d=a.levelLoadingTimeOut;break;default:o=a.levelLoadingMaxRetry,d=a.levelLoadingTimeOut,A=a.levelLoadingRetryDelay,u=a.levelLoadingMaxRetryTimeout;break}if(m=this.createInternalLoader(l),(i=l.deliveryDirectives)!==null&&i!==void 0&&i.part){var f;if(l.type===x.PlaylistContextType.LEVEL&&l.level!==null?f=this.hls.levels[l.level].details:l.type===x.PlaylistContextType.AUDIO_TRACK&&l.id!==null?f=this.hls.audioTracks[l.id].details:l.type===x.PlaylistContextType.SUBTITLE_TRACK&&l.id!==null&&(f=this.hls.subtitleTracks[l.id].details),f){var t=f.partTarget,h=f.targetduration;t&&h&&(d=Math.min(Math.max(t*3,h*.8)*1e3,d))}}var e={timeout:d,maxRetry:o,retryDelay:A,maxRetryDelay:u,highWaterMark:0},y={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};m.load(l,e,y)},v.loadsuccess=function(l,i,a,m){m===void 0&&(m=null),this.resetInternalLoader(a.type);var p=l.data;if(p.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(l,a,"no EXTM3U delimiter",m);return}i.parsing.start=performance.now(),p.indexOf("#EXTINF:")>0||p.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(l,i,a,m):this.handleMasterPlaylist(l,i,a,m)},v.loaderror=function(l,i,a){a===void 0&&(a=null),this.handleNetworkError(i,a,!1,l)},v.loadtimeout=function(l,i,a){a===void 0&&(a=null),this.handleNetworkError(i,a,!0)},v.handleMasterPlaylist=function(l,i,a,m){var p=this.hls,o=l.data,d=L(l,a),A=C.default.parseMasterPlaylist(o,d),u=A.levels,f=A.sessionData,t=A.sessionKeys;if(!u.length){this.handleManifestParsingError(l,a,"no level found in manifest",m);return}var h=u.map(function(k){return{id:k.attrs.AUDIO,audioCodec:k.audioCodec}}),e=u.map(function(k){return{id:k.attrs.SUBTITLES,textCodec:k.textCodec}}),y=C.default.parseMasterPlaylistMedia(o,d,"AUDIO",h),P=C.default.parseMasterPlaylistMedia(o,d,"SUBTITLES",e),S=C.default.parseMasterPlaylistMedia(o,d,"CLOSED-CAPTIONS");if(y.length){var w=y.some(function(k){return!k.url});!w&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(c.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new E.AttrList({}),bitrate:0,url:""}))}p.trigger(g.Events.MANIFEST_LOADED,{levels:u,audioTracks:y,subtitles:P,captions:S,url:d,stats:i,networkDetails:m,sessionData:f,sessionKeys:t})},v.handleTrackOrLevelPlaylist=function(l,i,a,m){var p=this.hls,o=a.id,d=a.level,A=a.type,u=L(l,a),f=(0,D.isFiniteNumber)(o)?o:0,t=(0,D.isFiniteNumber)(d)?d:f,h=T(a),e=C.default.parseLevelPlaylist(l.data,u,t,h,f);if(!e.fragments.length){p.trigger(g.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:u,reason:"no fragments found in level",level:typeof a.level=="number"?a.level:void 0});return}if(A===x.PlaylistContextType.MANIFEST){var y={attrs:new E.AttrList({}),bitrate:0,details:e,name:"",url:u};p.trigger(g.Events.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:u,stats:i,networkDetails:m,sessionData:null,sessionKeys:null})}i.parsing.end=performance.now(),a.levelDetails=e,this.handlePlaylistLoaded(l,i,a,m)},v.handleManifestParsingError=function(l,i,a,m){this.hls.trigger(g.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:i.type===x.PlaylistContextType.MANIFEST,url:l.url,reason:a,response:l,context:i,networkDetails:m})},v.handleNetworkError=function(l,i,a,m){a===void 0&&(a=!1),c.logger.warn("[playlist-loader]: A network "+(a?"timeout":"error")+" occurred while loading "+l.type+" level: "+l.level+" id: "+l.id+' group-id: "'+l.groupId+'"');var p=b.ErrorDetails.UNKNOWN,o=!1,d=this.getInternalLoader(l);switch(l.type){case x.PlaylistContextType.MANIFEST:p=a?b.ErrorDetails.MANIFEST_LOAD_TIMEOUT:b.ErrorDetails.MANIFEST_LOAD_ERROR,o=!0;break;case x.PlaylistContextType.LEVEL:p=a?b.ErrorDetails.LEVEL_LOAD_TIMEOUT:b.ErrorDetails.LEVEL_LOAD_ERROR,o=!1;break;case x.PlaylistContextType.AUDIO_TRACK:p=a?b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,o=!1;break;case x.PlaylistContextType.SUBTITLE_TRACK:p=a?b.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:b.ErrorDetails.SUBTITLE_LOAD_ERROR,o=!1;break}d&&this.resetInternalLoader(l.type);var A={type:b.ErrorTypes.NETWORK_ERROR,details:p,fatal:o,url:l.url,loader:d,context:l,networkDetails:i};m&&(A.response=m),this.hls.trigger(g.Events.ERROR,A)},v.handlePlaylistLoaded=function(l,i,a,m){var p=a.type,o=a.level,d=a.id,A=a.groupId,u=a.loader,f=a.levelDetails,t=a.deliveryDirectives;if(!(f!=null&&f.targetduration)){this.handleManifestParsingError(l,a,"invalid target duration",m);return}if(!!u)switch(f.live&&(u.getCacheAge&&(f.ageHeader=u.getCacheAge()||0),(!u.getCacheAge||isNaN(f.ageHeader))&&(f.ageHeader=0)),p){case x.PlaylistContextType.MANIFEST:case x.PlaylistContextType.LEVEL:this.hls.trigger(g.Events.LEVEL_LOADED,{details:f,level:o||0,id:d||0,stats:i,networkDetails:m,deliveryDirectives:t});break;case x.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(g.Events.AUDIO_TRACK_LOADED,{details:f,id:d||0,groupId:A||"",stats:i,networkDetails:m,deliveryDirectives:t});break;case x.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(g.Events.SUBTITLE_TRACK_LOADED,{details:f,id:d||0,groupId:A||"",stats:i,networkDetails:m,deliveryDirectives:t});break}},_}();const r=I},"./src/polyfills/number.ts":(O,R,s)=>{s.r(R),s.d(R,{MAX_SAFE_INTEGER:()=>g,isFiniteNumber:()=>D});var D=Number.isFinite||function(b){return typeof b=="number"&&isFinite(b)},g=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>g});var D=function(){function b(){}return b.getSilentFrame=function(C,x){switch(C){case"mp4a.40.2":if(x===1)return new Uint8Array([0,200,0,128,35,128]);if(x===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(x===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(x===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(x===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(x===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(x===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(x===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(x===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},b}();const g=D},"./src/remux/mp4-generator.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>b});var D=Math.pow(2,32)-1,g=function(){function c(){}return c.init=function(){c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var x;for(x in c.types)c.types.hasOwnProperty(x)&&(c.types[x]=[x.charCodeAt(0),x.charCodeAt(1),x.charCodeAt(2),x.charCodeAt(3)]);var E=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),T=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);c.HDLR_TYPES={video:E,audio:T};var L=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),I=new Uint8Array([0,0,0,0,0,0,0,0]);c.STTS=c.STSC=c.STCO=I,c.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),c.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),c.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),c.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var r=new Uint8Array([105,115,111,109]),_=new Uint8Array([97,118,99,49]),v=new Uint8Array([0,0,0,1]);c.FTYP=c.box(c.types.ftyp,r,v,r,_),c.DINF=c.box(c.types.dinf,c.box(c.types.dref,L))},c.box=function(x){for(var E=8,T=arguments.length,L=new Array(T>1?T-1:0),I=1;I<T;I++)L[I-1]=arguments[I];for(var r=L.length,_=r;r--;)E+=L[r].byteLength;var v=new Uint8Array(E);for(v[0]=E>>24&255,v[1]=E>>16&255,v[2]=E>>8&255,v[3]=E&255,v.set(x,4),r=0,E=8;r<_;r++)v.set(L[r],E),E+=L[r].byteLength;return v},c.hdlr=function(x){return c.box(c.types.hdlr,c.HDLR_TYPES[x])},c.mdat=function(x){return c.box(c.types.mdat,x)},c.mdhd=function(x,E){E*=x;var T=Math.floor(E/(D+1)),L=Math.floor(E%(D+1));return c.box(c.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,T>>24,T>>16&255,T>>8&255,T&255,L>>24,L>>16&255,L>>8&255,L&255,85,196,0,0]))},c.mdia=function(x){return c.box(c.types.mdia,c.mdhd(x.timescale,x.duration),c.hdlr(x.type),c.minf(x))},c.mfhd=function(x){return c.box(c.types.mfhd,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,x&255]))},c.minf=function(x){return x.type==="audio"?c.box(c.types.minf,c.box(c.types.smhd,c.SMHD),c.DINF,c.stbl(x)):c.box(c.types.minf,c.box(c.types.vmhd,c.VMHD),c.DINF,c.stbl(x))},c.moof=function(x,E,T){return c.box(c.types.moof,c.mfhd(x),c.traf(T,E))},c.moov=function(x){for(var E=x.length,T=[];E--;)T[E]=c.trak(x[E]);return c.box.apply(null,[c.types.moov,c.mvhd(x[0].timescale,x[0].duration)].concat(T).concat(c.mvex(x)))},c.mvex=function(x){for(var E=x.length,T=[];E--;)T[E]=c.trex(x[E]);return c.box.apply(null,[c.types.mvex].concat(T))},c.mvhd=function(x,E){E*=x;var T=Math.floor(E/(D+1)),L=Math.floor(E%(D+1)),I=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,T>>24,T>>16&255,T>>8&255,T&255,L>>24,L>>16&255,L>>8&255,L&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return c.box(c.types.mvhd,I)},c.sdtp=function(x){var E=x.samples||[],T=new Uint8Array(4+E.length),L,I;for(L=0;L<E.length;L++)I=E[L].flags,T[L+4]=I.dependsOn<<4|I.isDependedOn<<2|I.hasRedundancy;return c.box(c.types.sdtp,T)},c.stbl=function(x){return c.box(c.types.stbl,c.stsd(x),c.box(c.types.stts,c.STTS),c.box(c.types.stsc,c.STSC),c.box(c.types.stsz,c.STSZ),c.box(c.types.stco,c.STCO))},c.avc1=function(x){var E=[],T=[],L,I,r;for(L=0;L<x.sps.length;L++)I=x.sps[L],r=I.byteLength,E.push(r>>>8&255),E.push(r&255),E=E.concat(Array.prototype.slice.call(I));for(L=0;L<x.pps.length;L++)I=x.pps[L],r=I.byteLength,T.push(r>>>8&255),T.push(r&255),T=T.concat(Array.prototype.slice.call(I));var _=c.box(c.types.avcC,new Uint8Array([1,E[3],E[4],E[5],255,224|x.sps.length].concat(E).concat([x.pps.length]).concat(T))),v=x.width,n=x.height,l=x.pixelRatio[0],i=x.pixelRatio[1];return c.box(c.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,v>>8&255,v&255,n>>8&255,n&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),_,c.box(c.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),c.box(c.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,i>>24,i>>16&255,i>>8&255,i&255])))},c.esds=function(x){var E=x.config.length;return new Uint8Array([0,0,0,0,3,23+E,0,1,0,4,15+E,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([E]).concat(x.config).concat([6,1,2]))},c.mp4a=function(x){var E=x.samplerate;return c.box(c.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,E>>8&255,E&255,0,0]),c.box(c.types.esds,c.esds(x)))},c.mp3=function(x){var E=x.samplerate;return c.box(c.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,E>>8&255,E&255,0,0]))},c.stsd=function(x){return x.type==="audio"?x.segmentCodec==="mp3"&&x.codec==="mp3"?c.box(c.types.stsd,c.STSD,c.mp3(x)):c.box(c.types.stsd,c.STSD,c.mp4a(x)):c.box(c.types.stsd,c.STSD,c.avc1(x))},c.tkhd=function(x){var E=x.id,T=x.duration*x.timescale,L=x.width,I=x.height,r=Math.floor(T/(D+1)),_=Math.floor(T%(D+1));return c.box(c.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,E>>24&255,E>>16&255,E>>8&255,E&255,0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,_>>24,_>>16&255,_>>8&255,_&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,L>>8&255,L&255,0,0,I>>8&255,I&255,0,0]))},c.traf=function(x,E){var T=c.sdtp(x),L=x.id,I=Math.floor(E/(D+1)),r=Math.floor(E%(D+1));return c.box(c.types.traf,c.box(c.types.tfhd,new Uint8Array([0,0,0,0,L>>24,L>>16&255,L>>8&255,L&255])),c.box(c.types.tfdt,new Uint8Array([1,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,r>>24,r>>16&255,r>>8&255,r&255])),c.trun(x,T.length+16+20+8+16+8+8),T)},c.trak=function(x){return x.duration=x.duration||4294967295,c.box(c.types.trak,c.tkhd(x),c.mdia(x))},c.trex=function(x){var E=x.id;return c.box(c.types.trex,new Uint8Array([0,0,0,0,E>>24,E>>16&255,E>>8&255,E&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},c.trun=function(x,E){var T=x.samples||[],L=T.length,I=12+16*L,r=new Uint8Array(I),_,v,n,l,i,a;for(E+=8+I,r.set([x.type==="video"?1:0,0,15,1,L>>>24&255,L>>>16&255,L>>>8&255,L&255,E>>>24&255,E>>>16&255,E>>>8&255,E&255],0),_=0;_<L;_++)v=T[_],n=v.duration,l=v.size,i=v.flags,a=v.cts,r.set([n>>>24&255,n>>>16&255,n>>>8&255,n&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,i.isLeading<<2|i.dependsOn,i.isDependedOn<<6|i.hasRedundancy<<4|i.paddingValue<<1|i.isNonSync,i.degradPrio&240<<8,i.degradPrio&15,a>>>24&255,a>>>16&255,a>>>8&255,a&255],12+16*_);return c.box(c.types.trun,r)},c.initSegment=function(x){c.types||c.init();var E=c.moov(x),T=new Uint8Array(c.FTYP.byteLength+E.byteLength);return T.set(c.FTYP),T.set(E,c.FTYP.byteLength),T},c}();g.types=void 0,g.HDLR_TYPES=void 0,g.STTS=void 0,g.STSC=void 0,g.STCO=void 0,g.STSZ=void 0,g.VMHD=void 0,g.SMHD=void 0,g.STSD=void 0,g.FTYP=void 0,g.DINF=void 0;const b=g},"./src/remux/mp4-remuxer.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>l,flushTextTrackMetadataCueSamples:()=>m,flushTextTrackUserdataCueSamples:()=>p,normalizePts:()=>i});var D=s("./src/polyfills/number.ts"),g=s("./src/remux/aac-helper.ts"),b=s("./src/remux/mp4-generator.ts"),c=s("./src/events.ts"),C=s("./src/errors.ts"),x=s("./src/utils/logger.ts"),E=s("./src/types/loader.ts"),T=s("./src/utils/timescale-conversion.ts");function L(){return L=Object.assign?Object.assign.bind():function(A){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var t in f)Object.prototype.hasOwnProperty.call(f,t)&&(A[t]=f[t])}return A},L.apply(this,arguments)}var I=10*1e3,r=1024,_=1152,v=null,n=null,l=function(){function A(f,t,h,e){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=f,this.config=t,this.typeSupported=h,this.ISGenerated=!1,v===null){var y=navigator.userAgent||"",P=y.match(/Chrome\/(\d+)/i);v=P?parseInt(P[1]):0}if(n===null){var S=navigator.userAgent.match(/Safari\/(\d+)/i);n=S?parseInt(S[1]):0}}var u=A.prototype;return u.destroy=function(){},u.resetTimeStamp=function(t){x.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},u.resetNextTimestamp=function(){x.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},u.resetInitSegment=function(){x.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},u.getVideoStartPts=function(t){var h=!1,e=t.reduce(function(y,P){var S=P.pts-y;return S<-4294967296?(h=!0,i(y,P.pts)):S>0?y:P.pts},t[0].pts);return h&&x.logger.debug("PTS rollover detected"),e},u.remux=function(t,h,e,y,P,S,w,k){var F,U,N,j,W,H,G=P,V=P,Y=t.pid>-1,Q=h.pid>-1,z=h.samples.length,X=t.samples.length>0,q=w&&z>0||z>1,te=(!Y||X)&&(!Q||q)||this.ISGenerated||w;if(te){this.ISGenerated||(N=this.generateIS(t,h,P));var ee=this.isVideoContiguous,Z=-1,J;if(q&&(Z=a(h.samples),!ee&&this.config.forceKeyFrameOnDiscontinuity))if(H=!0,Z>0){x.logger.warn("[mp4-remuxer]: Dropped "+Z+" out of "+z+" video samples due to a missing keyframe");var ie=this.getVideoStartPts(h.samples);h.samples=h.samples.slice(Z),h.dropped+=Z,V+=(h.samples[0].pts-ie)/h.inputTimeScale,J=V}else Z===-1&&(x.logger.warn("[mp4-remuxer]: No keyframe found out of "+z+" video samples"),H=!1);if(this.ISGenerated){if(X&&q){var ne=this.getVideoStartPts(h.samples),ue=i(t.samples[0].pts,ne)-ne,oe=ue/h.inputTimeScale;G+=Math.max(0,oe),V+=Math.max(0,-oe)}if(X){if(t.samplerate||(x.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),N=this.generateIS(t,h,P)),U=this.remuxAudio(t,G,this.isAudioContiguous,S,Q||q||k===E.PlaylistLevelType.AUDIO?V:void 0),q){var le=U?U.endPTS-U.startPTS:0;h.inputTimeScale||(x.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),N=this.generateIS(t,h,P)),F=this.remuxVideo(h,V,ee,le)}}else q&&(F=this.remuxVideo(h,V,ee,0));F&&(F.firstKeyFrame=Z,F.independent=Z!==-1,F.firstKeyFramePTS=J)}}return this.ISGenerated&&(e.samples.length&&(W=m(e,P,this._initPTS,this._initDTS)),y.samples.length&&(j=p(y,P,this._initPTS))),{audio:U,video:F,initSegment:N,independent:H,text:j,id3:W}},u.generateIS=function(t,h,e){var y=t.samples,P=h.samples,S=this.typeSupported,w={},k=!(0,D.isFiniteNumber)(this._initPTS),F="audio/mp4",U,N,j;if(k&&(U=N=1/0),t.config&&y.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":S.mpeg?(F="audio/mpeg",t.codec=""):S.mp3&&(t.codec="mp3");break}w.audio={id:"audio",container:F,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&S.mpeg?new Uint8Array(0):b.default.initSegment([t]),metadata:{channelCount:t.channelCount}},k&&(j=t.inputTimeScale,U=N=y[0].pts-Math.round(j*e))}if(h.sps&&h.pps&&P.length&&(h.timescale=h.inputTimeScale,w.video={id:"main",container:"video/mp4",codec:h.codec,initSegment:b.default.initSegment([h]),metadata:{width:h.width,height:h.height}},k)){j=h.inputTimeScale;var W=this.getVideoStartPts(P),H=Math.round(j*e);N=Math.min(N,i(P[0].dts,W)-H),U=Math.min(U,W-H)}if(Object.keys(w).length)return this.ISGenerated=!0,k&&(this._initPTS=U,this._initDTS=N),{tracks:w,initPTS:U,timescale:j}},u.remuxVideo=function(t,h,e,y){var P=t.inputTimeScale,S=t.samples,w=[],k=S.length,F=this._initPTS,U=this.nextAvcDts,N=8,j=this.videoSampleDuration,W,H,G=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,Y=!1;if(!e||U===null){var Q=h*P,z=S[0].pts-i(S[0].dts,S[0].pts);U=Q-z}for(var X=0;X<k;X++){var q=S[X];q.pts=i(q.pts-F,U),q.dts=i(q.dts-F,U),q.dts<S[X>0?X-1:X].dts&&(Y=!0)}Y&&S.sort(function(Be,Ge){var tt=Be.dts-Ge.dts,rt=Be.pts-Ge.pts;return tt||rt}),W=S[0].dts,H=S[S.length-1].dts;var te=H-W,ee=te?Math.round(te/(k-1)):j||t.inputTimeScale/30;if(e){var Z=W-U,J=Z>ee,ie=Z<-1;if((J||ie)&&(J?x.logger.warn("AVC: "+(0,T.toMsFromMpegTsClock)(Z,!0)+" ms ("+Z+"dts) hole between fragments detected, filling it"):x.logger.warn("AVC: "+(0,T.toMsFromMpegTsClock)(-Z,!0)+" ms ("+Z+"dts) overlapping between fragments detected"),!ie||U>S[0].pts)){W=U;var ne=S[0].pts-Z;S[0].dts=W,S[0].pts=ne,x.logger.log("Video: First PTS/DTS adjusted: "+(0,T.toMsFromMpegTsClock)(ne,!0)+"/"+(0,T.toMsFromMpegTsClock)(W,!0)+", delta: "+(0,T.toMsFromMpegTsClock)(Z,!0)+" ms")}}W=Math.max(0,W);for(var ue=0,oe=0,le=0;le<k;le++){for(var ae=S[le],se=ae.units,de=se.length,fe=0,ve=0;ve<de;ve++)fe+=se[ve].data.length;oe+=fe,ue+=de,ae.length=fe,ae.dts=Math.max(ae.dts,W),G=Math.min(ae.pts,G),V=Math.max(ae.pts,V)}H=S[k-1].dts;var ce=oe+4*ue+8,pe;try{pe=new Uint8Array(ce)}catch(Be){this.observer.emit(c.Events.ERROR,c.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ce,reason:"fail allocating video mdat "+ce});return}var xe=new DataView(pe.buffer);xe.setUint32(0,ce),pe.set(b.default.types.mdat,4);for(var me=!1,_e=Number.POSITIVE_INFINITY,Ee=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,Te=Number.NEGATIVE_INFINITY,ye=0;ye<k;ye++){for(var ge=S[ye],Se=ge.units,be=0,he=0,Le=Se.length;he<Le;he++){var De=Se[he],Oe=De.data,Pe=De.data.byteLength;xe.setUint32(N,Pe),N+=4,pe.set(Oe,N),N+=Pe,be+=4+Pe}var Ce=void 0;if(ye<k-1)j=S[ye+1].dts-ge.dts,Ce=S[ye+1].pts-ge.pts;else{var Ke=this.config,Me=ye>0?ge.dts-S[ye-1].dts:ee;if(Ce=ye>0?ge.pts-S[ye-1].pts:ee,Ke.stretchShortVideoTrack&&this.nextAudioPts!==null){var ze=Math.floor(Ke.maxBufferHole*P),ke=(y?G+y*P:this.nextAudioPts)-ge.pts;ke>ze?(j=ke-Me,j<0?j=Me:me=!0,x.logger.log("[mp4-remuxer]: It is approximately "+ke/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=Me}else j=Me}var Xe=Math.round(ge.pts-ge.dts);_e=Math.min(_e,j),re=Math.max(re,j),Ee=Math.min(Ee,Ce),Te=Math.max(Te,Ce),w.push(new o(ge.key,j,be,Xe))}if(w.length){if(v){if(v<70){var je=w[0].flags;je.dependsOn=2,je.isNonSync=0}}else if(n&&Te-Ee<re-_e&&ee/re<.025&&w[0].cts===0){x.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Fe=W,Ae=0,We=w.length;Ae<We;Ae++){var He=Fe+w[Ae].duration,Qe=Fe+w[Ae].cts;if(Ae<We-1){var Ze=He+w[Ae+1].cts;w[Ae].duration=Ze-Qe}else w[Ae].duration=Ae?w[Ae-1].duration:ee;w[Ae].cts=0,Fe=He}}}console.assert(j!==null,"mp4SampleDuration must be computed"),j=me||!j?ee:j,this.nextAvcDts=U=H+j,this.videoSampleDuration=j,this.isVideoContiguous=!0;var Je=b.default.moof(t.sequenceNumber++,W,L({},t,{samples:w})),qe="video",et={data1:Je,data2:pe,startPTS:G/P,endPTS:(V+j)/P,startDTS:W/P,endDTS:U/P,type:qe,hasAudio:!1,hasVideo:!0,nb:w.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(pe.length,"MDAT length must not be zero"),et},u.remuxAudio=function(t,h,e,y,P){var S=t.inputTimeScale,w=t.samplerate?t.samplerate:S,k=S/w,F=t.segmentCodec==="aac"?r:_,U=F*k,N=this._initPTS,j=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,W=[],H=P!==void 0,G=t.samples,V=j?0:8,Y=this.nextAudioPts||-1,Q=h*S;if(this.isAudioContiguous=e=e||G.length&&Y>0&&(y&&Math.abs(Q-Y)<9e3||Math.abs(i(G[0].pts-N,Q)-Y)<20*U),G.forEach(function(De){De.pts=i(De.pts-N,Q)}),!e||Y<0){if(G=G.filter(function(De){return De.pts>=0}),!G.length)return;P===0?Y=0:y&&!H?Y=Math.max(0,Q):Y=G[0].pts}if(t.segmentCodec==="aac")for(var z=this.config.maxAudioFramesDrift,X=0,q=Y;X<G.length;X++){var te=G[X],ee=te.pts,Z=ee-q,J=Math.abs(1e3*Z/S);if(Z<=-z*U&&H)X===0&&(x.logger.warn("Audio frame @ "+(ee/S).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Z/S)+" ms."),this.nextAudioPts=Y=q=ee);else if(Z>=z*U&&J<I&&H){var ie=Math.round(Z/U);q=ee-ie*U,q<0&&(ie--,q+=U),X===0&&(this.nextAudioPts=Y=q),x.logger.warn("[mp4-remuxer]: Injecting "+ie+" audio frame @ "+(q/S).toFixed(3)+"s due to "+Math.round(1e3*Z/S)+" ms gap.");for(var ne=0;ne<ie;ne++){var ue=Math.max(q,0),oe=g.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);oe||(x.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),oe=te.unit.subarray()),G.splice(X,0,{unit:oe,pts:ue}),q+=U,X++}}te.pts=q,q+=U}for(var le=null,ae=null,se,de=0,fe=G.length;fe--;)de+=G[fe].unit.byteLength;for(var ve=0,ce=G.length;ve<ce;ve++){var pe=G[ve],xe=pe.unit,me=pe.pts;if(ae!==null){var _e=W[ve-1];_e.duration=Math.round((me-ae)/k)}else if(e&&t.segmentCodec==="aac"&&(me=Y),le=me,de>0){de+=V;try{se=new Uint8Array(de)}catch(De){this.observer.emit(c.Events.ERROR,c.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:de,reason:"fail allocating audio mdat "+de});return}if(!j){var Ee=new DataView(se.buffer);Ee.setUint32(0,de),se.set(b.default.types.mdat,4)}}else return;se.set(xe,V);var re=xe.byteLength;V+=re,W.push(new o(!0,F,re,0)),ae=me}var Te=W.length;if(!!Te){var ye=W[W.length-1];this.nextAudioPts=Y=ae+k*ye.duration;var ge=j?new Uint8Array(0):b.default.moof(t.sequenceNumber++,le/k,L({},t,{samples:W}));t.samples=[];var Se=le/S,be=Y/S,he="audio",Le={data1:ge,data2:se,startPTS:Se,endPTS:be,startDTS:Se,endDTS:be,type:he,hasAudio:!0,hasVideo:!1,nb:Te};return this.isAudioContiguous=!0,console.assert(se.length,"MDAT length must not be zero"),Le}},u.remuxEmptyAudio=function(t,h,e,y){var P=t.inputTimeScale,S=t.samplerate?t.samplerate:P,w=P/S,k=this.nextAudioPts,F=(k!==null?k:y.startDTS*P)+this._initDTS,U=y.endDTS*P+this._initDTS,N=w*r,j=Math.ceil((U-F)/N),W=g.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(x.logger.warn("[mp4-remuxer]: remux empty Audio"),!W){x.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var H=[],G=0;G<j;G++){var V=F+G*N;H.push({unit:W,pts:V,dts:V})}return t.samples=H,this.remuxAudio(t,h,e,!1)},A}();function i(A,u){var f;if(u===null)return A;for(u<A?f=-8589934592:f=8589934592;Math.abs(A-u)>4294967296;)A+=f;return A}function a(A){for(var u=0;u<A.length;u++)if(A[u].key)return u;return-1}function m(A,u,f,t){var h=A.samples.length;if(!!h){for(var e=A.inputTimeScale,y=0;y<h;y++){var P=A.samples[y];P.pts=i(P.pts-f,u*e)/e,P.dts=i(P.dts-t,u*e)/e}var S=A.samples;return A.samples=[],{samples:S}}}function p(A,u,f){var t=A.samples.length;if(!!t){for(var h=A.inputTimeScale,e=0;e<t;e++){var y=A.samples[e];y.pts=i(y.pts-f,u*h)/h}A.samples.sort(function(S,w){return S.pts-w.pts});var P=A.samples;return A.samples=[],{samples:P}}}var o=function(u,f,t,h){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=f,this.size=t,this.cts=h,this.flags=new d(u)},d=function(u){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=u?2:1,this.isNonSync=u?0:1}},"./src/remux/passthrough-remuxer.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>T});var D=s("./src/polyfills/number.ts"),g=s("./src/remux/mp4-remuxer.ts"),b=s("./src/utils/mp4-tools.ts"),c=s("./src/loader/fragment.ts"),C=s("./src/utils/logger.ts"),x=function(){function L(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var I=L.prototype;return I.destroy=function(){},I.resetTimeStamp=function(_){this.initPTS=_,this.lastEndTime=null},I.resetNextTimestamp=function(){this.lastEndTime=null},I.resetInitSegment=function(_,v,n,l){this.audioCodec=v,this.videoCodec=n,this.generateInitSegment((0,b.patchEncyptionData)(_,l)),this.emitInitSegment=!0},I.generateInitSegment=function(_){var v=this.audioCodec,n=this.videoCodec;if(!_||!_.byteLength){this.initTracks=void 0,this.initData=void 0;return}var l=this.initData=(0,b.parseInitSegment)(_);v||(v=E(l.audio,c.ElementaryStreamTypes.AUDIO)),n||(n=E(l.video,c.ElementaryStreamTypes.VIDEO));var i={};l.audio&&l.video?i.audiovideo={container:"video/mp4",codec:v+","+n,initSegment:_,id:"main"}:l.audio?i.audio={container:"audio/mp4",codec:v,initSegment:_,id:"audio"}:l.video?i.video={container:"video/mp4",codec:n,initSegment:_,id:"main"}:C.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i},I.remux=function(_,v,n,l,i){var a,m=this.initPTS,p=this.lastEndTime,o={audio:void 0,video:void 0,text:l,id3:n,initSegment:void 0};(0,D.isFiniteNumber)(p)||(p=this.lastEndTime=i||0);var d=v.samples;if(!d||!d.length)return o;var A={initPTS:void 0,timescale:1},u=this.initData;if((!u||!u.length)&&(this.generateInitSegment(d),u=this.initData),!u||!u.length)return C.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),o;this.emitInitSegment&&(A.tracks=this.initTracks,this.emitInitSegment=!1);var f=(0,b.getStartDTS)(u,d);(0,D.isFiniteNumber)(m)||(this.initPTS=A.initPTS=m=f-i);var t=(0,b.getDuration)(d,u),h=_?f-m:p,e=h+t;(0,b.offsetStartDTS)(u,d,m),t>0?this.lastEndTime=e:(C.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var y=!!u.audio,P=!!u.video,S="";y&&(S+="audio"),P&&(S+="video");var w={data1:d,startPTS:h,startDTS:h,endPTS:e,endDTS:e,type:S,hasAudio:y,hasVideo:P,nb:1,dropped:0};o.audio=w.type==="audio"?w:void 0,o.video=w.type!=="audio"?w:void 0,o.initSegment=A;var k=(a=this.initPTS)!=null?a:0;return o.id3=(0,g.flushTextTrackMetadataCueSamples)(n,i,k,k),l.samples.length&&(o.text=(0,g.flushTextTrackUserdataCueSamples)(l,i,k)),o},L}();function E(L,I){var r=L==null?void 0:L.codec;return r&&r.length>4?r:r==="hvc1"||r==="hev1"?"hvc1.1.c.L120.90":r==="av01"?"av01.0.04M.08":r==="avc1"||I===c.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const T=x},"./src/task-loop.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>D});var D=function(){function g(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=g.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(C){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,C),!0)},b.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},b.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},b.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},g}()},"./src/types/cmcd.ts":(O,R,s)=>{s.r(R),s.d(R,{CMCDObjectType:()=>g,CMCDStreamType:()=>c,CMCDStreamingFormat:()=>b,CMCDVersion:()=>D});var D=1,g;(function(C){C.MANIFEST="m",C.AUDIO="a",C.VIDEO="v",C.MUXED="av",C.INIT="i",C.CAPTION="c",C.TIMED_TEXT="tt",C.KEY="k",C.OTHER="o"})(g||(g={}));var b;(function(C){C.DASH="d",C.HLS="h",C.SMOOTH="s",C.OTHER="o"})(b||(b={}));var c;(function(C){C.VOD="v",C.LIVE="l"})(c||(c={}))},"./src/types/demuxer.ts":(O,R,s)=>{s.r(R),s.d(R,{MetadataSchema:()=>D});var D;(function(g){g.audioId3="org.id3",g.dateRange="com.apple.quicktime.HLS",g.emsg="https://aomedia.org/emsg/ID3"})(D||(D={}))},"./src/types/level.ts":(O,R,s)=>{s.r(R),s.d(R,{HdcpLevels:()=>C,HlsSkip:()=>x,HlsUrlParameters:()=>T,Level:()=>L,getSkipValue:()=>E});function D(I,r){for(var _=0;_<r.length;_++){var v=r[_];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(I,b(v.key),v)}}function g(I,r,_){return r&&D(I.prototype,r),_&&D(I,_),Object.defineProperty(I,"prototype",{writable:!1}),I}function b(I){var r=c(I,"string");return typeof r=="symbol"?r:String(r)}function c(I,r){if(typeof I!="object"||I===null)return I;var _=I[Symbol.toPrimitive];if(_!==void 0){var v=_.call(I,r||"default");if(typeof v!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(I)}var C=["NONE","TYPE-0","TYPE-1","TYPE-2",null],x;(function(I){I.No="",I.Yes="YES",I.v2="v2"})(x||(x={}));function E(I,r){var _=I.canSkipUntil,v=I.canSkipDateRanges,n=I.endSN,l=r!==void 0?r-n:0;return _&&l<_?v?x.v2:x.Yes:x.No}var T=function(){function I(_,v,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=_,this.part=v,this.skip=n}var r=I.prototype;return r.addDirectives=function(v){var n=new self.URL(v);return this.msn!==void 0&&n.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&n.searchParams.set("_HLS_part",this.part.toString()),this.skip&&n.searchParams.set("_HLS_skip",this.skip),n.href},I}(),L=function(){function I(r){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[r.url],this.attrs=r.attrs,this.bitrate=r.bitrate,r.details&&(this.details=r.details),this.id=r.id||0,this.name=r.name,this.width=r.width||0,this.height=r.height||0,this.audioCodec=r.audioCodec,this.videoCodec=r.videoCodec,this.unknownCodecs=r.unknownCodecs,this.codecSet=[r.videoCodec,r.audioCodec].filter(function(_){return _}).join(",").replace(/\.[^.,]+/g,"")}return g(I,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(_){var v=_%this.url.length;this._urlId!==v&&(this.details=void 0,this._urlId=v)}}]),I}()},"./src/types/loader.ts":(O,R,s)=>{s.r(R),s.d(R,{PlaylistContextType:()=>D,PlaylistLevelType:()=>g});var D;(function(b){b.MANIFEST="manifest",b.LEVEL="level",b.AUDIO_TRACK="audioTrack",b.SUBTITLE_TRACK="subtitleTrack"})(D||(D={}));var g;(function(b){b.MAIN="main",b.AUDIO="audio",b.SUBTITLE="subtitle"})(g||(g={}))},"./src/types/transmuxer.ts":(O,R,s)=>{s.r(R),s.d(R,{ChunkMetadata:()=>D});var D=function(c,C,x,E,T,L){E===void 0&&(E=0),T===void 0&&(T=-1),L===void 0&&(L=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=g(),this.buffering={audio:g(),video:g(),audiovideo:g()},this.level=c,this.sn=C,this.id=x,this.size=E,this.part=T,this.partial=L};function g(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(O,R,s)=>{s.r(R),s.d(R,{AttrList:()=>b});var D=/^(\d+)x(\d+)$/,g=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,b=function(){function c(x){typeof x=="string"&&(x=c.parseAttrList(x));for(var E in x)x.hasOwnProperty(E)&&(this[E]=x[E])}var C=c.prototype;return C.decimalInteger=function(E){var T=parseInt(this[E],10);return T>Number.MAX_SAFE_INTEGER?1/0:T},C.hexadecimalInteger=function(E){if(this[E]){var T=(this[E]||"0x").slice(2);T=(T.length&1?"0":"")+T;for(var L=new Uint8Array(T.length/2),I=0;I<T.length/2;I++)L[I]=parseInt(T.slice(I*2,I*2+2),16);return L}else return null},C.hexadecimalIntegerAsNumber=function(E){var T=parseInt(this[E],16);return T>Number.MAX_SAFE_INTEGER?1/0:T},C.decimalFloatingPoint=function(E){return parseFloat(this[E])},C.optionalFloat=function(E,T){var L=this[E];return L?parseFloat(L):T},C.enumeratedString=function(E){return this[E]},C.bool=function(E){return this[E]==="YES"},C.decimalResolution=function(E){var T=D.exec(this[E]);if(T!==null)return{width:parseInt(T[1],10),height:parseInt(T[2],10)}},c.parseAttrList=function(E){var T,L={},I='"';for(g.lastIndex=0;(T=g.exec(E))!==null;){var r=T[2];r.indexOf(I)===0&&r.lastIndexOf(I)===r.length-1&&(r=r.slice(1,-1)),L[T[1]]=r}return L},c}()},"./src/utils/binary-search.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>g});var D={search:function(c,C){for(var x=0,E=c.length-1,T=null,L=null;x<=E;){T=(x+E)/2|0,L=c[T];var I=C(L);if(I>0)x=T+1;else if(I<0)E=T-1;else return L}return null}};const g=D},"./src/utils/buffer-helper.ts":(O,R,s)=>{s.r(R),s.d(R,{BufferHelper:()=>b});var D=s("./src/utils/logger.ts"),g={length:0,start:function(){return 0},end:function(){return 0}},b=function(){function c(){}return c.isBuffered=function(x,E){try{if(x){for(var T=c.getBuffered(x),L=0;L<T.length;L++)if(E>=T.start(L)&&E<=T.end(L))return!0}}catch(I){}return!1},c.bufferInfo=function(x,E,T){try{if(x){var L=c.getBuffered(x),I=[],r;for(r=0;r<L.length;r++)I.push({start:L.start(r),end:L.end(r)});return this.bufferedInfo(I,E,T)}}catch(_){}return{len:0,start:E,end:E,nextStart:void 0}},c.bufferedInfo=function(x,E,T){E=Math.max(0,E),x.sort(function(o,d){var A=o.start-d.start;return A||d.end-o.end});var L=[];if(T)for(var I=0;I<x.length;I++){var r=L.length;if(r){var _=L[r-1].end;x[I].start-_<T?x[I].end>_&&(L[r-1].end=x[I].end):L.push(x[I])}else L.push(x[I])}else L=x;for(var v=0,n,l=E,i=E,a=0;a<L.length;a++){var m=L[a].start,p=L[a].end;if(E+T>=m&&E<p)l=m,i=p,v=i-E;else if(E+T<m){n=m;break}}return{len:v,start:l||0,end:i||0,nextStart:n}},c.getBuffered=function(x){try{return x.buffered}catch(E){return D.logger.log("failed to get media.buffered",E),g}},c}()},"./src/utils/cea-608-parser.ts":(O,R,s)=>{s.r(R),s.d(R,{CaptionScreen:()=>a,Row:()=>i,default:()=>u});var D=s("./src/utils/logger.ts"),g={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},b=function(t){var h=t;return g.hasOwnProperty(t)&&(h=g[t]),String.fromCharCode(h)},c=15,C=100,x={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},E={17:2,18:4,21:6,22:8,23:10,19:13,20:15},T={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},L={25:2,26:4,29:6,30:8,31:10,27:13,28:15},I=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],r;(function(f){f[f.ERROR=0]="ERROR",f[f.TEXT=1]="TEXT",f[f.WARNING=2]="WARNING",f[f.INFO=2]="INFO",f[f.DEBUG=3]="DEBUG",f[f.DATA=3]="DATA"})(r||(r={}));var _=function(){function f(){this.time=null,this.verboseLevel=r.ERROR}var t=f.prototype;return t.log=function(e,y){if(this.verboseLevel>=e){var P=typeof y=="function"?y():y;D.logger.log(this.time+" ["+e+"] "+P)}},f}(),v=function(t){for(var h=[],e=0;e<t.length;e++)h.push(t[e].toString(16));return h},n=function(){function f(h,e,y,P,S){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=h||"white",this.underline=e||!1,this.italics=y||!1,this.background=P||"black",this.flash=S||!1}var t=f.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var y=["foreground","underline","italics","background","flash"],P=0;P<y.length;P++){var S=y[P];e.hasOwnProperty(S)&&(this[S]=e[S])}},t.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},f}(),l=function(){function f(h,e,y,P,S,w){this.uchar=void 0,this.penState=void 0,this.uchar=h||" ",this.penState=new n(e,y,P,S,w)}var t=f.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,y){this.uchar=e,this.penState.copy(y)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},f}(),i=function(){function f(h){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<C;e++)this.chars.push(new l);this.logger=h,this.pos=0,this.currPenState=new n}var t=f.prototype;return t.equals=function(e){for(var y=!0,P=0;P<C;P++)if(!this.chars[P].equals(e.chars[P])){y=!1;break}return y},t.copy=function(e){for(var y=0;y<C;y++)this.chars[y].copy(e.chars[y])},t.isEmpty=function(){for(var e=!0,y=0;y<C;y++)if(!this.chars[y].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(r.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>C&&(this.logger.log(r.DEBUG,"Too large cursor position "+this.pos),this.pos=C)},t.moveCursor=function(e){var y=this.pos+e;if(e>1)for(var P=this.pos+1;P<y+1;P++)this.chars[P].setPenState(this.currPenState);this.setCursor(y)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){var y=this;e>=144&&this.backSpace();var P=b(e);if(this.pos>=C){this.logger.log(r.ERROR,function(){return"Cannot insert "+e.toString(16)+" ("+P+") at position "+y.pos+". Skipping it!"});return}this.chars[this.pos].setChar(P,this.currPenState),this.moveCursor(1)},t.clearFromPos=function(e){var y;for(y=e;y<C;y++)this.chars[y].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],y=!0,P=0;P<C;P++){var S=this.chars[P].uchar;S!==" "&&(y=!1),e.push(S)}return y?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e);var y=this.chars[this.pos];y.setPenState(this.currPenState)},f}(),a=function(){function f(h){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<c;e++)this.rows.push(new i(h));this.logger=h,this.currRow=c-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=f.prototype;return t.reset=function(){for(var e=0;e<c;e++)this.rows[e].clear();this.currRow=c-1},t.equals=function(e){for(var y=!0,P=0;P<c;P++)if(!this.rows[P].equals(e.rows[P])){y=!1;break}return y},t.copy=function(e){for(var y=0;y<c;y++)this.rows[y].copy(e.rows[y])},t.isEmpty=function(){for(var e=!0,y=0;y<c;y++)if(!this.rows[y].isEmpty()){e=!1;break}return e},t.backSpace=function(){var e=this.rows[this.currRow];e.backSpace()},t.clearToEndOfRow=function(){var e=this.rows[this.currRow];e.clearToEndOfRow()},t.insertChar=function(e){var y=this.rows[this.currRow];y.insertChar(e)},t.setPen=function(e){var y=this.rows[this.currRow];y.setPenStyles(e)},t.moveCursor=function(e){var y=this.rows[this.currRow];y.moveCursor(e)},t.setCursor=function(e){this.logger.log(r.INFO,"setCursor: "+e);var y=this.rows[this.currRow];y.setCursor(e)},t.setPAC=function(e){this.logger.log(r.INFO,function(){return"pacData = "+JSON.stringify(e)});var y=e.row-1;if(this.nrRollUpRows&&y<this.nrRollUpRows-1&&(y=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==y){for(var P=0;P<c;P++)this.rows[P].clear();var S=this.currRow+1-this.nrRollUpRows,w=this.lastOutputScreen;if(w){var k=w.rows[S].cueStartTime,F=this.logger.time;if(k&&F!==null&&k<F)for(var U=0;U<this.nrRollUpRows;U++)this.rows[y-this.nrRollUpRows+U+1].copy(w.rows[S+U])}}this.currRow=y;var N=this.rows[this.currRow];if(e.indent!==null){var j=e.indent,W=Math.max(j-1,0);N.setCursor(e.indent),e.color=N.chars[W].penState.foreground}var H={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(H)},t.setBkgData=function(e){this.logger.log(r.INFO,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){var e=this;if(this.nrRollUpRows===null){this.logger.log(r.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(r.TEXT,function(){return e.getDisplayText()});var y=this.currRow+1-this.nrRollUpRows,P=this.rows.splice(y,1)[0];P.clear(),this.rows.splice(this.currRow,0,P),this.logger.log(r.INFO,"Rolling up")},t.getDisplayText=function(e){e=e||!1;for(var y=[],P="",S=-1,w=0;w<c;w++){var k=this.rows[w].getTextString();k&&(S=w+1,e?y.push("Row "+S+": '"+k+"'"):y.push(k.trim()))}return y.length>0&&(e?P="["+y.join(" | ")+"]":P=y.join(`
`)),P},t.getTextAndFormat=function(){return this.rows},f}(),m=function(){function f(h,e,y){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=h,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new a(y),this.nonDisplayedMemory=new a(y),this.lastOutputScreen=new a(y),this.currRollUpRow=this.displayedMemory.rows[c-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=y}var t=f.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[c-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(r.INFO,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var y=this,P=0;P<e.length;P++)this.writeScreen.insertChar(e[P]);var S=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(r.INFO,function(){return S+": "+y.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(r.TEXT,function(){return"DISPLAYED: "+y.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(r.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(r.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(r.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(r.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(r.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(r.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(r.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(r.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(r.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(r.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(r.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){var e=this;if(this.logger.log(r.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var y=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=y,this.writeScreen=this.nonDisplayedMemory,this.logger.log(r.TEXT,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(r.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var y={flash:!1};if(y.underline=e%2===1,y.italics=e>=46,y.italics)y.foreground="white";else{var P=Math.floor(e/2)-16,S=["white","green","blue","cyan","red","yellow","magenta"];y.foreground=S[P]}this.logger.log(r.INFO,"MIDROW: "+JSON.stringify(y)),this.writeScreen.setPen(y)},t.outputDataUpdate=function(e){e===void 0&&(e=!1);var y=this.logger.time;y!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=y:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,y,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:y),this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},f}(),p=function(){function f(h,e,y){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var P=new _;this.channels=[null,new m(h,e,P),new m(h+1,y,P)],this.cmdHistory=A(),this.logger=P}var t=f.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,y){this.channels[e].setHandler(y)},t.addData=function(e,y){var P,S,w,k=!1;this.logger.time=e;for(var F=0;F<y.length;F+=2)if(S=y[F]&127,w=y[F+1]&127,!(S===0&&w===0)){if(this.logger.log(r.DATA,"["+v([y[F],y[F+1]])+"] -> ("+v([S,w])+")"),P=this.parseCmd(S,w),P||(P=this.parseMidrow(S,w)),P||(P=this.parsePAC(S,w)),P||(P=this.parseBackgroundAttributes(S,w)),!P&&(k=this.parseChars(S,w),k)){var U=this.currentChannel;if(U&&U>0){var N=this.channels[U];N.insertChars(k)}else this.logger.log(r.WARNING,"No channel found yet. TEXT-MODE?")}!P&&!k&&this.logger.log(r.WARNING,"Couldn't parse cleaned data "+v([S,w])+" orig: "+v([y[F],y[F+1]]))}},t.parseCmd=function(e,y){var P=this.cmdHistory,S=(e===20||e===28||e===21||e===29)&&y>=32&&y<=47,w=(e===23||e===31)&&y>=33&&y<=35;if(!(S||w))return!1;if(d(e,y,P))return o(null,null,P),this.logger.log(r.DEBUG,"Repeated command ("+v([e,y])+") is dropped"),!0;var k=e===20||e===21||e===23?1:2,F=this.channels[k];return e===20||e===21||e===28||e===29?y===32?F.ccRCL():y===33?F.ccBS():y===34?F.ccAOF():y===35?F.ccAON():y===36?F.ccDER():y===37?F.ccRU(2):y===38?F.ccRU(3):y===39?F.ccRU(4):y===40?F.ccFON():y===41?F.ccRDC():y===42?F.ccTR():y===43?F.ccRTD():y===44?F.ccEDM():y===45?F.ccCR():y===46?F.ccENM():y===47&&F.ccEOC():F.ccTO(y-32),o(e,y,P),this.currentChannel=k,!0},t.parseMidrow=function(e,y){var P=0;if((e===17||e===25)&&y>=32&&y<=47){if(e===17?P=1:P=2,P!==this.currentChannel)return this.logger.log(r.ERROR,"Mismatch channel in midrow parsing"),!1;var S=this.channels[P];return S?(S.ccMIDROW(y),this.logger.log(r.DEBUG,"MIDROW ("+v([e,y])+")"),!0):!1}return!1},t.parsePAC=function(e,y){var P,S=this.cmdHistory,w=(e>=17&&e<=23||e>=25&&e<=31)&&y>=64&&y<=127,k=(e===16||e===24)&&y>=64&&y<=95;if(!(w||k))return!1;if(d(e,y,S))return o(null,null,S),!0;var F=e<=23?1:2;y>=64&&y<=95?P=F===1?x[e]:T[e]:P=F===1?E[e]:L[e];var U=this.channels[F];return U?(U.setPAC(this.interpretPAC(P,y)),o(e,y,S),this.currentChannel=F,!0):!1},t.interpretPAC=function(e,y){var P,S={color:null,italics:!1,indent:null,underline:!1,row:e};return y>95?P=y-96:P=y-64,S.underline=(P&1)===1,P<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(P/2)]:P<=15?(S.italics=!0,S.color="white"):S.indent=Math.floor((P-16)/2)*4,S},t.parseChars=function(e,y){var P,S=null,w=null;if(e>=25?(P=2,w=e-8):(P=1,w=e),w>=17&&w<=19){var k;w===17?k=y+80:w===18?k=y+112:k=y+144,this.logger.log(r.INFO,"Special char '"+b(k)+"' in channel "+P),S=[k]}else e>=32&&e<=127&&(S=y===0?[e]:[e,y]);if(S){var F=v(S);this.logger.log(r.DEBUG,"Char codes =  "+F.join(",")),o(e,y,this.cmdHistory)}return S},t.parseBackgroundAttributes=function(e,y){var P=(e===16||e===24)&&y>=32&&y<=47,S=(e===23||e===31)&&y>=45&&y<=47;if(!(P||S))return!1;var w,k={};e===16||e===24?(w=Math.floor((y-32)/2),k.background=I[w],y%2===1&&(k.background=k.background+"_semi")):y===45?k.background="transparent":(k.foreground="black",y===47&&(k.underline=!0));var F=e<=23?1:2,U=this.channels[F];return U.setBkgData(k),o(e,y,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var y=this.channels[e];y&&y.reset()}this.cmdHistory=A()},t.cueSplitAtTime=function(e){for(var y=0;y<this.channels.length;y++){var P=this.channels[y];P&&P.cueSplitAtTime(e)}},f}();function o(f,t,h){h.a=f,h.b=t}function d(f,t,h){return h.a===f&&h.b===t}function A(){return{a:null,b:null}}const u=p},"./src/utils/codecs.ts":(O,R,s)=>{s.r(R),s.d(R,{isCodecSupportedInMp4:()=>b,isCodecType:()=>g});var D={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function g(c,C){var x=D[C];return!!x&&x[c.slice(0,4)]===!0}function b(c,C){return MediaSource.isTypeSupported((C||"video")+'/mp4;codecs="'+c+'"')}},"./src/utils/cues.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>x});var D=s("./src/utils/vttparser.ts"),g=s("./src/utils/webvtt-parser.ts"),b=s("./src/utils/texttrack-utils.ts"),c=/\s/,C={newCue:function(T,L,I,r){for(var _=[],v,n,l,i,a,m=self.VTTCue||self.TextTrackCue,p=0;p<r.rows.length;p++)if(v=r.rows[p],l=!0,i=0,a="",!v.isEmpty()){for(var o=0;o<v.chars.length;o++)c.test(v.chars[o].uchar)&&l?i++:(a+=v.chars[o].uchar,l=!1);v.cueStartTime=L,L===I&&(I+=1e-4),i>=16?i--:i++;var d=(0,D.fixLineBreaks)(a.trim()),A=(0,g.generateCueId)(L,I,d);(!T||!T.cues||!T.cues.getCueById(A))&&(n=new m(L,I,d),n.id=A,n.line=p+1,n.align="left",n.position=10+Math.min(80,Math.floor(i*8/32)*10),_.push(n))}return T&&_.length&&(_.sort(function(u,f){return u.line==="auto"||f.line==="auto"?0:u.line>8&&f.line>8?f.line-u.line:u.line-f.line}),_.forEach(function(u){return(0,b.addCueToTrack)(T,u)})),_}};const x=C},"./src/utils/discontinuities.ts":(O,R,s)=>{s.r(R),s.d(R,{adjustSlidingStart:()=>T,alignMediaPlaylistByPDT:()=>_,alignPDT:()=>r,alignStream:()=>L,findDiscontinuousReferenceFrag:()=>x,findFirstFragWithCC:()=>c,shouldAlignOnDiscontinuities:()=>C});var D=s("./src/polyfills/number.ts"),g=s("./src/utils/logger.ts"),b=s("./src/controller/level-helper.ts");function c(v,n){for(var l=null,i=0,a=v.length;i<a;i++){var m=v[i];if(m&&m.cc===n){l=m;break}}return l}function C(v,n,l){return!!(n.details&&(l.endCC>l.startCC||v&&v.cc<l.startCC))}function x(v,n,l){var i=v.fragments,a=n.fragments;if(!a.length||!i.length){g.logger.log("No fragments to align");return}var m=c(i,a[0].cc);if(!m||m&&!m.startPTS){g.logger.log("No frag in previous level to align on");return}return m}function E(v,n){if(v){var l=v.start+n;v.start=v.startPTS=l,v.endPTS=l+v.duration}}function T(v,n){for(var l=n.fragments,i=0,a=l.length;i<a;i++)E(l[i],v);n.fragmentHint&&E(n.fragmentHint,v),n.alignedSliding=!0}function L(v,n,l){!n||(I(v,l,n),!l.alignedSliding&&n.details&&r(l,n.details),!l.alignedSliding&&n.details&&!l.skippedSegments&&(0,b.adjustSliding)(n.details,l))}function I(v,n,l){if(C(v,l,n)){var i=x(l.details,n);i&&(0,D.isFiniteNumber)(i.start)&&(g.logger.log("Adjusting PTS using last level due to CC increase within current level "+n.url),T(i.start,n))}}function r(v,n){if(!(!n.fragments.length||!v.hasProgramDateTime||!n.hasProgramDateTime)){var l=n.fragments[0].programDateTime,i=v.fragments[0].programDateTime,a=(i-l)/1e3+n.fragments[0].start;a&&(0,D.isFiniteNumber)(a)&&(g.logger.log("Adjusting PTS using programDateTime delta "+(i-l)+"ms, sliding:"+a.toFixed(3)+" "+v.url+" "),T(a,v))}}function _(v,n){if(!(!v.hasProgramDateTime||!n.hasProgramDateTime)){var l=v.fragments,i=n.fragments;if(!(!l.length||!i.length)){var a=Math.round(i.length/2)-1,m=i[a],p=c(l,m.cc)||l[Math.round(l.length/2)-1],o=m.programDateTime,d=p.programDateTime;if(!(o===null||d===null)){var A=(d-o)/1e3-(p.start-m.start);T(A,v)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>b});var D=s("./src/utils/ewma.ts"),g=function(){function c(x,E,T){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=T,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new D.default(x),this.fast_=new D.default(E)}var C=c.prototype;return C.update=function(E,T){var L=this.slow_,I=this.fast_;this.slow_.halfLife!==E&&(this.slow_=new D.default(E,L.getEstimate(),L.getTotalWeight())),this.fast_.halfLife!==T&&(this.fast_=new D.default(T,I.getEstimate(),I.getTotalWeight()))},C.sample=function(E,T){E=Math.max(E,this.minDelayMs_);var L=8*T,I=E/1e3,r=L/I;this.fast_.sample(I,r),this.slow_.sample(I,r)},C.canEstimate=function(){var E=this.fast_;return E&&E.getTotalWeight()>=this.minWeight_},C.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},C.destroy=function(){},c}();const b=g},"./src/utils/ewma.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>g});var D=function(){function b(C,x,E){x===void 0&&(x=0),E===void 0&&(E=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=C,this.alpha_=C?Math.exp(Math.log(.5)/C):0,this.estimate_=x,this.totalWeight_=E}var c=b.prototype;return c.sample=function(x,E){var T=Math.pow(this.alpha_,x);this.estimate_=E*(1-T)+T*this.estimate_,this.totalWeight_+=x},c.getTotalWeight=function(){return this.totalWeight_},c.getEstimate=function(){if(this.alpha_){var x=1-Math.pow(this.alpha_,this.totalWeight_);if(x)return this.estimate_/x}return this.estimate_},b}();const g=D},"./src/utils/fetch-loader.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>a,fetchSupported:()=>_});var D=s("./src/polyfills/number.ts"),g=s("./src/loader/load-stats.ts"),b=s("./src/demux/chunk-cache.ts");function c(m,p){m.prototype=Object.create(p.prototype),m.prototype.constructor=m,L(m,p)}function C(m){var p=typeof Map=="function"?new Map:void 0;return C=function(d){if(d===null||!T(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(typeof p<"u"){if(p.has(d))return p.get(d);p.set(d,A)}function A(){return x(d,arguments,I(this).constructor)}return A.prototype=Object.create(d.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),L(A,d)},C(m)}function x(m,p,o){return E()?x=Reflect.construct.bind():x=function(A,u,f){var t=[null];t.push.apply(t,u);var h=Function.bind.apply(A,t),e=new h;return f&&L(e,f.prototype),e},x.apply(null,arguments)}function E(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(m){return!1}}function T(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function L(m,p){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,A){return d.__proto__=A,d},L(m,p)}function I(m){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},I(m)}function r(){return r=Object.assign?Object.assign.bind():function(m){for(var p=1;p<arguments.length;p++){var o=arguments[p];for(var d in o)Object.prototype.hasOwnProperty.call(o,d)&&(m[d]=o[d])}return m},r.apply(this,arguments)}function _(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(m){}return!1}var v=function(){function m(o){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=o.fetchSetup||l,this.controller=new self.AbortController,this.stats=new g.LoadStats}var p=m.prototype;return p.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},p.abortInternal=function(){var d=this.response;(!d||!d.ok)&&(this.stats.aborted=!0,this.controller.abort())},p.abort=function(){var d;this.abortInternal(),(d=this.callbacks)!==null&&d!==void 0&&d.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},p.load=function(d,A,u){var f=this,t=this.stats;if(t.loading.start)throw new Error("Loader can only be used once.");t.loading.start=self.performance.now();var h=n(d,this.controller.signal),e=u.onProgress,y=d.responseType==="arraybuffer",P=y?"byteLength":"length";this.context=d,this.config=A,this.callbacks=u,this.request=this.fetchSetup(d,h),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){f.abortInternal(),u.onTimeout(t,d,f.response)},A.timeout),self.fetch(this.request).then(function(S){if(f.response=f.loader=S,!S.ok){var w=S.status,k=S.statusText;throw new i(k||"fetch, bad network response",w,S)}return t.loading.first=Math.max(self.performance.now(),t.loading.start),t.total=parseInt(S.headers.get("Content-Length")||"0"),e&&(0,D.isFiniteNumber)(A.highWaterMark)?f.loadProgressively(S,t,d,A.highWaterMark,e):y?S.arrayBuffer():S.text()}).then(function(S){var w=f.response;self.clearTimeout(f.requestTimeout),t.loading.end=Math.max(self.performance.now(),t.loading.first);var k=S[P];k&&(t.loaded=t.total=k);var F={url:w.url,data:S};e&&!(0,D.isFiniteNumber)(A.highWaterMark)&&e(t,d,S,w),u.onSuccess(F,t,d,w)}).catch(function(S){if(self.clearTimeout(f.requestTimeout),!t.aborted){var w=S&&S.code||0,k=S?S.message:null;u.onError({code:w,text:k},d,S?S.details:null)}})},p.getCacheAge=function(){var d=null;if(this.response){var A=this.response.headers.get("age");d=A?parseFloat(A):null}return d},p.loadProgressively=function(d,A,u,f,t){f===void 0&&(f=0);var h=new b.default,e=d.body.getReader(),y=function P(){return e.read().then(function(S){if(S.done)return h.dataLength&&t(A,u,h.flush(),d),Promise.resolve(new ArrayBuffer(0));var w=S.value,k=w.length;return A.loaded+=k,k<f||h.dataLength?(h.push(w),h.dataLength>=f&&t(A,u,h.flush(),d)):t(A,u,w,d),P()}).catch(function(){return Promise.reject()})};return y()},m}();function n(m,p){var o={method:"GET",mode:"cors",credentials:"same-origin",signal:p,headers:new self.Headers(r({},m.headers))};return m.rangeEnd&&o.headers.set("Range","bytes="+m.rangeStart+"-"+String(m.rangeEnd-1)),o}function l(m,p){return new self.Request(m.url,p)}var i=function(m){c(p,m);function p(o,d,A){var u;return u=m.call(this,o)||this,u.code=void 0,u.details=void 0,u.code=d,u.details=A,u}return p}(C(Error));const a=v},"./src/utils/hex.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>g});var D={hexDump:function(c){for(var C="",x=0;x<c.length;x++){var E=c[x].toString(16);E.length<2&&(E="0"+E),C+=E}return C}};const g=D},"./src/utils/imsc1-ttml-parser.ts":(O,R,s)=>{s.r(R),s.d(R,{IMSC1_CODEC:()=>T,parseIMSC1:()=>_});var D=s("./src/utils/mp4-tools.ts"),g=s("./src/utils/vttparser.ts"),b=s("./src/utils/vttcue.ts"),c=s("./src/demux/id3.ts"),C=s("./src/utils/timescale-conversion.ts"),x=s("./src/utils/webvtt-parser.ts");function E(){return E=Object.assign?Object.assign.bind():function(u){for(var f=1;f<arguments.length;f++){var t=arguments[f];for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&(u[h]=t[h])}return u},E.apply(this,arguments)}var T="stpp.ttml.im1t",L=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,I=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,r={left:"start",center:"center",right:"end",start:"start",end:"end"};function _(u,f,t,h,e){var y=(0,D.findBox)(new Uint8Array(u),["mdat"]);if(y.length===0){e(new Error("Could not parse IMSC1 mdat"));return}var P=y.map(function(w){return(0,c.utf8ArrayToStr)(w)}),S=(0,C.toTimescaleFromScale)(f,1,t);try{P.forEach(function(w){return h(v(w,S))})}catch(w){e(w)}}function v(u,f){var t=new DOMParser,h=t.parseFromString(u,"text/xml"),e=h.getElementsByTagName("tt")[0];if(!e)throw new Error("Invalid ttml");var y={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},P=Object.keys(y).reduce(function(U,N){return U[N]=e.getAttribute("ttp:"+N)||y[N],U},{}),S=e.getAttribute("xml:space")!=="preserve",w=l(n(e,"styling","style")),k=l(n(e,"layout","region")),F=n(e,"body","[begin]");return[].map.call(F,function(U){var N=i(U,S);if(!N||!U.hasAttribute("begin"))return null;var j=o(U.getAttribute("begin"),P),W=o(U.getAttribute("dur"),P),H=o(U.getAttribute("end"),P);if(j===null)throw p(U);if(H===null){if(W===null)throw p(U);H=j+W}var G=new b.default(j-f,H-f,N);G.id=(0,x.generateCueId)(G.startTime,G.endTime,G.text);var V=k[U.getAttribute("region")],Y=w[U.getAttribute("style")],Q=a(V,Y,w),z=Q.textAlign;if(z){var X=r[z];X&&(G.lineAlign=X),G.align=z}return E(G,Q),G}).filter(function(U){return U!==null})}function n(u,f,t){var h=u.getElementsByTagName(f)[0];return h?[].slice.call(h.querySelectorAll(t)):[]}function l(u){return u.reduce(function(f,t){var h=t.getAttribute("xml:id");return h&&(f[h]=t),f},{})}function i(u,f){return[].slice.call(u.childNodes).reduce(function(t,h,e){var y;return h.nodeName==="br"&&e?t+`
`:(y=h.childNodes)!==null&&y!==void 0&&y.length?i(h,f):f?t+h.textContent.trim().replace(/\s+/g," "):t+h.textContent},"")}function a(u,f,t){var h="http://www.w3.org/ns/ttml#styling",e=null,y=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],P=u!=null&&u.hasAttribute("style")?u.getAttribute("style"):null;return P&&t.hasOwnProperty(P)&&(e=t[P]),y.reduce(function(S,w){var k=m(f,h,w)||m(u,h,w)||m(e,h,w);return k&&(S[w]=k),S},{})}function m(u,f,t){return u&&u.hasAttributeNS(f,t)?u.getAttributeNS(f,t):null}function p(u){return new Error("Could not parse ttml timestamp "+u)}function o(u,f){if(!u)return null;var t=(0,g.parseTimeStamp)(u);return t===null&&(L.test(u)?t=d(u,f):I.test(u)&&(t=A(u,f))),t}function d(u,f){var t=L.exec(u),h=(t[4]|0)+(t[5]|0)/f.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+h/f.frameRate}function A(u,f){var t=I.exec(u),h=Number(t[1]),e=t[2];switch(e){case"h":return h*3600;case"m":return h*60;case"ms":return h*1e3;case"f":return h/f.frameRate;case"t":return h/f.tickRate}return h}},"./src/utils/keysystem-util.ts":(O,R,s)=>{s.r(R),s.d(R,{changeEndianness:()=>b,convertDataUriToArrayBytes:()=>c,strToUtf8array:()=>C});var D=s("./src/utils/numeric-encoding-utils.ts");function g(x){var E=C(x).subarray(0,16),T=new Uint8Array(16);return T.set(E,16-E.length),T}function b(x){var E=function(L,I,r){var _=L[I];L[I]=L[r],L[r]=_};E(x,0,3),E(x,1,2),E(x,4,5),E(x,6,7)}function c(x){var E=x.split(":"),T=null;if(E[0]==="data"&&E.length===2){var L=E[1].split(";"),I=L[L.length-1].split(",");if(I.length===2){var r=I[0]==="base64",_=I[1];r?(L.splice(-1,1),T=(0,D.base64Decode)(_)):T=g(_)}}return T}function C(x){return Uint8Array.from(unescape(encodeURIComponent(x)),function(E){return E.charCodeAt(0)})}},"./src/utils/logger.ts":(O,R,s)=>{s.r(R),s.d(R,{enableLogs:()=>x,logger:()=>E});var D=function(){},g={trace:D,debug:D,log:D,warn:D,info:D,error:D},b=g;function c(T){var L=self.console[T];return L?L.bind(self.console,"["+T+"] >"):D}function C(T){for(var L=arguments.length,I=new Array(L>1?L-1:0),r=1;r<L;r++)I[r-1]=arguments[r];I.forEach(function(_){b[_]=T[_]?T[_].bind(T):c(_)})}function x(T,L){if(self.console&&T===!0||typeof T=="object"){C(T,"debug","log","info","warn","error");try{b.log('Debug logs enabled for "'+L+'"')}catch(I){b=g}}else b=g}var E=b},"./src/utils/mediakeys-helper.ts":(O,R,s)=>{s.r(R),s.d(R,{KeySystemFormats:()=>g,KeySystemIds:()=>c,KeySystems:()=>D,getKeySystemsForConfig:()=>E,getSupportedMediaKeySystemConfigurations:()=>L,keySystemDomainToKeySystemFormat:()=>x,keySystemFormatToKeySystemDomain:()=>b,keySystemIdToKeySystemDomain:()=>C,requestMediaKeySystemAccess:()=>T});var D;(function(r){r.CLEARKEY="org.w3.clearkey",r.FAIRPLAY="com.apple.fps",r.PLAYREADY="com.microsoft.playready",r.WIDEVINE="com.widevine.alpha"})(D||(D={}));var g;(function(r){r.CLEARKEY="org.w3.clearkey",r.FAIRPLAY="com.apple.streamingkeydelivery",r.PLAYREADY="com.microsoft.playready",r.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"})(g||(g={}));function b(r){switch(r){case g.FAIRPLAY:return D.FAIRPLAY;case g.PLAYREADY:return D.PLAYREADY;case g.WIDEVINE:return D.WIDEVINE;case g.CLEARKEY:return D.CLEARKEY}}var c;(function(r){r.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"})(c||(c={}));function C(r){if(r===c.WIDEVINE)return D.WIDEVINE}function x(r){switch(r){case D.FAIRPLAY:return g.FAIRPLAY;case D.PLAYREADY:return g.PLAYREADY;case D.WIDEVINE:return g.WIDEVINE;case D.CLEARKEY:return g.CLEARKEY}}function E(r){var _=r.drmSystems,v=r.widevineLicenseUrl,n=_?[D.FAIRPLAY,D.WIDEVINE,D.PLAYREADY,D.CLEARKEY].filter(function(l){return!!_[l]}):[];return!n[D.WIDEVINE]&&v&&n.push(D.WIDEVINE),n}var T=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function L(r,_,v,n){var l;switch(r){case D.FAIRPLAY:l=["cenc","sinf"];break;case D.WIDEVINE:case D.PLAYREADY:l=["cenc"];break;case D.CLEARKEY:l=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+r)}return I(l,_,v,n)}function I(r,_,v,n){var l={initDataTypes:r,persistentState:n.persistentState||"not-allowed",distinctiveIdentifier:n.distinctiveIdentifier||"not-allowed",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:_.map(function(i){return{contentType:'audio/mp4; codecs="'+i+'"',robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null}}),videoCapabilities:v.map(function(i){return{contentType:'video/mp4; codecs="'+i+'"',robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}})};return[l]}},"./src/utils/mediasource-helper.ts":(O,R,s)=>{s.r(R),s.d(R,{getMediaSource:()=>D});function D(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(O,R,s)=>{s.r(R),s.d(R,{RemuxerTrackIdConfig:()=>T,appendUint8Array:()=>f,bin2str:()=>L,computeRawDurationFromSamples:()=>d,discardEPB:()=>P,findBox:()=>n,getDuration:()=>o,getStartDTS:()=>p,mp4Box:()=>w,mp4pssh:()=>k,offsetStartDTS:()=>A,parseEmsg:()=>S,parseInitSegment:()=>i,parsePssh:()=>F,parseSEIMessageFromNALu:()=>y,parseSamples:()=>t,parseSegmentIndex:()=>l,parseSinf:()=>m,patchEncyptionData:()=>a,readSint32:()=>_,readUint16:()=>I,readUint32:()=>r,segmentValidRange:()=>u,writeUint32:()=>v});var D=s("./src/loader/fragment.ts"),g=s("./src/utils/typed-array.ts"),b=s("./src/demux/id3.ts"),c=s("./src/utils/logger.ts"),C=s("./src/utils/hex.ts"),x=Math.pow(2,32)-1,E=[].push,T={video:1,audio:2,id3:3,text:4};function L(U){return String.fromCharCode.apply(null,U)}function I(U,N){var j=U[N]<<8|U[N+1];return j<0?65536+j:j}function r(U,N){var j=_(U,N);return j<0?4294967296+j:j}function _(U,N){return U[N]<<24|U[N+1]<<16|U[N+2]<<8|U[N+3]}function v(U,N,j){U[N]=j>>24,U[N+1]=j>>16&255,U[N+2]=j>>8&255,U[N+3]=j&255}function n(U,N){var j=[];if(!N.length)return j;for(var W=U.byteLength,H=0;H<W;){var G=r(U,H),V=L(U.subarray(H+4,H+8)),Y=G>1?H+G:W;if(V===N[0])if(N.length===1)j.push(U.subarray(H+8,Y));else{var Q=n(U.subarray(H+8,Y),N.slice(1));Q.length&&E.apply(j,Q)}H=Y}return j}function l(U){var N=[],j=U[0],W=8,H=r(U,W);W+=4;var G=0,V=0;j===0?W+=8:W+=16,W+=2;var Y=U.length+V,Q=I(U,W);W+=2;for(var z=0;z<Q;z++){var X=W,q=r(U,X);X+=4;var te=q&2147483647,ee=(q&2147483648)>>>31;if(ee===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var Z=r(U,X);X+=4,N.push({referenceSize:te,subsegmentDuration:Z,info:{duration:Z/H,start:Y,end:Y+te-1}}),Y+=te,X+=4,W=X}return{earliestPresentationTime:G,timescale:H,version:j,referencesCount:Q,references:N}}function i(U){for(var N=[],j=n(U,["moov","trak"]),W=0;W<j.length;W++){var H=j[W],G=n(H,["tkhd"])[0];if(G){var V=G[0],Y=V===0?12:20,Q=r(G,Y),z=n(H,["mdia","mdhd"])[0];if(z){V=z[0],Y=V===0?12:20;var X=r(z,Y),q=n(H,["mdia","hdlr"])[0];if(q){var te=L(q.subarray(8,12)),ee={soun:D.ElementaryStreamTypes.AUDIO,vide:D.ElementaryStreamTypes.VIDEO}[te];if(ee){var Z=n(H,["mdia","minf","stbl","stsd"])[0],J=void 0;Z&&(J=L(Z.subarray(12,16))),N[Q]={timescale:X,type:ee},N[ee]={timescale:X,id:Q,codec:J}}}}}}var ie=n(U,["moov","mvex","trex"]);return ie.forEach(function(ne){var ue=r(ne,4),oe=N[ue];oe&&(oe.default={duration:r(ne,12),flags:r(ne,20)})}),N}function a(U,N){if(!U||!N)return U;var j=N.keyId;if(j&&N.isCommonEncryption){var W=n(U,["moov","trak"]);W.forEach(function(H){var G=n(H,["mdia","minf","stbl","stsd"])[0],V=G.subarray(8),Y=n(V,["enca"]),Q=Y.length>0;Q||(Y=n(V,["encv"])),Y.forEach(function(z){var X=Q?z.subarray(28):z.subarray(78),q=n(X,["sinf"]);q.forEach(function(te){var ee=m(te);if(ee){var Z=ee.subarray(8,24);Z.some(function(J){return J!==0})||(c.logger.log("[eme] Patching keyId in 'enc"+(Q?"a":"v")+">sinf>>tenc' box: "+C.default.hexDump(Z)+" -> "+C.default.hexDump(j)),ee.set(j,8))}})})})}return U}function m(U){var N=n(U,["schm"])[0];if(N){var j=L(N.subarray(4,8));if(j==="cbcs"||j==="cenc")return n(U,["schi","tenc"])[0]}return c.logger.error("[eme] missing 'schm' box"),null}function p(U,N){return n(N,["moof","traf"]).reduce(function(j,W){var H=n(W,["tfdt"])[0],G=H[0],V=n(W,["tfhd"]).reduce(function(Y,Q){var z=r(Q,4),X=U[z];if(X){var q=r(H,4);G===1&&(q*=Math.pow(2,32),q+=r(H,8));var te=X.timescale||9e4,ee=q/te;if(isFinite(ee)&&(Y===null||ee<Y))return ee}return Y},null);return V!==null&&isFinite(V)&&(j===null||V<j)?V:j},null)||0}function o(U,N){for(var j=0,W=0,H=0,G=n(U,["moof","traf"]),V=0;V<G.length;V++){var Y=G[V],Q=n(Y,["tfhd"])[0],z=r(Q,4),X=N[z];if(!!X){var q=X.default,te=r(Q,0)|(q==null?void 0:q.flags),ee=q==null?void 0:q.duration;te&8&&(te&2?ee=r(Q,12):ee=r(Q,8));for(var Z=X.timescale||9e4,J=n(Y,["trun"]),ie=0;ie<J.length;ie++){if(j=d(J[ie]),!j&&ee){var ne=r(J[ie],4);j=ee*ne}X.type===D.ElementaryStreamTypes.VIDEO?W+=j/Z:X.type===D.ElementaryStreamTypes.AUDIO&&(H+=j/Z)}}}if(W===0&&H===0){for(var ue=0,oe=n(U,["sidx"]),le=0;le<oe.length;le++){var ae=l(oe[le]);ae!=null&&ae.references&&(ue+=ae.references.reduce(function(se,de){return se+de.info.duration||0},0))}return ue}return W||H}function d(U){var N=r(U,0),j=8;N&1&&(j+=4),N&4&&(j+=4);for(var W=0,H=r(U,4),G=0;G<H;G++){if(N&256){var V=r(U,j);W+=V,j+=4}N&512&&(j+=4),N&1024&&(j+=4),N&2048&&(j+=4)}return W}function A(U,N,j){n(N,["moof","traf"]).forEach(function(W){n(W,["tfhd"]).forEach(function(H){var G=r(H,4),V=U[G];if(!!V){var Y=V.timescale||9e4;n(W,["tfdt"]).forEach(function(Q){var z=Q[0],X=r(Q,4);if(z===0)X-=j*Y,X=Math.max(X,0),v(Q,4,X);else{X*=Math.pow(2,32),X+=r(Q,8),X-=j*Y,X=Math.max(X,0);var q=Math.floor(X/(x+1)),te=Math.floor(X%(x+1));v(Q,4,q),v(Q,8,te)}})}})})}function u(U){var N={valid:null,remainder:null},j=n(U,["moof"]);if(j){if(j.length<2)return N.remainder=U,N}else return N;var W=j[j.length-1];return N.valid=(0,g.sliceUint8)(U,0,W.byteOffset-8),N.remainder=(0,g.sliceUint8)(U,W.byteOffset-8),N}function f(U,N){var j=new Uint8Array(U.length+N.length);return j.set(U),j.set(N,U.length),j}function t(U,N){var j=[],W=N.samples,H=N.timescale,G=N.id,V=!1,Y=n(W,["moof"]);return Y.map(function(Q){var z=Q.byteOffset-8,X=n(Q,["traf"]);X.map(function(q){var te=n(q,["tfdt"]).map(function(ee){var Z=ee[0],J=r(ee,4);return Z===1&&(J*=Math.pow(2,32),J+=r(ee,8)),J/H})[0];return te!==void 0&&(U=te),n(q,["tfhd"]).map(function(ee){var Z=r(ee,4),J=r(ee,0)&16777215,ie=(J&1)!==0,ne=(J&2)!==0,ue=(J&8)!==0,oe=0,le=(J&16)!==0,ae=0,se=(J&32)!==0,de=8;Z===G&&(ie&&(de+=8),ne&&(de+=4),ue&&(oe=r(ee,de),de+=4),le&&(ae=r(ee,de),de+=4),se&&(de+=4),N.type==="video"&&(V=h(N.codec)),n(q,["trun"]).map(function(fe){var ve=fe[0],ce=r(fe,0)&16777215,pe=(ce&1)!==0,xe=0,me=(ce&4)!==0,_e=(ce&256)!==0,Ee=0,re=(ce&512)!==0,Te=0,ye=(ce&1024)!==0,ge=(ce&2048)!==0,Se=0,be=r(fe,4),he=8;pe&&(xe=r(fe,he),he+=4),me&&(he+=4);for(var Le=xe+z,De=0;De<be;De++){if(_e?(Ee=r(fe,he),he+=4):Ee=oe,re?(Te=r(fe,he),he+=4):Te=ae,ye&&(he+=4),ge&&(ve===0?Se=r(fe,he):Se=_(fe,he),he+=4),N.type===D.ElementaryStreamTypes.VIDEO)for(var Oe=0;Oe<Te;){var Pe=r(W,Le);if(Le+=4,e(V,W[Le])){var Ce=W.subarray(Le,Le+Pe);y(Ce,V?2:1,U+Se/H,j)}Le+=Pe,Oe+=Pe+4}U+=Ee/H}}))})})}),j}function h(U){if(!U)return!1;var N=U.indexOf("."),j=N<0?U:U.substring(0,N);return j==="hvc1"||j==="hev1"||j==="dvh1"||j==="dvhe"}function e(U,N){if(U){var j=N>>1&63;return j===39||j===40}else{var W=N&31;return W===6}}function y(U,N,j,W){var H=P(U),G=0;G+=N;for(var V=0,Y=0,Q=!1,z=0;G<H.length;){V=0;do{if(G>=H.length)break;z=H[G++],V+=z}while(z===255);Y=0;do{if(G>=H.length)break;z=H[G++],Y+=z}while(z===255);var X=H.length-G;if(!Q&&V===4&&G<H.length){Q=!0;var q=H[G++];if(q===181){var te=I(H,G);if(G+=2,te===49){var ee=r(H,G);if(G+=4,ee===1195456820){var Z=H[G++];if(Z===3){var J=H[G++],ie=31&J,ne=64&J,ue=ne?2+ie*3:0,oe=new Uint8Array(ue);if(ne){oe[0]=J;for(var le=1;le<ue;le++)oe[le]=H[G++]}W.push({type:Z,payloadType:V,pts:j,bytes:oe})}}}}}else if(V===5&&Y<X){if(Q=!0,Y>16){for(var ae=[],se=0;se<16;se++){var de=H[G++].toString(16);ae.push(de.length==1?"0"+de:de),(se===3||se===5||se===7||se===9)&&ae.push("-")}for(var fe=Y-16,ve=new Uint8Array(fe),ce=0;ce<fe;ce++)ve[ce]=H[G++];W.push({payloadType:V,pts:j,uuid:ae.join(""),userData:(0,b.utf8ArrayToStr)(ve),userDataBytes:ve})}}else if(Y<X)G+=Y;else if(Y>X)break}}function P(U){for(var N=U.byteLength,j=[],W=1;W<N-2;)U[W]===0&&U[W+1]===0&&U[W+2]===3?(j.push(W+2),W+=2):W++;if(j.length===0)return U;var H=N-j.length,G=new Uint8Array(H),V=0;for(W=0;W<H;V++,W++)V===j[0]&&(V++,j.shift()),G[W]=U[V];return G}function S(U){var N=U[0],j="",W="",H=0,G=0,V=0,Y=0,Q=0,z=0;if(N===0){for(;L(U.subarray(z,z+1))!=="\0";)j+=L(U.subarray(z,z+1)),z+=1;for(j+=L(U.subarray(z,z+1)),z+=1;L(U.subarray(z,z+1))!=="\0";)W+=L(U.subarray(z,z+1)),z+=1;W+=L(U.subarray(z,z+1)),z+=1,H=r(U,12),G=r(U,16),Y=r(U,20),Q=r(U,24),z=28}else if(N===1){z+=4,H=r(U,z),z+=4;var X=r(U,z);z+=4;var q=r(U,z);for(z+=4,V=Math.pow(2,32)*X+q,Number.isSafeInteger(V)||(V=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Y=r(U,z),z+=4,Q=r(U,z),z+=4;L(U.subarray(z,z+1))!=="\0";)j+=L(U.subarray(z,z+1)),z+=1;for(j+=L(U.subarray(z,z+1)),z+=1;L(U.subarray(z,z+1))!=="\0";)W+=L(U.subarray(z,z+1)),z+=1;W+=L(U.subarray(z,z+1)),z+=1}var te=U.subarray(z,U.byteLength);return{schemeIdUri:j,value:W,timeScale:H,presentationTime:V,presentationTimeDelta:G,eventDuration:Y,id:Q,payload:te}}function w(U){for(var N=arguments.length,j=new Array(N>1?N-1:0),W=1;W<N;W++)j[W-1]=arguments[W];for(var H=j.length,G=8,V=H;V--;)G+=j[V].byteLength;var Y=new Uint8Array(G);for(Y[0]=G>>24&255,Y[1]=G>>16&255,Y[2]=G>>8&255,Y[3]=G&255,Y.set(U,4),V=0,G=8;V<H;V++)Y.set(j[V],G),G+=j[V].byteLength;return Y}function k(U,N,j){if(U.byteLength!==16)throw new RangeError("Invalid system id");var W,H;if(N){W=1,H=new Uint8Array(N.length*16);for(var G=0;G<N.length;G++){var V=N[G];if(V.byteLength!==16)throw new RangeError("Invalid key");H.set(V,G*16)}}else W=0,H=new Uint8Array;var Y;W>0?(Y=new Uint8Array(4),N.length>0&&new DataView(Y.buffer).setUint32(0,N.length,!1)):Y=new Uint8Array;var Q=new Uint8Array(4);return j&&j.byteLength>0&&new DataView(Q.buffer).setUint32(0,j.byteLength,!1),w([112,115,115,104],new Uint8Array([W,0,0,0]),U,Y,H,Q,j||new Uint8Array)}function F(U){if(!(U instanceof ArrayBuffer)||U.byteLength<32)return null;var N={version:0,systemId:"",kids:null,data:null},j=new DataView(U),W=j.getUint32(0);if(U.byteLength!==W&&W>44)return null;var H=j.getUint32(4);if(H!==1886614376||(N.version=j.getUint32(8)>>>24,N.version>1))return null;N.systemId=C.default.hexDump(new Uint8Array(U,12,16));var G=j.getUint32(28);if(N.version===0){if(W-32<G)return null;N.data=new Uint8Array(U,32,G)}else if(N.version===1){N.kids=[];for(var V=0;V<G;V++)N.kids.push(new Uint8Array(U,32+V*16,16))}return N}},"./src/utils/numeric-encoding-utils.ts":(O,R,s)=>{s.r(R),s.d(R,{base64Decode:()=>x,base64DecodeToStr:()=>b,base64Encode:()=>c,base64ToBase64Url:()=>D,base64UrlEncode:()=>C,strToBase64Encode:()=>g});function D(E){return E.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function g(E){return btoa(E)}function b(E){return atob(E)}function c(E){return btoa(String.fromCharCode.apply(String,E))}function C(E){return D(c(E))}function x(E){return Uint8Array.from(atob(E),function(T){return T.charCodeAt(0)})}},"./src/utils/output-filter.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>D});var D=function(){function g(c,C){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=c,this.trackName=C}var b=g.prototype;return b.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(C,x,E){(this.startTime===null||this.startTime>C)&&(this.startTime=C),this.endTime=x,this.screen=E,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[],this.startTime=null},g}()},"./src/utils/texttrack-utils.ts":(O,R,s)=>{s.r(R),s.d(R,{addCueToTrack:()=>b,clearCurrentCues:()=>c,getCuesInRange:()=>E,removeCuesInRange:()=>C,sendAddTrackEvent:()=>g});var D=s("./src/utils/logger.ts");function g(T,L){var I;try{I=new Event("addtrack")}catch(r){I=document.createEvent("Event"),I.initEvent("addtrack",!1,!1)}I.track=T,L.dispatchEvent(I)}function b(T,L){var I=T.mode;if(I==="disabled"&&(T.mode="hidden"),T.cues&&!T.cues.getCueById(L.id))try{if(T.addCue(L),!T.cues.getCueById(L.id))throw new Error("addCue is failed for: "+L)}catch(_){D.logger.debug("[texttrack-utils]: "+_);var r=new self.TextTrackCue(L.startTime,L.endTime,L.text);r.id=L.id,T.addCue(r)}I==="disabled"&&(T.mode=I)}function c(T){var L=T.mode;if(L==="disabled"&&(T.mode="hidden"),T.cues)for(var I=T.cues.length;I--;)T.removeCue(T.cues[I]);L==="disabled"&&(T.mode=L)}function C(T,L,I,r){var _=T.mode;if(_==="disabled"&&(T.mode="hidden"),T.cues&&T.cues.length>0)for(var v=E(T.cues,L,I),n=0;n<v.length;n++)(!r||r(v[n]))&&T.removeCue(v[n]);_==="disabled"&&(T.mode=_)}function x(T,L){if(L<T[0].startTime)return 0;var I=T.length-1;if(L>T[I].endTime)return-1;for(var r=0,_=I;r<=_;){var v=Math.floor((_+r)/2);if(L<T[v].startTime)_=v-1;else if(L>T[v].startTime&&r<I)r=v+1;else return v}return T[r].startTime-L<L-T[_].startTime?r:_}function E(T,L,I){var r=[],_=x(T,L);if(_>-1)for(var v=_,n=T.length;v<n;v++){var l=T[v];if(l.startTime>=L&&l.endTime<=I)r.push(l);else if(l.startTime>I)return r}return r}},"./src/utils/time-ranges.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>g});var D={toString:function(c){for(var C="",x=c.length,E=0;E<x;E++)C+="["+c.start(E).toFixed(3)+"-"+c.end(E).toFixed(3)+"]";return C}};const g=D},"./src/utils/timescale-conversion.ts":(O,R,s)=>{s.r(R),s.d(R,{toMpegTsClockFromTimescale:()=>C,toMsFromMpegTsClock:()=>c,toTimescaleFromBase:()=>g,toTimescaleFromScale:()=>b});var D=9e4;function g(x,E,T,L){T===void 0&&(T=1),L===void 0&&(L=!1);var I=x*E*T;return L?Math.round(I):I}function b(x,E,T,L){return T===void 0&&(T=1),L===void 0&&(L=!1),g(x,E,1/T,L)}function c(x,E){return E===void 0&&(E=!1),g(x,1e3,1/D,E)}function C(x,E){return E===void 0&&(E=1),g(x,D,1/E)}},"./src/utils/typed-array.ts":(O,R,s)=>{s.r(R),s.d(R,{sliceUint8:()=>D});function D(g,b,c){return Uint8Array.prototype.slice?g.slice(b,c):new Uint8Array(Array.prototype.slice.call(g,b,c))}},"./src/utils/vttcue.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>D});const D=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var g=["","lr","rl"],b=["start","middle","end","left","right"];function c(L,I){if(typeof I!="string"||!Array.isArray(L))return!1;var r=I.toLowerCase();return~L.indexOf(r)?r:!1}function C(L){return c(g,L)}function x(L){return c(b,L)}function E(L){for(var I=arguments.length,r=new Array(I>1?I-1:0),_=1;_<I;_++)r[_-1]=arguments[_];for(var v=1;v<arguments.length;v++){var n=arguments[v];for(var l in n)L[l]=n[l]}return L}function T(L,I,r){var _=this,v={enumerable:!0};_.hasBeenReset=!1;var n="",l=!1,i=L,a=I,m=r,p=null,o="",d=!0,A="auto",u="start",f=50,t="middle",h=50,e="middle";Object.defineProperty(_,"id",E({},v,{get:function(){return n},set:function(P){n=""+P}})),Object.defineProperty(_,"pauseOnExit",E({},v,{get:function(){return l},set:function(P){l=!!P}})),Object.defineProperty(_,"startTime",E({},v,{get:function(){return i},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");i=P,this.hasBeenReset=!0}})),Object.defineProperty(_,"endTime",E({},v,{get:function(){return a},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");a=P,this.hasBeenReset=!0}})),Object.defineProperty(_,"text",E({},v,{get:function(){return m},set:function(P){m=""+P,this.hasBeenReset=!0}})),Object.defineProperty(_,"region",E({},v,{get:function(){return p},set:function(P){p=P,this.hasBeenReset=!0}})),Object.defineProperty(_,"vertical",E({},v,{get:function(){return o},set:function(P){var S=C(P);if(S===!1)throw new SyntaxError("An invalid or illegal string was specified.");o=S,this.hasBeenReset=!0}})),Object.defineProperty(_,"snapToLines",E({},v,{get:function(){return d},set:function(P){d=!!P,this.hasBeenReset=!0}})),Object.defineProperty(_,"line",E({},v,{get:function(){return A},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");A=P,this.hasBeenReset=!0}})),Object.defineProperty(_,"lineAlign",E({},v,{get:function(){return u},set:function(P){var S=x(P);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");u=S,this.hasBeenReset=!0}})),Object.defineProperty(_,"position",E({},v,{get:function(){return f},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");f=P,this.hasBeenReset=!0}})),Object.defineProperty(_,"positionAlign",E({},v,{get:function(){return t},set:function(P){var S=x(P);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");t=S,this.hasBeenReset=!0}})),Object.defineProperty(_,"size",E({},v,{get:function(){return h},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");h=P,this.hasBeenReset=!0}})),Object.defineProperty(_,"align",E({},v,{get:function(){return e},set:function(P){var S=x(P);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");e=S,this.hasBeenReset=!0}})),_.displayState=void 0}return T.prototype.getCueAsHTML=function(){var L=self.WebVTT;return L.convertCueToDOMTree(self,this.text)},T}()},"./src/utils/vttparser.ts":(O,R,s)=>{s.r(R),s.d(R,{VTTParser:()=>I,fixLineBreaks:()=>L,parseTimeStamp:()=>b});var D=s("./src/utils/vttcue.ts"),g=function(){function r(){}var _=r.prototype;return _.decode=function(n,l){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},r}();function b(r){function _(n,l,i,a){return(n|0)*3600+(l|0)*60+(i|0)+parseFloat(a||0)}var v=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return v?parseFloat(v[2])>59?_(v[2],v[3],0,v[4]):_(v[1],v[2],v[3],v[4]):null}var c=function(){function r(){this.values=Object.create(null)}var _=r.prototype;return _.set=function(n,l){!this.get(n)&&l!==""&&(this.values[n]=l)},_.get=function(n,l,i){return i?this.has(n)?this.values[n]:l[i]:this.has(n)?this.values[n]:l},_.has=function(n){return n in this.values},_.alt=function(n,l,i){for(var a=0;a<i.length;++a)if(l===i[a]){this.set(n,l);break}},_.integer=function(n,l){/^-?\d+$/.test(l)&&this.set(n,parseInt(l,10))},_.percent=function(n,l){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(l)){var i=parseFloat(l);if(i>=0&&i<=100)return this.set(n,i),!0}return!1},r}();function C(r,_,v,n){var l=n?r.split(n):[r];for(var i in l)if(typeof l[i]=="string"){var a=l[i].split(v);if(a.length===2){var m=a[0],p=a[1];_(m,p)}}}var x=new D.default(0,0,""),E=x.align==="middle"?"middle":"center";function T(r,_,v){var n=r;function l(){var m=b(r);if(m===null)throw new Error("Malformed timestamp: "+n);return r=r.replace(/^[^\sa-zA-Z-]+/,""),m}function i(m,p){var o=new c;C(m,function(u,f){var t;switch(u){case"region":for(var h=v.length-1;h>=0;h--)if(v[h].id===f){o.set(u,v[h].region);break}break;case"vertical":o.alt(u,f,["rl","lr"]);break;case"line":t=f.split(","),o.integer(u,t[0]),o.percent(u,t[0])&&o.set("snapToLines",!1),o.alt(u,t[0],["auto"]),t.length===2&&o.alt("lineAlign",t[1],["start",E,"end"]);break;case"position":t=f.split(","),o.percent(u,t[0]),t.length===2&&o.alt("positionAlign",t[1],["start",E,"end","line-left","line-right","auto"]);break;case"size":o.percent(u,f);break;case"align":o.alt(u,f,["start",E,"end","left","right"]);break}},/:/,/\s/),p.region=o.get("region",null),p.vertical=o.get("vertical","");var d=o.get("line","auto");d==="auto"&&x.line===-1&&(d=-1),p.line=d,p.lineAlign=o.get("lineAlign","start"),p.snapToLines=o.get("snapToLines",!0),p.size=o.get("size",100),p.align=o.get("align",E);var A=o.get("position","auto");A==="auto"&&x.position===50&&(A=p.align==="start"||p.align==="left"?0:p.align==="end"||p.align==="right"?100:50),p.position=A}function a(){r=r.replace(/^\s+/,"")}if(a(),_.startTime=l(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);r=r.slice(3),a(),_.endTime=l(),a(),i(r,_)}function L(r){return r.replace(/<br(?: \/)?>/gi,`
`)}var I=function(){function r(){this.state="INITIAL",this.buffer="",this.decoder=new g,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var _=r.prototype;return _.parse=function(n){var l=this;n&&(l.buffer+=l.decoder.decode(n,{stream:!0}));function i(){var A=l.buffer,u=0;for(A=L(A);u<A.length&&A[u]!=="\r"&&A[u]!==`
`;)++u;var f=A.slice(0,u);return A[u]==="\r"&&++u,A[u]===`
`&&++u,l.buffer=A.slice(u),f}function a(A){C(A,function(u,f){},/:/)}try{var m="";if(l.state==="INITIAL"){if(!/\r\n|\n/.test(l.buffer))return this;m=i();var p=m.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!p||!p[0])throw new Error("Malformed WebVTT signature.");l.state="HEADER"}for(var o=!1;l.buffer;){if(!/\r\n|\n/.test(l.buffer))return this;switch(o?o=!1:m=i(),l.state){case"HEADER":/:/.test(m)?a(m):m||(l.state="ID");continue;case"NOTE":m||(l.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(m)){l.state="NOTE";break}if(!m)continue;if(l.cue=new D.default(0,0,""),l.state="CUE",m.indexOf("-->")===-1){l.cue.id=m;continue}case"CUE":if(!l.cue){l.state="BADCUE";continue}try{T(m,l.cue,l.regionList)}catch(A){l.cue=null,l.state="BADCUE";continue}l.state="CUETEXT";continue;case"CUETEXT":{var d=m.indexOf("-->")!==-1;if(!m||d&&(o=!0)){l.oncue&&l.cue&&l.oncue(l.cue),l.cue=null,l.state="ID";continue}if(l.cue===null)continue;l.cue.text&&(l.cue.text+=`
`),l.cue.text+=m}continue;case"BADCUE":m||(l.state="ID")}}}catch(A){l.state==="CUETEXT"&&l.cue&&l.oncue&&l.oncue(l.cue),l.cue=null,l.state=l.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},_.flush=function(){var n=this;try{if((n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL"||n.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(l){n.onparsingerror&&n.onparsingerror(l)}return n.onflush&&n.onflush(),this},r}()},"./src/utils/webvtt-parser.ts":(O,R,s)=>{s.r(R),s.d(R,{generateCueId:()=>I,parseWebVTT:()=>_});var D=s("./src/polyfills/number.ts"),g=s("./src/utils/vttparser.ts"),b=s("./src/demux/id3.ts"),c=s("./src/utils/timescale-conversion.ts"),C=s("./src/remux/mp4-remuxer.ts"),x=/\r\n|\n\r|\n|\r/g,E=function(n,l,i){return i===void 0&&(i=0),n.slice(i,i+l.length)===l},T=function(n){var l=parseInt(n.slice(-3)),i=parseInt(n.slice(-6,-4)),a=parseInt(n.slice(-9,-7)),m=n.length>9?parseInt(n.substring(0,n.indexOf(":"))):0;if(!(0,D.isFiniteNumber)(l)||!(0,D.isFiniteNumber)(i)||!(0,D.isFiniteNumber)(a)||!(0,D.isFiniteNumber)(m))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+n);return l+=1e3*i,l+=60*1e3*a,l+=60*60*1e3*m,l},L=function(n){for(var l=5381,i=n.length;i;)l=l*33^n.charCodeAt(--i);return(l>>>0).toString()};function I(v,n,l){return L(v.toString())+L(n.toString())+L(l)}var r=function(n,l,i){var a=n[l],m=n[a.prevCC];if(!m||!m.new&&a.new){n.ccOffset=n.presentationOffset=a.start,a.new=!1;return}for(;(p=m)!==null&&p!==void 0&&p.new;){var p;n.ccOffset+=a.start-m.start,a.new=!1,a=m,m=n[a.prevCC]}n.presentationOffset=i};function _(v,n,l,i,a,m,p,o){var d=new g.VTTParser,A=(0,b.utf8ArrayToStr)(new Uint8Array(v)).trim().replace(x,`
`).split(`
`),u=[],f=(0,c.toMpegTsClockFromTimescale)(n,l),t="00:00.000",h=0,e=0,y,P=!0;d.oncue=function(S){var w=i[a],k=i.ccOffset,F=(h-f)/9e4;w!=null&&w.new&&(e!==void 0?k=i.ccOffset=w.start:r(i,a,F)),F&&(k=F-i.presentationOffset);var U=S.endTime-S.startTime,N=(0,C.normalizePts)((S.startTime+k-e)*9e4,m*9e4)/9e4;S.startTime=Math.max(N,0),S.endTime=Math.max(N+U,0);var j=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(j)),S.id||(S.id=I(S.startTime,S.endTime,j)),S.endTime>0&&u.push(S)},d.onparsingerror=function(S){y=S},d.onflush=function(){if(y){o(y);return}p(u)},A.forEach(function(S){if(P)if(E(S,"X-TIMESTAMP-MAP=")){P=!1,S.slice(16).split(",").forEach(function(w){E(w,"LOCAL:")?t=w.slice(6):E(w,"MPEGTS:")&&(h=parseInt(w.slice(7)))});try{e=T(t)/1e3}catch(w){y=w}return}else S===""&&(P=!1);d.parse(S+`
`)}),d.flush()}},"./src/utils/xhr-loader.ts":(O,R,s)=>{s.r(R),s.d(R,{default:()=>C});var D=s("./src/utils/logger.ts"),g=s("./src/loader/load-stats.ts"),b=/^age:\s*[\d.]+\s*$/m,c=function(){function x(T){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=T?T.xhrSetup:null,this.stats=new g.LoadStats,this.retryDelay=0}var E=x.prototype;return E.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},E.abortInternal=function(){var L=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),L&&(L.onreadystatechange=null,L.onprogress=null,L.readyState!==4&&(this.stats.aborted=!0,L.abort()))},E.abort=function(){var L;this.abortInternal(),(L=this.callbacks)!==null&&L!==void 0&&L.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},E.load=function(L,I,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=L,this.config=I,this.callbacks=r,this.retryDelay=I.retryDelay,this.loadInternal()},E.loadInternal=function(){var L=this.config,I=this.context;if(!!L){var r=this.loader=new self.XMLHttpRequest,_=this.stats;_.loading.first=0,_.loaded=0;var v=this.xhrSetup;try{if(v)try{v(r,I.url)}catch(i){r.open("GET",I.url,!0),v(r,I.url)}r.readyState||r.open("GET",I.url,!0);var n=this.context.headers;if(n)for(var l in n)r.setRequestHeader(l,n[l])}catch(i){this.callbacks.onError({code:r.status,text:i.message},I,r);return}I.rangeEnd&&r.setRequestHeader("Range","bytes="+I.rangeStart+"-"+(I.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=I.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),L.timeout),r.send()}},E.readystatechange=function(){var L=this.context,I=this.loader,r=this.stats;if(!(!L||!I)){var _=I.readyState,v=this.config;if(!r.aborted&&_>=2)if(self.clearTimeout(this.requestTimeout),r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start)),_===4){I.onreadystatechange=null,I.onprogress=null;var n=I.status,l=I.responseType==="arraybuffer";if(n>=200&&n<300&&(l&&I.response||I.responseText!==null)){r.loading.end=Math.max(self.performance.now(),r.loading.first);var i,a;if(l?(i=I.response,a=i.byteLength):(i=I.responseText,a=i.length),r.loaded=r.total=a,!this.callbacks)return;var m=this.callbacks.onProgress;if(m&&m(r,L,i,I),!this.callbacks)return;var p={url:I.responseURL,data:i};this.callbacks.onSuccess(p,r,L,I)}else r.retry>=v.maxRetry||n>=400&&n<499?(D.logger.error(n+" while loading "+L.url),this.callbacks.onError({code:n,text:I.statusText},L,I)):(D.logger.warn(n+" while loading "+L.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,v.maxRetryDelay),r.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),v.timeout)}},E.loadtimeout=function(){D.logger.warn("timeout while loading "+this.context.url);var L=this.callbacks;L&&(this.abortInternal(),L.onTimeout(this.stats,this.context,this.loader))},E.loadprogress=function(L){var I=this.stats;I.loaded=L.loaded,L.lengthComputable&&(I.total=L.total)},E.getCacheAge=function(){var L=null;if(this.loader&&b.test(this.loader.getAllResponseHeaders())){var I=this.loader.getResponseHeader("age");L=I?parseFloat(I):null}return L},x}();const C=c},"./node_modules/eventemitter3/index.js":O=>{var R=Object.prototype.hasOwnProperty,s="~";function D(){}Object.create&&(D.prototype=Object.create(null),new D().__proto__||(s=!1));function g(x,E,T){this.fn=x,this.context=E,this.once=T||!1}function b(x,E,T,L,I){if(typeof T!="function")throw new TypeError("The listener must be a function");var r=new g(T,L||x,I),_=s?s+E:E;return x._events[_]?x._events[_].fn?x._events[_]=[x._events[_],r]:x._events[_].push(r):(x._events[_]=r,x._eventsCount++),x}function c(x,E){--x._eventsCount===0?x._events=new D:delete x._events[E]}function C(){this._events=new D,this._eventsCount=0}C.prototype.eventNames=function(){var E=[],T,L;if(this._eventsCount===0)return E;for(L in T=this._events)R.call(T,L)&&E.push(s?L.slice(1):L);return Object.getOwnPropertySymbols?E.concat(Object.getOwnPropertySymbols(T)):E},C.prototype.listeners=function(E){var T=s?s+E:E,L=this._events[T];if(!L)return[];if(L.fn)return[L.fn];for(var I=0,r=L.length,_=new Array(r);I<r;I++)_[I]=L[I].fn;return _},C.prototype.listenerCount=function(E){var T=s?s+E:E,L=this._events[T];return L?L.fn?1:L.length:0},C.prototype.emit=function(E,T,L,I,r,_){var v=s?s+E:E;if(!this._events[v])return!1;var n=this._events[v],l=arguments.length,i,a;if(n.fn){switch(n.once&&this.removeListener(E,n.fn,void 0,!0),l){case 1:return n.fn.call(n.context),!0;case 2:return n.fn.call(n.context,T),!0;case 3:return n.fn.call(n.context,T,L),!0;case 4:return n.fn.call(n.context,T,L,I),!0;case 5:return n.fn.call(n.context,T,L,I,r),!0;case 6:return n.fn.call(n.context,T,L,I,r,_),!0}for(a=1,i=new Array(l-1);a<l;a++)i[a-1]=arguments[a];n.fn.apply(n.context,i)}else{var m=n.length,p;for(a=0;a<m;a++)switch(n[a].once&&this.removeListener(E,n[a].fn,void 0,!0),l){case 1:n[a].fn.call(n[a].context);break;case 2:n[a].fn.call(n[a].context,T);break;case 3:n[a].fn.call(n[a].context,T,L);break;case 4:n[a].fn.call(n[a].context,T,L,I);break;default:if(!i)for(p=1,i=new Array(l-1);p<l;p++)i[p-1]=arguments[p];n[a].fn.apply(n[a].context,i)}}return!0},C.prototype.on=function(E,T,L){return b(this,E,T,L,!1)},C.prototype.once=function(E,T,L){return b(this,E,T,L,!0)},C.prototype.removeListener=function(E,T,L,I){var r=s?s+E:E;if(!this._events[r])return this;if(!T)return c(this,r),this;var _=this._events[r];if(_.fn)_.fn===T&&(!I||_.once)&&(!L||_.context===L)&&c(this,r);else{for(var v=0,n=[],l=_.length;v<l;v++)(_[v].fn!==T||I&&!_[v].once||L&&_[v].context!==L)&&n.push(_[v]);n.length?this._events[r]=n.length===1?n[0]:n:c(this,r)}return this},C.prototype.removeAllListeners=function(E){var T;return E?(T=s?s+E:E,this._events[T]&&c(this,T)):(this._events=new D,this._eventsCount=0),this},C.prototype.off=C.prototype.removeListener,C.prototype.addListener=C.prototype.on,C.prefixed=s,C.EventEmitter=C,O.exports=C},"./node_modules/url-toolkit/src/url-toolkit.js":function(O){(function(R){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,D=/^(?=([^\/?#]*))\1([^]*)$/,g=/(?:\/|^)\.(?=\/)/g,b=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(C,x,E){if(E=E||{},C=C.trim(),x=x.trim(),!x){if(!E.alwaysNormalize)return C;var T=c.parseURL(C);if(!T)throw new Error("Error trying to parse base URL.");return T.path=c.normalizePath(T.path),c.buildURLFromParts(T)}var L=c.parseURL(x);if(!L)throw new Error("Error trying to parse relative URL.");if(L.scheme)return E.alwaysNormalize?(L.path=c.normalizePath(L.path),c.buildURLFromParts(L)):x;var I=c.parseURL(C);if(!I)throw new Error("Error trying to parse base URL.");if(!I.netLoc&&I.path&&I.path[0]!=="/"){var r=D.exec(I.path);I.netLoc=r[1],I.path=r[2]}I.netLoc&&!I.path&&(I.path="/");var _={scheme:I.scheme,netLoc:L.netLoc,path:null,params:L.params,query:L.query,fragment:L.fragment};if(!L.netLoc&&(_.netLoc=I.netLoc,L.path[0]!=="/"))if(!L.path)_.path=I.path,L.params||(_.params=I.params,L.query||(_.query=I.query));else{var v=I.path,n=v.substring(0,v.lastIndexOf("/")+1)+L.path;_.path=c.normalizePath(n)}return _.path===null&&(_.path=E.alwaysNormalize?c.normalizePath(L.path):L.path),c.buildURLFromParts(_)},parseURL:function(C){var x=s.exec(C);return x?{scheme:x[1]||"",netLoc:x[2]||"",path:x[3]||"",params:x[4]||"",query:x[5]||"",fragment:x[6]||""}:null},normalizePath:function(C){for(C=C.split("").reverse().join("").replace(g,"");C.length!==(C=C.replace(b,"")).length;);return C.split("").reverse().join("")},buildURLFromParts:function(C){return C.scheme+C.netLoc+C.path+C.params+C.query+C.fragment}};O.exports=c})()}},$={};function K(O){var R=$[O];if(R!==void 0)return R.exports;var s=$[O]={exports:{}};return B[O].call(s.exports,s,s.exports,K),s.exports}K.m=B,K.n=O=>{var R=O&&O.__esModule?()=>O.default:()=>O;return K.d(R,{a:R}),R},K.d=(O,R)=>{for(var s in R)K.o(R,s)&&!K.o(O,s)&&Object.defineProperty(O,s,{enumerable:!0,get:R[s]})},K.o=(O,R)=>Object.prototype.hasOwnProperty.call(O,R),K.r=O=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})};var M=K("./src/hls.ts");return M=M.default,M})())})(Ye);const st=Ue(Ye.exports);export{nt as A,st as H,at as a};
